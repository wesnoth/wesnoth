[scenario]
	id=Crossroads
	textdomain=wesnoth-httt
	name= _ "Crossroads"
	map_data="{maps/Heir_To_The_Throne/Crossroads}"
	{TURNS 42 36 30}

	next_scenario=The_Princess_of_Wesnoth

	objectives= _ "
Victory:
@Defeat Kojun Herolm
Defeat:
#Death of Konrad
#Death of Delfador
#Death of Kalenz"

	{BIGMAP_CROSSROADS}

	{DAWN}
	{MORNING}
	{AFTERNOON}
	{DUSK}
	{FIRST_WATCH}
	{SECOND_WATCH}

	[side]
	type=Commander
	description=Konrad
	unrenamable=1
	side=1
	canrecruit=1
	controller=human
	hitpoints=80
	gold=100
	[/side]

#define CROSSROADS_AI_PARAMS
		[ai]
		caution=1.0
		aggression=0.3
		[/ai]
		[ai]
		time_of_day=dusk
		turns=8-100
		caution=0.25
		aggression=0.6
		[/ai]
		[ai]
		time_of_day=first_watch,second_watch
		caution=0.0
		aggression=1.0
		grouping=no
		[/ai]
#enddef

	[side]
	type=Orcish Warrior
	description=Mokho Kimer
	experience=0
	side=2
	controller=ai
	canrecruit=1
	recruit=Orcish Grunt,Wolf Rider,Orcish Archer,Troll Whelp
	{GOLD 120 180 300}
	team_name=orcs
	{CROSSROADS_AI_PARAMS}
	[/side]

	[side]
	type=Orcish Warlord
	description=Kojun Herolm
	experience=0
	side=3
	controller=ai
	canrecruit=1
	recruit=Orcish Grunt,Wolf Rider,Orcish Archer,Troll Whelp
	{GOLD 100 200 300}
	team_name=orcs
	{CROSSROADS_AI_PARAMS}
	[/side]

	#signs at the crossroads for decoration
	[item]
	x,y=14,17
	image=items/signpost.png
	[/item]

	[event]
	name=start
		[recall]
		description=Delfador
		[/recall]
		[recall]
		description=Kalenz
		[/recall]
		[message]
		description=Delfador
		message= _ "Here we come to the great cross-roads. We should go north-east."
		[/message]
		[message]
		description=Kalenz
		message= _ "Beware! These hills are not safe! The roads are important to Asheviere's strategy, and she has hired Orcs to guard them. We shall have to fight to travel them."
		[/message]
		[message]
		description=Konrad
		message= _ "Then fight we shall. Let it begin!"
		[/message]
	[/event]

	[event]
	name=die
		[filter]
		description=Kojun Herolm
		[/filter]
		[endlevel]
		result=victory
		bonus=yes
		[/endlevel]
	[/event]

	[event]
	name=victory
		[message]
		description=Konrad
		message= _ "Victory is ours, men. Let us proceed north-east!"
		[/message]
	[/event]

	[event]
	name=moveto
		[filter]
		side=1
		x,y=13,29
		[/filter]
		[move_unit_fake]
		type=Elvish Archer
		x=11,12,12,12,12,12
		y=24,24,25,26,27,28
		[/move_unit_fake]
		[unit]
		side=1
		type=Elvish Archer
		description=Niodien
		x,y=12,28
		[/unit]
		[message]
		description=Niodien
		message= _ "Stay on the path! The hills here are not safe!"
		[/message]
	[/event]

	[event]
	name=moveto
		[filter]
		side=1
		x,y=3,26
		[/filter]
		[move_unit_fake]
		type=Elvish Fighter
		x=2,2,2,2,2
		y=21,22,23,24,25
		[/move_unit_fake]
		[unit]
		side=1
		type=Elvish Fighter
		description=Loflar
		x,y=2,25
		[/unit]
		[message]
		description=Loflar
		message= _ "Beware the hills! There are many Orcs in hiding, preparing to ambush you!"
		[/message]
	[/event]
	
#define TRAP1 NUM
	{RANDOM $random_string}
	{VARIABLE_OP trapx{NUM} to_variable possible_ambush_locations[$random].x}
	{VARIABLE_OP trapy{NUM} to_variable possible_ambush_locations[$random].y}
	[event]
	name=moveto
		[filter]
		side=1
		x=$trapx{NUM}
		y=$trapy{NUM}
		[/filter]
		[unit]
		side=2
		x=$trapx{NUM}
		y=$trapy{NUM}
		type=Orcish Archer
		[/unit]
		[unit]
		side=2
		x=$trapx{NUM}
		y=$trapy{NUM}
		type=Orcish Archer
		[/unit]
		[unit]
		side=2
		x=$trapx{NUM}
		y=$trapy{NUM}
		type=Orcish Grunt
		[/unit]
		[print]
		text=_"Ambushed!"
		red,green,blue=255,0,0
		size=32
		[/print]
	[/event]
	[event]
	name=victory
		{CLEAR_VARIABLE trapx{NUM}}
		{CLEAR_VARIABLE trapy{NUM}}
	[/event]
#enddef

#define TRAP2 NUM
	{RANDOM $random_string}
	{VARIABLE_OP trapx{NUM} to_variable possible_ambush_locations[$random].x}
	{VARIABLE_OP trapy{NUM} to_variable possible_ambush_locations[$random].y}
	[event]
	name=moveto
		[filter]
		side=1
		x=$trapx{NUM}
		y=$trapy{NUM}
		[/filter]
		[unit]
		side=3
		x=$trapx{NUM}
		y=$trapy{NUM}
		type=Wolf Rider
		[/unit]
		[unit]
		side=3
		x=$trapx{NUM}
		y=$trapy{NUM}
		type=Troll Whelp
		[/unit]
		[unit]
		side=3
		x=$trapx{NUM}
		y=$trapy{NUM}
		type=Troll Whelp
		[/unit]
		[unit]
		side=3
		x=$trapx{NUM}
		y=$trapy{NUM}
		type=Orcish Archer
		[/unit]
		[print]
		text=_"Ambushed!"
		red,green,blue=255,0,0
		size=32
		[/print]
	[/event]
	[event]
	name=victory
		{CLEAR_VARIABLE trapx{NUM}}
		{CLEAR_VARIABLE trapy{NUM}}
	[/event]
#enddef
	
	[event]
	name=start
		[store_locations]
		x=1-32,14-39
		y=9-25,17-30
		terrain=hv
		variable=possible_ambush_locations
		[/store_locations]
		{VARIABLE_OP last_possibility to_variable possible_ambush_locations.length}
		{VARIABLE_OP last_possibility add -1}
		{VARIABLE_OP random_string format 0..$last_possibility}
		
		#26 ambushes total
		{TRAP1 0}
		{TRAP2 1}
		{TRAP1 2}
		{TRAP2 3}
		{TRAP1 4}
		{TRAP2 5}
		{TRAP1 6}
		{TRAP2 7}
		{TRAP1 8}
		{TRAP2 9}
		{TRAP1 10}
		{TRAP2 11}
		{TRAP1 12}
		{TRAP2 13}
		{TRAP1 14}
		{TRAP2 15}
		{TRAP1 16}
		{TRAP2 17}
		{TRAP1 18}
		{TRAP2 19}
		{TRAP1 20}
		{TRAP2 21}
		{TRAP1 22}
		{TRAP2 23}
		{TRAP1 24}
		{TRAP2 25}
		{CLEAR_VARIABLE possible_ambush_locations}
	[/event]

{scenarios/Heir_To_The_Throne/deaths.cfg}

[/scenario]
