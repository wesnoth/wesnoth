[scenario]
	id=Evacuation
	textdomain=wesnoth-ei
	name= _ "Evacuation"
	map_data="{maps/Eastern_Invasion/Evacuation}"
	turns=12
	next_scenario=The_Drowned_Plains

	{DAWN}
	{MORNING}
	{AFTERNOON}
	{DUSK}
	{FIRST_WATCH}
	{SECOND_WATCH}

	music="wesnoth-2.ogg"

	objectives= _ "
Victory:
@Get everyone possible across the river
@Destroy the bridge (everyone left on the wrong side of the river will die, including everyone left on your recall list)
Defeat:
#Death of Gweddry or leaving him on the river's north side
#Death of Dacyn or leaving him on the river's north side
#Death of Owaec or leaving him on the river's north side"

	{scenarios/Eastern_Invasion/deaths.cfg}

	[story]
		[part]
			background=campaigns/Eastern_Invasion/maps/eastern_invasion.png
			show_title=yes
			{DOT 280 160}
			{CROSS 260 130}
		[/part]
	[/story]

	[side]
	type=Lieutenant
	description=Gweddry
	side=1
	canrecruit=1
	controller=human
	[/side]
	
	[side]
	type=Orcish Warlord
	description=Varrak-Klar
	side=2
	canrecruit=1
	controller=ai
	recruit=Orcish Warrior,Goblin Knight,Direwolf Rider
	{GOLD 100 150 200}
	{INCOME 100 120 140}
	team_name=bad
	[/side]
	
	[side]
	type=Troll Warrior
	description=Unhk
	side=3
	canrecruit=1
	controller=ai
	recruit=Troll,Troll Warrior,Goblin Pillager
	{GOLD 100 150 200}
	{INCOME 80 100 120}
	team_name=bad
	[/side]

	[side]
	type=Orcish Warlord
	description=Ran-Lar
	side=4
	canrecruit=1
	controller=ai
	recruit=Orcish Crossbowman,Orcish Slayer,Orcish Warrior
	{GOLD 150 200 300}
	{INCOME 120 140 160}
	team_name=bad	
	[/side]
	[event]
	name=prestart
		[recall]
		description=Dacyn
		[/recall]
		[recall]
		description=Owaec
		[/recall]
		#recall the two people you got in captured
		[recall]
		description=Ranged
		[/recall]
		[recall]
		description=Melee
		[/recall]
	[/event]

	[event]
	name=start
		#create a mage with a special description
		[unit]
		description=Engineer
		type=Mage
		x,y=18,5
		side=1
		[/unit]
		[message]
		description=Dacyn
		message= _ "All is lost! We have to get out of the Northlands as quickly as possible! Run for your - what the...?!? Who are you?"
		[/message]
		[message]
		description=Engineer
		message= _ "I'm an enginea'. I s'pect you'll have a need of me services. I bet you're gonna want me to blow up that bridge ov'r theah."
		[/message]
		[message]
		description=Owaec
		message= _ "Why would we want to do that?!?"
		[/message]
		[message]
		description=Engineer
		message= _ "Well, I see those orcs are chasin' you, and if I blow up the bridge, they can't get across. It'll help you escape."
		[/message]
		[message]
		description=Dacyn
		message= _ "Gweddry, he's actually right... we have to hire him. How much?"
		[/message]
		[message]
		description=Engineer
		message= _ "Fifty gold pieces."
		[/message]
		[message]
		description=Gweddry
		message= _ "Very well, but you only get it once the bridge is down."
		[/message]
		[message]
		description=Engineer
		message= _ "Deal. I c'n blow'er up once I get to that signpost ov'r 'ere. That's where my eq'pment is."
		[/message]
		[message]
		description=Dacyn
		message= _ "All right, now everyone across the bridge! Anyone left on this side when the bridge is exploded will be left to their own devices!"
		[/message]
		[item]
		image=items/signpost.png
		x,y=8,20
		[/item]
	[/event]
	
	[event]
	name=moveto
	first_time_only=no
		[filter]
		x,y=8,20
		description=Engineer
		[/filter]
		[message]
		description=Engineer
		message= _ "So, d'ya want me to blow up der bridge yet, Cap'n?"
		[/message]
		[message]
		description=Gweddry
		message= _ "Hm..."
			[option]
			message= _ "Yes, blow it up."
				[command]
				[message]
				description=Engineer
				message= _ "I believe you owe me some money first."
				[/message]
				[message]
				description=Gweddry
				message= _ "Here it is. Now blow up the bridge!"
				[/message]
				[store_gold]
				side=1
				variable=gold
				[/store_gold]
				[if]
					[variable]
					name=gold
					greater_than=49
					[/variable]
					[then]
						[message]
						description=Engineer
						message= _ "Alright! Blast'n time!"
						[/message]
						[gold]
						amount=-50
						[/gold]
						[sound]
						name=gunshot.wav
						[/sound]
						[delay]
						time=200
						[/delay]
						[sound]
						name=gunshot.wav
						[/sound]
						[delay]
						time=200
						[/delay]
						[sound]
						name=gunshot.wav
						[/sound]
						[delay]
						time=500
						[/delay]
						[sound]
						name=fire.wav
						[/sound]
						[message]
						speaker=narrator
						message= _ "BOOM!!!"
						[/message]
						[terrain]
						x=8
						y=16-19
						letter=c
						[/terrain]
						[if]
							[have_unit]
							description=Gweddry
							x=1-31,1-20
							y=21-24,18-20
							[/have_unit]
							[else]
								[message]
								description=Gweddry
								message= _ "Oops... I'm north of the bridge! That was bad planning on my part."
								[/message]
								[endlevel]
								result=defeat
								[/endlevel]
							[/else]
						[/if]
						[if]
							[have_unit] 
							description=Dacyn
							x=1-31,1-20
							y=21-24,18-20
							[/have_unit]
							[else]
								[message]
								description=Dacyn 
								message= _ "You idiot! You left me north of the bridge!"
								[/message]
								[endlevel]
								result=defeat
								[/endlevel]
							[/else]
						[/if]
						[if]
							[have_unit]
							description=Owaec
							x=1-31,1-20
							y=21-24,18-20
							[/have_unit]
							[else]
								[message]
								description=Owaec
								message= _ "I'm still north of the bridge, Gweddry! Why'd you blow it up!?!"
								[/message]
								[endlevel]
								result=defeat
								[/endlevel]
							[/else]
						[/if]
						[kill]
						x=0-31
						y=0-20
						side=1
						fire_event=yes
						animate=yes
						[/kill]
						[message]
						description=Gweddry
						message= _ "Good, we have escaped from these orcs. Now we have to go south. I think the undead probably aren't as numerous this far west, so we won't get immediately killed, anyway."
						[/message]
						[message]
						description=Engineer
						message= _ "I ain't goin' to be going with yah. Best o' luck t'yah!"
						[/message]
						[kill]
						description=Engineer
						[/kill]
						[endlevel]
						result=victory
						bonus=yes
						[/endlevel]
					[/then]
					[else]
						[message]
						description=Engineer
						message="Ya can't afford it. Try again later."
						[/message]
					[/else]
					{CLEAR_VARIABLE gold}
				[/if]
				[/command]
			[/option]
			[option]
			message= _ "No, wait until later."
				[command]
				[message]
				description=Engineer
				message= _ "Neh? Alright then, we'll wait fa' later, eh?"
				[/message]
				[/command]
			[/option]
		[/message]
	[/event] 
   
	[event]
	name=time over
		[message]
		description=Dacyn
		message= _ "We have not thrown down the bridge in time! The orcs will kill us all!"
		[/message]
	[/event]

	[event]
	name=enemies defeated
		[message]
		description=Dacyn
		message= _ "Well, we didn't have to blow up the bridge after all, but we still have to go south. Hopefully the Undead are not as numerous this far west."
		[/message]
		[message]
		description=Engineer
		message= _ "What? Y'got no need a me se'vices? I quit!"
		[/message]
		[kill]
		description=Engineer
		[/kill]
	[/event]
[/scenario]
