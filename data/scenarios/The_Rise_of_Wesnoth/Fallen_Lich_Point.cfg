[scenario]
	id=Fallen_Lich_Point
	textdomain=wesnoth-trow
	name= _ "Fallen Lich Point"
	map_data="{maps/The_Rise_of_Wesnoth/Fallen_Lich_Point}"
	turns=36

	{DAWN}
	{MORNING}
	{AFTERNOON}
	{DUSK}
	{FIRST_WATCH}
	{SECOND_WATCH}

	next_scenario=Sewer
	victory_when_enemies_defeated=no
	
	music=wesnoth-4.ogg

	objectives= _ "
Victory:
@Kill the Lich's to get his Book and
@Enter Southbay's Sewer
@Kill All Enemy Leaders to Get the Bonus
Defeat:
#Death of Prince Haldric or
#Death of Lady Jessica or
#Turns run out"

	{scenarios/The_Rise_of_Wesnoth/trow-deaths.cfg}
	{scenarios/The_Rise_of_Wesnoth/trow-macros.cfg}

	[story]
		[part]
			background=maps/the_green_isle.png
			show_title=yes
			{DOT 376 341}
			{DOT 386 346}
			{DOT 396 351}
			{DOT 411 356}
			{DOT 428 359}
			{DOT 446 361}
			{DOT 461 366}
			{DOT 476 371}
			{DOT 471 386}
			{DOT 466 396}
			{DOT 453 406}
			{DOT 441 416}
			{DOT 426 426}
			{DOT 406 431}
			{DOT 391 431}
			{DOT 371 431}
			{DOT 356 431}
			{DOT 341 431}
			{DOT 326 426}
			{DOT 311 426}
			{DOT 296 426}
			{DOT 281 431}
			{DOT 271 436}
			{DOT 256 436}
			{CROSS 236 437}
		[/part]
	[/story]

	
	[side]
		type=Noble Commander
		description=Prince Haldric
		side=1
		canrecruit=1
		controller=human
		team_name=Haldric
	[/side]
	
	[side]
		type=Orcish Warlord
		description=Ut'Tan-Grilg
		side=2
		canrecruit=1
#ifdef EASY
		recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman
#endif

#ifdef NORMAL	
		recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Knight, Orcish Slayer, Goblin Spearman
#endif

#ifdef HARD
		recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Orcish Warrior, Goblin Knight, Goblin Pillager, Orcish Slayer, Goblin Spearman, Goblin Impaler
#endif
		{GOLD 210 250 310}
		team_name=orcs
		[ai]
			{NO_SCOUTS}
			recruitment_pattern=scout,fighter,fighter,archer
			{ATTACK_DEPTH 4 5 6} 
		[/ai]
		[ai]
			time_of_day=first_watch,second_watch 
			aggression=0.75
			caution=0.0
			grouping=no
		[/ai]
	[/side]
	
	[side]
		type=Orcish Warlord
		description=Tan-Pulk
		side=3
		canrecruit=1
#ifdef EASY
		recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Spearman
#endif

#ifdef NORMAL	
		recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Orcish Warrior, Goblin Pillager, Goblin Spearman
#endif

#ifdef HARD
		recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Orcish Warrior, Goblin Knight, Goblin Pillager, Orcish Slayer, Goblin Spearman, Goblin Impaler
#endif

		{GOLD 210 250 310}
		team_name=orcs
		[ai]
			{NO_SCOUTS}
			recruitment_pattern=scout,fighter,fighter,archer
			{ATTACK_DEPTH 4 5 6}
		[/ai]
		[ai]
			time_of_day=first_watch,second_watch 
			aggression=0.75
			caution=0.0
			grouping=no
		[/ai]
	[/side]

#define TURNED_TO_STONE
	[status]
		stone=on
	[/status]
#enddef

	[side]
		type=Demilich
		description=Lich-Lord Caror
		side=4
		canrecruit=1
		recruit=Skeleton, Skeleton Archer, Ghost, Ghoul, Walking Corpse
		{GOLD 120 150 210}
		team_name=undead
		[ai]
			aggression=1.0
			recruitment_ignore_bad_movement=yes
			recruitment_pattern=scout,fighter,fighter,archer
			{ATTACK_DEPTH 4 5 6}
		[/ai]
		{TURNED_TO_STONE}
		{NO_SCOUTS}
	[/side]

	[event]
	name=prestart

		{STARTING_VILLAGES 2 8}
		{STARTING_VILLAGES 3 6}

		{PUT_IMG (items/signpost.png) 25 1}
		{PUT_IMG (items/signpost.png) 14 8}
		{PUT_IMG (items/monolith4.png) 14 30}
		{PUT_IMG (terrain/mine.png) 15 9}
		
#define STONE_SHOOTER X Y
		[unit]
			side=4
			type=Bone Shooter
			x={X}
			y={Y}
			[status]
				stone=on
			[/status]
		[/unit]
#enddef

#define STONE_WARRIOR X Y
		[unit]
			side=4
			type=Revenant
			x={X}
			y={Y}
			[status]
				stone=on
			[/status]
		[/unit]
#enddef
		{STONE_SHOOTER 12 35}
		{STONE_SHOOTER 13 37}
		{STONE_SHOOTER 11 37}
		{STONE_WARRIOR 13 36}
		{STONE_WARRIOR 12 37}
		{STONE_WARRIOR 11 36}

		[set_variable]
			name=lich_free
			value=0
		[/set_variable]
		[set_variable]
			name=have_book
			value=0
		[/set_variable]

		[hide_unit]
			x=33
			y=24
		[/hide_unit]
	[/event]

	[event]
	name=start
		[message]
			id=msgT8_1
			speaker=Tan-Pulk
			message= _ "Da big bosses said we'd be in da city by winter. Bosses wrong, stinky humans still there, and I'm a tinkin- -"
		[/message]
		[message]
			id=msgT8_2
			speaker=Ut'Tan-Grilg
			message= _ "Wait! I see a ship! Humans is coming! Smash 'em good!"
		[/message]
		
		[move_unit_fake]
			type=Transport Galleon
			x=35,34,33,33,34,34
			y=30,29,29,28,27,26
		[/move_unit_fake]
		
		{PUT_IMG (pirate-galleon.png) 34 26}
		
		[unhide_unit]
			x=33
			y=24
		[/unhide_unit]
		
		[message]
			id=msgT8_3
			speaker=narrator
			message= _ "Prince Haldric has arrived at Fallen Lich Point, to retrieve the Lich's Book, and flee into the Sewers of Southbay."
		[/message]
		
		[recall]
			description=Lady Jessica
		[/recall]
		[recall]
			description=Burin the Lost
		[/recall]
		[recall]
			description=Sir Ruddry
		[/recall]
		
		[recall]
			description=Sir Ladoc
		[/recall]
		
		[recall]
			description=Minister Edmond
		[/recall]
		
		[message]
			id=msgT8_4
			description=Prince Haldric
			message= _ "Okay. Let's unstone that Lich and get his book, then get into the sewers. Ummm, what language would that book be in?"
		[/message]
		[message]
			id=msgT8_5
			description=Lady Jessica
			message= _ "Some pep talk. The book will probably be in the Old Wesfolk tongue."
		[/message]
		[message]
			id=msgT8_6
			description=Prince Haldric
			message= _ "Ohhh."
		[/message]
		[message]
			id=msgT8_7
			description=Lady Jessica
			message= _ "Just get the book, I think I should be able to translate it."
		[/message]
		[message]
			id=msgT8_8
			description=Prince Haldric
			message= _ "Then into Southbay's sewer."
		[/message]
		[message]
			id=msgT8_9
			description=Lady Jessica
			message= _ "Right."
		[/message]
	[/event]
	
	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=14
			y=30
		[/filter]
		[message]
			id=msgT8_10
			speaker=narrator
			message= _ "INSCRIPTION: This monolith was erected by me, <CHIPPED AWAY>, first Mage of the good people of the Green Isle. By it's power the Lich is bound in stone. To end the spell a noble of the line of Kings should utter the following. . ."
		[/message]
		
		[if]
		
		[variable]
			name=lich_free
			numerical_equals=0
		[/variable]
		
		[then]
			
			[if]
				[have_unit]
					description=Prince Haldric
					x=14
					y=30
				[/have_unit]

				[then]
					[message]
					id=msgT8_10a
						description=Prince Haldric
						message= _ "Hmm... after some thought. . ."
			
						[option]
							id=phrase_now
							message= _ "I think I'll say that magic phrase."
							
							[command]
							[set_variable]
								name=lich_free
								value=1
							[/set_variable]
							[unstone]
							[/unstone]
							[message]
								id=msgT8_11a
								description=Prince Haldric
								message= _ "The Lich is free! Let's bash him and grab that book. That sounds like a job for you, Lady Jessica!"
							[/message]
							[message]
								id=msgT8_11b
								description=Lady Jessica
								message= _ "Hmph! You're just happy because that monolith proves your paternity!"
							[/message]
							[message]
								id=msgT8_11c
								description=Lich-Lord Caror
								message= _ "Free, I'm free, and I feel the Ruby of Fire! It will be mine."
							[/message]
							[message]
								id=msgT8_11d
								description=Minister Edmond
								message= _ "No you won't you soldier of darkness!"
							[/message]
							[/command]
						[/option]
						
						[option]
						id=phrase_later
						message= _ "I think I'll wait a while before uttering any magic phrases."
						
						[command]
							[message]
								id=msgT8_11e
								description=Prince Haldric
								message= _ "We have more pressing matters to deal with before we free that Lich."
							[/message]
							
							[message]
								id=msgT8_11f
								description=Lady Jessica
								message= _ "Afraid you'll find out you're not of the line of Kings?"
							[/message]
						[/command]
						[/option]
					[/message]
				[/then]
					
				[else]
					[message]
						id=msgT8_12
						speaker=narrator
						message= _ "This sounds like a job for Prince Haldric, hopefully."
					[/message]
				[/else]
			[/if]
		[/then]
		
		[else]
			[message]
				id=msgT8_13
				speaker=narrator
				message= _ "The Lich-Lord is already free."
			[/message]
		[/else]
		
		[/if]
	[/event]
	
	[event]
		name=moveto
		[filter]
			side=1
			x=25
			y=1
		[/filter]
		[message]
			id=msgT8_14
			speaker=narrator
			message= _ "NW - Southbay."
		[/message]
		[message]
			id=msgT8_15
			speaker=unit
			message= _ "More Like NW - Every Orc on the Isle. Hmph!"
		[/message]
	[/event]
	
	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=15
			y=9
		[/filter]
		
		[if]
			[have_unit]
				description=Prince Haldric
				x=15
				y=9
			[/have_unit]
			
			[then]
		
				[if]
		
				[variable]
					name=have_book
					numerical_equals=1
				[/variable]
				[then]
					[message]
						id=msgT8_16
						description=Prince Haldric
						message= _ "We have the book, let's get out of here!"
					[/message]
							
					[message]
						id=msgT8_17
						description=Lady Jessica
						message= _ "Sounds good to me."
					[/message]
					
					[if]
		
						[variable]
							name=Killed_an_Orc
							numerical_equals=1
						[/variable]
						
						[then]
							[endlevel]
								bonus=yes
								result=victory
							[/endlevel]
						[/then]
					
						[else]
							[endlevel]
								bonus=no
								result=victory
							[/endlevel]
						[/else]
					[/if]

				[/then]
			
				[else]
					[message]
						id=msgT8_18
						description=Prince Haldric
						message= _ "I seem to be forgetting something. Ohhh, the book!"
					[/message]
				[/else]
				[/if]
			[/then]
			
			[else]
				[message]
					id=msgT8_19
					speaker=narrator
					message= _ "Prince Haldric must be the first into the sewers of Southbay."
				[/message]
			
			[/else]
		[/if]
	[/event]

	[event]
		name=moveto
		[filter]
			x=15-27
			y=16-25
		[/filter]
		[move_unit_fake]
			type=Yeti
			x=13,13,13,12,11,10,9,9,9,10,11,11,11,12,12
			y=1,2,3,3,4,4,5,6,7,7,8,9,10,10,11
		[/move_unit_fake]

		{UNIT (Yeti) (Rarlg) 4 12 11}

		[message]
			id=msgT8_20
			description=Rarlg
			message= _ "Rarlg - argh, a raul-rarlg!"
		[/message]
		[message]
			id=msgT8_21
			description=Prince Haldric
			message= _ "Oh my!"
		[/message]
		[message]
			id=msgT8_22
			description=Ut'Tan-Grilg
			message= _ "Oh my!"
		[/message]
		[message]
			id=msgT8_23
			description=Tan-Pulk
			message= _ "Oh my!"
		[/message]
		[message]
			id=msgT8_24
			description=Lady Jessica
			message= _ "And he brought a friend."
		[/message]

		[scroll_to_unit]
			description=Rarlg
		[/scroll_to_unit]

		{UNIT (Yeti) (Raul-Rarlg) 4 15 11}
	[/event]

	[event]
		name=die
		[filter]
			description=Lich-Lord Caror
		[/filter]

		[message]
			id=msgT8_25
			description=Lich-Lord Caror
			message= _ "So close. So close."
		[/message]

		[message]
			id=msgT8_26
			speaker=second_unit
			message= _ "I found the book in what was left of his robes! Let's get out of here!"
		[/message]

		[set_variable]
			name=have_book
			value=1
		[/set_variable]
	[/event]
	
	
	[event]
		name=die
		[filter]
			description=Tan-Pulk
		[/filter]

		[filter_second]
			side=1
		[/filter_second]

		[set_variable]
			name=Killed_an_Orc
			value=1
		[/set_variable]
	[/event]
	
	[event]
		name=die
		[filter]
			description=Ut'Tan-Grilg
		[/filter]

		[filter_second]
			side=1
		[/filter_second]

		[set_variable]
			name=Killed_an_Orc
			value=1
		[/set_variable]
	[/event]

	[event]
		name=victory
		
		{CLEAR_VARIABLE have_book}
		{CLEAR_VARIABLE lich_free}
		{CLEAR_VARIABLE Killed_an_Orc}
	[/event]

	[event]
		name=time over
		[message]
			id=msgT8_27
			description=Prince Haldric
			message= _ "I can hear their re-enforcements coming! We're trapped! All is lost!"
		[/message]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x=14
			y=8
		[/filter]
		[message]
			id=msgT8_28
			speaker=narrator
			message= _ "Sewer - Danger Keep Out!"
		[/message]
	[/event]

[/scenario]
