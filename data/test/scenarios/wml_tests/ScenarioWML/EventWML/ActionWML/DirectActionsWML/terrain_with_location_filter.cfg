# wmllint: no translatables

#####
# API(s) being tested: [terrain]
##
# Actions:
# Use [terrain] to remove all overlays (as the entire map has a ^Kov overlay)
# Use [terrain] to change any castle that's not adjacent to a keep into cave
##
# Expected end state:
# 14 hexes are transformed to cave
#####
{GENERIC_UNIT_TEST "terrain_with_location_filter" (
    [event]
        name = start

        # The entire map has a ^Kov overlay, which at least needs commenting on,
        # so it might as well be removed before the main part of the test.
        [terrain]
            layer=overlay
            terrain=^
        [/terrain]

        # Rather than taking a subtag for a Standard Location Filter, [terrain] is an SLF,
        # except for the terrain= attribute, which is removed first. It's documented on
        # the Wiki that [and]terrain= can be used for filtering the affected hexes.
        [terrain]
            terrain=Uu
            [and]
                terrain=C*
            [/and]
            [not]
                terrain=K*
                radius=1
            [/not]
        [/terrain]

        {ASSERT (
            [have_location]
                count=2
                terrain=K*
            [/have_location]
        )}

        {ASSERT (
            [have_location]
                count=2
                terrain=C*
            [/have_location]
        )}

        {ASSERT (
            [have_location]
                count=14
                terrain=Uu
            [/have_location]
        )}

        {SUCCEED}
    [/event]
)}
