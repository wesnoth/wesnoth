#wmllint: no translatables

#define INITIAL_VARIABLES
    [variables]
        [test_include]
            name=foo
        [/test_include]
        [test_include]
            name=bar
        [/test_include]
        [test_include]
            name=baz
        [/test_include]
        [test]
            value=92
            [tag]
                core=main
            [/tag]
            [tag]
                core=alt
            [/tag]
        [/test]
        [test]
            value=21
            [tag]
                core=original
            [/tag]
            [tag]
                core=revised
            [/tag]
        [/test]
        [test]
            value=87
            [tag]
                core=left
            [/tag]
            [tag]
                core=right
            [/tag]
        [/test]
        [test]
            value=46
            [tag]
                core=top
            [/tag]
            [tag]
                core=bottom
            [/tag]
        [/test]
        [test]
            value=102
            [insert_tag]
                name=redo
                variable=test_include
            [/insert_tag]
        [/test]
    [/variables]
#enddef

#define SET_VARIABLES_TEST ID LOGIC
    {GENERIC_UNIT_TEST "set_variables_{ID}" (
        {INITIAL_VARIABLES}
        [event]
            name=turn 1
            {LOGIC}
            {SUCCEED}
        [/event]
        [event]
            name=turn 1
            {FAIL}
        [/event]
    )}
#enddef

#####
# API(s) being tested: [variables]
##
# Expected end state:
# Variables are set to the specified initial values
#####
{SET_VARIABLES_TEST init (
    {ASSERT ({VARIABLE_CONDITIONAL test_include[0].name equals foo})}
    {ASSERT ({VARIABLE_CONDITIONAL test_include[1].name equals bar})}
    {ASSERT ({VARIABLE_CONDITIONAL test_include[2].name equals baz})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].value equals 92})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[0].core equals main})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[1].core equals alt})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].value equals 21})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[0].core equals original})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[1].core equals revised})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].value equals 87})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[0].core equals left})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[1].core equals right})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].value equals 46})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[0].core equals top})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[1].core equals bottom})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].value equals 102})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.name equals redo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.variable equals test_include})}
)}

#####
# API(s) being tested: [set_variables][value]
##
# Expected end state:
# Variables are correctly set
#####
{SET_VARIABLES_TEST value (
    [set_variables]
        name=test_var
        [value]
            value=one
            turn=$turn_number
        [/value]
        [value]
            value=two
            side=$side_number
        [/value]
        [value]
            [insert_tag]
                name=include
                variable=test_include
            [/insert_tag]
        [/value]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].value equals one})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].turn equals 1})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[1].value equals two})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[1].side equals 1})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[2].include[0].name equals foo})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[2].include[1].name equals bar})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[2].include[2].name equals baz})}
)}

#####
# API(s) being tested: [set_variables][literal]
##
# Expected end state:
# Variables are correctly set
#####
{SET_VARIABLES_TEST literal (
    [set_variables]
        name=test_var
        [literal]
            value=one
            turn=$turn_number
        [/literal]
        [literal]
            value=two
            side=$side_number
        [/literal]
        [literal]
            [insert_tag]
                name=include
                variable=test_include
            [/insert_tag]
        [/literal]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].value equals one})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].turn equals "$|turn_number"})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[1].value equals two})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[1].side equals "$|side_number"})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[2].insert_tag.name equals include})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[2].insert_tag.variable equals test_include})}
)}

#####
# API(s) being tested: [set_variables][split]
##
# Expected end state:
# Variables are correctly set
#####
{SET_VARIABLES_TEST split_explode (
    [set_variables]
        name=test_var
        [split]
            list="Hello World!"
            key=char
        [/split]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].char equals H})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[1].char equals e})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[2].char equals l})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[3].char equals l})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[4].char equals o})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[5].char equals " "})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[6].char equals W})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[7].char equals o})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[8].char equals r})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[9].char equals l})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[10].char equals d})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[11].char equals "!"})}
)}

#####
# API(s) being tested: [set_variables][split]separator=
##
# Expected end state:
# Variables are correctly set
#####
{SET_VARIABLES_TEST split_sep (
    [set_variables]
        name=test_var
        [split]
            list="one,two,,three"
            key="words"
            separator=","
            remove_empty=yes
        [/split]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].words equals one})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[1].words equals two})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[2].words equals three})}
)}

#####
# API(s) being tested: [set_variables] mixed
##
# Expected end state:
# Variables are correctly set
#####
{SET_VARIABLES_TEST mixed (
    [set_variables]
        name=test_var
        [value]
            value="$turn_number"
            [tag]
                something=here
            [/tag]
            [tag]
                nothing=there
            [/tag]
            [insert_tag]
                name=include
                variable=test_include
            [/insert_tag]
        [/value]
        [split]
            list="one,two,,three"
            key="words"
            separator=","
            remove_empty=yes
        [/split]
        [literal]
            value="$turn_number"
            [tag]
                nothing=here
            [/tag]
            [insert_tag]
                name=include
                variable=test_include
            [/insert_tag]
        [/literal]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].value equals 1})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].tag[0].something equals here})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].tag[1].nothing equals there})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].include[0].name equals foo})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].include[1].name equals bar})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].include[2].name equals baz})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].insert_tag.name blank yes})} # insert_tag substituted in [value]
    {ASSERT ({VARIABLE_CONDITIONAL test_var[0].insert_tag.variable blank yes})} # insert_tag substituted in [value]
    {ASSERT ({VARIABLE_CONDITIONAL test_var[1].words equals one})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[2].words equals two})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[3].words equals three})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[4].value equals "$|turn_number"})} # $turn_number not substituted in [literal]
    {ASSERT ({VARIABLE_CONDITIONAL test_var[4].tag.nothing equals here})}
    {ASSERT ({VARIABLE_CONDITIONAL test_var[4].insert_tag.name equals include})} # insert_tag not substituted in [literal]
    {ASSERT ({VARIABLE_CONDITIONAL test_var[4].insert_tag.variable equals test_include})} # insert_tag not substituted in [literal]
)}

#####
# API(s) being tested: [set_variables]move=replace
##
# Expected end state:
# Variables are properly replaced
#####
{SET_VARIABLES_TEST replace (
    [set_variables]
        name=test
        mode=replace
        [value]
            replace=yes
            value=42
            [tag]
                name=foo
            [/tag]
        [/value]
        [value]
            nothing=here
            [tag]
                name=bar
            [/tag]
        [/value]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test[0].value equals 42})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].replace equals yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[0].name equals foo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[0].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[1].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].nothing equals here})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].value blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[0].name equals bar})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[0].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[1].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].value blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[0].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[1].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].value blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[0].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[1].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].value blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.name blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.variable blank yes})}
)}

#####
# API(s) being tested: [set_variables]mode=replace with explicit index
##
# Expected end state:
# Variables are properly replaced
#####
{SET_VARIABLES_TEST replace_explicit (
    [set_variables]
        name=test[2]
        mode=replace
        [value]
            replace=yes
            value=42
            [tag]
                name=foo
            [/tag]
        [/value]
        [value]
            nothing=here
            [tag]
                name=bar
            [/tag]
        [/value]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test[0].value equals 92})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[0].core equals main})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[1].core equals alt})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].value equals 21})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[0].core equals original})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[1].core equals revised})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].value equals 42})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].replace equals yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag.name equals foo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[0].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[1].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].nothing equals here})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag.name equals bar})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].value blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[0].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[1].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].value equals 46})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].tag[0].core equals top})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].tag[1].core equals bottom})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].value equals 102})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].insert_tag.name equals redo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].insert_tag.variable equals test_include})}
)}

#####
# API(s) being tested: [set_variables]mode=insert
##
# Expected end state:
# Variables are properly inserted
#####
{SET_VARIABLES_TEST insert (
    [set_variables]
        name=test
        mode=insert
        [value]
            value=42
            insert=yes
            [tag]
                name=foo
            [/tag]
        [/value]
        [value]
            something=there
            [tag]
                name=bar
            [/tag]
        [/value]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test[0].value equals 42})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].insert equals yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag.name equals foo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].something equals there})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag.name equals bar})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].value equals 92})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[0].core equals main})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[1].core equals alt})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].value equals 21})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[0].core equals original})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[1].core equals revised})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].value equals 87})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].tag[0].core equals left})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].tag[1].core equals right})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].value equals 46})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].tag[0].core equals top})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].tag[1].core equals bottom})}
    {ASSERT ({VARIABLE_CONDITIONAL test[6].value equals 102})}
    {ASSERT ({VARIABLE_CONDITIONAL test[6].insert_tag.name equals redo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[6].insert_tag.variable equals test_include})}
)}

#####
# API(s) being tested: [set_variables]mode=insert with explicit index
##
# Expected end state:
# Variables are properly inserted
#####
{SET_VARIABLES_TEST insert_explicit (
    [set_variables]
        name=test[2]
        mode=insert
        [value]
            value=42
            insert=yes
            [tag]
                name=foo
            [/tag]
        [/value]
        [value]
            something=there
            [tag]
                name=bar
            [/tag]
        [/value]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test[0].value equals 92})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[0].core equals main})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[1].core equals alt})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].value equals 21})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[0].core equals original})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[1].core equals revised})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].value equals 42})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].insert equals yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag.name equals foo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].something equals there})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag.name equals bar})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].value equals 87})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].tag[0].core equals left})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].tag[1].core equals right})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].value equals 46})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].tag[0].core equals top})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].tag[1].core equals bottom})}
    {ASSERT ({VARIABLE_CONDITIONAL test[6].value equals 102})}
    {ASSERT ({VARIABLE_CONDITIONAL test[6].insert_tag.name equals redo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[6].insert_tag.variable equals test_include})}
)}

#####
# API(s) being tested: [set_variables]mode=merge
##
# Expected end state:
# Variables are properly merged
#####
{SET_VARIABLES_TEST merge (
    [set_variables]
        name=test
        mode=merge
        [value]
            value=12
            [tag]
                __remove=yes
            [/tag]
            [tag]
            [/tag]
            [tag]
                core=splinter
            [/tag]
        [/value]
        [value]
            value=4096
            [tag]
                name=foo
            [/tag]
        [/value]
        [value]
        [/value]
        [value]
        [/value]
        [value]
            value=9
            [tag]
                name=bar
            [/tag]
        [/value]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test[0].value equals 12})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[0].core equals alt})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[1].core equals splinter})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[1].core equals splinter})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].value equals 4096})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[0].core equals original})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[0].name equals foo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[1].core equals revised})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].value equals 87})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[0].core equals left})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[1].core equals right})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].value equals 46})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[0].core equals top})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[1].core equals bottom})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].value equals 9})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.name equals redo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.variable equals test_include})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].tag[0].name equals bar})}
)}

#####
# API(s) being tested: [set_variables]mode=merge with explicit index
##
# Expected end state:
# Variables are properly merged
#####
{SET_VARIABLES_TEST merge_explicit (
    [set_variables]
        name=test[2]
        mode=merge
        [value]
            value=12
            [tag]
                __remove=yes
            [/tag]
            [tag]
            [/tag]
            [tag]
                core=splinter
            [/tag]
        [/value]
        [value]
            square=4096
            [tag]
                name=foo
            [/tag]
        [/value]
        [value]
            test=9
            [tag]
                name=bar
            [/tag]
        [/value]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test[0].value equals 92})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[0].core equals main})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[1].core equals alt})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].value equals 21})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[0].core equals original})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[1].core equals revised})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].value equals 12})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].square equals 4096})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].test equals 9})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[0].core equals right})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[1].core equals splinter})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[2].name equals foo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[3].name equals bar})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].value equals 46})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[0].core equals top})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[1].core equals bottom})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].value equals 102})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.name equals redo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.variable equals test_include})}
)}

#####
# API(s) being tested: [set_variables]mode=append
##
# Expected end state:
# Variables are properly appended
#####
{SET_VARIABLES_TEST append (
    [set_variables]
        name=test
        mode=append
        [value]
            name=moo
            value=42
            [tag]
                name=foo
            [/tag]
        [/value]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test[0].value equals 92})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[0].core equals main})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[1].core equals alt})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].value equals 21})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[0].core equals original})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[1].core equals revised})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].value equals 87})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[0].core equals left})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[1].core equals right})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].value equals 46})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[0].core equals top})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[1].core equals bottom})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].value equals 102})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.name equals redo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.variable equals test_include})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].value equals 42})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].name equals moo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].tag.name equals foo})}
)}

#####
# API(s) being tested: [set_variables]mode=append with explicit index
##
# Expected end state:
# Variables are properly appended
# Note: This is identical to mode=append, as append mode ignores the explicit index
#####
{SET_VARIABLES_TEST append_explicit (
    [set_variables]
        name=test[2]
        mode=append
        [value]
            name=moo
            value=42
            [tag]
                name=foo
            [/tag]
        [/value]
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test[0].value equals 92})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[0].core equals main})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[1].core equals alt})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].value equals 21})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[0].core equals original})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[1].core equals revised})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].value equals 87})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[0].core equals left})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[1].core equals right})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].value equals 46})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[0].core equals top})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[1].core equals bottom})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].value equals 102})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.name equals redo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.variable equals test_include})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].value equals 42})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].name equals moo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[5].tag.name equals foo})}
)}

#####
# API(s) being tested: [set_variables]to_variable=
##
# Expected end state:
# Variables are properly cloned
#####
{SET_VARIABLES_TEST to_variable (
    [set_variables]
        name=test
        to_variable=test_include
    [/set_variables]
    {ASSERT ({VARIABLE_CONDITIONAL test[0].name equals foo})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].name equals bar})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].name equals baz})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].value blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[0].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[0].tag[1].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].value blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[0].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[1].tag[1].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].value blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[0].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[2].tag[1].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].value blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[0].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[3].tag[1].core blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].value blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.name blank yes})}
    {ASSERT ({VARIABLE_CONDITIONAL test[4].insert_tag.variable blank yes})}
)}

#####
# API(s) being tested: [modify_unit][set_variables]
##
# Expected end state:
# Variables are correctly set
#####
{GENERIC_UNIT_TEST set_variables_unit (
    {INITIAL_VARIABLES}
    [event]
        name=start
        [modify_unit]
            [filter]
                side=1
                canrecruit=yes
            [/filter]
            [set_variables]
                name=test_var
                [value]
                    value="$turn_number"
                    [tag]
                        something=here
                    [/tag]
                    [tag]
                        nothing=there
                    [/tag]
                    [insert_tag]
                        name=include
                        variable=test_include
                    [/insert_tag]
                [/value]
                [split]
                    list="one,two,,three"
                    key="words"
                    separator=","
                    remove_empty=yes
                [/split]
                [literal]
                    value="$turn_number"
                    [tag]
                        nothing=here
                    [/tag]
                    [insert_tag]
                        name=include
                        variable=test_include
                    [/insert_tag]
                [/literal]
            [/set_variables]
        [/modify_unit]
        [store_unit]
            [filter]
                side=1
                canrecruit=yes
            [/filter]
            variable=test_unit
        [/store_unit]
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[0].value equals 1})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[0].tag[0].something equals here})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[0].tag[1].nothing equals there})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[0].include[0].name equals foo})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[0].include[1].name equals bar})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[0].include[2].name equals baz})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[0].insert_tag.name blank yes})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[0].insert_tag.variable blank yes})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[1].words equals one})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[2].words equals two})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[3].words equals three})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[4].value equals "$|turn_number"})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[4].tag.nothing equals here})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[4].insert_tag.name equals include})}
        {ASSERT ({VARIABLE_CONDITIONAL test_unit.variables.test_var[4].insert_tag.variable equals test_include})}

        {SUCCEED}
    [/event]
)}

#####
# API(s) being tested: [modify_side][set_variables]
##
# Expected end state:
# Variables are correctly set
#####
{GENERIC_UNIT_TEST set_variables_side (
    {INITIAL_VARIABLES}
    [event]
        name=start
        [modify_side]
            [filter_side]
                side=1
            [/filter_side]
            [set_variables]
                name=test_var
                [value]
                    value="$turn_number"
                    [tag]
                        something=here
                    [/tag]
                    [tag]
                        nothing=there
                    [/tag]
                    [insert_tag]
                        name=include
                        variable=test_include
                    [/insert_tag]
                [/value]
                [split]
                    list="one,two,,three"
                    key="words"
                    separator=","
                    remove_empty=yes
                [/split]
                [literal]
                    value="$turn_number"
                    [tag]
                        nothing=here
                    [/tag]
                    [insert_tag]
                        name=include
                        variable=test_include
                    [/insert_tag]
                [/literal]
            [/set_variables]
        [/modify_side]
        [store_side]
            side=1
            variable=test_side
        [/store_side]
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[0].value equals 1})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[0].tag[0].something equals here})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[0].tag[1].nothing equals there})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[0].include[0].name equals foo})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[0].include[1].name equals bar})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[0].include[2].name equals baz})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[0].insert_tag.name blank yes})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[0].insert_tag.variable blank yes})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[1].words equals one})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[2].words equals two})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[3].words equals three})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[4].value equals "$|turn_number"})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[4].tag.nothing equals here})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[4].insert_tag.name equals include})}
        {ASSERT ({VARIABLE_CONDITIONAL test_side.variables.test_var[4].insert_tag.variable equals test_include})}

        {SUCCEED}
    [/event]
)}
