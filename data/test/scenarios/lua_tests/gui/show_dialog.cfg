
{GENERIC_UNIT_TEST "lua_gui_show_dialog" (
    [event]
        name = prestart
        [lua]
            code=<<
                T = wml.tag

                function _G.do_nothing() end

                _G.delay_dialog = {
                  T.tooltip { id = "tooltip_large" },
                  T.helptip { id = "tooltip_large" },
                  T.grid { T.row {
                    T.column { T.grid {
                      T.row { T.column { T.grid {
                        T.row {
                            T.column {
                                T.button { id = "ok", label = "I have seen my leader now" }
                            }
                        }
                      } } }
                    } },
                    T.column { T.image { id = "the_image" } }
                  } }
                }


                -- correct: delay_dialog[3][2][1][2][1][2][1][2][1][2][1][2][1][2]
                if true then
                table.insert(delay_dialog[3][2][1][2][1][2][1][2][1][2][1][2], T.row {
                    T.column {
                        T.label { id = "other", label = "other" }
                    }
                })
                end

                -- this exits the scenario if lua_jailbreak_exception is not cleared
                gui.show_dialog(_G.delay_dialog, do_nothing, do_nothing)
                -- instead, we want it to stop executing this tag, but then continue the scenario

                -- should not reach this
                unit_test.fail()
            >>
        [/lua]
    [/event]
    [event]
        name = start
        [endlevel]
            result=victory
        [/endlevel]
    [/event]
)}
