# Simple MP_RANDOM macros
#
#  MP_RANDOM_NORMAL_INIT within the scenario to create a random seed
#
#  MP_RANDOM $value to generate a number between 1..$value
# 
# MP_RANDOM_INDEX $value generates a number between 0..$value-1

#define MP_RANDOM_HP_INIT
	[store_unit]
	[filter]
	[/filter]
	variable=all_units
	[/store_unit]
	{VARIABLE total_hp 0}
	{FOREACH all_units r_i}
	  {VARIABLE coord 97}
	  {VARIABLE_OP coord add $all_units[$r_i].x}
	  {VARIABLE_OP coord add -$all_units[$r_i].y}
	  {VARIABLE_OP coord add $all_units[$r_i].movement}
	  {VARIABLE_OP coord modulo 14}
	  {VARIABLE_OP coord add 1}
		{VARIABLE r_temp $all_units[$r_i].hitpoints}
		{VARIABLE factor 1}
		[while]
		  [variable]
		    name=coord
		    greater_than=1
		  [/variable]
		  [do]
		    {VARIABLE_OP factor multiply 2}
		    {VARIABLE_OP coord add -1}
		  [/do]
		[/while]
		{VARIABLE_OP r_temp multiply $factor}
		{VARIABLE_OP total_hp add $r_temp}
	{NEXT r_i}
	{VARIABLE seed $total_hp}
	{CLEAR_VARIABLE r_temp}
	{CLEAR_VARIABLE all_units}
#enddef

#define MP_RANDOM_NORMAL_INIT
   [event]
     name=turn 2
     {MP_RANDOM_HP_INIT}
   [/event]
#enddef

#define MP_ADJUST_SEED
{VARIABLE_OP seed add 777781}
{VARIABLE factor $seed}
{VARIABLE_OP factor modulo 3}
{VARIABLE_OP factor add 1}
{VARIABLE_OP seed multiply $factor}
{VARIABLE_OP seed add 99991}
{VARIABLE factor $seed}
{VARIABLE_OP factor modulo 3}
{VARIABLE_OP factor add 1}
[while]
  [variable]
    name=factor
    greater_than=0
  [/variable]
  [do]
    {VARIABLE_OP factor add -1}
    {VARIABLE_OP seed multiply 1.339285}
  [/do]
[/while]
{VARIABLE_OP seed modulo 100000}
#enddef

# sets random to a value from 0..MAX-1
#define MP_RANDOM_INDEX MAX
{MP_ADJUST_SEED}
{VARIABLE random $seed}
{VARIABLE_OP random modulo {MAX}}
{VARIABLE_OP seed add $random}
#enddef

# sets random to a value from 1..MAX
#define MP_RANDOM MAX
{MP_RANDOM_INDEX {MAX}}
{VARIABLE_OP random add 1}
#enddef
