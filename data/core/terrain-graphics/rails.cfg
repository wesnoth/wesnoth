#
# Mine rail graphics
#

#define IMAGE_LN LAYER NAME
    [image]
        layer={LAYER}
        name={BUILD_IMAGE IMAGE_SINGLE {NAME} ()}
    [/image]
#enddef
# this macro adds switches at track intersections
#define RAIL_SWITCH_LF IMAGESTEM BRIDGETYPE_NAME BRIDGETYPE_JOIN_NAME LAYER FLAG SWITCHSIDE_AFFIX MAINRAIL_AFFIX SWITCH_REVERSE_AFFIX X Y
    [terrain_graphics]
        [tile]
            x=1
            y=1
            type={BRIDGETYPE_NAME}
            set_flag={FLAG}-{SWITCH_REVERSE_AFFIX}
        [/tile]
        [tile]
            x={X}
            y={Y}
            type={BRIDGETYPE_JOIN_NAME}
            no_flag={FLAG}-away-{SWITCHSIDE_AFFIX}, {FLAG}-{SWITCHSIDE_AFFIX}, {FLAG}-{SWITCH_REVERSE_AFFIX}
            set_flag={FLAG}-away-{SWITCHSIDE_AFFIX}
            {IMAGE_LN {LAYER} ({IMAGESTEM}-switch-{SWITCHSIDE_AFFIX}-{MAINRAIL_AFFIX})}
        [/tile]
    [/terrain_graphics]
#enddef

# this macro adds ends wherever rails don't join with another track
#define RAIL_END_LF IMAGESTEM BRIDGETYPE_NAME TRACKSIDE_AFFIX LAYER FLAG X Y
    [terrain_graphics]
        [tile]
            x=1
            y=1
            type={BRIDGETYPE_NAME}
        [/tile]
        [tile]
            x={X}
            y={Y}
            no_flag={FLAG}-away-{TRACKSIDE_AFFIX}, {FLAG}-{TRACKSIDE_AFFIX}
            {IMAGE_LN {LAYER} {IMAGESTEM}-{TRACKSIDE_AFFIX}-end}
        [/tile]
    [/terrain_graphics]
#enddef
#define RAILWAY_LF SE_NW_VALUE N_S_VALUE NE_SW_VALUE LAYER FLAG IMAGESTEM

    # find Y intersections
    {TRACK_Y_LF {N_S_VALUE} {SE_NW_VALUE} {NE_SW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-ne-s-nw n ne se s sw nw 2 4 3 * * *}
    {TRACK_Y_LF {NE_SW_VALUE} {N_S_VALUE} {SE_NW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-n-se-sw ne se s sw nw n * 2 4 3 * *}
    {TRACK_Y_LF {SE_NW_VALUE} {NE_SW_VALUE} {N_S_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-ne-s-nw se s sw nw n ne * * 2 4 3 *}
    {TRACK_Y_LF {N_S_VALUE} {SE_NW_VALUE} {NE_SW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-n-se-sw s sw nw n ne se * * * 2 4 3}
    {TRACK_Y_LF {NE_SW_VALUE} {N_S_VALUE} {SE_NW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-ne-s-nw sw nw n ne se s 3 * * * 2 4}
    {TRACK_Y_LF {SE_NW_VALUE} {NE_SW_VALUE} {N_S_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-n-se-sw nw n ne se s sw 4 3 * * * 2}

    # make sure that colinear adjacent bridges stay connected
    {TRACK_CONNECT_F {N_S_VALUE}   {FLAG} n ne se s sw nw 1 0}
    {TRACK_CONNECT_F {NE_SW_VALUE} {FLAG} ne se s sw nw n 2 1}
    {TRACK_CONNECT_F {SE_NW_VALUE} {FLAG} se s sw nw n ne 2 2}

    # normal corners
    {TRACK_CORNER_LF {N_S_VALUE}   {SE_NW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-s-nw  s  nw se n  sw ne 2 3 * * * *}
    {TRACK_CORNER_LF {N_S_VALUE}   {NE_SW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-ne-s  s  ne sw n  se nw * 3 2 * * *}
    {TRACK_CORNER_LF {NE_SW_VALUE} {N_S_VALUE}   {LAYER} {FLAG} {IMAGESTEM}-joint-n-sw  sw n  s  ne nw se * 2 3 * * *}
    {TRACK_CORNER_LF {NE_SW_VALUE} {SE_NW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-se-sw sw se nw ne s  n  * * 3 2 * *}
    {TRACK_CORNER_LF {SE_NW_VALUE} {NE_SW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-ne-nw nw ne sw se n  s  * * 2 3 * *}
    {TRACK_CORNER_LF {SE_NW_VALUE} {N_S_VALUE}   {LAYER} {FLAG} {IMAGESTEM}-joint-s-nw  nw s  n  se sw ne * * * 3 2 *}
    {TRACK_CORNER_LF {N_S_VALUE}   {SE_NW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-n-se  n  se nw s  ne sw * * * 2 3 *}
    {TRACK_CORNER_LF {N_S_VALUE}   {NE_SW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-n-sw  n  sw ne s  nw se * * * * 3 2}
    {TRACK_CORNER_LF {NE_SW_VALUE} {N_S_VALUE}   {LAYER} {FLAG} {IMAGESTEM}-joint-ne-s  ne s  n  sw se nw * * * * 2 3}
    {TRACK_CORNER_LF {NE_SW_VALUE} {SE_NW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-ne-nw ne nw se sw n  s  2 * * * * 3}
    {TRACK_CORNER_LF {SE_NW_VALUE} {NE_SW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-joint-se-sw se sw ne nw s  n  3 * * * * 2}
    {TRACK_CORNER_LF {SE_NW_VALUE} {N_S_VALUE}   {LAYER} {FLAG} {IMAGESTEM}-joint-n-se  se n  s  nw ne sw 3 2 * * * *}

    # these 3 macros define the default straight bridges
    {TRACK_LF {N_S_VALUE}   {LAYER} {FLAG} {IMAGESTEM}-n-s}
    {TRACK_LF {NE_SW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-ne-sw}
    {TRACK_LF {SE_NW_VALUE} {LAYER} {FLAG} {IMAGESTEM}-se-nw}

    # add switches that are not Ys
    {RAIL_SWITCH_LF {IMAGESTEM} {N_S_VALUE}   {NE_SW_VALUE} {LAYER}  {FLAG} s  ne n  1 0}
    {RAIL_SWITCH_LF {IMAGESTEM} {N_S_VALUE}   {SE_NW_VALUE} {LAYER}  {FLAG} s  nw n  1 0}
    {RAIL_SWITCH_LF {IMAGESTEM} {NE_SW_VALUE} {N_S_VALUE}   {LAYER}  {FLAG} sw n  ne 2 1}
    {RAIL_SWITCH_LF {IMAGESTEM} {NE_SW_VALUE} {SE_NW_VALUE} {LAYER}  {FLAG} sw se sw 2 1}
    {RAIL_SWITCH_LF {IMAGESTEM} {SE_NW_VALUE} {N_S_VALUE}   {LAYER}  {FLAG} nw s  se 2 2}
    {RAIL_SWITCH_LF {IMAGESTEM} {SE_NW_VALUE} {NE_SW_VALUE} {LAYER}  {FLAG} nw ne nw 2 2}
    {RAIL_SWITCH_LF {IMAGESTEM} {N_S_VALUE}   {NE_SW_VALUE} {LAYER}  {FLAG} n  sw s  1 2}
    {RAIL_SWITCH_LF {IMAGESTEM} {N_S_VALUE}   {SE_NW_VALUE} {LAYER}  {FLAG} n  se s  1 2}
    {RAIL_SWITCH_LF {IMAGESTEM} {NE_SW_VALUE} {N_S_VALUE}   {LAYER}  {FLAG} ne s  sw 0 2}
    {RAIL_SWITCH_LF {IMAGESTEM} {NE_SW_VALUE} {SE_NW_VALUE} {LAYER}  {FLAG} ne nw ne 0 2}
    {RAIL_SWITCH_LF {IMAGESTEM} {SE_NW_VALUE} {N_S_VALUE}   {LAYER}  {FLAG} se n  nw 0 1}
    {RAIL_SWITCH_LF {IMAGESTEM} {SE_NW_VALUE} {NE_SW_VALUE} {LAYER}  {FLAG} se sw se 0 1}

    # add basic end to anything left
    {RAIL_END_LF {IMAGESTEM} {N_S_VALUE}   {LAYER}  {FLAG} s  1 0}
    {RAIL_END_LF {IMAGESTEM} {NE_SW_VALUE} {LAYER}  {FLAG} sw 2 1}
    {RAIL_END_LF {IMAGESTEM} {SE_NW_VALUE} {LAYER}  {FLAG} nw 2 2}
    {RAIL_END_LF {IMAGESTEM} {N_S_VALUE}   {LAYER}  {FLAG} n  1 2}
    {RAIL_END_LF {IMAGESTEM} {NE_SW_VALUE} {LAYER}  {FLAG} ne 0 2}
    {RAIL_END_LF {IMAGESTEM} {SE_NW_VALUE} {LAYER}  {FLAG} se 0 1}
#enddef

#meta-macro RAILWAY SE_NW_TERRAIN N_S_TERRAIN NE_SW_TERRAIN L=LAYER=-80 F=FLAG=overlay IMAGESTEM

#####################################################################################################
###############        AUTO GENERATED CODE        ###################################################
#####################################################################################################
#The following code is autogenerated by expand-terrain-macros.py
#generated from: #meta-macro RAILWAY SE_NW_TERRAIN N_S_TERRAIN NE_SW_TERRAIN L=LAYER=-80 F=FLAG=overlay IMAGESTEM
#Please do not modify
#define RAILWAY_F SE_NW_TERRAIN N_S_TERRAIN NE_SW_TERRAIN FLAG IMAGESTEM
    {RAILWAY_LF ({SE_NW_TERRAIN}) ({N_S_TERRAIN}) ({NE_SW_TERRAIN}) -80 ({FLAG}) ({IMAGESTEM})}
#enddef
#define RAILWAY_L SE_NW_TERRAIN N_S_TERRAIN NE_SW_TERRAIN LAYER IMAGESTEM
    {RAILWAY_LF ({SE_NW_TERRAIN}) ({N_S_TERRAIN}) ({NE_SW_TERRAIN}) ({LAYER}) overlay ({IMAGESTEM})}
#enddef
#define RAILWAY SE_NW_TERRAIN N_S_TERRAIN NE_SW_TERRAIN IMAGESTEM
    {RAILWAY_LF ({SE_NW_TERRAIN}) ({N_S_TERRAIN}) ({NE_SW_TERRAIN}) -80 overlay ({IMAGESTEM})}
#enddef
#end of generated code
