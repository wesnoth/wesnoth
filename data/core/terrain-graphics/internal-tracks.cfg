#textdomain wesnoth
# macros for bridges/rails and anything overlayed that is path-like

#define IMAGEC_LN LAYER NAME SUFFIX
    [image]
        layer={LAYER}
	center=90,144
        name={BUILD_IMAGE IMAGE_SINGLE {NAME} {SUFFIX}}
    [/image]
#enddef

# this macro keeps colinear bridges connected, it does not add images
#define TRACK_CONNECT_F TERRAINLIST FLAG R0 R1 R2 R3 R4 R5 S0 S1 S2 S3 S4 S5
    [terrain_graphics]
        map="
,  {S1}
{S0},   {S2}
,  1
{S5},   {S3}
,  {S4}"
        [tile]
	    #main bridge
	    pos=1
            type={TERRAINLIST}
            set_flag={FLAG}-connect-{R0}
        [/tile]
        [tile]
	    pos=2
            type={TERRAINLIST}
        [/tile]
    [/terrain_graphics]
#enddef

# this macro produces Y intersections
#define TRACK_Y_PLF TERRAINLIST ADJACENT1 ADJACENT2 PROB LAYER FLAG IMAGESTEM SUFFIX R0 R1 R2 R3 R4 R5 S0 S1 S2 S3 S4 S5
    [terrain_graphics]
        map="
,  {S1}
{S0},   {S2}
,  1
{S5},   {S3}
,  {S4}"
        [tile]
	    #main track
            pos=1
            type={TERRAINLIST}
            no_flag={FLAG},{FLAG}-connect-{R0}
            set_flag={FLAG},{FLAG}-connect-{R1},{FLAG}-connect-{R5},{FLAG}-connect-{R3},{FLAG}-away-{R0}
        [/tile]
        [tile]
	    #out track
            pos=2
            no_flag={FLAG}-connect-{R3},{FLAG}-connect-{R1}
            set_flag={FLAG}-connect-{R2}
            type={ADJACENT1}
        [/tile]
        [tile]
	    #out track
            pos=3
            no_flag={FLAG}-connect-{R3},{FLAG}-connect-{R5}
            set_flag={FLAG}-connect-{R4}
            type={ADJACENT2}
        [/tile]
        [tile]
	    #middle of both out track
            pos=4
            type=!,{TERRAINLIST}
            set_flag={FLAG}-away-{R3}
        [/tile]
        probability={PROB}
        {IMAGEC_LN {LAYER}  {IMAGESTEM} {SUFFIX}}
    [/terrain_graphics]
#enddef

# this macro handles the normal corners
#define TRACK_CORNER_PLF TERRAINLIST ADJACENT PROB LAYER FLAG IMAGESTEM SUFFIX R1 R2 R3 R4 R5 R6 S0 S1 S2 S3 S4 S5
    [terrain_graphics]
        map="
,  {S1}
{S0},   {S2}
,  1
{S5},   {S3}
,  {S4}"
        [tile]
	    #main track
            pos=1
            type={TERRAINLIST}
            no_flag={FLAG},{FLAG}-connect-{R4}
            set_flag={FLAG},{FLAG}-connect-{R1},{FLAG}-connect-{R2},{FLAG}-away-{R4}
        [/tile]
        [tile]
            #exit side
            pos=2
            type={ADJACENT}
            no_flag={FLAG}-connect-{R1},{FLAG}-connect-{R6},{FLAG}-away-{R3}
            set_flag={FLAG}-connect-{R3}
        [/tile]
        [tile]
	    #side where we should have exited, but don't
            pos=3
            set_flag={FLAG}-away-{R1}
	    no_flag={FLAG}-connect-{R1}
        [/tile]
        probability={PROB}
        {IMAGEC_LN {LAYER}  {IMAGESTEM} {SUFFIX}}
    [/terrain_graphics]
#enddef

#mark the bridges that finish in a dead end
#define TRACK_DEADEND_PLF TERRAINLIST PROB LAYER FLAG IMAGESTEM R0 R1 R2 R3 R4 R5 S0 S1 S2 S3 S4 S5
    [terrain_graphics]
        map="
,  {S1}
{S0},   {S2}
,  1
{S5},   {S3}
,  {S4}"
        [tile]
	    #main bridge
	    pos=1
            type={TERRAINLIST}
	    no_flag={FLAG},{FLAG}-connect-{R0}
            set_flag={FLAG},{FLAG}-connect-{R0}
        [/tile]
        probability={PROB}
        {IMAGEC_LN {LAYER}  {IMAGESTEM} -{R3}}
    [/terrain_graphics]
#enddef

#mark the bridges that are alone
#define TRACK_ALONE_PLF TERRAINLIST PROB LAYER FLAG IMAGESTEM R0 R1 R2 R3 R4 R5 S0 S1 S2 S3 S4 S5
    [terrain_graphics]
        map="
,  *
*,   *
,  1
*,   *
,  *"
        [tile]
	    #main bridge
	    pos=1
            type={TERRAINLIST}
	    no_flag={FLAG},{FLAG}-connect-{R0},{FLAG}-connect-{R3}
            set_flag={FLAG}
        [/tile]
        probability={PROB}
        {IMAGEC_LN {LAYER}  {IMAGESTEM} ()}
    [/terrain_graphics]
#enddef



#define TRACK_BORDER_RESTRICTED_PLF TERRAINLIST ADJACENT PROB LAYER FLAG IMAGESTEM
    [terrain_graphics]
        map="
, 2
* , *
, 1
* , *
, *"
        [tile]
            pos=1
            type={ADJACENT}
            no_flag={FLAG}-connect-@R0
        [/tile]
        [tile]
            pos=2
            type={TERRAINLIST}
	    has_flag={FLAG}-connect-@R3
        [/tile]

        {IMAGEC_LN {LAYER} {IMAGESTEM} -@R0}
        probability={PROB}
        rotations=n,ne,se,s,sw,nw
    [/terrain_graphics]
#enddef


#define TRACK_STRAIGHT_PLF TERRAINLIST PROB LAYER FLAG IMAGESTEM SUFFIX R0 R1 R2 R3 R4 R5 S0 S1 S2 S3 S4 S5
    [terrain_graphics]
        map="
,  {S1}
{S0},   {S2}
,  1
{S5},   {S3}
,  {S4}"
        [tile]
            pos=1
            type={TERRAINLIST}
            no_flag={FLAG},{FLAG}-away-{R0},{FLAG}-away-{R3}
            set_flag={FLAG},{FLAG}-connect-{R0},{FLAG}-connect-{R3}
        [/tile]

        probability={PROB}
        {IMAGEC_LN {LAYER}  {IMAGESTEM} {SUFFIX}}
    [/terrain_graphics]
#enddef

#define TRACK_ANGLE_CW_PLF TERRAINLIST ADJACENT1 ADJACENT2 PROB LAYER FLAG IMAGESTEM
    [terrain_graphics]
        map="
, 2
3 , *
, 1
* , *
, *"
        [tile]
            pos=1
            type={ADJACENT1}
            no_flag={FLAG}-connect-@R0
        [/tile]
        [tile]
            pos=2
            type={TERRAINLIST}
	    has_flag={FLAG}-connect-@R3
        [/tile]
        [tile]
            pos=3
            type={ADJACENT2}
        [/tile]

        {IMAGEC_LN {LAYER} {IMAGESTEM} -@R0}
        #{IMAGEC_LN 8 void ()}
        probability={PROB}
        rotations=n,ne,se,s,sw,nw
    [/terrain_graphics]
#enddef

#define TRACK_ANGLE_CCW_PLF TERRAINLIST ADJACENT1 ADJACENT2 PROB LAYER FLAG IMAGESTEM
    [terrain_graphics]
        map="
, 3
2 , *
, 1
* , *
, *"
        [tile]
            pos=1
            type={ADJACENT1}
            no_flag={FLAG}-@R0,{FLAG}-connect-@R0
            set_flag={FLAG}-@R0
        [/tile]
        [tile]
            pos=2
            type={TERRAINLIST}
            no_flag={FLAG}-@R3
            set_flag={FLAG}-@R3
	    has_flag={FLAG}-connect-@R3
        [/tile]
        [tile]
            pos=3
            type={ADJACENT2}
        [/tile]

        {IMAGEC_LN {LAYER} {IMAGESTEM} -@R0}
        probability={PROB}
        rotations=n,ne,se,s,sw,nw
    [/terrain_graphics]
#enddef

