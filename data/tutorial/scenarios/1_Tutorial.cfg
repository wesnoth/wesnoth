#textdomain wesnoth-tutorial

#define LABEL NAME POS
[label]
	x,y={POS}
	text={NAME}
[/label]
#enddef
#define UNLABEL POS
[label]
	x,y={POS}
	text=""
[/label]
#enddef

#define PRINT STRING
[set_variable] 
	name=print_string 
	format={STRING} 
[/set_variable] 
[print]
	text=$print_string
	size=18 
	duration=10000
	red,green,blue=255,255,255 
[/print]
#enddef

#define CLEAR_PRINT
[print]
	text=""
[/print]
#enddef

#define DEST X Y
{VARIABLE destx {X}}
{VARIABLE desty {Y}}
{VARIABLE dest set}
#enddef

#FIXME: You'd think that using CLEAR_VARIABLE here would make it fail the
#equals="set" test.  You'd be wrong...
#define NODEST
{VARIABLE dest unset}
#enddef

# FIXME: For some reason, label locations need to be offset??
#define STUDENT_START_LOC
8,5
#enddef
#define MARKER_LOC
11,4
#enddef
#define DELFADOR_LOC
12,5
#enddef
#define DUMMY_LOC
12,6
#enddef
#define VILLAGE_LOC
10,6
#enddef
#define KEEP_LOC
8,5
#enddef

[tutorial]
	id=tutorial
	name=_ "Wesnoth Tutorial"
	map_data="ffffggcctggggggfffff
ffgggggccggggggggfff
fgggggggcggggggggggf
fgggggggccgggggggggf
ftfggggggg/ggggggggg
ffgggggC1gccgggggggg
fgggggggCgt/gggggggg
fgtggggggggcgggggggf
ffggggggggggccgggggf
ffffgggggggggcggggff
ffffgggggggggcgggfff
"
	turns=20
	music=wesnoth-4.ogg

	{DAWN}
	{MORNING}
	{AFTERNOON}
	{DUSK}
	{FIRST_WATCH}
	{SECOND_WATCH}

	victory_when_enemies_defeated=no
	
	[side]
		type=Fighter
		description=student
		user_description=_"Konrad"
		canrecruit=1
		side=1
		controller=human
	[/side]

	[side]
		no_leader=yes
		type=Dummy
		description=Dummy
		user_description=_ "Dummy"
		side=2
		controller=ai
		[ai]
			passive_leader=no
			caution=0
			aggression=5
			[target]
				description=student
				value=10
			[/target]
			[target]
				description=Delfador
				value=.1
			[/target]
		[/ai]
	[/side]

	[side]
		no_leader=yes
		description=Delfador
		user_description=_ "Delfador"
		side=3
		team_name=1
		controller=null
	[/side]

	[event]
		name=prestart

		[unit]
			description=Delfador
			type=Elder Mage
			x,y=13,6
			side=3
		[/unit]
		{LABEL Delfador {DELFADOR_LOC}}

		[objectives]
			side=1
			summary=_ "You will learn the basics of:
 movement
 attacking
 healing
 recruiting"
			[objective]
				description=_ "Destroy a fierce enemy"
				condition=win
			[/objective]
			[objective]
				description=_ "Get yourself killed"
				condition=lose
			[/objective]
		[/objectives]

		[hide_unit]
			x,y=9,6
		[/hide_unit]
		{VARIABLE student_hp 32}

	[/event]

	[event]
		name=start
		[message]
			speaker=narrator
			message=_"Who would you like to play?"
			[option]
				message="&" + "konrad-fighter.png" + "=" + _"Konrad"
				[command]
					{VARIABLE gender male}
					{VARIABLE student _"Konrad"}
					{VARIABLE he he}
				[/command]
			[/option]
			[option]
				message="&" + "human-junior-princess.png" + "=" + _"Li'sar"
				[command]
					{VARIABLE gender female}
					{VARIABLE student _"Li'sar"}
					{VARIABLE he she}
					[store_unit]
						[filter]
							description=student
						[/filter]
						kill=yes
						variable=student
					[/store_unit]
					{VARIABLE student.type Fighteress}
					{VARIABLE student.user_description _"Li'sar"}
					[unstore_unit]
						variable=student
					[/unstore_unit]
					[redraw][/redraw]
				[/command]
			[/option]
		[/message]

		[unhide_unit][/unhide_unit]
		{LABEL $student {STUDENT_START_LOC}}
		[redraw][/redraw]
		[message]
			speaker=narrator
			message=_ "*Welcome to Wesnoth!
For this tutorial, you are playing $student, standing in the keep.  Your mentor Delfador is on the East side of the river.
*Left click or any key to continue..."
		[/message]

		{PRINT (_"Left click on $student")}
	[/event]

	[event]
		name=select
		[filter]
			side=1
		[/filter]

		{UNLABEL {STUDENT_START_LOC}}
		{CLEAR_PRINT}

		[redraw][/redraw]
		[message]
			speaker=narrator
			message=_ "*You have selected $student.
The places $he could move to are highlighted.
*Left click or any key to continue..."
		[/message]

		{LABEL (_ "HERE") {MARKER_LOC}}
		[redraw][/redraw]

		[message]
			speaker=narrator
			message=_ "Move $student next to Delfador, by clicking on the place marked 'HERE'
*Left click or any key to continue..."
		[/message]

		{DEST 12 5}
		{PRINT (_"Left click on tile labelled HERE")}
	[/event]

	# General catch for them moving to the wrong place.
	[event]
		name=moveto
		first_time_only=no
		[allow_undo][/allow_undo]

		[filter]
			side=1
		[/filter]

		[if]
			[or]
				[variable]
					name=x1
					numerical_not_equals=$destx
				[/variable]
			[/or]
			[or]
				[variable]
					name=y1
					numerical_not_equals=$desty
				[/variable]
			[/or]
		[then]
			[if]
				[variable]
					name=dest
					equals="set"
				[/variable]
			[then]
				[redraw][/redraw]
				[message]
					speaker=narrator
					message=_ "*Oops!
You moved to the wrong place!  After this message, you can press 'u' to Undo, then try again.
*Left click or any key to continue..."
				[/message]
			[/then]
			[/if]
		[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x,y=12,5
		[/filter]

		{CLEAR_PRINT}
		{UNLABEL {MARKER_LOC}}
		{UNLABEL {DELFADOR_LOC}}
		{NODEST}
		[redraw][/redraw]

		[message]
			description=student
			message=_ "Good morning Delfador!  Is it time to attack things?"
		[/message]

		[message]
			description=Delfador
			message=_ "Um, well..."
		[/message]

		[message]
			description=student
			message=_ "Have you found an orc for me to fight, huh?  A troll?"
		[/message]

		[message]
			description=Delfador
			message=_ "Quiet!  I will summon an enemy for you..."
		[/message]

		[scroll_to_unit]
		description=Delfador
		[/scroll_to_unit]

		[sound]
		name=lightning.wav
		[/sound]

		[colour_adjust]
		red=100
		green=100
		blue=100
		[/colour_adjust]

		[delay]
		time=10
		[/delay]

		[colour_adjust]
		red=0
		green=0
		blue=0
		[/colour_adjust]

		[unit]
			description=Dummy
			type=Dummy
			ai_special="guardian"
			x,y=13,7
			side=2
		[/unit]

		{LABEL (_"Dummy") {DUMMY_LOC}}
		[redraw][/redraw]

		[message]
			description=Delfador
			message=_ "... this quintain!"
		[/message]

		[message]
		description=student
		message=_ "A quintain?  You want me to pretend to fight a dummy??"
		[/message]

		[message]
		description=Delfador
		message=_ "Child, you have 32 hitpoints and a sword.    I'm fairly sure you'll win."
		[/message]

		[message]
			speaker=narrator
			message=_ "To attack the dummy, you will first select the attacker ($student) and then the target (the dummy).  You will see a description of the details of the attack.  When you click OK, $student will attack.
*Left click or any key to continue..."
		[/message]

		[event]
			name=select
			[filter]
				side=1
			[/filter]

			{PRINT (_"Click on the dummy to attack it")}
		[/event]

		{PRINT (_"Click on $student")}
	[/event]

	# We track student's hitpoints so Delfador can explain them.
	[event]
		name=attacker_hits
		first_time_only=no
		[filter_second]
			description=student
		[/filter_second]
		{VARIABLE_OP student_hp add -3}
	[/event]
	[event]
		name=defender_hits
		first_time_only=no
		[filter]
			description=student
		[/filter]
		{VARIABLE_OP student_hp add -3}
	[/event]

	[event]
		name=attack_end

		{CLEAR_PRINT}
		{UNLABEL {DUMMY_LOC}}

		[message]
			description=student
			message=_ "Hey! This dummy fights back!"
		[/message]

		[message]
			description=Delfador
			message=_ "Hmm, maybe we should have started with a doll."
		[/message]

		[message]
			description=student
			message=_ "Should I retreat?"
		[/message]

		[message]
			description=Delfador
			message=_ "Good idea!"
		[/message]

		[hide_unit]
			x,y=13,6
		[/hide_unit]
		[move_unit_fake]
			type=Elder Mage
			x=13,12,11
			y=6,5,4
		[/move_unit_fake]
		[teleport]
			[filter]
			description=Delfador
			[/filter]
			x,y=11,4
		[/teleport]
		[unhide_unit][/unhide_unit]

		{VARIABLE future_hp $student_hp}
		{VARIABLE_OP future_hp add -15}
		[message]
			description=Delfador
			message=_ "Unfortunately, you've used up your turn attacking the dummy.  The dummy will now get a turn."
		[/message]
		[message]
			description=student
			message=_ "The DUMMY gets a turn?"
		[/message]
		[message]
			description=Delfador
			message=_ "Yes: it's a magical dummy.
Now, this dummy gets five chances to hit you, and if it hits every time, you'll drop from $student_hp to $future_hp hit points.  Brace yourself!"
		[/message]
		{PRINT (_ "Click on the End Turn button on the bottom right")}
	[/event]

	[event]
		name="turn 2"

		# There is a 1 in 170,000 chance that the dummy will miss on all
		# 10 attacks.  Ignoring that.
		{CLEAR_PRINT}
		[refresh][/refresh]
		[message]
			description=student
			message=_ "Ouch!  I need to heal!  Only $student_hp hp left!"
		[/message]

		{LABEL (_"Village") {VILLAGE_LOC}}

		[message]
			description=Delfador
			message=_ "There is a village on the other side of the river.  Visiting villages is a good idea, and ending your turn in one will heal you: you should retreat to there."
		[/message]

		{PRINT (_ "Click on $student")}

		[event]
			name=select
			[filter]
				side=1
			[/filter]
			
			{PRINT (_ "Click on the village to move $student")}
		[/event]

		{DEST 11 7}
		[event]
			name=moveto
			[filter]
				side=1
				x,y=11,7
			[/filter]
			{CLEAR_PRINT}
			[redraw][/redraw]

			{NODEST}
			[message]
				speaker=narrator
				message=_ "You now 'own' this village: you can see it flies your flag, and soon a '1' will appear next to the house icon at the top of screen.  Villages give gold: every turn you gain two gold, plus one for every village you own.
*Left click or any key to continue..."
			[/message]
			{PRINT (_"Click on the End Turn button")}
		[/event]
	[/event]
		
	
	[event]
		name=recruit
		first_time_only=no
		# zookeeper suggested we eliminate traits by killing
		# the recruit and replacing it
		[kill]
			x,y=$x1,$y1
		[/kill]
		[unit]
			description=Elvish Fighter
			type=Elvish Fighter
			x,y=$x1,$y1
			side=1
			moves=0
		[/unit]
	[/event]

	[event]
		name="turn 3"

		{CLEAR_PRINT}
		{UNLABEL {VILLAGE_LOC}}
		[message]
			description=Delfador
			# FIXME: How many HP really?
			message=_ "You're about to be healed by 8 hitpoints.   But I think you're going to need some help against that dummy."
		[/message]

		[message]
			description=student
			message=_ "I'll recruit some elves!"
		[/message]

		{LABEL (_"Keep") {KEEP_LOC}}

		[message]
			description=Delfador
			message=_ "A splendid idea.  If you return to your keep, you can recruit two units.  You have plenty of gold for that."
		[/message]

		{DEST 9 6}
		{PRINT (_"Move $student to the keep")}

		[event]
			name=moveto
			[filter]
				x,y=9,6
			[/filter]

			{CLEAR_PRINT}
			{UNLABEL {KEEP_LOC}}
			[set_recruit]
				recruit=Elvish Fighter
				side=1
			[/set_recruit]
			[redraw][/redraw]

			[message]
				speaker=narrator
				message=_ "Whenever you're on a keep, you can recruit into castle tiles around it, by right-clicking and selecting 'Recruit'.  This time you will only be given one type of unit to choose: select it.
*Left click or any key to continue..."
			[/message]

			{PRINT (_"Right click on one castle tile and select Recruit")}
		[/event]

		[event]
			name=recruit
			[filter]
				x,y=8,6
			[/filter]
			{VARIABLE Fighter1 1}
			[if]
				[variable]
					name=Fighter2
					numerical_equals=1
				[/variable]
			[then]
				{CLEAR_PRINT}
				[redraw][/redraw]
				[message]
					speaker=narrator
					message=_ "These newly recruited units can do nothing this turn: you will control them next turn.
Note: after this dialog, you can move the mouse over a unit to see a description on the right of the screen.
*Left click or any key to continue..."
				[/message]
				# They can move to the village if they're smart
				{NODEST}
				{PRINT (_"Click on the End Turn button")}
			[/then]
			[else]
				{PRINT (_"Right click on the other castle tile and Recruit another unit")}
			[/else]
			[/if]
		[/event]

		[event]
			name=recruit
			[filter]
				x,y=9,7
			[/filter]
			{VARIABLE Fighter2 1}
			[if]
				[variable]
					name=Fighter1
					numerical_equals=1
				[/variable]
			[then]
				{CLEAR_PRINT}
				[redraw][/redraw]
				[message]
					speaker=narrator
					message=_ "These newly recruited units can do nothing this turn: you will control them next turn.
Note: after this dialog, you can move the mouse over a unit to see a description on the right of the screen.
*Left click or any key to continue..."
				[/message]
				# They can move to the village if they're smart
				{NODEST}
				{PRINT (_"Click on the End Turn button")}
			[/then]
			[else]
				{PRINT (_"Right click on the other castle tile and Recruit another unit")}
			[/else]
			[/if]
		[/event]
	[/event]

	[event]
		name="turn 4"

		{CLEAR_PRINT}
		[message]
			description=student
			message=_ "Hey, the dummy just healed by two hitpoints!  I'd better attack it at once!"
		[/message]
		[message]
			description=Delfador
			message=_ "Yes, if a unit doesn't do anything for a turn, it will slowly heal.
But before you send your fighters against the dummy, you should know they have two kinds of attack..."
		[/message]
		[message]
			description=student
			message=_ "I'll tell them to use the one which does most damage!"
		[/message]
		[message]
			description=Delfador
			message=_ "And which would that be?  The sword (5-4) or the bow (3-3)?  I guess you'll find out..."
		[/message]
		{PRINT (_"Left click on an Elvish Fighter")}
		{VARIABLE encourage (_"End your turn, then attack again.")}

		[event]
			name=select
			[filter]
				type=Elvish Fighter
			[/filter]
			{PRINT (_"Left click on the Dummy to attack it.")}
		[/event]

		[event]
			name=attack
			{CLEAR_PRINT}
		[/event]
		[event]
			name=attack_end

			[special_filter]
				weapon=sword
			[/special_filter]

			{VARIABLE used_sword 1}
			[if]
				[variable]
					name=used_bow
					numerical_equals=1
				[/variable]
			[then]
				[if]
					[variable]
						name=dummy_dead
						numerical_equals=1
					[/variable]
				[then]
					[message]
						description=Delfador
						message=_ "Your elf used a sword (5-4, or 5 damage, 4 attacks), which is a melee attack, so the dummy defended with its melee attack (3-5).  The ranged attack was safer."
					[/message]
				[/then]
				[else]
					[message]
						description=Delfador
						message=_ "Your elf used a sword (5-4, or 5 damage, 4 attacks), which is a melee attack, so the dummy defended with its melee attack (3-5).  The ranged attack was safer.
End your turn, then attack again."
					[/message]
					{PRINT (_"Click on the End Turn button")}
				[/else]
				[/if]
			[/then]
			[else]
				[message]
					description=Delfador
					message=_ "Your elf used a sword (5-4, or 5 damage, 4 attacks), which is a melee attack, so the dummy defended with its melee attack (3-5).  You should tell the other Elf to use the bow."
				[/message]
				{PRINT (_"Attack with the other Elf")}
			[/else]
			[/if]
		[/event]
		[event]
			name=attack_end

			{VARIABLE used_bow 1}
			[special_filter]
				weapon=bow
			[/special_filter]

			[if]
				[variable]
					name=used_sword
					numerical_equals=1
				[/variable]
			[then]
				[if]
					[variable]
						name=dummy_dead
						numerical_equals=1
					[/variable]
				[then]
					[message]
						description=Delfador
						message=_ "Your elf used a bow, which is a ranged attack (3-3, or 3 damage, 3 attacks).  The dummy has no ranged attack, only a melee attack, so it could not defend itself."
					[/message]
				[/then]
				[else]
					[message]
						description=Delfador
						message=_ "Your elf used a bow, which is a ranged attack (3-3, or 3 damage, 3 attacks).  The dummy has no ranged attack, only a melee attack, so it could not defend itself.
End your turn, then attack again."
					[/message]
					{PRINT (_"Click on the End Turn button")}
				[/else]
				[/if]
			[/then]
			[else]
				[message]
					description=Delfador
					message=_ "Your elf used a bow, which is a ranged attack (3-3, or 3 damage, 3 attacks).  The dummy has no ranged attack, only a melee attack, so it could not defend itself."
				[/message]
				{PRINT (_"Attack with the other Elf")}
			[/else]
			[/if]
		[/event]
	[/event]

	[event]
		name="turn 5"
		{CLEAR_PRINT}
		[message]
			description=Delfador
			message=_ "Keep attacking, with both elves, until the dummy is finished!"
		[/message]
	[/event]

	[event]
		name="turn 6"
		[message]
			description=Delfador
			message=_ "Maybe you should recruit another elf?"
		[/message]
		[message]
			speaker=narrator
			message=_ "Note:
You can right click on a unit to see a detailed Unit Description"
		[/message]
	[/event]

	[event]
		name="turn 7"
		[if]
			[variable]
				name=dummy_dead
				numerical_equals=1
			[/variable]
		[then]
			[message]
				speaker=narrator
				message=_ "Note:
Remember to pull back wounded units into villages, and recruit more if you need.  Take special care of units with the highest experience points (XP)."
			[/message]
		[/then]
		[/if]
	[/event]

	[event]
		name="turn 8"
		[if]
			[variable]
				name=dummy_dead
				numerical_equals=1
			[/variable]
		[then]
			[message]
				speaker=narrator
				message=_ "Note:
These dummies only attack if you are a single tile away.  With care, you should be able to kill them one at a time."
			[/message]
		[/then]
		[/if]
	[/event]

	[event]
		name="turn 9"
		[message]
			speaker=narrator
			message=_ "Note:
When a unit gets enough experience (the experience bar is the smaller bar on the right), it will go up a level.  Elvish Fighters have two options, and you will get to choose which one you want."
		[/message]
	[/event]

	[event]
		name="turn 12"
		[message]
			speaker=narrator
			message=_ "Note:
Each village you own can support a single unit for free.  After that, each unit costs you one gold per turn."
		[/message]
	[/event]

	[event]
		name="turn 14"
		[message]
			speaker=narrator
			message=_ "Note:
Once you select a unit, you see percentages for different places: higher means more defensible.  For example, defence is good in castles and villages, bad inside rivers.  The dummies' attacks are magical, however, so they have a 70% chance of hitting you wherever you stand."
		[/message]
	[/event]

	[event]
		name=die
		[filter]
			description=student
		[/filter]
		[endlevel]
			result=defeat
		[/endlevel]
	[/event]

	[event]
		name=die
		[filter]
			type=Dummy
		[/filter]
		{CLEAR_PRINT}
		[message]
			speaker=second_unit
			message=_ "The dummy is dead, sirs, and I have gained more experience!"
		[/message]
		[message]
			description=Delfador
			message=_ "Yes, you gain more experience through battle, especially killing an opponent: gain enough experience and you become more powerful.
Now $student, I will leave you with more dummies to practice on!"
		[/message]
		{VARIABLE dummy_dead 1}

		[unit]
			description=Dummy
			type=Dummy
			ai_special="guardian"
			x,y=16,10
			side=2
		[/unit]
		[unit]
			description=Dummy
			type=Dummy
			ai_special="guardian"
			x,y=5,8
			side=2
		[/unit]
		[unit]
			description=Dummy
			type=Dummy
			ai_special="guardian"
			x,y=10,8
			side=2
		[/unit]
		[unit]
			description=Dummy
			type=Dummy
			ai_special="guardian"
			x,y=13,11
			side=2
		[/unit]
		[unit]
			description=Dummy
			type=Dummy
			ai_special="guardian"
			x,y=9,11
			side=2
		[/unit]
		[unit]
			description=Dummy
			type=Dummy
			ai_special="guardian"
			x,y=4,10
			side=2
		[/unit]

		[kill]
			description=Delfador
		[/kill]
		[move_unit_fake]
			type=Elder Mage
			x=11,11,10,9,8,7,6,5,4,3,2
			y=4,5,5,5,4,4,3,3,2,2,1
		[/move_unit_fake]

		[scroll_to_unit]
			type=Dummy
		[/scroll_to_unit]

		[event]
			name=new turn
			first_time_only=no
			[message]
				speaker=narrator
				message=_ "Do you want to keep practicing?"
				[option]
					message=_ "Yes, I'm still figuring it out."
				[/option]
				[option]
					message=_ "No, I think I've got it."
					[command]
						[endlevel]
							result=victory
						[/endlevel]
					[/command]
				[/option]
			[/message]
		[/event]
	[/event]

	[event]
		name=time over
		[if]
			[variable]
				name=dummy_dead
				numerical_equals=1
			[/variable]
		[then]
			[endlevel]
				result=victory
			[/endlevel]
		[/then]
		[else]
			[endlevel]
				result=defeat
			[/endlevel]
		[/else]
		[/if]
	[/event]
[/tutorial]
