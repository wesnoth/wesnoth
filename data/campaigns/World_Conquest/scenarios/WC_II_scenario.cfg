#textdomain wesnoth-wc
## macros may not be used inside translatable strings.

#define WC_II_CAMPAIGN_NAME_1P
_ "World Conquest 1p" #enddef

#define WC_II_CAMPAIGN_NAME_2P
_ "World Conquest 2p" #enddef

#define WC_II_CAMPAIGN_NAME_3P
_ "World Conquest 3p" #enddef

#define WC_II_CAMPAIGN_DESC_1P
    _ "A randomly generated campaign for 1 player. It has 6 levels of difficulty.
(Expert level, 5 scenarios.)" #enddef

#define WC_II_CAMPAIGN_DESC_2P
    _ "A randomly generated cooperative campaign for 2 players. It has 6 levels of difficulty.
(Expert level, 5 scenarios.)" #enddef

#define WC_II_CAMPAIGN_DESC_3P
    _ "A randomly generated cooperative campaign for 3 players. It has 6 levels of difficulty.
(Expert level, 5 scenarios.)" #enddef

#define WC2_HUMAN_DIFFICULTY IMAGE COLOR
"units/{IMAGE}.png~RC(magenta>{COLOR})"#enddef

#define WC2_NIGHTMARE_DIFFICULTY
"units/monsters/fire-dragon.png~CROP(0,0,160,160)~SCALE_INTO(72,72)~RC(magenta>red)"#enddef

#define WC2_CAMPAIGN_DIFFICULTY DIFFICULTY IMAGE LABEL DESCRIPTION POWER TRAINED HEROES GOLD TRAIN XP
    {CAMPAIGN_DIFFICULTY {DIFFICULTY} {IMAGE} {LABEL} {DESCRIPTION}}
    [event]
        name=preload
        # These events run for every difficulty, so this Lua block ensures only the active difficulty's
        # event actually fills the settings variable.
        [lua]
            code=<<
                if wesnoth.scenario.difficulty ~= (...).difficulty then
                    wesnoth.wml_actions["return"]{}
                end
            >>
            [args]
                difficulty={DIFFICULTY}
            [/args]
        [/lua]
        [set_variables]
            name=wc2_difficulty
            [value]
                name={LABEL}
                enemy_power={POWER}
                enemy_trained={TRAINED}
                heroes={HEROES}
                # adjust bonus gold for number of players
                extra_gold=$(gold * 2 ^ (3 - nplayers) where nplayers = $wc2_player_count, gold = {GOLD})
                extra_training={TRAIN}
                experience_penalty={XP}
            [/value]
        [/set_variables]
    [/event]
#enddef

#define WC2_CAMPAIGN_NEW PLAYERS
    [campaign]
        id = "WC_II_{PLAYERS}p"
        define = CAMPAIGN_WC_{PLAYERS}P
        name= {WC_II_CAMPAIGN_NAME_{PLAYERS}P}
        description = {WC_II_CAMPAIGN_DESC_{PLAYERS}P}
        first_scenario = "WC_II_{PLAYERS}p"
        min_players={PLAYERS}
        max_players={PLAYERS}
        type = mp
        abbrev = _ "WC"
        {WC2_CAMPAIGN_DIFFICULTY VERY_EASY {WC2_HUMAN_DIFFICULTY human-peasants/peasant purple} {STR_PEASANT} {STR_BEGINNER} 6 2 2 10 yes 0}
        {WC2_CAMPAIGN_DIFFICULTY EASY {WC2_HUMAN_DIFFICULTY human-loyalists/sergeant black} {STR_SERGEANT} {STR_EASY} 7 3 2 7 yes 5}
        {WC2_CAMPAIGN_DIFFICULTY NORMAL {WC2_HUMAN_DIFFICULTY human-loyalists/lieutenant brown} {STR_LIEUTENANT} {STR_MEDIUM} 8 4 2 5 yes 10} {DEFAULT_DIFFICULTY}
        {WC2_CAMPAIGN_DIFFICULTY HARD {WC2_HUMAN_DIFFICULTY human-loyalists/general orange} {STR_GENERAL} {STR_HARD} 8 5 2 2 no 13}
        # Challenging is a string that exists in mainline but only in campaigns so it probably counts as adding a string?
        #textdomain wesnoth-httt
        {WC2_CAMPAIGN_DIFFICULTY VERY_HARD {WC2_HUMAN_DIFFICULTY human-loyalists/marshal white} {STR_GRAND_MARSHAL} _"Challenging" 9 6 2 1 no 17}
        # Expert is a string that was supposed to be in wesnoth-wc but accidentally got added to wesnoth-units instead
        #textdomain wesnoth-units
        {WC2_CAMPAIGN_DIFFICULTY NIGHTMARE {WC2_NIGHTMARE_DIFFICULTY} {STR_NIGHTMARE} _"Expert" 9 7 1 0 no 20}
    [/campaign]
#enddef

#define WC2_SCENARIO_NEW TAG ID NAME PLAYERS
    ## Everything that usually goes into [scenario] like [event], [load_ressource], map_data
    ## etc is generated by lua. This is also why there is only one [scenario] tag: the next
    ## scenario is again "WC_II" and the lua code detects that is was called a second
    ## time and generates the second scenario. (Same for third, fourth and fifth). All the lua
    ## code inside ./lua/map does map/scenario generation.
    [{TAG}]
        id = {ID}
        name={NAME}
        allow_new_game=no
        scenario_generation=lua
        experience_modifier=100
        victory_when_enemies_defeated=yes
        carryover_percentage=0
        carryover_report=no
        carryover_add=no
        force_lock_settings=yes
        [generator]
            id={ID}
            config_name={NAME}
            nplayers={PLAYERS}
            create_scenario = <<
                local a = ...
                local function doit()
                    wesnoth.dofile('campaigns/World_Conquest//lua/map/main.lua')
                    return wc_ii_generate_scenario(a.nplayers, a)
                end

                local status, res = xpcall(doit, function(e) std_print(e, debug.traceback()) end)
                if status then
                    return res
                else
                    print(res)
                    std_print(res)
                end
            >>
#ifdef EDITOR
            user_config = <<
                local a = ...
                local function doit()
                    wesnoth.dofile('campaigns/World_Conquest//lua/map/main.lua');
                    wesnoth.dofile('campaigns/World_Conquest//lua/map/settings/settings_dialog.lua');
                    return wc2_debug_settings(a.nplayers)
                end

                local status, res = xpcall(doit, function(e) std_print(e, debug.traceback()) end)
                if status then
                    return res
                else
                    std_print(res)
                end
            >>
#endif
            nplayers={PLAYERS}
            [scenario]
                {DEFAULT_SCHEDULE}
                {DEFAULT_MUSIC_PLAYLIST}
            [/scenario]
        [/generator]
    [/{TAG}]
#enddef

{WC2_CAMPAIGN_NEW 1}
{WC2_CAMPAIGN_NEW 2}
{WC2_CAMPAIGN_NEW 3}

#ifdef CAMPAIGN_WC_1P
{WC2_SCENARIO_NEW scenario "WC_II_1p" {WC_II_CAMPAIGN_NAME_1P} 1}
#endif

#ifdef CAMPAIGN_WC_2P
{WC2_SCENARIO_NEW scenario "WC_II_2p" {WC_II_CAMPAIGN_NAME_2P} 2}
#endif

#ifdef CAMPAIGN_WC_3P
{WC2_SCENARIO_NEW scenario "WC_II_3p" {WC_II_CAMPAIGN_NAME_3P} 3}
#endif
