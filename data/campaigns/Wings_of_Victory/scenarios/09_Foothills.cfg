#textdomain wesnoth-wov
# This scenario is intended to be hard difficulty.
[scenario]
    id=09_Foothills
    name= _ "Foothills"
    next_scenario=10_Heart_Mountains
    {WOV_MAP 09_Foothills.map}
    {TURNS 36 34 32}
    {UNDERGROUND}
    [time_area]
        x=    0,     1,     2,     3
        y=35-37, 36-37, 36-37,    37
        {DEFAULT_SCHEDULE_DUSK} #It's autumn
    [/time_area]
    carryover_percentage=40
    carryover_add=yes

    {INTRO_AND_SCENARIO_MUSIC revelation.ogg the_deep_path.ogg}
    {EXTRA_SCENARIO_MUSIC into_the_shadows.ogg}
    {EXTRA_SCENARIO_MUSIC underground.ogg}

    [story]
        [part]
            story= _ "Upon leaving the forest, a mountain in the range ahead caught Galun’s attention, and he led the flight toward it."
        [/part]
    [/story]
    [story]
        [part]
            background=story/landscape-hills-01.jpg
            story= _ "As they flew over the rough foothills of what men would someday call the Heart Mountains, a fierce storm swelled up and forced the flight to land and take shelter in a cave."
        [/part]
    [/story]
    {WOV_GC_TRACK {JOURNEY_09_NEW}}

    # wmllint: validate-off
    [side]
        side=1
        controller=human
        recruit=Drake Burner, Drake Clasher, Drake Fighter, Drake Glider
        gold=100 # Player should have some carryover from previous scenario
        fog=no
        shroud=yes
        save_id=Player
        team_name=hero
        user_team_name= _ "Drakes"
        side_name= _ "Galun"
        {FLAG_VARIANT long}
        [leader]
            {GALUN}
        [/leader]
        [unit]
            {VANK}
            placement=leader
        [/unit]
    [/side]
    {WOV_DEATHS}

    [side]
        side=2
        controller=ai
        recruit=Skeleton, Revenant, Deathblade, Skeleton Archer, Bone Shooter, Walking Corpse, Soulless, Ghost, Wraith, Shadow
        {GOLD 125 175 225}
        {INCOME 3 7 11}
        team_name=undead
        user_team_name= _ "Undead"
        {FLAG_VARIANT undead}
        [leader]
            id=Naemir
            name= _ "Naemir"
            type=Lich # This lich is a former elf
            facing=sw
        [/leader]
    [/side]
    {STARTING_VILLAGES 2 5}
#ifdef HARD
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Shadow" 1} # One is bad enough
#else
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Shadow" 0}
#endif

    # Spiders are set up to spawn roughly every 9 turns
    [side]
        side=3
        controller=ai
        recruit=Giant Spider
        gold=0 # Given randomly in prestart
        income=1 # + 2 base + 3 villages = 6 per turn & upkeep of one recruit covered
        team_name=undead
        user_team_name= _ "Spiders"
        {FLAG_VARIANT undead}
        [leader]
            type=Giant Spider
            facing=nw
        [/leader]
        [ai]
            aggression=0.70
            [avoid]
                terrain=*^Vu
            [/avoid]
        [/ai]
    [/side]
    {STARTING_VILLAGES 3 5}

    # Serpents are set up to spawn roughly every 9 turns
    [side]
        side=4
        controller=ai
        recruit=Water Serpent
        gold=0 # Given randomly in prestart
        income=-1 # + 2 base + 2 village = 3 per turn & upkeep of one recruit covered
        team_name=undead
        user_team_name= _ "Serpents"
        {FLAG_VARIANT undead}
        [leader]
            type=Water Serpent
            facing=sw
        [/leader]
        [ai]
            aggression=0.70
            [avoid]
                terrain=*^Vu
            [/avoid]
        [/ai]
    [/side]
    {STARTING_VILLAGES 4 5}
    # wmllint: validate-on

    [event]
        name=prestart
        {MODIFY_UNIT side=1 facing ne}

        # Randomly determine which monster gets to recruit on turn 1
        {RANDOM Spiders,Serpents}
        [switch]
            variable=random
            [case]
                value=Spiders
                [gold]
                    side=3
                    amount=59
                [/gold]
                [gold]
                    side=4
                    amount=4
                [/gold]
            [/case]
            [case]
                value=Serpents
                [gold]
                    side=3
                    amount=32
                [/gold]
                [gold]
                    side=4
                    amount=26
                [/gold]
            [/case]
        [/switch]
        {CLEAR_VARIABLE random}

        [objectives]
            [objective]
                description= _ "Defeat Naemir to lift the storm"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Galun"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Vank"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=start
        [message]
            speaker=Galun
            message= _ "We are stuck in this cave until the storm lifts."
        [/message]
        [message]
            speaker=Vank
            message= _ "Hopefully the time will pass well."
        [/message]
        [message]
            speaker=Galun
            message= _ "Perhaps, old friend. There is something troubling about the storm and this place."
        [/message]

        [delay]
            time=1500
        [/delay]

        [message]
            speaker=narrator # Until the lich gives his name
            image="portraits/undead/lich.png~CHAN(20, 20, 20)"
            image_pos=right
            mirror=yes
            message= _ "Right you are. It is my storm and this is my domain."
        [/message]
        [message]
            speaker=Vank
            message= {WHISPER ( _ "Galun, that sounds like prey-speech.")}
        [/message]
        [message]
            speaker=Galun
            message= {WHISPER ( _ "Yes, it does. How fitting…")}
        [/message]
        [message]
            speaker=Galun
            message= _ "Who are <i>you</i> to challenge us?"
        [/message]
        [message]
            speaker=narrator
            image="portraits/undead/lich.png~CHAN(20, 20, 20)"
            image_pos=right
            mirror=yes
            message= _ "The new servants ask too many questions. I am Naemir, and I rule here."
        [/message]
        [message]
            speaker=Galun
            message= _ "I am Galun, and I am not ‘ruled’ by anyone."
        [/message]
        [message]
            speaker=Naemir
            image="portraits/undead/lich.png~CHAN(20, 20, 20)"
            image_pos=right
            mirror=yes
            message= _ "Here, you will either be ruled by me or you will be dead. Or, possibly, both."
        [/message]
        [message]
            speaker=Galun
            message= _ "No being of the lesser races may rule a drake."
        [/message]
        [message]
            speaker=Vank
            message= {WHISPER ( _ "Careful, Galun. We are no longer in Morogor…")}
        [/message]
        [message]
            speaker=Naemir
            image="portraits/undead/lich.png~CHAN(20, 20, 20)"
            image_pos=right
            mirror=yes
            message= _ "Lesser, am I? I think not."
        [/message]
        [message]
            speaker=Naemir
            image="portraits/undead/lich.png~CHAN(20, 20, 20)"
            image_pos=right
            mirror=yes
            message= _ "Rise, my pets, there is food for you."
        [/message]
        [delay]
            time=1000
        [/delay]
        [sound]
            name=hiss.wav # Serpent
        [/sound]
        [delay]
            time=1500
        [/delay]
        [sound]
            name=hiss-big.wav # Spider
        [/sound]
        [delay]
            time=1500
        [/delay]
        [message]
            speaker=Naemir
            image="portraits/undead/lich.png~CHAN(20, 20, 20)"
            image_pos=right
            mirror=yes
            message= _ "And you, arrogant one, shall serve me — living or dead, I care not."
        [/message]

        [delay]
            time=1000
        [/delay]

        [message]
            speaker=Galun
            message= _ "We cannot risk the breeders by escaping through the unnatural storm outside. We must defeat this foe."
        [/message]
    [/event]

    [event]
        name=sighted
        [filter]
            side=2
            type_adv_tree=Skeleton, Skeleton Archer, Lich
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [scroll_to_unit]
            id=$unit.id
            highlight=yes
        [/scroll_to_unit]
        [delay]
            time=1500
        [/delay]
        [message]
            side=1
            race=drake
            message= _ "Walking bones without meat! What kind of abominations are these?"
        [/message]
    [/event]

    [event]
        name=die
        [filter]
            side=2
            type_adv_tree=Walking Corpse
        [/filter]
        [filter_second]
            side=1
            race=drake
        [/filter_second]
        [message]
            speaker=second_unit
            message= _ "Yuck, this meat is rancid!"
        [/message]
    [/event]

    [event]
        name=die
        [filter]
            id=Naemir
        [/filter]
        [delay]
            time=3000
        [/delay]
        [endlevel]
            result=victory
        [/endlevel]
    [/event]
    [event]
        name=victory
        [message]
            speaker=Vank
            message= _ "That did it! The storm outside is lifting."
        [/message]
        [message]
            speaker=Galun
            message= _ "Let’s get out of here."
        [/message]
    [/event]
[/scenario]
