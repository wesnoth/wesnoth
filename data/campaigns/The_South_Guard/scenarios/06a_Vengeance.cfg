#textdomain wesnoth-tsg

#define TURN_LIMIT
13#enddef

[scenario]
    id=06a_Vengeance
    map_file=06a_Vengeance.map
    name= _ "Vengeance"
    next_scenario=06x_Epilogue
    victory_when_enemies_defeated=no
    {EXPERIENCE_MODIFIER_SCENARIO}
    {DEFAULT_SCHEDULE}
    turns={TURN_LIMIT}
    {ADD_WEATHER_SNOW}
    {SCENARIO_MUSIC loyalists.ogg}
    {EXTRA_SCENARIO_MUSIC the_city_falls.ogg}
    {EXTRA_SCENARIO_MUSIC the_dangerous_symphony.ogg}
    {TSG_BIGMAP (
        [if] {VARIABLE_CONDITIONAL s05c not_equals yes}
            [then]
                {JOURNEY_06a_NEW}
            [/then]
            [else]
                {JOURNEY_06c_NEW}
            [/else]
        [/if]
    )}

    #######################################################################################################################################################
    #                                                                   DEFINE SIDES
    #######################################################################################################################################################
    #############################
    # DEORAN
    #############################
    [side]
        side=1
        controller=human
        no_leader=yes
        team_name=good
        user_team_name=_"South Guard"
        gold=30
        recruit=Spearman,Bowman
        {CUSTOM_SG_FLAG}
        defeat_condition=never
        save_id=player_side
    [/side]

    #############################
    # TOWN GUARD
    #############################
    [side]
        side,controller,color=2,ai,wesred
        gold,income=0,{ON_DIFFICULTY 0 2 6} # give the town a little extra gold on higher difficulties. 1) this helps Westin not die as quickly, 2) this gives a real reason why you might choose to not take over the AI
        recruit=Spearman
        team_name=good
        user_team_name=_"Westin"
        no_leader=yes
        {CUSTOM_SG_FLAG}
    [/side]
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Bowman"   1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Peasant"  1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Woodsman" 2}
#define MAIN_AVOID_AREA
    x=0-23, 24, 24,  25, 25,  26, 26,  27, 27,  28, 28, 28,   29, 29,   30, 30,   31, 31,   32, 32,   33, 33,   34, 34,  35, 35,  36-99
    y=0-99, 0-4,6-99,0-4,7-99,0-3,6-99,0-5,7-99,0-4,7-9,11-99,0-5,10-99,0-5,12-99,0-5,10-99,0-4,10-99,0-3,11-99,0-3,6-99,0-5,7-99,0-99
#enddef
    [event]
        name=side 2 turn refresh
        first_time_only=no

        # prevent our crucial units from getting themselves killed
        {MODIFY_UNIT side,id=2,Mari moves 0}
        {MODIFY_UNIT side,id=2,"Sir Gerrick" moves 0}
        {MODIFY_UNIT side,id=2,"Minister Hylas" moves 0}
        # reset the micro AI each turn
        [micro_ai]
            side,ai_type,action=2,coward,delete
        [/micro_ai]

        # if the player is being aggressive (and we have extra soldiers) we should help out
        [if]{HAVE_UNIT( side,count=2,{ON_DIFFICULTY 4 5 6}-999 )} {HAVE_UNIT( side,count=1,3-999 {FILTER_LOCATION x,y,radius=1,5,17} )}
            {OR( {HAVE_UNIT side,count=2,{ON_DIFFICULTY 10 11 12}-999} )}
            [then]
                {RESET_SIDE_AI 2 offensive 0.4 0.25}
                {MODIFY_SIDE_AI 2 (
                    [avoid]
                        x=0-10,  11,  11, 12,  12, 13,   13, 14,   14, 15,   15, 16,   16, 17,   17, 18,   18, 19,   19, 20,   20, 21-99
                        y=0-99, 0-6,8-99,0-6,9-99,0-5,10-99,0-3,12-99,0-5,13-99,0-7,14-99,0-7,15-99,0-8,15-99,0-7,18-99,0-7,17-99, 19-99
                    [/avoid]
                )}
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 3 x,y=11,7})}
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 3 x,y=13,9})}
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 3 x,y=14,10})}
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 3 x,y=14,11})}
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 3 x,y=15,12})}
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 2 x,y=20,16})}
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 2 x,y=14,4})}
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 2 x,y=16,8})}
            [/then]

            # otherwise, play defensively
            [else]
                {RESET_SIDE_AI 2 no -1 1}
                {MODIFY_SIDE_AI 2 (
                    [avoid]
                        {MAIN_AVOID_AREA}
                    [/avoid]
                )}

                # if we have units out of the main area, use a MAI to have them retreat
                [micro_ai]
                    side,action,ai_type=2,add,coward
                    {FILTER( {FILTER_LOCATION {MAIN_AVOID_AREA}} )}
                    distance,attack_if_trapped=20,yes
                    seek_x,seek_y=31,7
                [/micro_ai]

                # protect the trapdoor
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 5 x,y=29,9})}
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 5 x,y=28,6})}
                # basic goals, so they don't afk in their keep
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 3 x,y=24,5})}
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 3 x,y=28,10})}
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 3 x,y=28,5})}
                {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 2 x,y=30,8})}
                [if] {HAVE_UNIT side,canrecruit=6,yes}
                    [then]
                        {MODIFY_SIDE_AI 3 ({GOAL_LOCATION 3 x,y=33,4})}
                        {MODIFY_SIDE_AI 1 ({GOAL_LOCATION 3 x,y=35,6})}
                    [/then]
                [/if]
            [/else]
        [/if]
    [/event]

    #############################
    # ELVES
    #############################
#define ELVISH_SIDE SIDE LEADER_AND_RECRUITS_WML
    [side]
        side,controller,color={SIDE},ai,green
        {LEADER_AND_RECRUITS_WML}
        gold,income={ON_DIFFICULTY 0 0 15},{ON_DIFFICULTY 3 8 16}
        team_name,user_team_name=elves,_"Aethenwood"
        {FLAG_VARIANT wood-elvish}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES {SIDE} 1}
#enddef
    {ELVISH_SIDE 3 (recruit=Elvish Fighter
    type,facing=Elvish Captain,ne
    [modifications]
        {TRAIT_RESILIENT}
        {TRAIT_STRONG}
    [/modifications] )}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Elvish Archer" ({ON_DIFFICULTY 0 1 1})}
    {ELVISH_SIDE 4 (recruit=Elvish Fighter
    type,facing=Elvish Hero,ne
    [modifications]
        {TRAIT_STRONG}
        {TRAIT_RESILIENT}
    [/modifications] )}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Elvish Archer" ({ON_DIFFICULTY 1 1 2})}
    {ELVISH_SIDE 5 (recruit=Elvish Shaman
    type,facing=Elvish Sorceress,ne
    [modifications]
        {TRAIT_QUICK}
        {TRAIT_STRONG}
    [/modifications] )}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Elvish Fighter" ({ON_DIFFICULTY 0 1 2})}
    {ELVISH_SIDE 6 (recruit=Elvish Archer
    no_leader,hidden=yes,yes )}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Elvish Marksman" ({ON_DIFFICULTY 0 1 2})}
    [event]
        name=side 3 turn
        first_time_only=no
        {RESET_SIDE_AI 3,4,5,6 offensive 0.4 0.25}
        {MODIFY_SIDE_AI 3,4,5,6 retreat_factor=0.75}
        [if] {VARIABLE_CONDITIONAL turn_number greater_than 5} # don't retreat right away
            [then]
                {VARY_AI_BY_SCHEDULE 3,4,5,6}
            [/then]
        [/if]
        {MODIFY_SIDE_AI 3,5,6 ({GOAL_LOCATION 11 x,y=30,7})}
        {MODIFY_SIDE_AI 3,5,6 (
            [avoid]
                x,y=0-99,20-99 # don't attack Deoran's starting area or go take the villages there; focus on the town
            [/avoid]
        )}
        [if] {VARIABLE_CONDITIONAL turn_number less_than 4}
            [then]
                {MODIFY_SIDE_AI 4 ({GOAL_LOCATION  11 x,y,radius=13,20,2})}
            [/then] # group up on the first few turns, then go fight Deoran
            [else]
                {MODIFY_SIDE_AI 4 ({GOAL_SEEK_SIDE 11 1 0})}
            [/else]
        [/if]
    [/event]

    # Ethiliel
    [side]
        side=7
        color=green
        controller=ai
        team_name=elves
        no_leader,hidden=yes,yes
    [/side]
    [event]
        name=side 7 turn refresh
        first_time_only=no
        {RESET_SIDE_AI 7 no 0.4 0.25}
        {MODIFY_UNIT id=Ethiliel moves 3} # enough to reach a village if she needs healing
        {MODIFY_SIDE_AI 7 ({GOAL_LOCATION 99 x,y=4,9})}
        {MODIFY_AI_DELETE_CANDIDATE_ACTION 7 main_loop move_leader_to_keep}
    [/event]

    # Statue
    [side]
        side,controller,color=8,null,wesred
        team_name=good,elves
        no_leader,hidden=yes,yes
    [/side]

    # Trapdoor
    [side]
        side,controller,color=8,null,wesred
        team_name=good,elves
        no_leader,hidden=yes,yes
    [/side]
    [event] # only allow elves to attack the trapdoor if there's no side=1,2 units adjacent
        name=side 2 turn end
        first_time_only=no
        [if] {HAVE_UNIT( side=1,2 {FILTER_ADJACENT side=8} )}
            [then]
                [modify_side]
                    side=8
                    team_name=good,elves
                [/modify_side]
            [/then]
            [else]
                [modify_side]
                    side=8
                    team_name=good
                [/modify_side]
            [/else]
        [/if]
    [/event]

    #######################################################################################################################################################
    #                                                                     PREPARE MAP
    #######################################################################################################################################################
    [event]
        name=prestart

        #############################
        # WESTIN SCENERY
        #############################
        {GENERIC_UNIT 8 Statue 31 9}
        {PLACE_IMAGE scenery/stairway.png 30 7}
        {PLACE_IMAGE scenery/temple1.png 28 5}
        {PLACE_IMAGE scenery/tent-fancy-red.png 24 13}
        {PLACE_IMAGE scenery/tent-shop-weapons.png 25 14}
        {PLACE_IMAGE items/archery-target-right.png 16 12}
        {PLACE_IMAGE items/archery-target-right.png 17 12}
        {BRAZIER_ILLUMINATION 26 8}
        {BRAZIER_ILLUMINATION 30 9}
        {BRAZIER_ILLUMINATION 25 13}
        #############################
        # ELVISH GUARDS
        #############################
        [unstore_unit]
            variable=stored_ethiliel
            x,y=4,9
        [/unstore_unit]
        {FULL_HEAL id=Ethiliel}
        {MODIFY_UNIT id=Ethiliel facing se}
        {MODIFY_UNIT id=Ethiliel side 7}
        [unhide_unit]
            id=Ethiliel # once, in a debug playthrough, Ethiliel somehow ended up with hidden=yes here. Not sure how, but fix it here just in case
        [/unhide_unit]
        {FIRE_EVENT refresh_experience}
        {GENERIC_UNITC 3 (Elvish Druid  )  13  9  ({ZONE_GUARDIAN 13  9 x,y,radius=13,10,4})}
        {GENERIC_UNITC 3 (Elvish Fighter)  16  8  ({ZONE_GUARDIAN 16  8 x,y,radius=13,10,4})}
        {GENERIC_UNITC 4 (Elvish Archer )   3 16  ({ZONE_GUARDIAN  3 16 x,y,radius=1,12,7})}
        {GENERIC_UNITC 4 (Elvish Archer )   1 17  ({ZONE_GUARDIAN  1 17 x,y,radius=1,12,7})}
        {GENERIC_UNITC 4 (Elvish Fighter)   2 14  ({ZONE_GUARDIAN  2 14 x,y,radius=1,12,7})}
        {GENERIC_UNITC 5 (Elvish Fighter)   4  6  ({ZONE_GUARDIAN  4  6 x,y,radius=1,7,10})}
        {GENERIC_UNITC 5 (Elvish Fighter)   1  6  ({ZONE_GUARDIAN  1  6 x,y,radius=1,7,10})}
        {GENERIC_UNITC 5 (Elvish Archer )   4  3  ({ZONE_GUARDIAN  4  3 x,y,radius=1,7,10})}
        {GENERIC_UNITC 5 (Elvish Archer )   3  3  ({ZONE_GUARDIAN  3  3 x,y,radius=1,7,10})}
        # archers are good against Deoran. These guys are here to hinder him if he tries to run straight in
        {GENERIC_UNITC 3 ({ON_DIFFICULTY "none" "Elvish Archer" "Elvish Archer"})  22 15   ({ZONE_GUARDIAN 22 15 x,y,radius=23,16,7})}
        {GENERIC_UNITC 3 ({ON_DIFFICULTY "none" "Elvish Archer" "Elvish Archer"})  19 17   ({ZONE_GUARDIAN 19 17 x,y,radius=23,16,7})}
        {GENERIC_UNITC 3 ({ON_DIFFICULTY "none" "none"          "Elvish Archer"})  23 17   ({ZONE_GUARDIAN 23 17 x,y,radius=23,16,7})}
        {GENERIC_UNITC 3 ({ON_DIFFICULTY "none" "none"          "Elvish Archer"})  25 15   ({ZONE_GUARDIAN 25 15 x,y,radius=23,16,7})}
        #############################
        # ELVISH ATTACKERS
        #############################
        {GENERIC_UNITC 3 {ON_DIFFICULTY "Elvish Fighter" "Elvish Fighter" "Elvish Fighter"} 14 10 ()}
        {GENERIC_UNITC 3 {ON_DIFFICULTY "none"           "Elvish Archer"  "Elvish Archer" } 14 11 ()}
        {GENERIC_UNITC 3 {ON_DIFFICULTY "none"           "none"           "Elvish Fighter"} 15 12 ()}
        {GENERIC_UNITC 4 {ON_DIFFICULTY "Elvish Archer"  "Elvish Archer"  "Elvish Archer" }  1 14 ()}
        {GENERIC_UNITC 4 {ON_DIFFICULTY "none"           "Elvish Fighter" "Elvish Fighter"}  2 14 ()}
        {GENERIC_UNITC 4 {ON_DIFFICULTY "none"           "none"           "Elvish Fighter"}  1 16 ()}
        {GENERIC_UNITC 5 {ON_DIFFICULTY "Elvish Shaman"  "Elvish Shaman"  "Elvish Shaman" }  2  4 ()}
        {GENERIC_UNITC 5 {ON_DIFFICULTY "none"           "Elvish Shaman"  "Elvish Shaman" }  2  5 ()}
        {GENERIC_UNITC 5 {ON_DIFFICULTY "none"           "none"           "Elvish Fighter"}  2  6 ()}
        #############################
        # HEROES
        #############################
        [unit]
            side,x,y=2,1,1
            {SINGLEUNITWML_HYLAS}
        [/unit]
        [unit]
            side,x,y=2,1,1
            {SINGLEUNITWML_GERRICK}
        [/unit]
        [unit]
            side,x,y=2,1,1
            {SINGLEUNITWML_MARI}
        [/unit]
        {KILL side,id=2,$companion_id} # our companion is still on our recall list
        [if] {HAVE_UNIT side,id=2,"Minister Hylas"}
            [then]
                {MODIFY_UNIT   side,id=2,"Minister Hylas" canrecruit yes}
                {TELEPORT_UNIT side,id=2,"Minister Hylas" 32 8}
                {TELEPORT_UNIT side,id=2,Mari             28 6}
                {TELEPORT_UNIT side,id=2,"Sir Gerrick"    28 6}
            [/then]
            [else]
                {MODIFY_UNIT   side,id=2,"Sir Gerrick"    canrecruit yes}
                {TELEPORT_UNIT side,id=2,"Sir Gerrick"    32 8}
                {TELEPORT_UNIT side,id=2,Mari             28 6}
                {TELEPORT_UNIT side,id=2,"Minister Hylas" 28 6}
            [/else]
        [/if]
        [modify_unit]
            {FILTER side,canrecruit=2,yes}
            [object]
                {EFFECT overlay remove=misc/hero-icon.png}
            [/object]
        [/modify_unit]
        {MODIFY_UNIT id="Minister Hylas","Sir Gerrick",Mari facing sw}
        [capture_village]
            side,x,y=2,23-99,0-11
        [/capture_village]

        #############################
        # TOWN GUARDS
        #############################
        {GENERIC_UNITC 2 Spearman  24  5  ({ZONE_GUARDIAN 24  5 x,y,radius=24,5,1})}
        {GENERIC_UNITC 2 Spearman  28 10  ({ZONE_GUARDIAN 28 10 x,y,radius=28,10,1})}
        {GENERIC_UNITC 2 Peasant   28  6  ()}
        {GENERIC_UNITC 2 Woodsman  33  4  ()}
        {GENERIC_UNITC 2 Peasant   30  8  ()}
#define TOWNSFOLK X Y IMAGE ROLENAME
    {GENERIC_UNIT 2 (Townsfolk) {X} {Y}} {ROLE {ROLENAME}}
    [object]
        {FILTER x,y={X},{Y}}
        [effect]
            apply_to=image_mod
            add="O(0)~CROP(0,0,72,72)~BLIT(units/townsfolk/{IMAGE})"
        [/effect]
    [/object]
#enddef
        {TOWNSFOLK 29 9 scribe.png        town1}
        {TOWNSFOLK 32 5 madame.png        town2}
        {TOWNSFOLK 31 8 worker+female.png town3}
        #############################
        # IF S05C
        #############################
        [if] {VARIABLE_CONDITIONAL s05c equals yes}
            [then]
                [replace_map]
                    map_file=06c_Vengeance.map
                    expand,shrink=yes,yes
                [/replace_map]
                {MODIFY_UNIT side=2 side 1}
                [capture_village]
                    side,x,y=1,23-99,0-11
                [/capture_village]
            [/then]
        [/if]

        {SCROLL_TO 32 8}
    [/event]

    #######################################################################################################################################################
    #                                                                    PLAY SCENARIO
    #######################################################################################################################################################
    [event]
        name=start
        #############################
        # GETTING TOWNSFOLK TO SAFETY
        #############################
        {DELAY 500}
        {MOVE_UNIT role=town1 30 7} {KILL role=town1} {DELAY 250}
        {MOVE_UNIT role=town2 30 7} {KILL role=town2} {DELAY 250}
        {MOVE_UNIT role=town3 30 7} {KILL role=town3}{DELAY 250}
        [item]
            x,y,halo=30,7,"scenery/trapdoor-centered.png~FL()"
            name=trapdoor
        [/item]
        {GENERIC_UNIT 9 Trapdoor 30 7}
        {DELAY 250}
        {SAY_IF_HAVE
        "Sir Gerrick" _"C’mon, keep movin’, everyone get underground. We don’ have much time left ’til—"
        Mari          _"Could you go any slower? Come on, everyone get underground. We don’t have much time left until—"
        }
        [message]
            speaker,image=Ethiliel,portraits/ethiliel-mad.webp
            message= _ "This is your last warning, humans. Return to us our sage or I shall be forced to resume our attack!"
        [/message]

        #############################
        # DEORAN ARRIVES
        #############################
        [if] {VARIABLE_CONDITIONAL s05c not_equals yes}
            [then]
                {SCROLL_TO               9 32} {DELAY 500}
                {RECALL_XY Deoran        9 32} {DELAY 500}
                {RECALL_XY $companion_id 8 32} {DELAY 500}
                {VARIABLE ignore_companion_defeat yes}
                [message]
                    speaker,image=Deoran,portraits/deoran-mad.webp
                    message= _ "Ethiliel! What’s going on here? What have you done?!"
                [/message]
                [message]
                    speaker=Ethiliel
                    message= _ "Deoran — good, you’re here. And even better, I see you no longer shelter that snake Afalas! Does this mean you humans have reconsidered your decisions, and have finally freed Mebrin from his bonds?"
                [/message]
                [message]
                    speaker=Deoran
                    message= _ "Mebrin is dead, Ethiliel. Afalas was right. I saw the lich Mal M’Brin with my own two eyes, heard his ravings with my own two ears! I watched him raise the dead up out of the ground!"
                [/message]
                [message]
                    speaker,image=Ethiliel,portraits/ethiliel-mad.webp
                    message= _ "Then where is his corpse, mayfly? Where is the evidence for the horrible things of which you accuse? I have known Mebrin my whole life — you, scarcely four months. Who shall I believe?"
                [/message]
                [message]
                    speaker=Ethiliel
                    message= _ "No, I felt Mebrin’s elfin presence. I felt him reaching out to me, I felt him in pain! No elf would fall to undeath, much less our wisest teacher."
                [/message]
                [message]
                    speaker,image=Ethiliel,portraits/ethiliel-mad.webp
                    message= _ "I don’t know why you won’t just admit what you’ve truly done with him — you fool humans’ stubbornness will be all of your undoing! Until you return Mebrin to us I have no choice but to cut you down!"
                [/message]
                [message]
                    speaker=Deoran
                    message= _ "Ethiliel, listen to yourself! ...there’s no reasoning with her, is there?"
                [/message]

                #############################
                # DISCUSSING WHAT TO DO
                #############################
                {MOVE_UNIT id=Deoran 10 30} {DELAY 150}
                {MODIFY_TERRAIN Ke 10 30} [redraw][/redraw] {DELAY 150}
                {MODIFY_TERRAIN Ce  9 30} [redraw][/redraw] {DELAY 150}
                {MODIFY_TERRAIN Ce 10 29} [redraw][/redraw] {DELAY 150}
                {MODIFY_TERRAIN Ce 11 30} [redraw][/redraw] {DELAY 150}
                [message]
                    speaker=Deoran
                    message= _ "Whether this rage is Ethiliel herself, Mebrin’s dark influence, or a mix of both, it’s clear that words alone are not going to change her mind."
                [/message]
                {SAY_COMPANION
                MESSAGE_MARI=_"Guess it’s time to take her down, then? Not my favorite plan, but what’s one little elf after an entire undead lich?"
                MESSAGE_GERRICK=_"Time to take her down by force? Shame to break a pretty face, but nothin’ can be as bad as fightin’ that lich."
                MESSAGE_HYLAS=_"Then it seems our only option is the violent one. This is not my preferred course of action, but I will do what I must."
                }
                [message]
                    speaker=Deoran
                    message= _ "No, absolutely not. I’ve spent enough time with Ethiliel to understand her and her culture. If we kill an elf of this importance in offensive action, never again in our lifetimes will there be peace between Wesnoth and the Aethenwood. And she’s not evil, she just... really believes she’s doing the right thing."
                [/message]
                [message]
                    speaker=Deoran
                    message= _ "Instead we make for Westin. We will rendezvous with the town defenders and hold the walls — the self-righteous fury that drives Ethiliel can only burn for so long. Once the dust settles, the elves may finally be willing to talk."
                [/message]

                #############################
                # OBJECTIVES
                #############################
                [objectives]
                    side=1
                    [objective]
                        description= _ "Reach Westin before it falls,
then survive until turns run out"
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "The town cellars are breached"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Deoran"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Ethiliel"
                        condition=lose
                    [/objective]
                    {IS_LAST_SCENARIO}
                [/objectives]
            [/then]

            #############################
            # DEORAN DOESN'T ARRIVE
            #############################
            # if we played S05c, Deoran got trapped in some caves and isn't the POV character for this scenario
            [else]
                [message]
                    speaker,image=Ethiliel,portraits/ethiliel-mad.webp
                    message= _ "I heard Afalas’s words. I watched Deoran’s choice. I know Westin and the Urza brothers have conspired to kidnap our sage, but it is not too late! Give new orders to Deoran, to return Mebrin to his home!"
                [/message]
                {SAY_IF_HAVE
                Mari             _"Lay off it, woman! I already told you we don’t have the slightest clue what you’re talking about!"
                "Minister Hylas" _"We cannot give what we do not have, elf. Whatever has driven you to such desperation, I urge you to reconsider."
                }
                [message]
                    speaker,image=Ethiliel,portraits/ethiliel-mad.webp
                    message= _ "No, I felt Mebrin reaching out to me. I felt him in pain! He needed me to do this! I have known Mebrin my whole life — you, scarcely a day now. Who shall I believe?"
                [/message]
                [message]
                    speaker,image=Ethiliel,portraits/ethiliel-mad.webp
                    message= _ "I don’t know why you won’t just admit what you’ve truly done with him — you fool humans’ stubbornness will be all of your undoing! Until Deoran returns Mebrin to us I have no choice but to cut you down!"
                [/message]
                {DELAY 500}
                {SAY_IF_HAVE
                "Minister Hylas" _"It seems our young Deoran has caused quite some trouble — now if only he and his soldiers were here to help solve it. We shall have to fight as best we can alone."
                "Mari"           _"Figures this’d all be the rookie’s fault. I knew I should’ve gone with to keep him out of trouble... Guess it’s up to us to keep the town safe."
                }
                {SAY_IF_HAVE
                "Sir Gerrick" _"Aye... I’ve got most o’ the civilians safe underground in th’ cellars, with our trapdoor shut an’ barred. If we’re lucky, we can clean up this mess without any more gettin’ hurt."
                "Mari" _"Yeah... I’ve got most of the civilians safely underground in the cellars, with the trapdoor shut and barred. If we’re lucky, we can clean us this mess without any more getting hurt."
                }
                {SAY_IF_HAVE
                "Minister Hylas" _"And so we are caught between a rock and a hard place. We cannot flee, or the elves would cut us down. We cannot attack, or we risk provoking an all-out war. Our only choice is to hold the town, and hope the elves see sense."
                "Mari"           _"Caught between a rock and a hard place. We can’t flee, or the elves would cut us down. Can’t attack, or we provoke an all-out war. Guess our only option is to hold the town and hope the elves see sense."
                }
                [event]
                    name=turn 3
                    {FIRE_EVENT lament_isolation_start_timer}
                [/event]

                #############################
                # OBJECTIVES
                #############################
                [objectives]
                    side=1
                    [objective]
                        description= _ "Survive until turns runs out"
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "The town cellars are breached"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Ethiliel"
                        condition=lose
                    [/objective]
                    {IS_LAST_SCENARIO}
                [/objectives]
            [/else]
        [/if]

        {S06_SACRIFICIAL_LAMB_TIP}
    [/event]

    #######################################################################################################################################################
    #                                                                DEORAN REACHES WESTIN
    #######################################################################################################################################################
    [event]
        name=moveto
        {FILTER( side=1 {FILTER_LOCATION( x,y,radius=34,5,9 )} )}
        {FILTER_CONDITION({HAVE_UNIT id=Deoran})}
        #############################
        # RE-INTRODUCTIONS
        #############################
        {SAY_IF_HAVE
        "Sir Gerrick" _"Look out, more elves at the perimeter! No, wait... it’s Sir Deoran. He’s alive!"
        "Minister Hylas" _"Take care! More elves approach our ramparts. No, wait... ’tis Commander Deoran. He comes to our aid!"
        SIDE=2
        }
        [message]
            speaker=Deoran
            message= _ "Hail, friends! I am relieved to see the town walls still standing, but I am sorry to confess that this whole problem with the elves is rather my doing. The full story is too long to speak of now."
        [/message]
        {SAY_IF_HAVE
        "Minister Hylas" _"The elves demand that we produce someone called “Mebrin” — I take it you know who that is? In his absence, we have instead focused our efforts on protecting the townsfolk."
        "Mari" _"Figures this’d all be the rookie’s fault. While you’ve been running around causing problems, we’ve been trying to actually keep the town safe."
        SIDE=2
        }
        {SAY_IF_HAVE
        "Sir Gerrick" _"Aye... I’ve got most o’ the civilians safe underground in th’ cellars, with our trapdoor shut an’ barred. If we’re lucky, we can clean up this mess without any more gettin’ hurt."
        "Mari" _"Yeah... I’ve got most of the civilians safely underground in the cellars, with the trapdoor shut and barred. If we’re lucky, we can clean us this mess without any more getting hurt."
        SIDE=2
        }
        {SAY_IF_HAVE
        "Minister Hylas" _"Deoran, you have the most experience dealing with these elves, and a more complete understanding of the situation than do I. If you wish to command the defense, our soldiers are at your service."
        "Sir Gerrick" _"Deoran, sounds like you’ve got the most experience dealin’ with these elves, an’ a better idea o’ what’s really goin’ on. If you want to take charge, my boys’re yours to command."
        SIDE=2
        }

        #############################
        # CHOICE
        #############################
        [message]
            speaker=Deoran
            [option]
                label= _ "Assume command of Westin’s defense"
                [command]
                    [capture_village]
                        owner_side,side=2,1
                    [/capture_village]
                    [heal_unit]
                        {FILTER side=2}
                        amount,moves,restore_attacks=0,full,yes
                    [/heal_unit]
                    [remove_object]
                        side,canrecruit=2,yes
                    [/remove_object]
                    {MODIFY_UNIT side,canrecruit=2,yes canrecruit no}
                    {MODIFY_UNIT side=2 side 1}
                    [message]
                        speaker=Deoran
                        message= _ "I shall assume command, my friend. Now hold fast, men of the South Guard! No matter how daunting the armies that oppose us, we must weather this shadow and defend our homes!"
                    [/message]
                [/command]
            [/option]
            [option]
                label= _ "Leave Westin’s defenders under AI control"
                [command] # leaving this as an option. 1) new players may prefer to let the AI help out, and 2) the AI also gets some base income that's lost if you take over
                    [message]
                        speaker=Deoran
                        message= _ "Command of Westin remains yours, my friend. Hold fast, men of the South Guard! No matter how daunting the armies that oppose us, we must weather this shadow and defend our homes!"
                    [/message]
                [/command]
            [/option]
        [/message]
        {FIRE_EVENT lament_isolation_start_timer}
        #############################
        # TRAPDOOR OBJECTIVE REMINDER
        #############################
        [event]
            name=attack end
            {FILTER_SECOND type=Trapdoor}
            [message]
                speaker=Deoran
                message= _ "The elves are trying to break into the cellars! If they get among the refugees, all will be lost."
            [/message]
        [/event]

        #############################
        # OBJECTIVES
        #############################
        [objectives]
            side=1
            [objective]
                description= _ "Survive until turns run out"
                condition=win
            [/objective]
            [objective]
                description= _ "The town cellars are breached"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Deoran"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Ethiliel"
                condition=lose
            [/objective]
            {IS_LAST_SCENARIO}
        [/objectives]
    [/event]

    #############################
    # MAYFLIES
    #############################
    [event]
        name=attack
        {FILTER side=3,4,5,6}
        [message]
            speaker=unit
            message= _ "You mayflies should never have interfered in our affairs. Now all your kind shall pay the price."
        [/message]
    [/event]

    #############################
    # LAMENTING
    #############################
    [event]
        name=lament_isolation_start_timer
        [event]
            name=new turn
            # it's possible but unlikely that multiple companions are dead here, which would break the dialogue
            [if] {VARIABLE_CONDITIONAL companion_id equals "Sir Gerrick"}
                [then]
                    {SAY_IF_HAVE
                    Deoran           _"I curse our isolation, so far removed from the great cities of the north. The capital garrison alone would make Westin’s walls impenetrable, if only they could have been contacted in time!"
                    "Minister Hylas" _"Our isolation is truly lamentable, so far removed from the great cities of the north. The capital garrison alone would make our walls impenetrable, if only they could have been contacted in time."
                    }
                [/then]
                [else]
                    {SAY_IF_HAVE
                    Deoran           _"I curse our isolation, so far removed from the great cities of the north. The capital garrison alone would make Westin’s walls impenetrable, if only they could have been contacted in time!"
                    "Sir Gerrick"    _"I curse our isolation, so far from the great cities o’ the north. The capital garrison alone would make our walls unbreakable, if only they could’ve been reached in time!"
                    }
                [/else]
            [/if]
            {SAY_IF_HAVE
            Mari             _"That’s assuming Weldyn would even bother to help out a podunk like this. Capital of the southern province, sure, but that’s not saying much. Without Prince Arand’s ambitions for this place, I doubt anybody — you and me included — would much care what happened here."
            "Minister Hylas" _"Even then, Westin is small and remote, and thus easy for others to overlook. Prince Arand’s ambitions for this place are the better part of the reason we have any significance at all — as well as the reason you were deployed here, Deoran."
            }
            {SAY_IF_HAVE
            "Sir Gerrick" _"O’ course, if th’ prince had actually come here himself instead o’ spendin’ all ’is time up in Weldyn with the king, we might’ve not gotten in such trouble in th’ first place..."
            Mari _"Of course, if the prince had actually come here himself instead of spending all his time up at Weldyn with the king, we might’ve not gotten in such trouble in the first place..."
            }
        [/event]
    [/event]

    #############################
    # ELVISH REINFORCEMENTS
    #############################
    [event]
        name=side 6 turn 9 refresh
        [if]
            {NOT({HAVE_UNIT( side,count=1,1-99 {FILTER_LOCATION x,y,radius=39,1,3} )})}
            {NOT({HAVE_UNIT( side,count=1,3-99 {FILTER_LOCATION x,y,radius=39,1,7} )})}
            [then]
                {GENERIC_UNITC 6 (Elvish Archer) 40 1 ({ANIMATE})}
                {GENERIC_UNITC 6 (Elvish Archer) 41 3 ({ANIMATE}{ZONE_GUARDIAN 41 3 x,y,radius=41,1,4})}
                [unit]
                    side,x,y,facing=6,41,1,se
                    type,canrecruit=Elvish Sharpshooter,yes
                    animate=yes
                [/unit]
                {MOVE_UNIT side,canrecruit=6,yes 39 1}
                {MODIFY_TERRAIN Ke 39 1} [redraw][/redraw] {DELAY 150}
                {MODIFY_TERRAIN Ce 39 2} [redraw][/redraw] {DELAY 150}
                {MODIFY_TERRAIN Ce 38 1} [redraw][/redraw] {DELAY 150}
                {MODIFY_TERRAIN Ce 37 1}
                {MODIFY_TERRAIN Dd 36 0} [redraw][/redraw] {DELAY 150}
            [/then]
            [elseif]
                {NOT({HAVE_UNIT( side,count=1,1-99 {FILTER_LOCATION x,y,radius=39,12,3} )})}
                {NOT({HAVE_UNIT( side,count=1,3-99 {FILTER_LOCATION x,y,radius=39,12,6} )})}
                [then]
                    {GENERIC_UNITC 6 (Elvish Archer) 40 11 ({ANIMATE})}
                    {GENERIC_UNITC 6 (Elvish Archer) 41 11 ({ANIMATE}{ZONE_GUARDIAN 41 11 x,y,radius=41,13,4})}
                    [unit]
                        side,x,y,facing=6,41,13,se
                        type,canrecruit=Elvish Sharpshooter,yes
                        animate=yes
                    [/unit]
                    {MOVE_UNIT side,canrecruit=6,yes 39 13}
                    {MODIFY_TERRAIN Ke 39 13} [redraw][/redraw] {DELAY 150}
                    {MODIFY_TERRAIN Ce 39 12} [redraw][/redraw] {DELAY 150}
                    {MODIFY_TERRAIN Ce 38 12} [redraw][/redraw] {DELAY 150}
                    {MODIFY_TERRAIN Ce 39 14} [redraw][/redraw] {DELAY 150}
                [/then]
            [/elseif]
            [else]
                {GENERIC_UNITC 6 (Elvish Archer) 12 2 ({ANIMATE})}
                {GENERIC_UNITC 6 (Elvish Archer) 11 2 ({ANIMATE}{ZONE_GUARDIAN 11 2 x,y,radius=13,1,4})}
                [unit]
                    side,x,y,facing=6,13,1,se
                    type,canrecruit=Elvish Sharpshooter,yes
                    animate=yes
                [/unit]
                {MODIFY_TERRAIN Ke 13 1} [redraw][/redraw] {DELAY 150}
                {MODIFY_TERRAIN Ce 13 2} [redraw][/redraw] {DELAY 150}
                {MODIFY_TERRAIN Ce 14 1} [redraw][/redraw] {DELAY 150}
                {MODIFY_TERRAIN Ce 15 1} [redraw][/redraw] {DELAY 150}
            [/else]
        [/if]

        {MODIFY_UNIT side=6 moves        3} # let them move immediately to counter spawncamping, but not far enough that they're likely to hit any normally-positioned player units
        {MODIFY_UNIT side=6 attacks_left 1}
        [modify_side]
            side=6
            gold={ON_DIFFICULTY 15 45 105} # 1 free non-guard archer, so real gold is 30/60/120
            hidden=no
        [/modify_side]

        [message]
            side,canrecruit=1,yes
            message= _ "They’ve come around behind us! Stand fast, soldiers of the South Guard!"
        [/message]
    [/event]

    #############################
    # REFUND ELVISH GOLD
    #############################
    [event]
        name=last breath
        {FILTER side=3,4,5,6}
        [message]
            speaker=unit
            message= _ "My kin will avenge me! For every one of us you strike down... more will come..."
        [/message]
        [event]
            name=die
            {DELAY 250}
            [message]
                speaker=Deoran
                message= _ "Every elf who dies only serves to further enrage the rest, drawing more warriors out of the Aethenwood!"
            [/message]
        [/event]
    [/event]
    [event]
        name=die
        first_time_only=no
        {FILTER side=3,4,5,6}
        [filter_condition] # make sure we have at least 1 leader, or else this is an infinite loop
            [have_unit]
                side=3,4,5,6
                canrecruit=yes
            [/have_unit]
        [/filter_condition]

        {VARIABLE refund_amount $unit.cost}
        [while] {VARIABLE_CONDITIONAL refund_amount greater_than 0}
            [do]
                {VARIABLE_OP refund_side rand 3,4,5,6}
                [if] {HAVE_UNIT side,canrecruit=$refund_side,yes}
                    [then]
                        [gold]
                            side=$refund_side
                            amount=1
                        [/gold]
                        {VARIABLE_OP refund_amount sub 1}
                    [/then]
                [/if]
            [/do]
        [/while]
        [floating_text]
            x,y=$unit.x,$unit.y
            #po: $unit.cost will be the value of the unit; likely between 14 and 40. If translation is an issue, the exact cost can be omitted.
            text= _ "<span color='#FFD700' size='x-small'>$unit.cost gold refunded</span>"
        [/floating_text]
    [/event]
#define TRANSFER_DEAD_LEADER_GOLD DEAD_SIDE LIVE_SIDE
    [event]
        name=new turn,side 1 turn end
        first_time_only=no
        {FILTER_CONDITION( {NOT({HAVE_UNIT side,canrecruit={DEAD_SIDE},yes})} )}
        [store_gold]
            side={DEAD_SIDE}
        [/store_gold]
        [gold]
            side,amount={LIVE_SIDE},$gold
        [/gold]
        [modify_side]
            side,gold={DEAD_SIDE},0
        [/modify_side]
        {CLEAR_VARIABLE gold}
    [/event]
#enddef
    {TRANSFER_DEAD_LEADER_GOLD 3 4}
    {TRANSFER_DEAD_LEADER_GOLD 4 5}
    {TRANSFER_DEAD_LEADER_GOLD 5 6}
    {TRANSFER_DEAD_LEADER_GOLD 6 3}
    #######################################################################################################################################################
    #                                                                 VICTORY / DEFEAT
    #######################################################################################################################################################
    #############################
    # ETHILIEL DIES
    #############################
    [event]
        name=last breath
        {FILTER id=Ethiliel}
        [message]
            speaker=Ethiliel
            message = _"Mebrin, I’m sorry... I tried..."
        [/message]
        [event]
            name=die
            [message]
                side,canrecruit=1,yes
                message = _"Ethiliel is dead! Even if we win by force of arms today, there will never again be peace between Wesnoth and the Aethenwood... We’ve started a war..."
            [/message]
            [message]
                side,canrecruit=1,no
                [show_if]
                    {NOT({HAVE_UNIT side,canrecruit=1,yes})}
                [/show_if]
                message = _"Ethiliel is dead! Even if we win by force of arms today, there will never again be peace between Wesnoth and the Aethenwood... We’ve started a war..."
            [/message]
            {ACHIEVE s06a}
            [endlevel]
                result=defeat
            [/endlevel]
        [/event]
    [/event]

    #############################
    # TIME OVER (AFALAS)
    #############################
    [event]
        name=side 6 turn {TURN_LIMIT} end
        {FILTER_CONDITION({VARIABLE_CONDITIONAL s05c not_equals yes})}
        {FADE_MUSIC_OUT 800}
        {REPLACE_SCENARIO_MUSIC heroes_rite.ogg}
        {FADE_MUSIC_IN 100}
        #############################
        # AFALAS ARRIVES
        #############################
        {SCROLL_TO 1 12} {DELAY 250}
        {NAMED_UNIT 6 (Elvish Champion) 1 12 Galdrad  _"Galdrad" (canrecruit,facing,animate=yes,ne,yes
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_STRONG}
        [/modifications]
    )}
    {MOVE_UNIT id=Galdrad 2 11}
    {MODIFY_UNIT id=Ethiliel facing sw}
    {DELAY 250}
    [message]
        speaker=Galdrad
        message = _"Ethiliel! What in Irdya is going on here?"
    [/message]
    [message]
        speaker,image=Ethiliel,portraits/ethiliel-mad.webp
        message = _"These snakes have captured Mebrin, and committed who knows what horrible atrocities against him! Galdrad, we must take him back!"
    [/message]
    [message]
        speaker=Galdrad
        message = _"Kidnapped Mebrin? I have heard otherwise. Ethiliel, this is Urza Afalas of the humans."
    [/message]
    [unstore_unit]
        variable=stored_afalas
        x,y,animate=1,12,yes
    [/unstore_unit]
    {MODIFY_UNIT id=Afalas facing ne}
    {MOVE_UNIT id=Afalas   1 11}
    {DELAY 500}
    {MOVE_UNIT id=Ethiliel 2 10}
    [message]
        speaker=Ethiliel
        message = _"We’ve met. This absolute scum, pig of a mudling—"
    [/message]
    [harm_unit]
        {FILTER id=Ethiliel}
        {FILTER_SECOND id=Afalas}
        [primary_attack]
            name=ensnare
        [/primary_attack]
        amount,damage_type=6,impact
        animate,delay=yes,0
    [/harm_unit]
    {MODIFY_UNIT id=Afalas status.slowed yes}
    [message]
        speaker=Afalas
        message = _"Hey! Hands off, lady! I try to make things right, come back t’ try an’ explain, an’ this be what I get? Trussed up in vines an’ called names by some—"
    [/message]

    #############################
    # EXPLAINING MEBRIN
    #############################
    [message]
        speaker=Galdrad
        message = _"What Urza Afalas <i><b>means</b></i> to say, is that I can corroborate the humans’ story. Some days ago, this outlaw came to me with unlikely words."
    [/message]
    [message]
        speaker=Afalas
        message = _"...yeah, I did. I heard them rangers in the forest southways, knew they’d be wantin’ my head. I could’a ran an’ hid, but I wanted to make things right. I went back t’ where we fought Mebrin, then t’ the Aethenwood."
    [/message]
    [message]
        speaker=Afalas
        message = _"You may think us men t’ all be criminals an’ outlaws, but we’re still human bei— err, livin’ beings, and we still know justice an’ truth. My brothers an’ I did wrong. It’s my responsibility to make things right."
    [/message]
    [message]
        speaker=Galdrad
        message = _"Afalas’ words could have seen him imprisoned, or worse, but at the height of my anger he produced the skull of a lich. The druids confirmed it — the skull was Mebrin’s."
    [/message]
    [message]
        speaker,image=Ethiliel,portraits/ethiliel-mad.webp
        message = _"The Mebrin I know is so gentle. So wise! It cannot be... can it?"
    [/message]
    [message]
        speaker=Ethiliel
        message = _"I did not want to believe the humans’ words. I could not bear to believe... But if Mebrin really did turn to undeath, then I have been the cause of so much meaningless bloodshed."
    [/message]
    [message]
        speaker=Ethiliel
        message = _"It’s true, isn’t it..."
    [/message]
    [message]
        speaker=Ethiliel
        message = _"..."
    [/message]
    {DELAY 250}
    {MOVE_UNIT id=Ethiliel 3 10}
    {DELAY 250}
    {MODIFY_UNIT id=Ethiliel facing sw}
    #############################
    # ETHILIEL APOLOGIZES
    #############################
    [message]
        speaker=Ethiliel
        message = _"Urza Afalas, thank you. I see now that not all humans are alike, and that you, too, are capable of courage and loyalty. Vengeance only begets more vengeance. You — and your brothers, posthumously — are forgiven."
    [/message]
    [message]
        speaker=Afalas
        message = _"<i>You</i> forgive <i>me</i>! After all the blood—"
    [/message]
    [message]
        speaker=Galdrad
        message = _"And Urza Afalas graciously accepts your forgiveness. Now come, Ethiliel. You have been away from your people for far too long. Our attack against the humans is over."
    [/message]

    {VARIABLE epilogue elves}
    [endlevel]
        result=victory
        linger_mode=no
        carryover_report=no
        save=no
    [/endlevel]
[/event]

#############################
# TIME OVER (DEORAN)
#############################
[event]
    name=side 6 turn {TURN_LIMIT} end
    {FILTER_CONDITION({VARIABLE_CONDITIONAL s05c equals yes})}
    {FADE_MUSIC_OUT 800}
    {ACHIEVE s05c}
    {REPLACE_SCENARIO_MUSIC heroes_rite.ogg}
    {FADE_MUSIC_IN 100}
    #############################
    # DEORAN ARRIVES
    #############################
    {SCROLL_TO               9 22} {DELAY 500}
    [unstore_unit]
        variable=stored_deoran
        x,y,animate=9,22,yes
    [/unstore_unit]
    {MODIFY_UNIT id=Deoran side 2}
    {MODIFY_UNIT id=Deoran facing ne}
    {DELAY 500}
    [unstore_unit]
        variable=stored_companion
        x,y,animate=8,22,yes
    [/unstore_unit]
    {MODIFY_UNIT id=$companion_id facing ne}
    {MODIFY_UNIT id=$companion_id side 2}
    {DELAY 500}
    {GENERIC_UNIT 1 "Troll" 10 22} {ANIMATE}
    {DELAY 500}
    #############################
    # DEORAN CONFRONTS ETHILIEL
    #############################
    [message]
        speaker,image=Deoran,portraits/deoran-mad.webp
        message= _ "Ethiliel! What’s going on here? What have you done?!"
    [/message]
    [message]
        speaker=Ethiliel
        message= _ "Deoran — good, you’re finally here. I knew that under enough pressure, Westin would eventually cave and summon you back. Does this mean you humans have reconsidered your decisions, and have finally freed Mebrin from his bonds?"
    [/message]
    [message]
        speaker=Deoran
        message= _ "No-one summoned me here, Ethiliel. Afalas was right. I saw the lich Mal M’Brin with my own two eyes, heard his ravings with my own two ears! I watched him raise the dead up out of the ground!"
    [/message]
    [message]
        speaker,image=Ethiliel,portraits/ethiliel-mad.webp
        message= _ "More lies, infuriating lies! Where is his corpse, mayfly? Where is the evidence for the horrible things of which you accuse? No elf would fall to undeath, much less our wisest teacher."
    [/message]
    {MOVE_UNIT id=Deoran 6 10}
    [message]
        speaker=Deoran
        message= _ "No elf could fall to undeath? What is this, then? I show you the skull of a lich, unmistakably elven, and unmistakably undead!"
    [/message]
    [message]
        speaker=Deoran
        message= _ "My men and I chased Mal M’Brin down into the depths of the earth, pushing ourselves nearly to exhaustion. When at last the lich was on the brink of defeat, with his last gasp of foul magic he collapsed his cave on us."
    [/message]
    [message]
        speaker=Deoran
        message= _ "Many perished, including Mebrin himself. But after days of hard labor by both man and troll, we dug ourselves free and set out for Westin, bringing the skull of our vanquished foe. You recognize its elven features, Ethiliel, do you not?"
    [/message]

    #############################
    # ETHILIEL BELIEVES DEORAN
    #############################
    [message]
        speaker=Ethiliel
        message = _"The Mebrin I know is so gentle. So wise! It cannot be... can it?"
    [/message]
    [message]
        speaker=Deoran
        message= _ "You believe, but you do not want to believe. Please, Ethiliel — enough blood has been shed today."
    [/message]
    [message]
        speaker=Ethiliel
        message = _"Mebrin... oh Mebrin... a lich!? But if Mebrin really did turn to undeath, then I have been the cause of so much meaningless bloodshed."
    [/message]
    [message]
        speaker=Ethiliel
        message = _"It’s true, isn’t it..."
    [/message]
    [message]
        speaker=Ethiliel
        message = _"..."
    [/message]
    {DELAY 250}
    {MOVE_UNIT id=Ethiliel 3 10}
    {DELAY 250}
    {MODIFY_UNIT id=Ethiliel facing sw}
    #############################
    # ETHILIEL APOLOGIZES
    #############################
    [message]
        speaker=Ethiliel
        message = _"Deoran, thank you. I see now that not all humans are alike, and that you, too, are capable of courage and loyalty."
    [/message]
    [message]
        speaker=Ethiliel
        message = _"Vengeance only begets more vengeance. Our attack against Westin is over."
    [/message]

    {VARIABLE epilogue elves}
    [endlevel]
        result=victory
        linger_mode=no
        carryover_report=no
        save=no
    [/endlevel]
[/event]
[/scenario]

#undef TURN_LIMIT
#undef TURN_WARNING
#undef TOWNSFOLK
