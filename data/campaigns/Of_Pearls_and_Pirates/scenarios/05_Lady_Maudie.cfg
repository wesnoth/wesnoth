#textdomain wesnoth-pap

[scenario]
    id=05_Lady_Maudie
    map_file=05_Lady_Maudie.map
    name= _ "Lady Maudie"
    next_scenario=06_Epilogue
    victory_when_enemies_defeated=no
    {EXPERIENCE_MODIFIER_SCENARIO}
    {DEFAULT_SCHEDULE}
    {ADD_WEATHER_RAIN}
    turns=-1

    {INTRO_AND_SCENARIO_MUSIC heroes_rite.ogg casualties_of_war.ogg}
    {EXTRA_SCENARIO_MUSIC battle-epic.ogg}
    {EXTRA_SCENARIO_MUSIC knalgan_theme.ogg}
    {EXTRA_SCENARIO_MUSIC the_dangerous_symphony.ogg}

    [story]
        [part]
            {PAP_BIGMAP}
            #po: S05 intro
            story= _ "The villagers held a sombre shipboard funeral for Constable Elyn, and a burial at sea. The alderman’s son had always been there for them... until suddenly he wasn’t."
        [/part]
        [part]
            {PAP_BIGMAP}
            #po: S05 intro. Thea's father left many months ago, along with other villagers.
            story= _ "Not for the first time, Thea worried about her father; about all those who’d gone to war. She’d heard stories, of course — but experiencing battle and loss herself was something else entirely." + "

" + _"She wondered how her father could so readily return to something so grim. She wondered what drives “Lady Maudie” to inflict it upon others."
        [/part]
        [part]
            {PAP_BIGMAP}
            #po: S05 intro
            story= _ "Guided by merfolk, the flotilla kept station several dozen miles behind Maudie’s ship; too slow to catch her, but fast enough to stay in sight. Maudie’s destination soon became apparent: the wild, unsettled islands known as the Three Sisters."
        [/part]
    [/story]
    {PAP_TRACK {JOURNEY_STAGE5}}

    #######################################################################################################################################################
    #                                                                   DEFINE SIDES
    #######################################################################################################################################################
    {PLAYER_SIDE "Peasant,Woodsman,Merman Fighter,Merman Hunter"}

    #############################
    # OUTLAWS
    #############################
    [side]
        side=2
        color=blue
        controller=ai
        type=Assassin
        id=leader2
        name=_"Analla"
        {MODIFICATIONS({TRAIT_INTELLIGENT}{TRAIT_RESILIENT})}
        gender=female
        facing=se
        recruit=Thief
        gold={ON_DIFFICULTY4 20 40 60 80}
        income={ON_DIFFICULTY4 -2 0 2 4}
        team_name=pirates
        user_team_name= _ "Corsairs"
        {FLAG_VARIANT6 ragged}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES 2 2}
    {STARTING_VILLAGES 2 6}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Poacher" {ON_DIFFICULTY4 0 1 1 2}}

    [side]
        side=3
        color=green
        controller=ai
        type=Ranger
        id=leader3
        name=_"Shipmaster Derryn"
        {MODIFICATIONS({TRAIT_RESILIENT}{TRAIT_STRONG})}
        facing=se
        recruit=Trapper
        gold={ON_DIFFICULTY4 20 40 60 80}
        income={ON_DIFFICULTY4 -2 0 2 4}
        team_name=pirates
        user_team_name= _ "Corsairs"
        {FLAG_VARIANT6 ragged}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES 3 2}
    {STARTING_VILLAGES 3 9}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Thug" {ON_DIFFICULTY4 0 1 1 2}}

    [side]
        side=4
        color=black
        controller=ai
        {SINGLEUNITWML_MAUDIE}
        facing=se
        recruit=Pirate Skiff # skiffs have low defense, and may be less frustrating for new players than the high-defense naga
        gold={ON_DIFFICULTY4 30 60 90 120}
        income={ON_DIFFICULTY4 -1 4 9 14}
        team_name=pirates
        user_team_name= _ "Corsairs"
        {FLAG_VARIANT6 ragged}
    [/side]
    {STARTING_VILLAGES 4 9}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Naga Fighter" {ON_DIFFICULTY4 1 2 2 3}}

    [event]
        name=side 2 turn
        first_time_only=no
        {RESET_SIDE_AI 2,3,4 offensive 0.6 0.2}
        {VARY_AI_BY_SCHEDULE 2,3,4}
        {AUTOENRAGE 2 0}
        {AUTOENRAGE 3 0}
        {AUTOENRAGE 4 0}
        # Maudie's naga stay in the water.
        # Less so for effectiveness, and more so that they "feel right"
        # Especially because we have lots of other land troops around
        {MODIFY_SIDE_AI 4 (
            [avoid]
                terrain=!,W*^*,S*^*,*^V*
            [/avoid]
        )}
        {RETREAT_WHEN_WEAK 2 {ON_DIFFICULTY4 0-0 0-2 0-3 0-3} (
            {GOAL_LOCATION 1 x,y,radius=13,10,1}
        )}
        # side 3 recruits expensive Trappers, and doesn't start with all that much gold
        {RETREAT_WHEN_WEAK 3 {ON_DIFFICULTY4 0-0 0-1 0-2 0-2} (
            {GOAL_LOCATION 2 x,y=9,30}
            {GOAL_LOCATION 1 x,y=6-8,31}
        )}
        # including 3 starting guards
        {RETREAT_WHEN_WEAK 4 {ON_DIFFICULTY4 0-0 0-5 0-6 0-7} (
            {GOAL_LOCATION 1 x,y,radius=24,6,1}
        )}
    [/event]

    # dummy side for the derelict ships
    [side]
        side=5
        color=black
        controller=ai
        no_leader=yes
        hidden=yes
        team_name=pirates
    [/side]
    [event]
        name=side 5 turn
        first_time_only=no
        {RESET_SIDE_AI 5 no 1 0}
    [/event]

    # dummy side for fishing boats
    [side]
        side=6
        color=red
        controller=ai
        no_leader=yes
        hidden=yes
        team_name=good,pirates
    [/side]

    #############################
    # TIP: VILLAGE CONTROL AND INCOME
    #############################
    [event]
        name=turn 2
        [filter_condition]
            {VARIABLE_CONDITIONAL enable_tutorial_elements equals yes}
        [/filter_condition]
        [message]
            speaker=Thea
            message= _ "This island is covered in villages. Even if we don’t need the gold ourselves, we should still make sure Maudie doesn’t take so many that we become overwhelmed."
        [/message]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message=_"To see how much gold and income your enemies have, press <i>Alt+S</i>, or open the Menu and select “Status Table”."
        [/message]
    [/event]

    #######################################################################################################################################################
    #                                                                    PREPARE MAP
    #######################################################################################################################################################
    [event]
        name=prestart
        {ADD_MULTIHEX_WIND x,y=1-33,1-40 "~ROTATE(90)"}
        {PLACE_IMAGE scenery/dwarven-keep-tile.png 21 20}
        {SET_LABEL 4 20 _"Makeshift Shipyard"}

        #############################
        # ENEMIES
        #############################
        {LOYAL_UNITC 4 ({ON_DIFFICULTY4 "none"       "Naga Guard"        "Naga Shield Guard" "Naga High Guard"}) 4 22 ({FACING sw}{GUARDIAN})}
        {LOYAL_UNITC 4 ({ON_DIFFICULTY4 "Naga Guard" "Naga Shield Guard" "Naga Shield Guard" "Naga High Guard"}) 7 20 ({FACING se}{GUARDIAN})}
        {LOYAL_UNITC 4 ({ON_DIFFICULTY4 "Naga Guard" "Naga Shield Guard" "Naga High Guard"   "Naga High Guard"}) 7 22 ({FACING se}{GUARDIAN})}

        {GENERIC_UNITC 5 ({ON_DIFFICULTY4 "none"     "none"     "Derelict" "Derelict"})  9 19 ({FACING se}{HITPOINTS 63}{ROLE derelict1})}
        {GENERIC_UNITC 5 ({ON_DIFFICULTY4 "none"     "none"     "none"     "Derelict"})  9 20 ({FACING se}{HITPOINTS 61}{ROLE derelict2})}
        {GENERIC_UNITC 5 ({ON_DIFFICULTY4 "Derelict" "Derelict" "Derelict" "Derelict"}) 11 21 ({FACING sw}{HITPOINTS 31}{ROLE derelict3})}
        {GENERIC_UNITC 5 ({ON_DIFFICULTY4 "Derelict" "Derelict" "Derelict" "Derelict"})  5 18 ({FACING se}{HITPOINTS 47}{ROLE derelict4})}
        {GENERIC_UNITC 5 ({ON_DIFFICULTY4 "none"     "Derelict" "Derelict" "Derelict"})  2 20 ({FACING se}{HITPOINTS 70}{ROLE derelict5})}
        {MODIFY_UNIT type=Derelict status.unhealable yes}
        {GIVE_OBJECT_TO type=Derelict (
            id=immobile_derelict
            {EFFECT remove_attacks ()}
            {EFFECT movement set=0}
        )}

        #############################
        # MAUDIE'S "KEEP"
        #############################
        {PLACE_IMAGE_SUBMERGED scenery/keep-overlay-high.png 4 20}
        {PLACE_IMAGE_SUBMERGED scenery/keep-overlay-low.png  4 21}
        {PLACE_IMAGE_SUBMERGED scenery/keep-overlay-low.png  5 20}
        {PLACE_IMAGE_SUBMERGED scenery/keep-overlay-low.png  5 21}

        #############################
        # THEA
        #############################
        {NAMED_UNIT 6 "Fishing Boat" 27  8 skiff1 _"Great White" facing=sw} {IMMOBILE}
        {NAMED_UNIT 6 "Fishing Boat" 31 10 skiff2 _"The Garard"  facing=se} {IMMOBILE}

        {RECALL_XY Diondra 28 12}
        {SCROLL_TO 4 20}
    [/event]

    #######################################################################################################################################################
    #                                                                    PLAY SCENARIO
    #######################################################################################################################################################
    [event]
        name=start
        #############################
        # THEA CONFRONTS MAUDIE
        #############################
        [message]
            speaker=Maudie
            #po: "fish" is meant to be an insulting way to refer to merfolk
            message= _ "Tut-tut, the mermaid followed me all this way? Show some deference, fish. Soon you’ll be calling me your lord."
        [/message]
        [message]
            speaker=Thea
            message= _ "It’s not just merfolk who followed you here. I’m here to avenge my brother, you soulless murderer!"
        [/message]
        [message]
            speaker=Maudie
            message= _ "My, such language. Who in the world are you talking about?"
        [/message]
        [message]
            speaker=Thea
            message= _ "My brother! The mustached javelineeer you drowned not two days ago?"
        [/message]
        [message]
            speaker=Maudie
            message= _ "I’m sorry, sweetie, you smallfolk all look the same to me. But if you’re so beaten up about his death, I’d be happy to help you join him. Shipmaster, is my fleet ready?"
        [/message]
        [message]
            speaker=leader3
            message= _ "Not yet, milady. As we’ve discussed, repairing derelicts takes quite some time. It might still be weeks—"
        [/message]
        [message]
            speaker=Maudie
            message= _ "Yes, yes, I remember now. Just... deal with these peasants, will you? That business with the freed prisoners has given me a terrible headache. I’m really not in the mood to entertain riff-raff."
        [/message]

        #############################
        # OBJECTIVES
        #############################
        [objectives]
            [objective]
                description= _ "Defeat Lady Maudie"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Thea or Diondra"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            {IS_LAST_SCENARIO}
        [/objectives]
    [/event]

    #############################
    # TRIGGER FIRESHIPS
    #############################
    [event]
        name=new turn
        [filter_condition]
            {VARIABLE_CONDITIONAL turn_number greater_than_equal_to 14}
            [or]
                [have_unit]
                    side=1
                    [filter_location]
                        x,y=1,22
                        radius=12
                    [/filter_location]
                [/have_unit]
            [/or]
        [/filter_condition]

        [if]
            [have_unit]
                id=leader3
            [/have_unit]
            [then]
                [message]
                    speaker=Maudie
                    message= _ "They’re getting closer. Shipmaster, how long until the fleet is finished?!"
                [/message]
                [message]
                    speaker=leader3
                    message= _ "Madam, I’ve told you, it might still be weeks—"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Maudie
                    message= _ "They’re getting closer. And my shipmaster got himself killed... Do I have to do everything myself?"
                [/message]
            [/else]
        [/if]
        [message]
            speaker=Maudie
            message= _ "Fine! Since these ships cannot serve me in any useful capacity, set them ablaze and send them to run down anything in the water!"
        [/message]

        {REMOVE_OBJECT immobile_derelict type=Derelict}
#define IGNITE_DERELICT FLT
    {ANIMATE_UNIT {FLT} levelout}
    {TRANSFORM_UNIT {FLT} Fireship}
    {FULL_HEAL {FLT}}
    {ANIMATE_UNIT {FLT} levelin}
#enddef
        {IGNITE_DERELICT role=derelict1}
        {IGNITE_DERELICT role=derelict2}
        {IGNITE_DERELICT role=derelict3}
        {IGNITE_DERELICT role=derelict4}
        {IGNITE_DERELICT role=derelict5}
        [display_tip]
            title=_"Know Thy Enemy"
            #po: knowing about the Fireship specifically isn't that important (although it does make it clear that this isn't a bug). But the Fireship is a good example about how knowing an enemy's weaknesses can make them much easier to fight. This also makes exploiting the Fireships feel less like a mistake ("oh, the AI is dumb"), and makes it clear that making them exploitable like this is a deliberate design choice
            message=_"A unit’s statistics determine the best strategy for fighting them.

Fireships, for example, can deal massive damage in melee combat.
But their main attack has the <i>naval</i> weapon special, preventing
them from ramming targets on dry land.

While many units are general-purpose, others — like the Fireship — 
have clear strengths and weaknesses. If you haven’t been doing so
already, consider checking new units’ stats to identify any 
weaknesses they may have."
        [/display_tip]
    [/event]

    #############################
    # THEA ATTACKS MAUDIE
    #############################
    [event]
        name=attack
        [filter]
            id=Thea,Maudie
        [/filter]
        [filter_second]
            id=Maudie,Thea
        [/filter_second]
        [message]
            speaker=Thea
            #po: Princess Bride movie reference
            message= _ "My name is Thea Nicolin. You killed my brother! Prepare to die!!"
        [/message]
    [/event]

    #############################
    # MAUDIE'S BACKSTORY
    #############################
    [event]
        name=attack end
        [filter_second]
            id=Maudie
        [/filter_second]
        [if]
            {VARIABLE_CONDITIONAL unit.race equals human}
            [then]
                [message]
                    speaker=Maudie
                    #po: "you're all leeches" echoes the S01 leader's dying words
                    message= _ "Get away from my ship, you low-born churl! You’re all just leeches! The Bay should be <i>mine</i>, not yours!"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Maudie
                    #po: "you're all leeches" echoes the S01 leader's dying words
                    message= _ "Get away from my ship, you filthy fish! You’re all just leeches! The Bay should be <i>mine</i>, not yours!"
                [/message]
            [/else]
        [/if]
        [message]
            speaker=Maudie
            message= _ "It belongs to me and my blood by right! My noble ancestors fought our way to the top, and we would have stayed there if those idiot kings hadn’t stolen it from us and given it to the merfolk instead."
        [/message]
        [message]
            speaker=Thea
            message= _ "You’re talking about when the Bay was first awarded to the merfolk? But that was over three hundred years ago!"
        [/message]
        [message]
            speaker=Maudie
            message= _ "And my line <i>has not forgotten</i>! It should have been <i>me</i> who inherited the pearls!" + "

" + _"Eating caviar instead of hardtack, served by slaves instead of outlaws, living in a villa instead of a smelly, grungy, fish-smelling pirate ship... oh, I’m going to be seasick again..."
        [/message]
        [event]
            name=attack end
            [filter_second]
                id=Maudie
                formula="( $this_unit.hitpoints>0 and $this_unit.hitpoints<$this_unit.max_hitpoints/2 )"
            [/filter_second]
            [message]
                speaker=Maudie
                message= _ "But you’re just a bunch of fish and smallfolk! It’s my right to rule! How— I mean... well, surely you can’t fault a girl for having ambition?"
            [/message]
        [/event]
    [/event]

    #######################################################################################################################################################
    #                                                                  VICTORY / DEFEAT
    #######################################################################################################################################################
    #############################
    # MAUDIE DIES
    #############################
    [event]
        name=last breath
        [filter]
            id=Maudie
        [/filter]
        [if]
            {VARIABLE_CONDITIONAL second_unit.id equals Thea}
            [then]
                {ACHIEVE s05}
            [/then]
        [/if]
        [message]
            speaker=Maudie
            message= _ "We’re sinking. Someone, stop the sinking! No. No! I can’t swim!!"
        [/message]
        [event]
            name=die
            [message]
                speaker=Thea
                #po: Echoing Maudie's lines from S04 and S02.
                message= _ "(grim) Ta ta."
            [/message]
            [endlevel]
                result=victory
                carryover_report=no
                linger_mode=no
            [/endlevel]
        [/event]
    [/event]
[/scenario]

#undef SCENARIO_TURN_LIMIT
