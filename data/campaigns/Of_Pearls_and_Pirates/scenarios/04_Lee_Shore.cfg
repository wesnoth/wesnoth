#textdomain wesnoth-pap

#define SCENARIO_TURN_LIMIT
{ON_DIFFICULTY4 25 30 30 30}#enddef

[scenario]
    id=04_Lee_Shore
    map_file=04_Lee_Shore.map
    name= _ "Lee Shore"
    next_scenario=05_Lady_Maudie
    victory_when_enemies_defeated=no
    {EXPERIENCE_MODIFIER_SCENARIO}
    {DEFAULT_SCHEDULE}
    turns={SCENARIO_TURN_LIMIT}

    {INTRO_AND_SCENARIO_MUSIC silence.ogg weight_of_revenge.ogg}
    {EXTRA_SCENARIO_MUSIC battle.ogg}
    {EXTRA_SCENARIO_MUSIC knolls.ogg}
    {EXTRA_SCENARIO_MUSIC traveling_minstrels.ogg}

    [story]
        [part]
            {PAP_BIGMAP}
            #po: S04 intro
            story= _ "The villagers boarded their new ships and set sail. The skill of their merfolk escorts more than compensated for the inexperience of the sailors, and the makeshift flotilla made good time around the cape."
        [/part]
        [part]
            {PAP_BIGMAP}
            #po: S04 intro
            story= _ "They passed several other small hamlets. Like Stuxton, all were empty, and marred by signs of weeks-old battle. Finally, five days after leaving home, the villagers and merfolk sighted signs of activity on the coast."
        [/part]
    [/story]
    {PAP_TRACK {JOURNEY_STAGE4}}

    #######################################################################################################################################################
    #                                                                   DEFINE SIDES
    #######################################################################################################################################################
    {PLAYER_SIDE "Peasant,Woodsman,Merman Fighter,Merman Hunter" GOLD=100}
    [modify_unit_type]
        type=Peasant
        set_cost=16
    [/modify_unit_type]
    [modify_unit_type]
        type=Woodsman
        set_cost=20
    [/modify_unit_type]

    #############################
    # OUTLAWS
    #############################
    [side]
        side=2
        color=blue
        controller=ai
        type=Outlaw
        id=leader2
        name=_"Havan"
        {MODIFICATIONS({TRAIT_STRONG}{TRAIT_QUICK})}
        facing=sw
        recruit=Footpad
        gold={ON_DIFFICULTY4 20 40 60 80}
        income={ON_DIFFICULTY4 -2 0 2 4} # ~4 villages, and low/no upkeep
        team_name=pirates
        user_team_name= _ "Corsairs"
        {FLAG_VARIANT6 ragged}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES 2 1}
    {STARTING_VILLAGES 2 5}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Poacher" {ON_DIFFICULTY4 0 1 1 2}}

    [side]
        side=3
        color=black
        controller=ai
        type=Huntsman
        id=leader3
        name=_"Rhaddin"
        {MODIFICATIONS({TRAIT_RESILIENT}{TRAIT_STRONG})}
        facing=sw
        recruit=Trapper
        gold={ON_DIFFICULTY4 30 60 90 120}
        income={ON_DIFFICULTY4 -1 4 7 10} # ~4 villages, and low/no upkeep
        team_name=pirates
        user_team_name= _ "Corsairs"
        {FLAG_VARIANT6 ragged}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES 3 1}
    {STARTING_VILLAGES 3 5}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Thug" {ON_DIFFICULTY4 0 1 1 2}}

    #############################
    # NAGA
    #############################
    # deliberately weak - fighting too many 60% defense naga can be frustrating for new players
    # this is also a leader who fled the last scenario, so it's plausible that they have fewer soldiers to deploy
    [side]
        side=4
        color=green
        controller=ai
        no_leader=yes
        recruit=Naga Fighter
        gold={ON_DIFFICULTY4 15 30 45 60}
        income={ON_DIFFICULTY4 -2 0 2 4} # ~8 villages, and low/no upkeep
        team_name=pirates
        user_team_name= _ "Naga"
        {FLAG_VARIANT6 ragged}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES 4 4} # enough moves that he can reach a village and heal
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Naga Dirkfang" {ON_DIFFICULTY4 0 1 1 2}}

    [event]
        name=side 2 turn
        first_time_only=no
        {RESET_SIDE_AI 2,3,4 offensive 0.6 0.2}
        {VARY_AI_BY_SCHEDULE 2,3,4}
        {AUTOENRAGE 2 0}
        {AUTOENRAGE 3 0}
        {AUTOENRAGE 4 0}
        {RETREAT_WHEN_WEAK 2 {ON_DIFFICULTY4 0-0 0-3 0-4 0-5} (
            {GOAL_LOCATION 3 x,y=26,23}
            {GOAL_LOCATION 1 x,y,radius=24,22,1}
        )}
        {RETREAT_WHEN_WEAK 3 {ON_DIFFICULTY4 0-0 0-4 0-5 0-6} (
            {GOAL_LOCATION 3 x,y=37,20}
            {GOAL_LOCATION 2 x,y=33,16}
            {GOAL_LOCATION 1 x,y,radius=37-38,1}
        )}
        # including 2 starting guards
        {RETREAT_WHEN_WEAK 4 {ON_DIFFICULTY4 0-0 0-3 0-4 0-5} (
            {GOAL_LOCATION 1 x,y,radius=24,6,1}
        )}
    [/event]

    # dummy side for the caged prisoners
    [side]
        side=5
        color=brown
        controller=ai
        no_leader=yes
        hidden=yes
        team_name=pirates
    [/side]

    # dummy side for fishing boats and maudie's prisoners
    [side]
        side=6
        color=red
        controller=ai
        no_leader=yes
        hidden=yes
        team_name=good,pirates
    [/side]

    #######################################################################################################################################################
    #                                                                    PREPARE MAP
    #######################################################################################################################################################
    [event]
        name=prestart
        # make the wind blow towards the shore; a "lee shore"
        {ADD_MULTIHEX_WIND x,y=1-38,1-25 "~ROTATE(90)"}

        #############################
        # CAGED PRISONERS
        #############################
#define PLACE_PRISONER X Y TYPE IMAGE DIRECTION
    {VARIABLE prisoner_type {TYPE}}
    [if]
        {VARIABLE_CONDITIONAL prisoner_type not_equals "none"}
        [then]
            {GENERIC_UNIT 5 Cage {X} {Y}}
            {PLACE_IMAGE "units/{IMAGE}~RC(magenta>brown)~NO_TOD_SHIFT()" {X} {Y}}
            [event]
                name=die
                {FILTER type,x,y=Cage,{X},{Y}}
                {REMOVE_IMAGE {X} {Y}}
                {GENERIC_UNIT 1 {TYPE} {X} {Y}}
                [+unit]
                    facing={DIRECTION}
                    overwrite=yes
                    role=prisoner
                [/unit]
                {FIRE_EVENT_UNIT prisoner_freed x,y={X},{Y}}
                {VARIABLE failed_achievement yes}
            [/event]
        [/then]
    [/if]
    {CLEAR_VARIABLE prisoner_type}
#enddef
        {PLACE_PRISONER 28 22 ({ON_DIFFICULTY4 Peasant  Peasant  Peasant  Peasant }) "human-peasants/peasant.png"       se}
        {PLACE_PRISONER 28 23 ({ON_DIFFICULTY4 Peasant  Peasant  Peasant  Peasant }) "human-peasants/peasant.png~FL()"  sw}
        {PLACE_PRISONER 29 22 ({ON_DIFFICULTY4 none     Woodsman Woodsman Woodsman}) "human-peasants/woodsman.png~FL()" sw}
        {PLACE_PRISONER 29 23 ({ON_DIFFICULTY4 Peasant  Peasant  Peasant  Peasant }) "human-peasants/peasant.png~FL()"  sw}
        {PLACE_PRISONER 30 22 ({ON_DIFFICULTY4 none     none     none     Woodsman}) "human-peasants/woodsman.png"      se}

        {PLACE_PRISONER 29 25 ({ON_DIFFICULTY4 none     none     Peasant  Peasant }) "human-peasants/peasant.png~FL()"  sw}
        {PLACE_PRISONER 30 24 ({ON_DIFFICULTY4 Woodsman Woodsman Woodsman Woodsman}) "human-peasants/woodsman.png~FL()" sw}
        {PLACE_PRISONER 30 25 ({ON_DIFFICULTY4 none     none     Peasant  Peasant }) "human-peasants/peasant.png"       se}

        {PLACE_PRISONER 35 20 ({ON_DIFFICULTY4 Peasant  Peasant  Peasant  Peasant }) "human-peasants/peasant.png"       se}
        {PLACE_PRISONER 36 20 ({ON_DIFFICULTY4 Peasant  Peasant  Peasant  Peasant }) "human-peasants/peasant.png~FL()"  sw}
        {PLACE_PRISONER 36 21 ({ON_DIFFICULTY4 none     Woodsman Woodsman Woodsman}) "human-peasants/woodsman.png~FL()" sw}

        {PLACE_PRISONER 37 22 ({ON_DIFFICULTY4 Peasant  Peasant  Peasant  Peasant }) "human-peasants/peasant.png~FL()"  sw}
        {PLACE_PRISONER 37 23 ({ON_DIFFICULTY4 none     none     Woodsman Woodsman}) "human-peasants/woodsman.png"      se}
        {PLACE_PRISONER 38 22 ({ON_DIFFICULTY4 none     Peasant  Peasant  Peasant }) "human-peasants/peasant.png~FL()"  sw}

        {PLACE_PRISONER 15 14 ({ON_DIFFICULTY4 Peasant  Peasant  Peasant  Peasant }) "human-peasants/peasant.png"       se}
        {PLACE_PRISONER 16 13 ({ON_DIFFICULTY4 Woodsman Woodsman Woodsman Woodsman}) "human-peasants/woodsman.png~FL()" sw}
        {PLACE_PRISONER 15 13 ({ON_DIFFICULTY4 none     Woodsman Woodsman Woodsman}) "human-peasants/woodsman.png~FL()" sw}

        {PLACE_PRISONER 17 10 ({ON_DIFFICULTY4 Peasant  Peasant  Peasant  Peasant }) "human-peasants/peasant.png"       se}
        {PLACE_PRISONER 18  9 ({ON_DIFFICULTY4 Peasant  Peasant  Peasant  Peasant }) "human-peasants/peasant.png~FL()"  sw}
        {PLACE_PRISONER 18 10 ({ON_DIFFICULTY4 none     Woodsman Woodsman Woodsman}) "human-peasants/woodsman.png~FL()" sw}
        {PLACE_PRISONER 19  9 ({ON_DIFFICULTY4 none     Peasant  Peasant  Peasant }) "human-peasants/peasant.png~FL()"  sw}
        {PLACE_PRISONER 19 10 ({ON_DIFFICULTY4 none     none     Woodsman Woodsman}) "human-peasants/woodsman.png"      se}

        {PLACE_PRISONER 25 11 ({ON_DIFFICULTY4 none     Peasant  Peasant  Peasant }) "human-peasants/peasant.png~FL()"  sw}

        #############################
        # ENEMIES
        #############################
        {GENERIC_UNITC 3 ({ON_DIFFICULTY4 "Poacher"    "Trapper"           "Trapper"           "Trapper"        })  36 18 ({FACING sw}{ZONE_GUARDIAN 36 18 x,y,radius=36,16,4})}
        {GENERIC_UNITC 4 ({ON_DIFFICULTY4 "Naga Guard" "Naga Shield Guard" "Naga Shield Guard" "Naga High Guard"})  20  7 ({FACING sw}{ZONE_GUARDIAN 20  7 x,y,radius=22,6,3})}
        {GENERIC_UNITC 4 ({ON_DIFFICULTY4 "Naga Guard" "Naga Shield Guard" "Naga Shield Guard" "Naga High Guard"})  29  9 ({FACING se}{ZONE_GUARDIAN 29  9 x,y,radius=29,6,4})}

        #############################
        # CUTSCENE PEASANTS
        #############################
        {PLACE_IMAGE "items/cage.png" 24 11}
        {PLACE_IMAGE "items/cage.png" 25 12}
        {GENERIC_UNIT 5 Peasant 25 15} {FACING ne} {ROLE peasant1}
        {GENERIC_UNIT 5 Peasant 26 14} {FACING nw} {ROLE peasant2}

        #############################
        # THEA
        #############################
        {PUT_TO_RECALL_LIST id=Thea}
        {SCROLL_TO 26 6}
    [/event]

    #######################################################################################################################################################
    #                                                                    PLAY SCENARIO
    #######################################################################################################################################################
    [event]
        name=start
        # this is the fleeing naga from S02, still injured
        # for some reason this works fine in the start event, but not in prestart
        {VARIABLE stored_naga.id leader4}
        {VARIABLE stored_naga.side 4}
        {VARIABLE stored_naga.hitpoints "$( $stored_naga.max_hitpoints - 13 )"}
        [unstore_unit]
            variable=stored_naga
            x,y=26,6
        [/unstore_unit]
        {CLEAR_VARIABLE stored_naga}
        [capture_village]
            side=4
            x,y,radius=27,5,10
        [/capture_village]
        {DELAY 500}

        #############################
        # SLAVES RETURN TO CAGES
        #############################
        [message]
            speaker=leader4
            message= _ "Sssmall boatsss are coming! I sssussspect these are sssurvivors from that last hovel; the onesss who hurt me. I am sssure they are here to caussse problemsss."
        [/message]
        [message]
            speaker=leader3
            #po: "The Lady" refers to Lady Maudie, the main villain of this campaign.
            message= _ "The Lady won’t be happy if any of our trainees escape, especially not with the invasion so near."
        [/message]
        [message]
            speaker=leader3
            message= _ "Call off the dive! Chattel, back to your quarters. Corsairs, get ready to fight!"
        [/message]
        {MOVE_UNIT role=peasant1 25 12}
        {KILL role=peasant1}
        {PLACE_PRISONER 25 12 Peasant "human-peasants/peasant.png~FL()" sw}
        {MOVE_UNIT role=peasant2 24 11}
        {KILL role=peasant2}
        {PLACE_PRISONER 24 11 Peasant "human-peasants/peasant.png" se}
        {DELAY 500}

        #############################
        # THEA ARRIVES
        #############################
        {NAMED_UNIT 6 "Fishing Boat" 6 25 skiff1 _"Great White" facing=ne} {ANIMATE}
        {GIVE_OBJECT_TO id=skiff1 ({EFFECT movement set=0})}
        {MOVE_UNIT id=skiff1 8 23}
        {MODIFY_UNIT id=skiff1 facing sw}
        {DELAY 250}

        {NAMED_UNIT 6 "Fishing Boat" 6 25 skiff2 _"The Garard" facing=ne} {ANIMATE}
        {GIVE_OBJECT_TO id=skiff2 ({EFFECT movement set=0})}
        {DELAY 250}

        {RECALL_XY Thea   9 24}
        {MODIFY_TERRAIN Ke  9 24} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce  8 24} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce  9 25} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce 10 24} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce 10 23} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce  9 23} {REDRAW} {DELAY 150}
        {RECALL_XY Diondra 9 23}

        #############################
        # THE PLAN IS REVEALED
        #############################
        [message]
            speaker=Thea
            message= _ "Here are the missing villagers — in chains! Would this have been our fate if not for your intervention, Diondra?"
        [/message]
        [message]
            speaker=Thea
            message= _ "I think the prisoners are being forced to... dive for pearls? But there aren’t any pearls on this part of the coast."
        [/message]
        [message]
            speaker=Diondra
            message= _ "Perhaps this is not the slaves’ final home. A grim omen. It sounds almost as if they mean to conquer the Bay of Pearls itself."
        [/message]
        [message]
            speaker=Thea
            message= _ "Is that possible?!"
        [/message]
        [message]
            speaker=Diondra
            message= _ "My city nurtures the continent’s largest and wealthiest merfolk population, yet most of us are not warriors. With Wesnoth’s army away at war in the east, I think it unlikely but not impossible for a coordinated group of corsairs to take control."
        [/message]
        [message]
            speaker=Thea
            message= _ "An invading army. And our neighbors enslaved! We can’t abide this."
        [/message]
        [message]
            speaker=Thea
            message= _ "Grab your weapons, everyone. Free every prisoner... but take none ourselves."
        [/message]

        #############################
        # OBJECTIVES
        #############################
        [store_unit]
            {FILTER type=Cage}
            variable=cages
        [/store_unit]
        [event]
            name=prisoner_freed
            first_time_only=no
            [store_unit]
                {FILTER type=Cage}
                variable=cages
            [/store_unit]
        [/event]
        [objectives]
            delayed_variable_substitution=yes
            [objective]
                #po: $cages.length will be between 1 and 20
                description= _ "Free the imprisoned slaves" + "<span color='white' size='small'> " + _"($cages.length remaining)" + "</span>"
                condition=win
            [/objective]
            {ALTERNATIVE_OBJECTIVE _"Defeat the enemy leaders"}
            [objective]
                description= _ "Death of Thea or Diondra"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
            [note]
                description= _ "Attack and break a cage to free the slave inside."
            [/note]
        [/objectives]
    [/event]

    #############################
    # TIP: ELUSIVEFOOT MOVETYPES
    #############################
    [event]
        name=attacker misses
        {FILTER_SECOND type=Footpad}
        {FILTER_CONDITION({VARIABLE_CONDITIONAL enable_tutorial_elements equals yes})}
        [message]
            speaker=second_unit
            message= _ "Hah! You missed me!"
        [/message]
        [display_tip]
            title=_"Elusive Enemies"
            message=_"Not all units are created equal. As you know, fighters like Naga or Merfolk have high defense (chance
to evade) in water, but pay for that strength by having low defense while on land.

Other units, like the Footpad you just attacked, have abnormally high defense <b><i>everywhere</i></b>. That’s a major
strength, but comes at the cost of poor damage output and vulnerability to most damage types.

To see a unit’s terrain defence and damage resistances/vulnerabilities, <b><i>right-click on it and select 
“Unit Type Description.”</i></b>"
        [/display_tip]
    [/event]

    #############################
    # FIRST SLAVE FREED
    #############################
    [event]
        name=prisoner_freed
        [message]
            speaker=unit
            #po: The player has just freed a slave from his cage.
            message= _ "What’s happening? Is that... Thea? Alderman Rael’s daughter?"
        [/message]
        [message]
            speaker=Diondra
            message= _ "We come to free you from your bonds, human. These pirates took you from your home. Now take from them their lives."
        [/message]
        [event]
            name=prisoner_freed
            [message]
                speaker=unit
                #po: The player has just freed a slave from his cage.
                message= _ "They burned my whole village! I want revenge!"
            [/message]
            [event]
                name=prisoner_freed
                [message]
                    speaker=unit
                    #po: The player has just freed a slave from his cage.
                    message= _ "Thank you! These pirates lock us up whenever they aren’t forcing us to dive..."
                [/message]
            [/event]
        [/event]
    [/event]

    #############################
    # MOST PRISONERS FREED
    #############################
    [event]
        name=prisoner_freed
        {FILTER_CONDITION({HAVE_UNIT side,count=5,0-3})}
        {FILTER_CONDITION({VARIABLE_CONDITIONAL skip_prisoner_dialogue not_equals yes})}
        [message]
            speaker=Thea
            message= _ "We’re almost finished. There’s only a few more prisoners left to free."
        [/message]
    [/event]

    #######################################################################################################################################################
    #                                                                  VICTORY / DEFEAT
    #######################################################################################################################################################
    #############################
    # ENEMY LEADERS DIE
    #############################
    [event]
        name=last breath
        {FILTER id=leader2}
        [message]
            speaker=unit
            #po: An enemy leader is dying.
            message= _ "No!"
        [/message]
        [event]
            name=die
            {FIRE_EVENT are_all_leaders_dead}
        [/event]
    [/event]
    [event]
        name=last breath
        {FILTER id=leader3}
        [message]
            speaker=unit
            #po: An enemy leader is dying.
            message= _ "Urgh..."
        [/message]
        [event]
            name=die
            {FIRE_EVENT are_all_leaders_dead}
        [/event]
    [/event]
    [event]
        name=last breath
        {FILTER id=leader4}
        [message]
            speaker=unit
            #po: An enemy naga leader is dying.
            message= _ "Hisss..."
        [/message]
        [event]
            name=die
            {FIRE_EVENT are_all_leaders_dead}
        [/event]
    [/event]
    [event]
        name=are_all_leaders_dead
        {FILTER_CONDITION({NOT({HAVE_UNIT id=leader2,leader3,leader4})})}
        [if] {VARIABLE_CONDITIONAL failed_achievement not_equals yes} {THEN(
            {ACHIEVE s04}
        )} [/if]
        {CLEAR_VARIABLE failed_achievement}
        [message]
            speaker=Thea
            message= _ "The outlaw leaders are dead! Time to release the rest of their prisoners."
        [/message]
        {VARIABLE skip_prisoner_dialogue yes}
        {KILL type=Cage FIRE_EVENT=yes} # don't animate, or we play the annoying metal sound a lot
    [/event]

    #############################
    # VICTORY CUTSCENE
    #############################
    [event]
        name=prisoner_freed
        {FILTER_CONDITION({NOT({HAVE_UNIT side=5})})}
        [if] {VARIABLE_CONDITIONAL skip_prisoner_dialogue not_equals yes} {THEN(
            [message]
                speaker=Thea
                message= _ "Well done, everyone! We’ve freed all of the pirates’ prisoners."
            [/message]
        )} [/if]
        {CLEAR_VARIABLE skip_prisoner_dialogue}
        [message]
            speaker=Thea
            message= _ "With so many new farmers and fishers swelling our ranks, we finally have the numbers we need to field more human fighters."
        [/message]
        # unlikely that this will matter much to the player at this point
        [object]
            {FILTER id=Thea}
            duration=turn
            image=attacks/fist-human.png
            name=_"Additional Manpower"
            description=_"Peasants and Woodsmen no longer cost twice as much to recruit."
        [/object]

        #------------------------
        # LADY MAUDIE ARRIVES
        #------------------------
        [unit]
            {SINGLEUNITWML_MAUDIE}
            x,y=1,2
            side=3
            facing=se
            animate=yes
        [/unit]
        {MOVE_UNIT id=Maudie 8 4}
        [message]
            speaker=Maudie
            message= _ "What’s this? An unruly mob in place of my orderly divers?"
        [/message]
        [message]
            speaker=Maudie
            #po: "trainees" refers to new slaves. "dispose of them" means to kill them.
            message= _ "My, my. How unlucky. I had meant to introduce some new trainees I’d acquired... but given the present state of affairs, I suppose I’ll have to dispose of them instead."
        [/message]

        #------------------------
        # WALK THE PLANK
        #------------------------
        {GENERIC_UNIT 6 Woodsman 9 5} {ROLE prisoner1} {FACING se} {ANIMATE}
        [message]
            role=prisoner1
            #po: A prisoner is being made to walk the plank (which will kill them).
            message= _ "No, wait—"
        [/message]
        [message]
            speaker=Maudie
            message= _ "Walk the plank!"
        [/message]
        {ANIMATE_ATTACK id=Maudie () yes x,y=9,5}
        {KILL role=prisoner1 ANIMATE=yes}
        {DELAY 500}

        {GENERIC_UNIT 6 Peasant 7 5} {ROLE prisoner2} {FACING sw} {ANIMATE}
        [message]
            role=prisoner2
            message= _ "I can’t swim, please—"
        [/message]
        {ANIMATE_ATTACK id=Maudie () yes x,y=7,5}
        {KILL role=prisoner2 ANIMATE=yes}
        {DELAY 500}

        [unit]
            {SINGLEUNITWML_ELYN}
            x,y=8,5
            side=6
            facing=se
            animate=yes
        [/unit]
        {DELAY 500}
        [if] {NOT({HAVE_UNIT(
            side=1
            race=human
            {NOT id=Thea}
            {NOT role=prisoner}
        )})} {THEN(
            {GENERIC_UNIT 1 Peasant 9 23}
        )} [/if]
        [message]
            side=1
            race=human
            {NOT id=Thea}
            {NOT role=prisoner}
            scroll=no
            message= _ "Look! That’s the constable!"
        [/message]
        [message]
            speaker=Thea
            scroll=no
            message= _ "Elyn! My brother!"
        [/message]
        {ANIMATE_ATTACK id=Maudie () yes x,y=8,5}
        {KILL id=Elyn ANIMATE=yes}
        {FADE_MUSIC_OUT 500}
        {REPLACE_SCENARIO_MUSIC heroes_rite.ogg}
        {FADE_MUSIC_IN 0}

        #------------------------
        # MAUDIE LEAVES
        #------------------------
        [message]
            speaker=Maudie
            message= _ "Ta ta, dears. This was unfortunate, but really, I had no choice. There’s no room for freeloaders on my ship."
        [/message]
        [message]
            speaker=Maudie
            #po: "fish-tailed sweethearts" refers to the merfolk. Maudie doesn't acknowledge the human villagers as a meaningful adversary.
            message= _ "You see, there’s a new power growing in these parts: me. It’s time for Lady Maudie to take back what she’s owed. I’ll see you fish-tailed sweethearts again real soon."
        [/message]
        {MOVE_UNIT id=Maudie 1 2}
        {KILL id=Maudie}

        #------------------------
        # ATTEMPTED RESCUE
        #------------------------
        [message]
            speaker=Thea
            message= _ "Elyn!! My brother can swim, but not for long in this surf! Diondra, you have to rescue him! Rescue them all!"
        [/message]
        {MOVE_UNIT id=Diondra 8 6} {DELAY 500}
        {MOVE_UNIT id=Diondra 7 5} {DELAY 500}
        {MOVE_UNIT id=Diondra 8 5}
        [store_unit]
            {FILTER id=Diondra}
            variable=diver
        [/store_unit]
        {GIVE_OBJECT_TO id=Diondra (id=diving_object {EFFECT new_animation (
            [standing_anim]
                start_time=-1600
                [frame]
                    image="$diver.image|~SCALE(64,64)~O(80%):80"
                [/frame]
                [frame]
                    image="$diver.image|~SCALE(56,56)~O(60%):80"
                [/frame]
                [frame]
                    image="$diver.image|~SCALE(36,36)~O(50%):80"
                [/frame]
                [frame]
                    image="$diver.image|~SCALE(32,32)~O(40%):90"
                [/frame]
                [frame]
                    image="$diver.image|~SCALE(26,26)~O(30%):100"
                [/frame]
                [frame]
                    image="$diver.image|~SCALE(16,16)~O(20%):100"
                [/frame]
                [frame]
                    image="$diver.image|~SCALE(1,1)~O(0%):10"
                [/frame]

                [frame]
                    image="misc/blank-hex.png:400"
                [/frame]

                [frame]
                    image="$diver.image|~SCALE(1,1)~O(0%):10"
                [/frame]
                [frame]
                    image="$diver.image|~SCALE(16,16)~O(20%):100"
                [/frame]
                [frame]
                    image="$diver.image|~SCALE(26,26)~O(30%):100"
                [/frame]
                [frame]
                    image="$diver.image|~SCALE(32,32)~O(40%):90"
                [/frame]
                [frame]
                    image="$diver.image|~SCALE(36,36)~O(50%):80"
                [/frame]
                [frame]
                    image="$diver.image|~SCALE(56,56)~O(60%):80"
                [/frame]
                [frame]
                    image="$diver.image|~SCALE(64,64)~O(80%):80"
                [/frame]
                [frame]
                    image=$diver.image:999
                [/frame]
            [/standing_anim]
        )} )}
        {DELAY 1600}
        {REMOVE_OBJECT diving_object id=Diondra}
        {CLEAR_VARIABLE diver}

        #------------------------
        # FAILED RESCUE
        #------------------------
        {STORE_UNIT_VAR id=Thea x x}
        {STORE_UNIT_VAR id=Thea y y}
        {MOVE_UNIT id=Diondra $x $y}
        {CLEAR_VARIABLE x,y}
        [message]
            speaker=Diondra
            message= _ "I am sorry, Thea. His arms and legs were bound... I’ve retrieved only a corpse. The pirates must’ve captured him while he sailed in search of help."
        [/message]
        [message]
            speaker=Thea
            message= _ "..."
        [/message]
        [message]
            speaker=Diondra
            message= _ "Do not let his death be in vain. We must catch this “Maudie” and bring her to justice. Follow the black ship!"
        [/message]
        {CLEAR_VARIABLE cages}
        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
            music=silence.ogg
        [/endlevel]
    [/event]

    #############################
    # TIME OVER
    #############################
    [event]
        name=turn $({SCENARIO_TURN_LIMIT}-8)
        [message]
            speaker=Diondra
            message=_"Do not delay, Thea. These pirates are planning something. If we cannot finish our battle here, I fear they will be reinforced, and us overwhelmed."
        [/message]
    [/event]
    [event]
        name=side 1 turn {SCENARIO_TURN_LIMIT} end
        [unit]
            {SINGLEUNITWML_MAUDIE}
            x,y=1,2
            side=3
            facing=se
            animate=yes
        [/unit]
        [message]
            speaker=Maudie
            message=_"What’s this? An unruly mob harassing my divers?"
        [/message]
        [message]
            speaker=Maudie
            message=_"Now now, we can’t be having that. Luckily for me, you’ve given me enough time to prepare a whole fleet of warships, all filled to the brim with angry outlaws."
        [/message]
        {GENERIC_UNIT 3 "Pirate Carrack" 1 3} {ANIMATE}
        {GENERIC_UNIT 3 "Pirate Carrack" 3 1} {ANIMATE}
        {GENERIC_UNIT 3 "Pirate Carrack" 2 2} {ANIMATE}
        {GENERIC_UNIT 3 "Pirate Carrack" 1 4} {ANIMATE}
        [message]
            speaker=Thea
            message=_"The merfolk aren’t prepared to battle such a large fleet! We have to flee before we’re destroyed..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]

#undef SCENARIO_TURN_LIMIT
