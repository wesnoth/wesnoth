#textdomain wesnoth-pap

#define SCENARIO_TURN_LIMIT
{ON_DIFFICULTY4 25 30 30 30}#enddef

[scenario]
    id=01_Pirates
    map_file=01_Pirates.map
    name= _ "Pirates!"
    next_scenario=02_Swimming_with_Serpents
    victory_when_enemies_defeated=no
    {EXPERIENCE_MODIFIER_SCENARIO}
    {DEFAULT_SCHEDULE} # we start with the Alderman and Constable being woken from sleep
    turns={SCENARIO_TURN_LIMIT}

    {INTRO_AND_SCENARIO_MUSIC traveling_minstrels.ogg breaking_the_chains.ogg}
    {EXTRA_SCENARIO_MUSIC battle.ogg}
    {EXTRA_SCENARIO_MUSIC knolls.ogg}
    {EXTRA_SCENARIO_MUSIC traveling_minstrels.ogg}

    [story]
        [part]
            {PAP_BIGMAP}
            music=traveling_minstrels.ogg
            #po: S01 intro
            story= _ "Far north from Westin, on the west coast of the Kingdom of Wesnoth, there lies a place called the Bay of Pearls. The waters of the bay are calm, and clear, and warm even in winter. But its most notable feature is that for which it is named — abundant beds of oysters and a vast wealth in pearls."
        [/part]
        [part]
            {PAP_BIGMAP}
            #po: S01 intro
            story= _ "Many have tried to claim the bay for their own; sometimes with words, and sometimes with swords. But in the end the Crown declared it the domain of the merfolk, those most suited to care for and harvest the bay’s undersea resources."
        [/part]
        [part]
            {PAP_BIGMAP}
            #po: S01 intro
            story= _ "Attracted by the temperate climate and easily-accessible wealth, a large and thriving community of mermen quickly sprang up along the bay’s eastern coast." + "

" + _"Along the west coast, where the pearls were less plentiful, hardy clans of human fishers and farmers began to settle. Though not wealthy — at least not compared with their merfolk neighbors — the human hamlets afforded a simple, secure life for those disinterested in the wider kingdom’s hustle and bustle."
        [/part]
        [part]
            {PAP_BIGMAP}
            #po: S01 intro
            story= _ "But for every man content with a quiet life, there is another who seeks to take it from him..."
        [/part]
    [/story]
    {PAP_TRACK {JOURNEY_STAGE1}}

    #######################################################################################################################################################
    #                                                                   DEFINE SIDES
    #######################################################################################################################################################
    {PLAYER_SIDE "Peasant,Woodsman" GOLD=20}

    #############################
    # OUTLAWS
    #############################
    [side]
        side=2
        color=black
        controller=ai
        recruit=Ruffian
        gold={ON_DIFFICULTY4 40 80 120 160}
        income={ON_DIFFICULTY4 -2 0 2 4} # several villages, and low/no upkeep
        team_name=pirates
        user_team_name= _ "Corsairs"
        {FLAG_VARIANT6 ragged}
        no_leader=yes
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES 2 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Thug"    {ON_DIFFICULTY4 2 3 4 5}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Poacher" {ON_DIFFICULTY4 0 2 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Footpad" {ON_DIFFICULTY4 0 0 2 3}}

    [event]
        name=side 2 turn
        first_time_only=no
        {RESET_SIDE_AI 2 offensive 0.6 0.2}
        {VARY_AI_BY_SCHEDULE 2}
        {AUTOENRAGE 2 0}
        {RETREAT_WHEN_WEAK 2 {ON_DIFFICULTY4 0-0 0-4 0-6 0-8} (
            {GOAL_LOCATION 3 x,y=18,23}
            {GOAL_LOCATION 3 x,y=17,24}
            {GOAL_LOCATION 1 x,y,radius=15,24,1}
        )}
    [/event]

    # dummy side for the ending cutscene crier
    [side]
        side=3
        color=red
        hidden=yes
        team_name=good,pirates
    [/side]

    #######################################################################################################################################################
    #                                                                    PREPARE MAP
    #######################################################################################################################################################
    [event]
        name=prestart
        priority=5 # before {STARTING_VILLAGES} fires, since we need to create Thea
        {SET_LABEL 18 9 _"Rochelm"}

        #############################
        # DIFFICULTY WARNINGS
        #############################
#ifdef NIGHTMARE
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            #po: notice that appears at the beginning of the scenario if you select Deadly difficulty
            message=_"NOTE: ‘Deadly’ difficulty is intended to be a moderate challenge even for experienced players! If you’re new to Wesnoth, I strongly suggest trying a lower difficulty."
        [/message]
#endif

        #############################
        # TUTORIAL TOGGLE
        #############################
        {VARIABLE enable_tutorial_elements yes} # on by default, even on high difficulties (in case a new player picks a high difficulty)
        [set_menu_item]
            id=tutorial_toggle_on
            description= _ "Tip Dialogue &amp; Popups: On"
            image="wesnoth-icon.png~SCALE(18,18)"
            [show_if]
                {VARIABLE_CONDITIONAL enable_tutorial_elements     equals yes}
            [/show_if]
            [command]
                {VARIABLE enable_tutorial_elements no}
                {FIRE_EVENT clear_tips}
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id=tutorial_toggle_off
            description= _ "Tip Dialogue &amp; Popups: Off"
            image="wesnoth-icon.png~SCALE(18,18)"
            [show_if]
                {VARIABLE_CONDITIONAL enable_tutorial_elements not_equals yes}
            [/show_if]
            [command]
                {VARIABLE enable_tutorial_elements yes}
            [/command]
        [/set_menu_item]

        #############################
        # THEA
        #############################
        # can't wait until later to create her because she's our leader - we want villages to start captured
        [unit]
            {SINGLEUNITWML_THEA}
            x,y=15,12
            animate=yes
        [/unit]
        [hide_unit]
            id=Thea
        [/hide_unit]

        [capture_village]
            side=1
            x,y,radius=18,9,8
        [/capture_village]

        {SCROLL_TO 1 23}
    [/event]

    #######################################################################################################################################################
    #                                                                    PLAY SCENARIO
    #######################################################################################################################################################
    [event]
        name=start
        {DELAY 500}
        {NOTRAIT_UNIT 1 Peasant 1 23} {FACING ne} {ANIMATE} {HITPOINTS 11} {EXPERIENCE 3} {ROLE fisher}
        {ADD_MODIFICATION({TRAIT_QUICK}{TRAIT_STRONG})}

        #############################
        # FLEEING FISHER
        #############################
        [message]
            role=fisher
            #po: a peasant is running towards town, calling out to the village leader
            message= _ "Alderman! Alderman Rael!"
        [/message]
        {MOVE_UNIT role=fisher 13 12}
        [message]
            role=fisher
            #po: a peasant is running towards town, calling out to the village leader
            message= _ "(panting) Pirates! Alderman, it’s pirates! Burned my farm... (pant) Stole my skiff... (pant) Thought you should know..."
        [/message]
        [unit]
            {SINGLEUNITWML_RAEL}
            x,y=14,11
            facing=sw
            animate=yes
        [/unit]
        {FAKE_UNIT_MOVE 14 15  11 12  1 "Bowman Thea" ()}
        {MODIFY_UNIT id=Thea facing sw}
        [unhide_unit]
            id=Thea
        [/unhide_unit]
        [message]
            speaker=Rael
            message= _ "Pirates? What, here?!"
        [/message]

        #############################
        # PIRATES ARRIVE
        #############################
        #po: this is a fishing boat name, and a pun on the phrase "seize the day"
        {NAMED_UNIT 2 "Fishing Boat" 8 33 skiff _"Seas the Day" ()} {FACING ne} {ANIMATE} {IMMOBILE}
        {MOVE_UNIT id=skiff 19 25}
        {NAMED_UNIT 2 Bandit 18 24 leader2 _"Boryn" canrecruit=yes} {FACING nw} {ANIMATE}
        {MODIFY_TERRAIN Ke 18 24} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce 19 24} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce 18 23} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce 17 24} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce 17 25} {REDRAW} {DELAY 150}
        [message]
            speaker=Rael
            message= _ "Blast! Haven’t seen outlaws in these parts since I were a lad... these ones even dare to leave their faces uncovered. What do you make of it, Thea?"
        [/message]
        [message]
            speaker=Thea
            message= _ "I don’t know, Father. This is a strange thing. These outlaws couldn’t’ve come from the other villages — the other aldermen won’t stand for troublemakers."
        [/message]
        [message]
            speaker=Rael
            #po: "waxed" can be substituted with any other kind of routine bow maintenance
            message= _ "Well, it’s a good thing I’ve been keeping my old war-bow waxed. There’s nothing for it but to drive them off. Constable Elyn, report!"
        [/message]

        #############################
        # RALLYING THE FIGHTERS
        #############################
        [unit]
            {SINGLEUNITWML_ELYN}
            x,y=11,10
            animate=yes
            facing=se
        [/unit]
        [message]
            speaker=Elyn
            #po: Elyn has just been woken up, and is getting ready to help fight a battle
            message= _ "(yawn) It’s too early for this, Pa..."
        [/message]
        [message]
            speaker=Thea
            message= _ "I’ll get to our keep and rally the farmers too; get a posse together. It’ll take more than the three of us to win this fight."
        [/message]
        {MOVE_UNIT id=Thea 18 9}
        {MODIFY_UNIT id=Thea facing sw}
        [message]
            speaker=Rael
            message= _ "Well done for taking the initiative, Thea. Let’s show these pirates what we stand for. What do you say, lads?"
        [/message]
        [message]
            role=fisher
            #po: The speaker is shouting a cheer and preparing to attack his enemy. Can be translated into any kind of cheer, but please stay consistent with the other instances of "Rah!"
            message= _ "Rah!"
        [/message]

        #############################
        # OBJECTIVES
        #############################
        [objectives]
            [objective]
                description= _ "Defeat the enemy leader"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Thea, Rael, or Elyn"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    #############################
    # TIP: FIGHTING FROM A DISADVANTAGE
    #############################
    [event]
        name=turn 2
        [filter_condition]
            {VARIABLE_CONDITIONAL enable_tutorial_elements equals yes}
        [/filter_condition]
        [message]
            speaker=Rael
            message= _ "(whistles) There’s more of them than I expected. We’re going to be outnumbered until we have the time and gold to rally a larger force."
        [/message]
        [display_tip]
            title=_"Fighting from a Disadvantage"
            message=_"Your enemy in this scenario starts with much more gold than you.
Even worse, your only recruit options are Peasants and Woodsmen:
cheap-but-frail fighters with makeshift weapons and minimal 
training. Peasants and Woodsmen are level 0 units, and as such 
do not enforce a Zone of Control (enemies can move freely around 
them without being stopped).

Fortunately, you’re much smarter than our AI (probably), and this 
scenario has a generous turn limit. Don’t sacrifice your entire 
army right away. Play smart — control villages to gain gold and 
use the time of day to your advantage. <i><b>Slowly build up your army
while whittling down the opponent’s.</b></i>"
        [/display_tip]
        [message]
            speaker=Elyn
            message= _ "We’ll need more experienced fighters, too. You’ve done your best to train me and Thea, Pa, but most of the farmers are just that... farmers."
        [/message]
        [display_tip]
            title=_"Experience Per Kill"
            message=_"Peasants and Woodsmen may be weak, but they also require little experience
to advance to the next level. Units gain 8 XP per level of the opponent they 
kill (e.g. 16 XP for killing a level 2 opponent). Killing a level 0 opponent 
grants 4 XP.

Even if units don’t kill their opponent, they still gain XP just for attacking:
0 XP for attacking a level 0 opponent, 1 XP for attacking a level 1 opponent, etc."
        [/display_tip]
    [/event]

    #############################
    # ELYN FLAVOR
    #############################
    [event]
        name=die
        [filter]
            [not]
                canrecruit=yes
            [/not]
        [/filter]
        [filter_second]
            id=Elyn
        [/filter_second]
        [message]
            speaker=Elyn
            #po: Elyn has just defeated a bandit
            message= _ "Take that! Don’t mess with Rochelm!"
        [/message]
    [/event]

    #############################
    # TRACK ACHIEVEMENT
    #############################
    [event]
        name=die
        [filter]
            side=1
        [/filter]
        {VARIABLE failed_achievement yes}
    [/event]

    #######################################################################################################################################################
    #                                                                  VICTORY / DEFEAT
    #######################################################################################################################################################
    #############################
    # PIRATE LEADER DIES
    #############################
    [event]
        name=last breath
        [filter]
            id=leader2
        [/filter]

        [if]
            {VARIABLE_CONDITIONAL failed_achievement not_equals yes}
            [then]
                {ACHIEVE s01}
            [/then]
        [/if]
        {CLEAR_VARIABLE failed_achievement}

        [message]
            speaker=unit
            #po: The bandit is dying, and is insulting his killers. "leeches" means that the "pearl-folk" (the people living around the Bay of Pearls) didn't earn the pearls.
            message= _ "Pfft. You’re just leeches... All you pearl-folk are. You’ll get... what’s coming to you..."
        [/message]
        [event]
            name=die
            [if]
                [have_unit]
                    id=skiff
                [/have_unit]
                [then]
                    {MOVE_UNIT id=skiff 14 28}
                    {CUTSCENE_ENEMIES_RETREAT 2 13 28 (CONDITIONS={NOT id=skiff})}
                    {MOVE_UNIT id=skiff 10 33}
                    {KILL id=skiff}
                [/then]
                [else]
                    {CUTSCENE_ENEMIES_RETREAT 2  1 "$($this_item.y)"}
                [/else]
            [/if]
            [message]
                speaker=Thea
                message= _ "Well, that sounded ominous."
            [/message]

            #------------------------
            # CRIER ARRIVES
            #------------------------
            {NAMED_UNIT 3 Cavalryman 31 1 Crier _"Crier" ()} {ANIMATE}
            {MOVE_UNIT id=Crier 24 4}
            [message]
                speaker=Crier
                message= _ "Hear ye! Word from Weldyn! I bring a proclamation from King Garard!"
            [/message]
            [message]
                speaker=Rael
                message= _ "Oh? Fortunate timing. Mayhaps this will explain our bandit attack."
            [/message]
            [message]
                speaker=Crier
                #po: "goodman" is an archaic term of respect, similar to "good sir".
                message= _ "No news of outlaws, goodman. Ahem..."
            [/message]
            [message]
                speaker=narrator
                image=portraits/scroll.webp
                #po: a crier is reading from a scroll
                message= "<i>" + _ "In the interest of common defense and the clearing of new lands, His Majesty Garard, second of that name, calls forth a force of stout-hearted men to wage war against the orcs of the north, being those who have long-threatened our home." + "</i>"
            [/message]
            [message]
                speaker=narrator
                image=portraits/scroll.webp
                #po: a crier is reading from a scroll
                message= "<i>" + _ "Of-age free men holding in excess of ten acres are obligated to purchase spear, shield, helmet, and knife, and shall report for muster at the fortress of Halstead within five weeks time." + "</i>"
            [/message]
            [message]
                speaker=narrator
                image=portraits/scroll.webp
                #po: a crier is reading from a scroll
                message= "<i>" + _ "Hear and obey.

— His Majesty Garard II, King of Wesnoth" + "</i>"
            [/message]
            [message]
                speaker=Crier
                message= _"The message is given. Onwards to the next village."
            [/message]
            {MOVE_UNIT id=Crier 1 19} {KILL id=Crier}

            #------------------------
            # RAEL GOES TO WAR
            #------------------------
            [message]
                speaker=Rael
                message= _ "Ten acres... well, that’d be most of us. Blimey. But it is our duty."
            [/message]
            [message]
                speaker=Elyn
                message= _ "You’re leading the village to war? But you’re our only veteran fighter. What will we do if the outlaws come back?"
            [/message]
            [message]
                speaker=Rael
                message= _ "I have faith in you, son. Take good care of your sister. The lads and I will return before you know it."
            [/message]
            {KILL id=Rael}
            [endlevel]
                result=victory
                bonus=yes
                {NEW_GOLD_CARRYOVER 40}
            [/endlevel]
        [/event]
    [/event]

    #############################
    # TIME OVER
    #############################
    [event]
        name=turn $({SCENARIO_TURN_LIMIT}-8)
        [message]
            speaker=Thea
            message=_"This battle is dragging on... if we can’t finish off these pirates soon, we won’t have enough spare hands to bring in the harvest."
        [/message]
    [/event]
    [event]
        name=side 1 turn {SCENARIO_TURN_LIMIT} end
        [message]
            speaker=Thea
            message=_"Brr, it’s starting to snow and we’re still stuck fighting. Our crops are all dead! Even if we win this battle, we’ll be sure to starve during the winter..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]

#undef SCENARIO_TURN_LIMIT
