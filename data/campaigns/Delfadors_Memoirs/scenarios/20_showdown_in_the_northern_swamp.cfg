#textdomain wesnoth-dm
[scenario]
    id=20_showdown_in_the_northern_swamp
    name= _ "Showdown in the Northern Swamp"
    next_scenario=21_prince_of_Wesnoth
    {MEMOIRS_MAP showdown.map}
    {TURNS 24 28 32}

    {DEFAULT_SCHEDULE}

    {INTRO_AND_SCENARIO_MUSIC northerners.ogg the_deep_path.ogg}
    {EXTRA_SCENARIO_MUSIC revelation.ogg}
    {EXTRA_SCENARIO_MUSIC heroes_rite.ogg}
    {EXTRA_SCENARIO_MUSIC underground.ogg}

    [story]
        [part]
            story= _ "With the portal closed, Iliah-Malal was weakened. He retreated into the Swamp of Dread to recover his strength and attempt another conjuration. Delfador's troop, hurrying west by secret Dwarvish ways and stealthily crossing the Listra by night, found the necromancer there, on the brink of raising another army amidst the fetid reek."
            delay=4000
        [/part]
        [part]
            story= _ "Using dwarvish and elvish messengers, Delfador was able to communicate the news to the King and ask for help. Mustering all the troops he could find, Lionel marched north to join Delfador for the battle that would decide the fate of Wesnoth."
            delay=4000
        [/part]
        [part]
            show_title=yes
            {TO_SHOWDOWN_IN_THE_NORTHERN_SWAMP}
        [/part]
    [/story]

    ##### Delfador's side #####
    #wmllint: validate-off
    [side]
        {YOUNG_DELFADOR}
        type=Journeyman Mage
        canrecruit=yes
        # wmllint: recognize Delfador
        recruit={LOYALISTS},White Mage,Red Mage
        #shroud=yes
        team_name=goodies
    [/side]
    #wmllint: validate-on

    [event]
        name=start
        {KALENZ_REJOINS_DELFADOR 26 22}
    [/event]
    ##### /Delfador's side #####

    [side]
        side=2
        type=General
        id=Lionel
        name=_ "Lionel"
        canrecruit=yes
        recruit=Spearman,Horseman,Bowman,Cavalryman,Heavy Infantryman
        shroud=yes
        team_name=goodies
    [/side]

    # The strategic challenge should be getting these to cooperate well
    [side]
        type=Lich
        id=Iliah-Malal
        name= _"Iliah-Malal"
        side=3
        canrecruit=yes
        controller=ai
        team_name=undead
#ifdef EASY
        recruit=Skeleton, Skeleton Archer, Vampire Bat, Ghost
#endif

#ifdef NORMAL
        recruit=Skeleton, Revenant, Skeleton Archer, Bone Shooter, Ghost, Vampire Bat, Blood Bat, Chocobone, Dark Adept
#endif

#ifdef HARD
        recruit=Skeleton, Skeleton Archer, Revenant, Draug, Banebow, Bone Shooter, Deathblade, Ghost, Wraith, Shadow, Nightgaunt, Chocobone, Dark Adept, Spectre, Blood Bat, Vampire Bat
#endif

        {GOLD 200 250 300}
        {INCOME 0 2 2}
        [ai]
            recruitment_pattern=scout,fighter,archer
            [target]
                id=Delfador
                value=10
            [/target]
        [/ai]
    [/side]

    [side]
        type=Necromancer
        id=Maldun
        name=_ "Maldun"
        side=4
        canrecruit=yes
        controller=ai
        recruit=Vampire Bat,Dark Adept,Walking Corpse,Ghost,Soulless
        #  [ai]
        #      recruitment_pattern=scout,fighter,archer
        #  [/ai]
        team_name=undead
        {GOLD 120 200 250}
    [/side]

    [side]
        type=Death Knight
        id=Alderoth
        name=_ "Alderoth"
        side=5
        team_name=undead
        controller=ai

        {GOLD 100 140 220}
        {INCOME 1 2 4}

        canrecruit=yes
        [ai]
            recruitment_pattern=scout,fighter,archer
            aggression=0.2
        [/ai]

#ifdef EASY
        recruit=Skeleton, Skeleton Archer, Vampire Bat
#endif

#ifdef NORMAL
        recruit=Skeleton, Revenant, Skeleton Archer, Bone Shooter, Ghost, Vampire Bat, Blood Bat, Chocobone, Dark Adept
#endif

#ifdef HARD
        recruit=Skeleton, Skeleton Archer, Revenant, Draug, Banebow, Bone Shooter, Deathblade, Ghost, Wraith, Shadow, Nightgaunt, Chocobone, Dark Adept, Spectre, Blood Bat, Vampire Bat
#endif
    [/side]

    [event]
        name=prestart

        [objectives]
            side=1
            [objective]
                description= _ "Defeat all enemies"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Delfador"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Lionel"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Turns run out"
                condition=lose
            [/objective]
        [/objectives]

        {OBJ_POTION_HOLY 26 19 showdown_holywater1}
        {OBJ_POTION_HOLY 30 20 showdown_holywater2}
        {OBJ_POTION_HOLY 29 20 showdown_holywater3}
    [/event]

    [event]
        name=start

        [message]
            id=Iliah-Malal
            message= _ "So we meet again, Delfador. You were a fool to turn down my offer. None of your allies will save you now."
        [/message]
        [message]
            id=Delfador
            message= _ "You have ravaged your own soul with your corrupt arts, and your words are empty wind; I fear them not."
        [/message]
        [message]
            id=Iliah-Malal
            message= _ "Is he not amusing, my creatures? He puffs himself up as though he were Delfador the Mighty, Delfador the Powerful, Delfador the Great...rather than a jumped-up hedge wizard I shall shortly crush beneath my heel."
        [/message]
        [message]
            id=Delfador
            message= _ "Delfador the Great, eh? And so it comes to pass as the four Oracles foretold. I accept your name-gift, Iliah-Malal."
        [/message]
        [message]
            id=Iliah-Malal
            message= _ "Oracles? What nonsense you babble...after you die, I will raise your corpse and compel you to tell me how to reopen my portal!"
        [/message]
        [message]
            id=Delfador
            message= _ "One of us will find a final death here. I do not think it will be me."
        [/message]
    [/event]

    [event]
        name=turn 2
        [message]
            speaker=Delfador
            message= _ "I have prepared some holy water. Sprinkle it on your impact weapon and smash those foul creatures into dust!"
        [/message]
        [message]
            speaker=Iliah-Malal
            message= _ "Powers of darkness, enshroud this field!"
        [/message]

        [place_shroud]
            side=1
            x=1-44
            y=1-33
        [/place_shroud]
    [/event]
    [event]
        name=turn 3
        [message]
            speaker=Delfador
            message= _ "Darkness shall be dispelled!"
        [/message]

        [remove_shroud]
            x=1-44
            y=1-33
        [/remove_shroud]
        [message]
            speaker=Iliah-Malal
            message= _ "No!"
        [/message]
        [message]
            speaker=Delfador
            message= _ "Let the light shine forth!"
        [/message]
        [message]
            speaker=Iliah-Malal
            message= _ "Your sorcery matters little. Your army will fall like wheat to the sickle before my undead legions."
        [/message]
        [message]
            speaker=Delfador
            message= _ "Your mindless minions will be no match for the sprit and fire of the living."
        [/message]

        [message]
            id=Lionel
            message= _ "Delfador, as the King ordered I place all troops under your command. They will follow you to death, if necessary, and so will I!"
        [/message]

        [message]
            id=Delfador
            message= _ "Lionel, it is an honor to go into battle beside you. Now let us fight for life over death!"
        [/message]

        [message]
            id=Delfador
            #wmllint: local spelling un-life
            message= _ "Remember that I must strike the final blow, for Iliah-Malal's un-life must be ended by a spell I have specially crafted to the task."
        [/message]

        {SUBSUME_SIDE_AND_VILLAGES 2}
    [/event]

    # Delfador can kill him
    [event]
        name=last breath
        [filter]
            id=Iliah-Malal
        [/filter]
        [filter_second]
            id=Delfador
        [/filter_second]

        [message]
            id=Delfador
            message= _ "Now your days are ended!"
        [/message]
        [message]
            speaker="Iliah-Malal"
            message=_ "The power of death is mine! When you strike me down I arise stronger than before!"
        [/message]
        [message]
            id=Delfador
            message= _ "Not this time. For I have gazed upon the dark heart of necromancy in the Book of Crelanu, AND I REMAIN OF THE LIGHT!"
        [/message]
        {DELFADOR_LIGHTNING}
        # We're counting on the lich-scream as he dies to end the scene.
    [/event]

    # But nobody else can.
    [event]
        name=last breath
        first_time_only=no
        [filter]
            id=Iliah-Malal
        [/filter]
        [filter_second]
            [not]
                id=Delfador
            [/not]
        [/filter_second]

        [message]
            speaker="Iliah-Malal"
            message=_ "The power of death is mine! When you strike me down I arise stronger than before!"
        [/message]

        #TODO: AMLA him so his hitpoints go up.
        {ADVANCE_UNIT (id="Iliah-Malal") ()}
        #{FULL_HEAL id="Iliah-Malal"}
    [/event]


    # wmllint: recognize Kalenz
    [event]
        name=victory

        [message]
            speaker=Delfador
            message= _ "Evil has been vanquished on this day. May this victory bring lasting peace."
        [/message]
        [if]
            [have_unit]
                id=Kalenz
            [/have_unit]
            [then]
                [message]
                    speaker=Kalenz
                    message= _ "You have earned the name the accursed one gave you...Delfador the Great."
                [/message]
            [/then]
            [else]
                [role]
                    side=1
                    role=Admirer5
                [/role]
                [message]
                    speaker=Admirer5
                    message= _ "You have earned the name the accursed one gave you...Delfador the Great."
                [/message]
            [/else]
        [/if]
        [message]
            speaker=Lionel
            message=_"And the portal, it is sealed for good?"
        [/message]
        [message]
            speaker=Delfador
            message=_"Yes, it is. But it was too great a work of magic to be entirely undone; there is a flaw still remaining, a trace of Iliah-Malal's way between worlds. Summoning undead will be a little easier in the future than it has been before. Those who come after us will have to be vigilant against the corruption of the dark arts, and show themselves worthy of the land they live in."
        [/message]

        # This is set-up for the next scenario, where Kalenz leads side 1 again
        {DELFADOR_DEPARTS_AGAIN}
    [/event]
    {MEMOIRS_DEATHS}
[/scenario]
