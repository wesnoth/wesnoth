#textdomain wesnoth-dm
#define MEMOIRS_VICTORY_POSITION X Y BONUS_VALUE
    [item]
        x={X}
        y={Y}
        image=scenery/signpost.png
    [/item]
    [event]
        name=moveto
        [filter]
            id=Delfador
            x={X}
            y={Y}
        [/filter]
        [endlevel]
            result=victory
            bonus={BONUS_VALUE}
        [/endlevel]
    [/event]
#enddef

#define MEMOIRS_SECRET_PASSAGE X Y TO_X TO_Y
    [item]
        x={X}
        y={Y}
        image=scenery/mine-abandoned.png
    [/item]
    [event]
        name=moveto
        [filter]
            x={X}
            y={Y}
            side=1
        [/filter]
        [message]
            speaker=unit
            message=_"A secret passage... I wonder where it leads..."
        [/message]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            x={X}
            y={Y}
        [/filter]
        [teleport]
            [filter]
                x={X}
                y={Y}
            [/filter]
            x={TO_X}
            y={TO_Y}
        [/teleport]
        [capture_village]
            side=1
            x={TO_X}
            y={TO_Y}
        [/capture_village]
        [scroll_to_unit]
            x={TO_X}
            y={TO_Y}
        [/scroll_to_unit]
    [/event]
#enddef

### create a sidekick for a leader near to starting position

#define MEMOIRS_SIDEKICK SIDE TYPE DESCRIPTION
    [store_starting_location]
        side={SIDE}
        variable=tmp
    [/store_starting_location]
    [unit]
        type={TYPE}
        id={DESCRIPTION}
        side={SIDE}
        x=$tmp.x
        y=$tmp.y
    [/unit]
    [clear_variable]
        name=tmp
    [/clear_variable]
#enddef

### earthquake effect stolen from "The Lost General"
#define MEMOIRS_TREMOR
    [scroll]
        x=5
        y=0
    [/scroll]
    [delay]
        time=10
    [/delay]
    [scroll]
        x=-10
        y=0
    [/scroll]
    [delay]
        time=10
    [/delay]
    [scroll]
        x=0
        y=5
    [/scroll]
    [delay]
        time=10
    [/delay]
    [scroll]
        x=0
        y=-10
    [/scroll]
#enddef

#define DELFADOR_LIGHTNING
    [sound]
        name=lightning.ogg
    [/sound]

    [color_adjust]
        red=100
        green=100
        blue=100
    [/color_adjust]

    [delay]
        time=10
    [/delay]

    [color_adjust]
        red=0
        green=0
        blue=0
    [/color_adjust]
#enddef



# This is for times when we absolutely MUST have a unit on the
# board with a given role. For example, when we need a speaker
# for a message and omitting the message would cause the flow
# of the conversation to jump or become unclear, or the message
# imparts critical information to the player.
#
# If we have a unit with the role, then recall that unit.
#
# Note that only one unit should have the role.
# So, if the unit is already on the board, the recall should silently fail.
#
# If we do not have a unit with the role, but we do have a unit matching the filter,
# then assign the role to that unit and recall it.
#
# Again, if the unit is already on the board, the recall should silently fail.
#
# Otherwise, create a unit for the role and assign it to the side and role.

#define DM_RECALL SIDENUMBER ROLENAME FILTERWML UNITWML
    [if]
        [have_unit]
            side={SIDENUMBER}
            role={ROLENAME}
            search_recall_list=yes
        [/have_unit]
        [then]
            [recall]
                side={SIDENUMBER}
                role={ROLENAME}
            [/recall]
        [/then]
        [elseif]
            [have_unit]
                side={SIDENUMBER}
                {FILTERWML}
                search_recall_list=yes
            [/have_unit]
            [then]
                [role]
                    side={SIDENUMBER}
                    {FILTERWML}
                    role={ROLENAME}
                [/role]
                [recall]
                    side={SIDENUMBER}
                    role={ROLENAME}
                [/recall]
            [/then]
        [/elseif]
        [else]
            {UNITWML}
            [+unit]
                side={SIDENUMBER}
                role={ROLENAME}
            [/unit]
        [/else]
    [/if]
#enddef



# This is for times when we would like to have a unit on the
# board with the given role but, if we do not, it is no great
# harm. For example, we would like a unit to interject a
# comment, but if it does not, the flow of the conversation
# does not suffer, and the player does not lose valuable
# information.
#
# If we don't have a unit on the board with the role, but
# we do have a unit on the board which matches the filter,
# assign the role to that unit.

#define OPTIONAL_ASSIGN_ROLE SIDENUMBER ROLENAME FILTERWML
    [if]
        [not]
            [have_unit]
                side={SIDENUMBER}
                role={ROLENAME}
            [/have_unit]
        [/not]
        [and]
            [have_unit]
                side={SIDENUMBER}
                {FILTERWML}
            [/have_unit]
        [/and]
        [then]
            [role]
                side={SIDENUMBER}
                {FILTERWML}
                role={ROLENAME}
            [/role]
        [/then]
    [/if]
#enddef
