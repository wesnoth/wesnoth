#textdomain wesnoth-thot

#define GIANT_SPIDER X Y
    [unit]
        type=Giant Spider
        x={X}
        y={Y}
        side=2
        ai_special=guardian
	description=Giant Spider
    [/unit]
#enddef

#define MASKED_GUARD X Y
    [unit]
        type=Dwarvish Steelclad
        x={X}
        y={Y}
        side=2
        ai_special=guardian
        random_traits=yes
        generate_description=yes
	user_description= _ "Masked Dwarf"
    [/unit]
#enddef


#define MASKED_SNIPER X Y
    [unit]
        type=Dwarvish Thunderguard
        x={X}
        y={Y}
        side=2
        ai_special=guardian
        random_traits=yes
        generate_description=yes
	user_description= _ "Masked Dwarf"
    [/unit]
#enddef


#define MASKED_STALWART X Y
    [unit]
        type=Dwarvish Stalwart
        x={X}
        y={Y}
        side=2
        ai_special=guardian
        random_traits=yes
        generate_description=yes
	user_description= _ "Masked Dwarf"
    [/unit]
#enddef

#define DRAUG_GUARD X Y
    [unit]
        type=Draug
        x={X}
        y={Y}
        side=2
        ai_special=guardian
    [/unit]
#enddef

[scenario]
    name=_"The Underlevels"
    id="12_The_Underlevels"
    next_scenario="13_Epilogue"
    victory_when_enemies_defeated=yes


    map_data="{@campaigns/The_Hammer_of_Thursagan/maps/underlevels.map}"

    {UNDERGROUND}
    {DEFAULT_MUSIC_PLAYLIST}

    turns=-1

    [side]
        type="Dwarvish Fighter"
        description="Aiglondur"
        user_description=_"Aiglondur"
        canrecruit="1"
        side="1"
        controller="human"
        team_name="good"
        fog="no"
        shroud="no" #Disabled for Playtesting
        recruit="Dwarvish Fighter,Dwarvish Thunderer,Mage"
	{GOLD 220 200 180}	# BALANCE
    [/side]

    [side]
        type="Lich"
        description="Karrag"
        user_description=_"Karrag"
        canrecruit="1"
        side="2"
        colour=black
        controller="ai"
        team_name="evil"
        fog="no"
        shroud="no"
        [ai]
            passive_leader=yes
            grouping=defensive
            {ATTACK_DEPTH 4 5 5}
        [/ai]
	gold=0	# BALANCE
    [/side]

	[side]
        type="Dwarvish Steelclad"
        description="Dufon"
        user_description=_"Masked Dwarf"
        canrecruit="1"
        side="3"
        controller="ai"
        team_name="evil"
        fog="no"
        shroud="no"
        recruit="Dwarvish Fighter, Dwarvish Thunderer, Dwarvish Ulfserker"
        [ai]
            {NO_SCOUTS}
        [/ai]
	gold=0	# BALANCE
    [/side]

	[side]
        type="Dwarvish Lord"
        description="Aragoth"
        user_description=_"Masked Dwarf"
        canrecruit="1"
        side="4"
        controller="ai"
        team_name="evil"
        fog="no"
        shroud="no"
        recruit="Dwarvish Fighter, Dwarvish Steelclad, Dwarvish Thunderer, Dwarvish Tunderguard, Dwarvish Ulfserker, Dwarvish Berserker"
        [ai]
            {NO_SCOUTS}
        [/ai]
	gold=0	# BALANCE
    [/side]

	[side]
        type="Dwarvish Lord"
        description="Dranath"
        user_description=_"Masked Dwarf"
        canrecruit="1"
        side="5"
        controller="ai"
        team_name="evil"
        fog="no"
        shroud="no"
        recruit="Dwarvish Fighter, Dwarvish Steelclad, Dwarvish Thunderer, Dwarvish Tunderguard, Dwarvish Ulfserker, Dwarvish Berserker"
        [ai]
            {NO_SCOUTS}
        [/ai]
	gold=0	# BALANCE
    [/side]

	[side]
        type="Lich"
        description="Fleleen"
        user_description=_"Fleleen"
        canrecruit="1"
        side="6"
        controller="ai"
        team_name="evil"
        fog="no"
        shroud="no"
	gold=0	# BALANCE
    [/side]

	[side]
        type="Lich"
        description="Lannex"
        user_description=_"Lannex"
        canrecruit="1"
        side="7"
        controller="ai"
        team_name="evil"
        fog="no"
        shroud="no"
        [ai]
            {NO_SCOUTS}
        [/ai]
	gold=0	# BALANCE
    [/side]

	[side]
        type="Dwarvish Steelclad"
        description="Sashaon"
        user_description=_"Masked Dwarf"
        canrecruit="1"
        side="8"
        controller="ai"
        team_name="evil"
        fog="no"
        shroud="no"
        recruit="Dwarvish Fighter, Dwarvish Thunderer, Dwarvish Ulfserker"
        [ai]
            {NO_SCOUTS}
        [/ai]
	{GOLD 150 175 200}
    [/side]

	

    {@campaigns/The_Hammer_of_Thursagan/utils/herodeaths.cfg}
    {@campaigns/The_Hammer_of_Thursagan/utils/macros.cfg}

    {SET_RIGHTEOUS_FLAME_EVENT}

    [event]
        name="start"

	
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 38 42}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 39 42}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 40 42}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 21 55}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 21 54}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 45 34}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 25 4}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 39 13}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 26 5}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 25 8}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 18 1}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 10 2}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 15 24}
	{PLACE_IMAGE "scenery/dwarven-doors-closed.png" 15 36}
	{PLACE_IMAGE "items/book2.png" 41 6}
	{PLACE_IMAGE items/chest.png 15 22}
	{PLACE_IMAGE items/chest.png 15 38}

	{MASKED_GUARD 10 25}
	{MASKED_GUARD 14 25}
	{MASKED_GUARD 18 25}
	{MASKED_SNIPER 12 25}
	{MASKED_SNIPER 16 25}
	{MASKED_SNIPER 20 25}

	{MASKED_GUARD 10 34}
	{MASKED_GUARD 14 34}
	{MASKED_GUARD 18 34}
	{MASKED_SNIPER 12 34}
	{MASKED_SNIPER 16 34}
	{MASKED_SNIPER 20 34}

	{MASKED_STALWART 26 27}
	{MASKED_STALWART 26 30}
	{MASKED_STALWART 30 26}
	{MASKED_STALWART 32 27}
	{MASKED_STALWART 32 30}
	{MASKED_STALWART 30 31}

	{MASKED_STALWART 38 24}
	{MASKED_STALWART 36 23}
	{MASKED_STALWART 38 19}
	{MASKED_STALWART 36 19}
	{MASKED_STALWART 33 16}
	{MASKED_STALWART 33 18}
	{MASKED_STALWART 23 16}
	{MASKED_STALWART 23 18}

	{MASKED_GUARD 24 14}
	{MASKED_SNIPER 22 14}
	{MASKED_GUARD 24 19}
	{MASKED_SNIPER 22 19}
	{MASKED_STALWART 18 15}
	{MASKED_STALWART 18 17}
	{MASKED_STALWART 12 16}
	{MASKED_STALWART 15 12}
	{MASKED_STALWART 11 12}
	{MASKED_GUARD 10 11}
	{MASKED_SNIPER 9 11}
	{MASKED_GUARD 16 11}
	{MASKED_SNIPER 17 11}
	
	{MASKED_STALWART 37 33}
	{MASKED_STALWART 35 34}
	{MASKED_GUARD 35 37}
	{MASKED_SNIPER 35 38}
	{MASKED_GUARD 35 39}
	{MASKED_SNIPER 35 40}
	{MASKED_GUARD 43 37}
	{MASKED_SNIPER 43 38}
	{MASKED_GUARD 43 39}
	{MASKED_SNIPER 43 40}

	{DRAUG_GUARD 20 43}
	{DRAUG_GUARD 20 44}
	{DRAUG_GUARD 20 45}
	{DRAUG_GUARD 28 43}
	{DRAUG_GUARD 28 44}
	{DRAUG_GUARD 28 45}
	{DRAUG_GUARD 22 42}
	{DRAUG_GUARD 24 41}
	{DRAUG_GUARD 26 42}
	{DRAUG_GUARD 26 46}
	{DRAUG_GUARD 24 47}
	{DRAUG_GUARD 22 46}
	
	{GIANT_SPIDER 45 3}
	{GIANT_SPIDER 39 12}
	{GIANT_SPIDER 44 7}
	{GIANT_SPIDER 39 7}
	{GIANT_SPIDER 49 5}
	{GIANT_SPIDER 38 2}
	

        [recall]
	    description="Angarthing"
	[/recall]

	[recall]
	    description="Dulcatulos"
	[/recall]

        [recall]
            description="Ratheln"
        [/recall]

       
        {CONDITIONAL_MAGE_RECRUITING}

        [message]
            description= _ "Angarthing"
            message=_"This place smells of death."
        [/message]

        [message]
            description= _ "Dulcatulos"
            message=_"It's been...it's been years since I've been down here.  Only Karrag and his personal followers used this level.  Why did I never wonder about that before?"
        [/message]
      
        [message]
            description= _ "Angarthing"
            message=_"Karrag's will, and his dark magic.  I think he has been casting glamours on all of you ever since he passed over."
        [/message]

        [message]
            description= _ "Aiglondur"
            message=_"Where *is* Karrag?  We can't have been more than seconds behind him."
        [/message]

        [message]
            description= _ "Dulcatulos"
            message=_"This is the Grand Gallery. There are rows of small chambers along its sides; he could have slipped into any of them."
        [/message]
      
        [message]
            description= _ "Aiglondur"
            message=_"More likely he has cloaked himself, thinking to run ahead to gather his followers.  He could be within a spear-cast of us now and we wouldn't know it in this gloom."
        [/message]

        [sound]
            name=wardrums.wav
        [/sound]

        [message]
            description= _ "Dulcatulos"
            message=_"Those are war-drums!"
        [/message]
      
        [message]
            description= _ "Aiglondur"
            message=_"Aye.  Karrag, calling his troops to battle. Only the Dark Gods know what hellspawn the lich will summon.  AXES UP!"
        [/message]
      
        [objectives]
            side="1"
            silent="no"
            [objective]
                description=_"Defeat Karrag"
                condition="win"
            [/objective]
            [objective]
                description=_"Death of Aiglondur"
                condition="lose"
            [/objective]
            [objective]
                description=_"Death of Angarthing"
                condition="lose"
            [/objective]
	    [objective]
                description=_"Death of Dulcatulos"
                condition="lose"
            [/objective]
        [/objectives]
    [/event]

    [event]
        name=sighted

        [filter]
            description="Dranath"
        [/filter]

	[message]
	    description="Dranath"
	    message= _ "You cannot pass, fools. The doors I guard are sealed by the power of the Hammer itself."
	[/message]

	[message]
	speaker=unit
	message= _ "We'll see about that!"
	[/message]
    [/event]


    [event]
        name=moveto
	first_time_only=no

        [filter]
            side=1
            x=38,39,40
            y=41,41,41
        [/filter]

	[if]
	    [variable]
	       name=key_read
	       numerical_equals=0
	    [/variable]

            [then]
                [message]
                    speaker=unit
                    message= _ "It sees that guard spoke truth.  These doors cannot be forced open by any means we have!"
                [/message]

                [message]
                    description= _ "Angarthing"
                    message= _ "I sense these bindings to be the work of common sorcery, not the power of the Hammer. Usually to each such locking spell there is some sort of key. If we can but find the key, we will able to open these doors."
                [/message]

            [/then]
        [/if]

        [if]
            [variable]
                name=key_read
                numerical_equals=1
            [/variable]

            [then]
                [message]
                speaker=unit
                message= _ "The key has been uttered, these doors should open..."
                [/message]

                [terrain]
                    x=38,39,40
                    y=42,42,42
                    letter=Uu
                [/terrain]

                [message]
                    speaker=unit
                    message= _ "There we go... faugh, what is that smell!"
                [/message]

                recruit="Blood Bat,Ghost,Wrath,Shadow,Skeleton,Skeleton Archer,Ghoul,Necrophage,Revenant,Deathblade,Bone Shooter"

                [allow_recruit]
                    side=2
                    type="Blood Bat,Ghost,Wrath,Shadow,Skeleton,Skeleton Archer,Ghoul,Necrophage,Revenant,Deathblade,Bone Shooter"
                [/allow_recruit]

                [allow_recruit]
                    side=6
                    type="Blood Bat,Ghost,Wrath,Shadow,Skeleton,Skeleton Archer,Ghoul,Necrophage,Revenant,Deathblade,Bone Shooter"
                [/allow_recruit]

                [allow_recruit]
                    side=7
                    type="Blood Bat,Ghost,Wrath,Shadow,Skeleton,Skeleton Archer,Ghoul,Necrophage,Revenant,Deathblade,Bone Shooter"
                [/allow_recruit]
            [/then]
        [/if]
    [/event] 

    [event]
        name=moveto

        [filter]
            side=1
            x=25,25
            y=5,6
        [/filter]

	[message]
	speaker=unit
	message= _ "It's locked, but nothing that our hammers can't manage."
	[/message]

	[terrain]
            x=26
            y=5
            letter=Uu
        [/terrain]
	
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=41
            y=6
        [/filter]

	[message]
	speaker=unit
	message= _ "A thin book with some strange writing on it..."
	[/message]

	[message]
	description= _ "Angarthing"
	message= _ "It seems to be the key for that sealed door."
	[/message]
	
	[message]
	description= _ "Angarthing"
	message= _ " (reads) Kannin a'kana du'masi a'forigln de'amp."
	[/message]

	[message]
	description= _ "Angarthing"
	message= _ "Now try the door again, it should open."
	[/message]

	[set_variable]
            name=key_read
            value=1
        [/set_variable]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=15
            y=25
        [/filter]

	[message]
	speaker=unit
	message= _ "A door. Perhaps Karrag is hiding in here..."
	[/message]

	[terrain]
            x=15
            y=24
            letter=Uu
        [/terrain]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=15
            y=35
        [/filter]

	[message]
	    speaker=unit
	    message= _ "A door, perhaps Karrag is hiding in here..."
	[/message]

	[terrain]
            x=15
            y=36
            letter=Uu
        [/terrain]
    [/event]

    [event]
        name=moveto
        [filter]
            x=15
            y=22
            side=1
        [/filter]
        [message]
            speaker=unit
            message= _ "150 gold pieces. This should help."
        [/message]
        [gold]
            side=1
            amount=150
        [/gold]
        [removeitem]
            x=15
            y=22
        [/removeitem]
    [/event]

    [event]
        name=moveto
        [filter]
            x=15
            y=38
            side=1
        [/filter]
        [message]
            speaker=unit
            message= _ "150 gold pieces. I wonder why Karrag would choose to store his gold here."
        [/message]
        [gold]
            side=1
            amount=150
        [/gold]
        [removeitem]
            x=15
            y=38
        [/removeitem]
    [/event]
[/scenario]
