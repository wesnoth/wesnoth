#textdomain wesnoth-h2tt
# scenario by Dalas

#
# Konrad's castle is large enough to recruit exactly 3 units (plus Konrad)
# His castle includes 2 keeps, so the player can choose to recall Delfador and use Delfador to recruit elementals
#
# It's very important that Konrad can NOT get positive income while he's still disguised, or else he could stall to gain infinite gold
# We accomplish that by putting orcish guards on or adjacent to all villages, and by giving Konrad ownership of Fagh-mok (who's level 3) to 
#

[scenario]
    name=_"scenario name^A Crisis of Leadership"
    {MAP_DYNAMIC 42_A_Crisis_of_Leadership}
    next_scenario=00_The_Great_Continent
    victory_when_enemies_defeated=no
    {SCHEDULE_DYNAMIC_NIGHT OFFSET=-1} # the exploration part looks nicer at night
    {SCENARIO_MUSIC underground.ogg}
    {EXTRA_SCENARIO_MUSIC suspense.ogg}

    #######################################################################################################################################################
    #                                                                   DEFINE SIDES
    #######################################################################################################################################################
    {KONRAD_SIDE SHROUD=yes}

    #############################
    # ORCS
    #############################
#define ORC_SIDE SIDE TYPE ID NAME TRAITS GOLD
    [side]
        side={SIDE}
        controller=ai
        color=white
        type={TYPE}
        facing=ne
        id={ID}
        name={NAME}
        {MODIFICATIONS( {TRAITS} )}
        gold={GOLD}
        income=-2
        village_gold=0 # no income until Konrad is discovered
        recruit=       # no recruits until Konrad is discovered
        team_name=orcs
        user_team_name=_"Clan Whitefang"
        {FLAG_VARIANT6 ragged}
    [/side]
    {STARTING_VILLAGES {SIDE} 11}
    {SILENTLY_LIMIT_LEADER_MOVES {SIDE} 1}
#enddef
    {ORC_SIDE 2 "Orcish Sovereign"  Khargol _"Chief Khargol" ({TRAIT_RESILIENT}  {TRAIT_STRONG}  ) ({ON_DIFFICULTY4 25 50 75 100})}
    {ORC_SIDE 3 "Orcish Slurbow"    leader3 _"Ga-har"        ({TRAIT_INTELLIGENT}{TRAIT_STRONG}  ) 0}
    {ORC_SIDE 4 "Orcish Warlord"    leader4 _"Aharb"         ({TRAIT_QUICK}      {TRAIT_STRONG}  ) 0}
    {ORC_SIDE 5 "Orcish Nightblade" Arshag  _"Arshag"        ({TRAIT_RESILIENT}  {TRAIT_DEXTROUS}) 0} # Asheviere's Dogs reference
    {ORC_SIDE 6 "Orcish Warrior"    leader6 _"Rizgab"        ({TRAIT_RESILIENT}  {TRAIT_QUICK}   ) 0}
    [event]
        name=prestart
        {NAMED_UNIT 3 "Orcish Warrior" 24 6 leader3b _"Muk-har" canrecruit=yes} # id is used in an event
    [/event]

    # guard side, so they don't consume upkeep
    [side]
        side=7
        controller=ai
        color=white
        no_leader=yes
        hidden=yes
        team_name=orcs
        user_team_name=_"Clan Whitefang"
        {FLAG_VARIANT6 ragged}
    [/side]

    [event]
        name=side 2 turn
        first_time_only=no
        {RESET_SIDE_AI 2,3,4,5,6,7 offensive 0.99 0.01}
        {AUTOENRAGE 2 0}

        # don't stray too far away from the camp
        # and return back home if enemies leave our avoid area
        {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 1 x,y,radius=37,5,3})}
        {MODIFY_SIDE_AI 2 (
            [avoid]
                {NOT x,y,radius=38,1,22}
            [/avoid]
        )}
        {MODIFY_SIDE_AI 3 ({GOAL_LOCATION 1 x,y,radius=28,5,3})}
        {MODIFY_SIDE_AI 3 (
            [avoid]
                {NOT x,y,radius=28,2,18}
            [/avoid]
        )}

        # everyone should avoid fagh-mok
        {MODIFY_SIDE_AI 4,5,6,7 (
            [avoid]
                x,y=5,30
                radius=11
            [/avoid]
        )}
    [/event]

    #############################
    # LISAR
    #############################
    # lisar does nothing in this scenario
    {LISAR_SIDE 8 (RECRUIT=)}
    [+side]
        scroll_to_leader=no
        [ai]
            ai_algorithm=idle_ai
        [/ai]
    [/side]
    # ensure Lisar has exactly 0 income and 0 upkeep - don't gain anything, don't lose anything
    # do this with a name=start event instead of via {LISAR_SIDE INCOME=-2} so that we don't have to worry the S43 double-income logic
    [event]
        name=start
        [modify_side]
            side=$lisar_side
            income=-2
        [/modify_side]
        {MODIFY_UNIT side=$lisar_side upkeep loyal}
    [/event]

    # animals
    [side]
        side=9
        controller=null
        color=brown
        no_leader=yes
        hidden=yes
        team_name=konrad,orcs
    [/side]

    #######################################################################################################################################################
    #                                                                    PREPARE MAP
    #######################################################################################################################################################
    [event]
        name=prestart

        #############################
        # TERRAIN
        #############################
        {PLACE_IMAGE items/dwarven-keep-tile.png 24  6}
        {PLACE_IMAGE items/dwarven-keep-tile.png 21 14}
        {PLACE_IMAGE "items/whitefang-flag.png"      40 17}
        {PLACE_IMAGE "items/whitefang-flag.png~FL()" 36  4}
        {PLACE_IMAGE "items/whitefang-flag.png"      32  6}
        {PLACE_IMAGE "items/whitefang-flag.png"      20 15}

        #############################
        # GOLD PICKUPS
        #############################
        {GOLD_PICKUP 18  5 items/gold-coins-small.png   25  _"25 gold" ""}
        {GOLD_PICKUP 28  8 items/gold-coins-medium.png  50  _"50 gold" ""}
        {GOLD_PICKUP 22  2 items/gold-coins-medium.png  50  _"50 gold" ""}
        {GOLD_PICKUP 27  5 items/gold-coins-medium.png 100 _"100 gold" ""}
        {GOLD_PICKUP 23  6 items/gold-coins-large.png  200 _"200 gold" ""}
        {GOLD_PICKUP  8  4 items/gold-coins-medium.png 100 _"100 gold" ""}
        {GOLD_PICKUP  9  5 items/gold-coins-large.png  200 _"200 gold" ""}
        {GOLD_PICKUP 41 21 items/gold-coins-medium.png 100 _"100 gold" ""}
        {GOLD_PICKUP 38 20 items/gold-coins-large.png  200 _"200 gold" ""}

        # these locations are used for the armory event
        {GOLD_PICKUP 40  9 items/gold-coins-small.png  25 _"25 gold" ""}
        {PLACE_IMAGE "items/box.png"            43  8}
        {PLACE_IMAGE "items/crossbow.png"       42  8}
        {PLACE_IMAGE "items/bow.png~FL()"       42  8}
        {PLACE_IMAGE "items/sword.png~FL()"     43  9}
        {PLACE_IMAGE "items/box.png"            43 10}
        {PLACE_IMAGE "items/crossbow.png~FL()"  41 10}
        {PLACE_IMAGE "items/buckler-2.png"      40 10}
        {PLACE_IMAGE "items/konrad-weapons.png" 40 10}

        #############################
        # ANIMALS
        #############################
        {GENERIC_UNIT 9 "Woodland Boar" 17 4} {ROLE boar1}
        {GENERIC_UNIT 9 "Woodland Boar" 15 3}
        {GENERIC_UNIT 9 "Woodland Boar" 13 4}
        {GENERIC_UNIT 9 "Woodland Boar" 16 4} {ROLE boar2}
        {GENERIC_UNIT 9 "Piglet"        15 4}
        {GENERIC_UNIT 9 "Piglet"        14 4}
        {GENERIC_UNIT 9 "Piglet"        16 3} {ROLE boar3}

        #############################
        # ORCISH GUARDS
        #############################
        # guards are placed in such a way that the player can't get right next to the chief without being spotted,
        # nor can the player leave the camp completely without being spotted
        # nor can the player capture any villages without being spotted
        #------------------------
        # CHIEF'S GUARDS
        #------------------------
        # let Konrad see the chief while still stealthing, so that the player has enough info to plan their attack
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Goblin Spearman" "Orcish Grunt"       "Orcish Grunt"      }) 35  2 ({FACING sw}{ROLE boar_helper1})} # no zone_guardian AI, because these guys get teleported west
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Archer"   "Orcish Archer"      "Orcish Archer"     }) 36  1 ({FACING se}{ROLE boar_helper2})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Goblin Spearman" "Orcish Grunt"       "Orcish Grunt"      }) 35  1 ({FACING sw}{ROLE boar_speaker})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Goblin Spearman" "Orcish Grunt"       "Orcish Warrior"    }) 36  3 ({FACING sw}{ZONE_GUARDIAN 36 3 x,y,radius=36,1,3})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "none"            "Goblin Spearman" "Orcish Slayer"      "Orcish Slayer"     }) 40  3 ({FACING se}{ZONE_GUARDIAN 40 3 x,y,radius=39,2,3})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "none"            "Orcish Assassin" "Orcish Assassin"    "Orcish Assassin"   }) 40  4 ({FACING sw})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Grunt"    "Orcish Warrior"     "Orcish Warrior"    }) 39  4 ({FACING se})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Assassin" "Orcish Assassin"    "Orcish Slayer"     }) 39  7 ({FACING sw})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Goblin Spearman" "Goblin Spearman"    "Orcish Grunt"      }) 34  6 ({FACING sw})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Goblin Spearman" "Goblin Spearman"    "Orcish Grunt"      }) 33  7 ({FACING se})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Goblin Spearman" "Orcish Grunt"       "Orcish Grunt"      }) 37  4 ({FACING sw})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Goblin Spearman" "Goblin Spearman"    "Orcish Grunt"      }) 36 10 ({FACING nw})}

        {GENERIC_UNIT 7 "Goblin Spearman" 43 11} {FACING se} {ZONE_GUARDIAN 43 11 x,y,radius=42,5,7} {ROLE sleeping_armory_goblin}
        {GIVE_OBJECT_TO role=sleeping_armory_goblin ({EFFECT new_animation (
            [standing_anim]
                base_score=99
                {FRAME image="units/goblins/spearman-idle-[4~12].png:[300,150*8]"}
            [/standing_anim]
        )})}

        #------------------------
        # SOUTHEAST GUARDS
        #------------------------
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Wolf"            "Great Wolf"      "Direwolf"           "Direwolf"          }) 40 21 ({FACING nw}{GUARDIAN}{ROLE arshag_wolf})} # Asheviere's Dogs reference
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Grunt"    "Orcish Grunt"       "Orcish Grunt"      }) 33 21 ({FACING se}{GUARDIAN})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Goblin Spearman" "Orcish Grunt"       "Orcish Grunt"      }) 36 24 ({FACING sw})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Orcish Archer"   "Orcish Archer"   "Orcish Archer"      "Orcish Crossbowman"}) 36 21 ({FACING sw}{GUARDIAN})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Assassin" "Orcish Assassin"    "Orcish Assassin"   }) 34 18 ({FACING se}{GUARDIAN})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Goblin Spearman" "Orcish Grunt"       "Orcish Warrior"    }) 39 18 ({FACING ne})}

        #------------------------
        # GATE GUARDS
        #------------------------
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Assassin" "Orcish Assassin"    "Orcish Slayer"     }) 29 18 ({FACING sw}{GUARDIAN})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Grunt"    "Orcish Grunt"       "Orcish Warrior"    }) 24 18 ({FACING sw})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Orcish Assassin" "Orcish Slayer"   "Orcish Slayer"      "Orcish Slayer"     }) 23 16 ({FACING sw}{ROLE gate_speaker})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Grunt"    "Orcish Grunt"       "Orcish Grunt"      }) 20 15 ({FACING ne}{GUARDIAN})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Archer"   "Orcish Crossbowman" "Orcish Crossbowman"}) 18 14 ({FACING se})}

        #------------------------
        # CENTRAL GUARDS
        #------------------------
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Warrior"  "Orcish Warrior"     "Orcish Warrior"    }) 31  5 ({FACING nw})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Grunt"    "Orcish Grunt"       "Orcish Warrior"    }) 29  4 ({FACING se}{GUARDIAN})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Grunt"    "Orcish Grunt"       "Orcish Grunt"      }) 26  5 ({FACING se}{GUARDIAN})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Grunt"    "Orcish Grunt"       "Orcish Grunt"      }) 25  8 ({FACING sw})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Orcish Assassin" "Orcish Assassin" "Orcish Assassin"    "Orcish Slayer"     }) 20  9 ({FACING sw}{GUARDIAN})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Assassin" "Orcish Assassin"    "Orcish Assassin"   }) 24  2 ({FACING se}{ROLE nw_gold_guard})} # doesn't actually guard the gold
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Grunt"    "Orcish Grunt"       "Orcish Grunt"      }) 13  5 ({FACING sw}{GUARDIAN})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Grunt"    "Orcish Grunt"       "Orcish Grunt"      }) 15  6 ({FACING nw})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Orcish Archer"   "Orcish Archer"   "Orcish Archer"      "Orcish Crossbowman"}) 15  9 ({FACING sw}{GUARDIAN})}

        #------------------------
        # WESTERN GUARDS
        #------------------------
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Assassin" "Orcish Assassin"    "Orcish Assassin"   })  4  5 ({FACING se}{GUARDIAN})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Archer"   "Orcish Archer"      "Orcish Archer"     })  6  7 ({FACING se}{GUARDIAN})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Orcish Grunt"    "Orcish Grunt"    "Orcish Grunt"       "Orcish Warrior"    })  9  4 ({FACING ne}{GUARDIAN})}

        #############################
        # KONRAD AND ALLIES
        #############################
        #------------------------
        # LISAR
        #------------------------
        {UNSTORE_NPC Lisar x,y=7,30 side,facing=$lisar_side,nw}
        {WARVEN_OR_GUARD          "Elite Heavy Infantryman" 6 27 ne x,y,radius=6,28,1}
        {GENERIC_UNIT $lisar_side "Elite Fencer"            2 30} {FACING ne}
        {GENERIC_UNIT $lisar_side "Elite Heavy Infantryman" 8 30} {FACING ne}

        #------------------------
        # FAGH-MOK
        #------------------------
        # NOT a leader, because we need his upkeep to prevent Konrad from farming infinite gold
        {NAMED_UNIT 1 "Orcish Warlord" 3 31 faghmok _"Fagh-mok the Flattered" profile=portraits/orcs/grunt-2.webp} {FACING se}
        {TEAM_COLOR_OVERRIDE id=faghmok white}
        {MODIFY_UNIT id=faghmok moves 0}
        [event]
            name=side 1 turn refresh
            first_time_only=no
            {MODIFY_UNIT id=faghmok moves 0}
        [/event]

        # item on the ground instead of halo on the unit, because Fag-mok will move away during the victory cutscene
        [item]
            halo=items/cage.png
            x,y=3,31
        [/item]

        {GENERIC_UNIT $lisar_side "Wagon" 11 26} {FACING ne} {ROLE wagon1} {TEAM_COLOR_OVERRIDE role=wagon1 white}
        {GENERIC_UNIT $lisar_side "Wagon" 10 26} {FACING ne} {ROLE wagon2} {TEAM_COLOR_OVERRIDE role=wagon2 white}
        {GENERIC_UNIT $lisar_side "Wagon" 10 27} {FACING ne} {ROLE wagon3} {TEAM_COLOR_OVERRIDE role=wagon3 white}
        {GENERIC_UNIT $lisar_side "Wagon"  9 27} {FACING ne} {ROLE wagon4} {TEAM_COLOR_OVERRIDE role=wagon4 white}

        #------------------------
        # KONRAD
        #------------------------
        # don't recall Delfador or any companions. In this scenario, Konrad can only command 4 units
        {RECALL_XY Konrad 4 29} # if I change Konrad's starting spot, change the LOAD_INTO_WAGON coords
        {MODIFY_UNIT id=Konrad facing ne}
        {SCROLL_TO 4 29}
        [capture_village]
            side=1
            x,y=4,29
            radius=3
        [/capture_village]

        {REVEAL x,y,radius=1,20,14}
        {REVEAL x,y,radius=1,30,22}
        {REVEAL x,y,radius=24,30,10}
        {REVEAL x,y,radius=28,30,8}
        {REVEAL x,y,radius=31,30,6}
        {REVEAL x,y,radius=34,30,5}
        {REVEAL x,y,radius=38,32,4}
        {REVEAL x,y,radius=42,33,3}
    [/event]
    #######################################################################################################################################################
    #                                                                    PLAY SCENARIO
    #######################################################################################################################################################
    [event]
        name=start

        #############################
        # EXPLAIN RECRUITING
        #############################
        {DELAY 500}
        [message]
            speaker=Lisar
            message=_"I have the scheming orc locked up, Konrad. My soldiers and I will guard the camp to make sure he doesn’t escape until you safely return."
        [/message]
        [message]
            speaker=faghmok
            image_pos=right
            mirror=yes # mirror the portraits so that we don't obscure faghmok
            message=_"Yeah yeah, nice cage. Now, prince — recruit three of your best fighters, and my followers’ wagons will sneak you four into the camp."
        [/message]
        [message]
            speaker=faghmok
            image_pos=right
            mirror=yes
            message=_"You haven’t seen our camp before, but as long as you stay hidden in my wagons you should be able to freely explore. Once you find the chief, kill him!"
        [/message]

        #############################
        # OBJECTIVES
        #############################
        [objectives]
            [objective]
                description= _ "Recruit three units to help Konrad infiltrate the orcish camp"
                condition=win
                [show_if]
                    {VARIABLE_CONDITIONAL turn_number equals 1}
                [/show_if]
            [/objective]
            [objective]
                description= _ "Find and defeat the Orcish Sovereign"
                condition=win
                [show_if]
                    {VARIABLE_CONDITIONAL turn_number greater_than 1}
                [/show_if]
            [/objective]
            {OBJECTIVES_HERODEATHS}
            [gold_carryover]
                carryover_percentage=40
            [/gold_carryover]
            [note]
                description=_"Konrad can only recruit or recall during this scenario’s first turn. Next turn, Fagh-mok will sneak all your units into the center of the orcish camp."
                [show_if]
                    {VARIABLE_CONDITIONAL turn_number equals 1}
                [/show_if]
            [/note]
            [note]
                description=_"Konrad’s soldiers are disguised. They will be permanently revealed after any soldier moves adjacent to an enemy."
                [show_if]
                    {VARIABLE_CONDITIONAL turn_number greater_than 1}
                    {HAVE_UNIT side,type=1,Wagon}
                [/show_if]
            [/note]
        [/objectives]
    [/event]

    #############################
    # TRACK ACHIEVEMENT
    #############################
    [event]
        name=recruit,recall
        {FILTER side=1}
        {VARIABLE s42_failed_achievement yes}
    [/event]

    #############################
    # SMUGGLE KONRAD INTO CAMP
    #############################
    [event]
        name=turn 2 refresh # after Konrad's new recruits get their full moves/attacks
        {IF} {VARIABLE_CONDITIONAL s42_failed_achievement not_equals yes} {THEN(
            [message]
                speaker=faghmok
                image_pos=right
                mirror=yes
                message=_"Just you? You’re going alone? ...fine, pick a wagon, get in, and hide under the hay. My goblins will sneak you inside."
            [/message]
        )}
        {ELSEIF} {HAVE_UNIT( side=1 {AND type_adv_tree="Grypon Rider",Cavalryman,Horseman} )}
        [then]
            [message]
                speaker=faghmok
                image_pos=right
                mirror=yes
                message=_"Ready? Pick a wagon, get in, and hide under the hay. Harness your animals to the front. My goblins will sneak you all inside."
            [/message]
        [/then]
        {/ELSEIF}
        {ELSEIF} {HAVE_UNIT( side=1 {AND type_adv_tree="Granite Golem"} )}
        [then]
            [message]
                speaker=faghmok
                image_pos=right
                mirror=yes
                message=_"Ready? Pick a wagon, get in, and hide under the hay. Yes, even that big rock thing. My goblins will sneak you all inside."
            [/message]
        [/then]
        {/ELSEIF}
        {ELSEIF} {HAVE_UNIT( side=1 {AND type_adv_tree="Fire Guardian"} )}
        [then]
            [message]
                speaker=faghmok
                image_pos=right
                mirror=yes
                message=_"Ready? Pick a wagon, get in, and hide under the hay. Err... maybe we can find something less flammable than hay to cover up that fire thing."
            [/message]
        [/then]
        {/ELSEIF}
        {ELSE(
            [message]
                speaker=faghmok
                image_pos=right
                mirror=yes
                message=_"Ready? Pick a wagon, get in, and hide under the hay. My goblins will sneak you all inside."
            [/message]
        )} {/IF}

        #------------------------
        # PREVENT RECRUITING
        #------------------------
        {MODIFY_UNIT id=Konrad                 canrecruit no}
        {MODIFY_UNIT id,x,y=Delfador,0-99,0-99 canrecruit no}

        {GIVE_OBJECT_TO id=Konrad (
            id=pretend_to_be_leader
            {EFFECT loyal ()}
            {EFFECT overlay add=misc/leader-crown.png}
        )}
        {GIVE_OBJECT_TO id,x,y=Delfador,0-99,0-99 (
            id=pretend_to_be_leader
            {EFFECT loyal ()}
            {EFFECT overlay add=misc/leader-crown.png}
        )}

        [event]
            name=victory
            {REMOVE_OBJECT pretend_to_be_leader ()}
            {MODIFY_UNIT id=Konrad   canrecruit yes}
            {MODIFY_UNIT id=Delfador canrecruit yes}
        [/event]

        #------------------------
        # LOAD UNITS INSIDE WAGONS
        #------------------------
#define LOAD_INTO_WAGON CARGO_FILTER WAGON
    {IF} {HAVE_UNIT {CARGO_FILTER}} {THEN(
        {STORE_UNIT_VAR {CARGO_FILTER} id cargo_id}
        {DO_AT_COORDS role={WAGON} (
            {MOVE_UNIT id=$cargo_id $coordX $coordY}
            {SOUND magicmissile.wav}
            [store_unit]
                {FILTER id=$cargo_id}
                variable=cargo_{WAGON}
                kill=yes
            [/store_unit]
            {FAKE_UNIT_MOVE $cargo_{WAGON}.x $coordX $cargo_{WAGON}.y $coordY 1 $cargo_{WAGON}.type ()}
            {MODIFY_UNIT role={WAGON} side 1}
            {GIVE_OBJECT_TO role={WAGON} (
                {EFFECT profile portrait=$cargo_{WAGON}.profile}
                [effect]
                    apply_to=overlay
                    add="misc/blank-hex.png~SCALE(144,144)~BLIT( $cargo_{WAGON}.image~FL()~RC(magenta>blue)~SCALE(100,100), 60,0 )"
                [/effect]
            )}
            {MODIFY_UNIT role={WAGON} name $cargo_{WAGON}.name}
        )}
        {CLEAR_VARIABLE cargo_id}
    )} {/IF}
#enddef
        {LOAD_INTO_WAGON id=Konrad wagon1}
        {LOAD_INTO_WAGON x,y=5,30  wagon2}
        {LOAD_INTO_WAGON x,y=4,28  wagon3}
        {LOAD_INTO_WAGON x,y=3,29  wagon4}
        {KILL( type=Wagon {NOT side=1} )}

        #------------------------
        # APPROACH GATE
        #------------------------
        {MOVE_UNIT role=wagon1 19 21} {REDRAW}
        {MOVE_UNIT role=wagon1 19 20} {REDRAW}
        {MOVE_UNIT role=wagon1 19 19} {REDRAW}
        {MOVE_UNIT role=wagon1 19 18} {REDRAW}
        {MOVE_UNIT role=wagon1 20 17} {REDRAW}
        {MOVE_UNIT role=wagon1 21 17} {REDRAW}

        {MOVE_UNIT role=wagon2 20 17} {REDRAW}
        {MOVE_UNIT role=wagon3 19 17} {REDRAW}
        {MOVE_UNIT role=wagon4 19 18} {REDRAW}

        [message]
            speaker=leader6
            message=_"Wagons at the gate!"
        [/message]
        {IF} {HAVE_UNIT type,count=Wagon,0-2} {THEN(
            [message]
                role=gate_speaker
                message=_"That you, Razgob? Glad to see you’re bringing pillage with you this time."
            [/message]
        )} {ELSE(
            [message]
                role=gate_speaker
                message=_"That you, Razgob? Big load of pillage you’ve brought with you this time."
            [/message]
        )} {/IF}
        [message]
            role=wagon1
            caption=_"Wagon Driver"
            image=portraits/goblins/spearman.webp
            message=_"(shaking) *squeak*"
        [/message]
        [message]
            speaker=leader6
            message=_"Stupid runtling, quit trembling! What’re you so afraid of? Go on through and get everything to the stockpiles."
        [/message]

        #------------------------
        # ENTER CAMP CENTER
        #------------------------
        {MOVE_UNIT role=wagon1 22 16} {REDRAW}
        {MOVE_UNIT role=wagon1 23 17} {REDRAW}
        {MOVE_UNIT role=wagon1 24 16} {REDRAW}
        {MOVE_UNIT role=wagon1 25 17} {REDRAW}
        {MOVE_UNIT role=wagon1 26 16} {REDRAW}
        {MOVE_UNIT role=wagon1 27 16} {REDRAW}
        {MOVE_UNIT role=wagon1 28 15} {REDRAW}
        {MOVE_UNIT role=wagon1 29 15} {REDRAW}
        {MOVE_UNIT role=wagon1 30 14} {REDRAW}
        {MOVE_UNIT role=wagon1 31 14} {REDRAW}

        {MOVE_UNIT role=wagon2 30 14} {REDRAW}
        {MOVE_UNIT role=wagon3 30 15} {REDRAW}
        {MOVE_UNIT role=wagon4 29 15} {REDRAW}

        #------------------------
        # ADD INVISIBILITY
        #------------------------
        # wagons look funny if they're invisible on turn 1, so wait until now
        {GIVE_OBJECT_TO type=Wagon ({EFFECT new_ability (
            [abilities]
                [hides]
                    id=disguised
                    name= _ "disguised"
                    female_name= _ "disguised"
                    description= _ "This unit’s mundane exterior conceals assassins within."
                    affect_self=yes
                [/hides]
            [/abilities]
        )} )}

        [show_objectives]
        [/show_objectives]
    [/event]

    #############################
    # DECLOAK WAGON
    #############################
#define UNLOAD_FROM_WAGON EXTRA_FILTER
    [store_unit]
        {FILTER( side,type=1,Wagon {EXTRA_FILTER} )}
        variable=wagons
        kill=yes
    [/store_unit]
    [foreach]
        array=wagons
        variable=wagon
        [do]
            [unstore_unit]
                variable=cargo_$wagon.role
                x,y=$wagon.x,$wagon.y
            [/unstore_unit]
            {MODIFY_UNIT x,y=$wagon.x,$wagon.y facing $wagon.facing}
            {MODIFY_UNIT x,y=$wagon.x,$wagon.y moves  $wagon.moves}
            {CLEAR_VARIABLE cargo_$wagon.role}
        [/do]
    [/foreach]
    {CLEAR_VARIABLE wagons}
#enddef
    [event]
        name=enter hex
        first_time_only=no
        {FILTER_CONDITION({HAVE_UNIT( side,type=1,Wagon {FILTER_ADJACENT({NOT( {IS_ALLY} )})} )})}

        [cancel_action]
        [/cancel_action]
        {FIRE_EVENT first_undisguise_pre}
        {SOUND wose-die.ogg}
        {DELAY 1000}
        {UNLOAD_FROM_WAGON ({FILTER_ADJACENT({NOT( {IS_ALLY} )})}) }
        {FIRE_EVENT first_undisguise_post}
    [/event]
    [event]
        name=first_undisguise_pre
        {STORE_UNIT_VAR ({NOT({IS_ALLY})}  {FILTER_ADJACENT side,type=1,Wagon}) id spotter_id}
        {STORE_UNIT_VAR (side,type=1,Wagon {FILTER_ADJACENT id=$spotter_id   }) id spotee_id}
        [message]
            speaker=$spotter_id
            message=_"Hey, I think there’s someone hiding inside this wagon! Let’s chase away the driver and break it apart!"
        [/message]
        {ANIMATE_HARM id=$spotter_id 15 range=melee id=$spotee_id EXPERIENCE=no KILL=no}
        {CLEAR_VARIABLE spotter_id,spotee_id}
    [/event]
    [event]
        name=first_undisguise_post
        {REDRAW}
        {FADE_MUSIC_OUT 500}
        {REPLACE_SCENARIO_MUSIC northerners.ogg}
        {APPEND_MUSIC northern_mountains.ogg}
        {APPEND_MUSIC frantic.ogg}
        {FADE_MUSIC_IN 10}
        [message]
            speaker=leader6
            #po: this is the same orc who let Konrad's soldiers in
            message=_"It’s a spy! Which one of you grunts let that worm into our camp?!"
        [/message]
        [message]
            speaker=Khargol
            message=_"We’re under attack! Check the other wagons! Grab your swords and kill anything that looks out of place!"
        [/message]
        {UNLOAD_FROM_WAGON ()}

        # move to a more defensive position, then recruit a few units immediately, so he's harder to rush down in 1 turm
        {MOVE_UNIT id=Khargol 39 1}
        {GENERIC_UNIT 2 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Grunt"   "Orcish Grunt"   "Orcish Warrior"}) 38 2} {ANIMATE} {FACING sw}
        {GENERIC_UNIT 2 ({ON_DIFFICULTY4 "Goblin Spearman" "Goblin Impaler" "Goblin Impaler" "Goblin Impaler"}) 39 2} {ANIMATE} {FACING sw}
        {GENERIC_UNIT 2 ({ON_DIFFICULTY4 "Goblin Spearman" "Orcish Grunt"   "Orcish Warrior" "Orcish Warrior"}) 38 1} {ANIMATE} {FACING se}
        [message]
            role=wagon1 {OR id=Konrad}
            caption=_"Konrad" {KONRAD_VARIATION mad}
            message=_"They’re getting ready for battle! We have to defeat the chief before we’re overwhelmed."
        [/message]

        [modify_side]
            side=2
            income={ON_DIFFICULTY4 4 10 16 22}
            recruit=Orcish Warrior,Orcish Crossbowman
        [/modify_side]
        [modify_side]
            side=3,4,5,6
            income={ON_DIFFICULTY4 4 6 8 10} # reduced scaling - these guys are a pseudo time limit, not a force to be fought
            recruit=Goblin Spearman,Orcish Grunt
        [/modify_side]
        {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Orcish Archer"   1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Orcish Archer"   1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Orcish Assassin" 1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Orcish Archer"   1}

        {VARIABLE decloak_turn $turn_number}

        #############################
        # BONUS INCOME OVER TIME
        #############################
        # every new turn, increase our income by 1
        [event]
            name=new turn
            first_time_only=no
            # give 1 gold to each side every turn
            [event]
                name=new turn
                first_time_only=no
                [store_unit]
                    {FILTER( canrecruit=yes {NOT({IS_ALLY})} )}
                    variable=stored_enemy_leaders
                [/store_unit]
                [foreach]
                    array=stored_enemy_leaders
                    [do]
                        [gold]
                            side=$this_item.side
                            amount=1
                        [/gold]
                    [/do]
                [/foreach]
            [/event]
        [/event]

        #############################
        # ENRAGE BAZUR
        #############################
        {VARIABLE enrage_turn "$($decloak_turn+12)"}
        [event]
            name=turn $enrage_turn

            # if the player is taking too long to win (maybe farming?), let Khargol make suicidal attacks
            [micro_ai]
                ai_type=zone_guardian
                action=add
                side=2
                {FILTER id=Khargol}
                {FILTER_LOCATION()}
                ca_score=400000 # higher than every other CA, including the normal leader CAs
            [/micro_ai]
            [remove_event]
                id=limit_moves_leader2
            [/remove_event]

            # nearby allies more-or-less follow Khargol
            [micro_ai]
                ai_type=zone_guardian
                action=add
                side=3
                {FILTER( {FILTER_LOCATION( radius=8 {FILTER id=Khargol} )} )}
                {FILTER_LOCATION(          radius=3 {FILTER id=Khargol} )}
                {FILTER_LOCATION_ENEMY(    radius=8 {FILTER id=Khargol} )}
                ca_score=300000
            [/micro_ai]
            [micro_ai]
                ai_type=zone_guardian
                action=add
                side=4
                {FILTER( {FILTER_LOCATION( radius=8 {FILTER id=Khargol} )} )}
                {FILTER_LOCATION(          radius=3 {FILTER id=Khargol} )}
                {FILTER_LOCATION_ENEMY(    radius=8 {FILTER id=Khargol} )}
                ca_score=300000
            [/micro_ai]
            [micro_ai]
                ai_type=zone_guardian
                action=add
                side=5
                {FILTER( {FILTER_LOCATION( radius=8 {FILTER id=Khargol} )} )}
                {FILTER_LOCATION(          radius=3 {FILTER id=Khargol} )}
                {FILTER_LOCATION_ENEMY(    radius=8 {FILTER id=Khargol} )}
                ca_score=300000
            [/micro_ai]
            [micro_ai]
                ai_type=zone_guardian
                action=add
                side=6
                {FILTER( {FILTER_LOCATION( radius=8 {FILTER id=Khargol} )} )}
                {FILTER_LOCATION(          radius=3 {FILTER id=Khargol} )}
                {FILTER_LOCATION_ENEMY(    radius=8 {FILTER id=Khargol} )}
                ca_score=300000
            [/micro_ai]
            [micro_ai]
                ai_type=zone_guardian
                action=add
                side=7
                {FILTER( {FILTER_LOCATION( radius=8 {FILTER id=Khargol} )} )}
                {FILTER_LOCATION(          radius=3 {FILTER id=Khargol} )}
                {FILTER_LOCATION_ENEMY(    radius=8 {FILTER id=Khargol} )}
                ca_score=300000
            [/micro_ai]
        [/event]
    [/event]

    #######################################################################################################################################################
    #                                                                    MINOR EVENTS
    #######################################################################################################################################################
    #############################
    # ARSHAG SPOTTED
    #############################
    [event]
        name=moveto
        {FILTER( side=1 {FILTER_LOCATION( radius=5 {FILTER id=Arshag} )} )}
        {FILTER_CONDITION({HAVE_UNIT( role=arshag_wolf {FILTER_ADJACENT id=Arshag} )})}
        {REVEAL( radius=1 {FILTER id=Arshag} )}
        [message]
            role=arshag_wolf
            message=_"Grrrr! Arf!"
        [/message]
        [message]
            speaker=Arshag
            #po: Arshag is talking to his pet wolf, in the same way that a modern human might talk to a dog
            message=_"Who’s a good girl? Are you a good girl? Are you ready to feast on the bones of our enemies?"
        [/message]
        [message]
            role=arshag_wolf
            message=_"Arf! Arf! Woof!"
        [/message]
        [allow_undo]
        [/allow_undo]
    [/event]

    #############################
    # STINKY GOBLIN GUARD
    #############################
    [event]
        name=moveto
        {FILTER( side=1 {FILTER_LOCATION( x,y,radius=22,6,1 )} )}
        {FILTER_CONDITION({VARIABLE_CONDITIONAL decloak_turn equals $null})}
        [message]
            speaker=leader3b
            message=_"Hurry on past, goblin. I don’t want your stench in my nose while I’m trying to eat."
        [/message]
        [allow_undo]
        [/allow_undo]
    [/event]

    #############################
    # GOLD GUARD SPOTTED
    #############################
    [event]
        name=moveto
        {FILTER( side=1 {FILTER_LOCATION( radius=5 {FILTER role=nw_gold_guard} )} )}
        {FILTER_CONDITION({VARIABLE_CONDITIONAL decloak_turn equals $null})}
        {REVEAL( radius=1 {FILTER role=nw_gold_guard} )}
        {REVEAL( x,y,radius=22,2,1 )}
        [message]
            role=nw_gold_guard
            message=_"That last raid was great! I can’t believe the queen is still finding rebel villages for us to plunder!"
        [/message]
        [message]
            role=nw_gold_guard
            message=_"Just look at this pile of gold I’ve pillaged! I hope nobody steals my loot while I’m not looking..."
        [/message]
        [allow_undo]
        [/allow_undo]
    [/event]

    #############################
    # ANIMALS EVENT
    #############################
    [event]
        name=moveto
        {FILTER( side=1 {FILTER_LOCATION x,y,radius=18,4,1} )}
        {FILTER_CONDITION({VARIABLE_CONDITIONAL decloak_turn equals $null})}
        {REVEAL x,y,radius=14-16,4,2}
        [message]
            role=wagon1 {OR id=Konrad}
            message=_"There are caged animals here, many bearing the brand of a chief. They don’t look very well cared for."
        [/message]
        [message]
            role=wagon1 {OR id=Konrad}
            message=_"Let us lift the latch on their fence gate, then quietly leave before anybody notices..."
        [/message]
        {DELAY 250}
        {MODIFY_TERRAIN "Rb"     18 4}
        {SOUND gate-fall.ogg}
        {REDRAW}
        {DELAY 250}
        [event]
            name=new turn
            {MOVE_UNIT role=boar1 19 5}
            {MOVE_UNIT role=boar2 18 6}
            {MOVE_UNIT role=boar3 21 7}
            [event]
                name=new turn
                {FILTER_CONDITION({VARIABLE_CONDITIONAL decloak_turn equals $null})}
                {REVEAL x,y,radius=35-37,1,2}
                [message]
                    role=boar_speaker
                    message=_"Chief! Chief! Someone opened the pasture gate! Your prize pigs are running free!"
                [/message]
                [message]
                    speaker=Khargol
                    message=_"Imbiciles! You three, go guard the pen and find my pigs. When I find out who was responsible..."
                [/message]
                [hide_unit]
                    role=boar_speaker
                [/hide_unit]
                {TELEPORT_UNIT role=boar_speaker 13 1}

                {MOVE_UNIT role=boar_helper1 35 1}
                [hide_unit]
                    role=boar_helper1
                [/hide_unit]
                {TELEPORT_UNIT role=boar_helper1 11 1}

                {MOVE_UNIT role=boar_helper2 35 1}
                [hide_unit]
                    role=boar_helper2
                [/hide_unit]
                {DELAY 1000}

                {REVEAL x,y,radius=12,1-2,3}
                [unhide_unit]
                    role=boar_helper1
                [/unhide_unit]
                {SCROLL_TO 12 1}
                {MOVE_UNIT role=boar_helper1 12 5}

                {TELEPORT_UNIT role=boar_helper2 11 1}
                [unhide_unit]
                    role=boar_helper2
                [/unhide_unit]
                {MOVE_UNIT role=boar_helper2 13 2}

                {TELEPORT_UNIT role=boar_speaker 11 1}
                [unhide_unit]
                    role=boar_speaker
                [/unhide_unit]
            [/event]
        [/event]
    [/event]

    #############################
    # CENTER ORC SPOTTED
    #############################
    [event]
        name=moveto
        {FILTER( side=1 {FILTER_LOCATION( radius=5 {FILTER id=leader3} )} )}
        {FILTER_CONDITION({VARIABLE_CONDITIONAL decloak_turn equals $null})}
        {REVEAL( radius=1 {FILTER id=leader3} )}
        [message]
            speaker=leader3
            message=_"Argh, this place is so boring! Why am I stuck guarding this dumb valley instead of going out on raids? I wish something exciting would finally happen..."
        [/message]
        [allow_undo]
        [/allow_undo]
    [/event]

    #############################
    # GATE ORC SPOTTED
    #############################
    [event]
        name=moveto
        {FILTER( side=1 {FILTER_LOCATION( x,y,radius=22,16,3 )} )}
        {FILTER_CONDITION({VARIABLE_CONDITIONAL decloak_turn equals $null})}
        {REVEAL( radius=1 {FILTER id=leader6} )}
        [message]
            speaker=leader6
            message=_"Hey, what’re you goblins doing back here? Get lost!"
        [/message]
        [allow_undo]
        [/allow_undo]
    [/event]

    #############################
    # ARMORY EVENT
    #############################
    [event]
        name=moveto
        priority=-10 # after the gold pickup
        {FILTER( side=1 {FILTER_LOCATION( x,y,radius=42,9,3 )} )}
        {FILTER_CONDITION({VARIABLE_CONDITIONAL decloak_turn equals $null})}
        [message]
            role=wagon1 {OR id=Konrad}
            caption=_"Konrad"
            message=_"Look at all those weapons! This must be one of their armories."
        [/message]
        [message]
            role=wagon1 {OR id=Konrad}
            caption=_"Konrad"
            message=_"If we can sabotage some without waking that goblin guard, we’ll make it harder for their chief to recruit fighters and respond to our attack."
        [/message]
        {SCROLL_TO 40 9}
        {SOUND magicmissile.wav} {PLACE_IMAGE "scenery/castle-ruins3.png" 40 10} {REDRAW} {DELAY 750}
        {SOUND magicmissile.wav} {PLACE_IMAGE "scenery/castle-ruins2.png" 41 10} {REDRAW} {DELAY 750}
        {SOUND magicmissile.wav} {PLACE_IMAGE "scenery/castle-ruins.png"  43  9} {REDRAW} {DELAY 750}
        {SOUND magicmissile.wav} {PLACE_IMAGE "scenery/castle-ruins2.png" 42  8} {REDRAW} {DELAY 750}
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message= _ "The Orcish Sovereign’s gold has been reduced to 0."
        [/message]
        [modify_side]
            side=2
            gold=0
        [/modify_side]
    [/event]

    #############################
    # KHARGOL SPOTTED
    #############################
    [event]
        name=moveto
        {FILTER( side=1 {FILTER_LOCATION( radius=5 {FILTER id=Khargol} )} )}
        {REVEAL( radius=1 {FILTER id=Khargol} )}
        [message]
            speaker=Khargol
            message=_"Where’s that useless worm Fagh-Mok? He’s supposed to take orders from me! But he’s been acting suspiciously lately, and now I can’t find him at all."
        [/message]
        [message]
            speaker=Khargol
            message=_"I’ll be watching him. He’d better not try anything funny or I’ll chop his head off!"
        [/message]
        [message]
            role=wagon1 {OR id=Konrad}
            caption=_"Konrad"
            message=_"That must be the orcish chief. He’s the one we need to kill."
        [/message]
        [allow_undo]
        [/allow_undo]
    [/event]

    #############################
    # KONRAD REACHES A KEEP
    #############################
    [event]
        name=moveto
        {FILTER( id=Konrad,Delfador {FILTER_LOCATION terrain=K*^*} )}
        [message]
            role=wagon1 {OR id=Konrad}
            caption=_"Konrad"
            message=_"We have reached an orcish keep, but our army is still outside. Any attempt to bring them in would only give the orcs time to deploy more soldiers against us."
        [/message]
        [allow_undo]
        [/allow_undo]
    [/event]

    #############################
    # KONRAD RETURNS TO CAMP
    #############################
    # don't let Konrad return to camp, or else our "can't recruit" justification gets shaky
    [event]
        name=enter hex
        first_time_only=no
        {FILTER( side=1 {FILTER_LOCATION x,y,radius=3,31,10} )}
        {FILTER_CONDITION({VARIABLE_CONDITIONAL turn_number greater_than 1})}
        {FIRE_EVENT explain_return}
        {MOVE_UNIT id=$unit.id $x2 $y2}
    [/event]
    [event]
        name=explain_return
        [message]
            speaker=faghmok
            image_pos=right
            mirror=yes
            message=_"You idiot! What’re you doing back here?! You’re supposed to be fighting the chief!"
        [/message]
        [message]
            speaker=faghmok
            image_pos=right
            mirror=yes
            message=_"Get back in there or our deal’s off!"
        [/message]
    [/event]

    #############################
    # KHARGOL SPEAKS
    #############################
    #------------------------
    # KHARGOL RECOGNIZES DELFADOR
    #------------------------
    [event]
        name=attack end
        {FILTER id=Delfador}
        [message]
            speaker=Khargol
            #po: referring to the events from the final scenario of Asheviere's Dogs. Khargol wasn't a named character in that campaign, but perhaps he was one of the random grunts
            message=_"You! You’re that wizard from the battle at Dan’Tonk! The one who did the storm and the lightning."
        [/message]
        [message]
            speaker=Khargol
            #po: Bazur is an orcish warrior, and the main character of Asheviere's Dogs.
            message=_"Bazur always said he wanted a chance to kill you. Now I’ll do what he never could!"
        [/message]
        [message]
            speaker=Delfador {DELFADOR_VARIATION mad}
            message=_"Those were dark days. Today I end your rule as I shall one day end Asheviere’s!"
        [/message]
    [/event]
    #------------------------
    # KHARGOL RECOGNIZES SCEPTRE
    #------------------------
    [event]
        name=attack end
        {FILTER_ATTACK name="sceptre of fire"}
        [message]
            speaker=Khargol
            message=_"Hey! Do you see that? That’s the thing the queen told us to watch out for!"
        [/message]
        [message]
            speaker=Khargol
            message=_"The Sceptre of Fire! Get it!"
        [/message]
    [/event]
    #------------------------
    # KHARGOL IS ATTACKED
    #------------------------
    [event]
        name=unit hits
        {FILTER_SECOND id=Khargol}
        [message]
            speaker=Khargol
            message=_"Weakling invaders! I’ll kill you all!"
        [/message]
    [/event]

    #######################################################################################################################################################
    #                                                                    VICTORY / DEFEAT
    #######################################################################################################################################################
    #############################
    # EXPENDABLE LEADERS DIE
    #############################
    [event]
        name=last breath
        {FILTER role=arshag_wolf}
        [message]
            role=arshag_wolf
            message=_"<i>whimper whimper whimper</i>"
        [/message]
        [message]
            speaker=Arshag
            message=_"You’ll pay for that!"
        [/message]
    [/event]
    [event]
        name=last breath
        {FILTER id=Arshag}
        [message]
            speaker=Arshag
            message=_"These foes are beyond my strength!"
        [/message]
    [/event]
    [event]
        name=last breath
        {FILTER id=leader3}
        [message]
            speaker=leader3
            message=_"Filthy pinkskins!"
        [/message]
    [/event]
    [event]
        name=last breath
        {FILTER id=leader4}
        [message]
            speaker=leader4
            message=_"Curse you all!"
        [/message]
    [/event]
    [event]
        name=last breath
        {FILTER id=leader6}
        [message]
            speaker=leader6
            message=_"Gah!!"
        [/message]
    [/event]

    #############################
    # BAZUR DIES
    #############################
    [event]
        name=last breath
        {FILTER id=Khargol}

        [message]
            speaker=Khargol
            #po: Konrad may not have struck the finishing blow, but it'll be either him or one of his soldiers
            message=_"Impossible! Arr, how shameful to die at the hands of some stupid assassins..."
        [/message]
        {IF} {VARIABLE_CONDITIONAL s42_failed_achievement not_equals yes} {THEN(
            {ACHIEVE s42}
        )} {/IF}
        {CLEAR_VARIABLE s42_failed_achievement}

        [event]
            name=die
            {IF} {NOT({HAVE_UNIT id=leader3})} {THEN(
                {NAMED_UNIT 3 "Orcish Warrior" 24 1 leader3 _"Gado-har" canrecruit=yes} {FACING se}
            )} {/IF}
            {REVEAL( radius=1 {FILTER id=leader3} )}
            [message]
                speaker=leader3
                message=_"Khargol’s dead! The assassins killed our chief!"
            [/message]

            #------------------------
            # FAGH-MOK ESCAPES HIS CAGE
            #------------------------
            [message]
                speaker=faghmok
                image_pos=right
                mirror=yes
                message=_"Now is my chance! Set me free, girl, so I can take command of the horde!"
            [/message]
            [message]
                speaker=Lisar {LISAR_VARIATION mad}
                message=_"Set you free? Nice try. You’re not getting out of that cage until Konrad returns."
            [/message]
            [message]
                speaker=faghmok
                image_pos=right
                mirror=yes
                message=_"Stupid girl, you think the other orcs are just going to let him walk out? I must take command. Set me free or your friends all die!"
            [/message]
            [message]
                speaker=Lisar {LISAR_VARIATION mad}
                message=_"Rrr... insufferable. I don’t know how Mother stands working with orcs."
            [/message]
            [message]
                speaker=Lisar {LISAR_VARIATION mad}
                message=_"Go. But don’t dare betray us, or I swear to personally find you and kill you. If you know anything about me, you’ll know that’s a promise I can keep."
            [/message]
            {REMOVE_IMAGE 3 31}
            {SOUND gate-fall.ogg}
            {DELAY 250}
            {MODIFY_UNIT id=faghmok side 2}
            {MODIFY_UNIT id=faghmok canrecruit yes}

            #------------------------
            # FAGH-MOK SAVES KONRAD
            #------------------------
            {UNLOAD_FROM_WAGON ()} # decloak any remaining wagons
            {DO_AT_COORDS id=Konrad (
                {PUT_TO_RECALL_LIST x,y=$coordX,"$($coordY+1)"}
                {MOVE_UNIT id=faghmok $coordX "$($coordY+1)"}
            )}
            [message]
                speaker=faghmok
                image_pos=right
                mirror=yes
                message=_"Assassins! I’ll get them!"
            [/message]
            {ANIMATE_HARM id=faghmok 20 range=melee id=Konrad EXPERIENCE=no KILL=no}
            [message]
                speaker=Konrad {KONRAD_VARIATION mad}
                message=_"You?! What??"
            [/message]
            [message]
                speaker=faghmok
                image_pos=right
                mirror=yes
                message="<span size='x-small'>" + _"Play dead, you idiot." + "</span>"
            [/message]
            {DELAY 500}
            {ANIMATE_HARM id=faghmok 20 range=melee id=Konrad EXPERIENCE=no KILL=no}
            {DELAY 250}
            [store_unit]
                {FILTER side,x,y=1,0-99,0-99}
                variable=escaping_infiltrators
                kill=yes
            [/store_unit]
            {DELAY 500}

            #------------------------
            # FAGH-MOK TRIES TO TAKE COMMAND
            #------------------------
            [message]
                speaker=faghmok
                image_pos=right
                mirror=yes
                message=_"Look, everyone! I have slain the invaders and avenged the murder of our chief!"
            [/message]
            [message]
                speaker=faghmok
                image_pos=right
                mirror=yes
                message=_"As head of Khargol’s personal guard, is only right that I assume the late chief’s duties! Long live chief Fagh-mok the Amazing!"
            [/message]
            {DELAY 500}

            #------------------------
            # OTHER CHIEFS TRY TO TAKE COMMAND
            #------------------------
            {IF} {NOT({HAVE_UNIT id=Arshag})} {THEN(
                {NAMED_UNIT 5 "Orcish Crossbowman" 43 20 Arshag _"Akhir" canrecruit=yes} {FACING nw}
            )} {/IF}
            {REVEAL( radius=1 {FILTER id=Arshag} )}
            [message]
                speaker=Arshag
                message=_"Fagh-mok? You?! You’re weak! You were nothing more than the chief’s sword-carrier!"
            [/message]
            [message]
                speaker=Arshag
                message=_"No, I should be chief instead! Khargol respected me most of all! I followed him from the beginning!"
            [/message]
            # we already verified leader3's existance further above
            [message]
                speaker=leader3
                message=_"No, I should be chief! My warriors are the bravest, and I am the strongest warrior of all!"
            [/message]

            {IF} {NOT({HAVE_UNIT id=Arshag})} {THEN(
                {NAMED_UNIT 4 "Orcish Slurbow" 11 2 leader4 _"Bovrir" canrecruit=yes} {FACING se}
            )} {/IF}
            {REVEAL( radius=1 {FILTER id=leader4} )}
            [message]
                speaker=leader4
                message=_"Strongest?! I could kill both you AND that ingrate Fagh-Mok, with one hand tied behind my back!"
            [/message]

            [message]
                speaker=faghmok
                image_pos=right
                mirror=yes
                message=_"Oh yeah? Come here and try it, you worthless sack of slime!"
            [/message]
            [message]
                speaker=Arshag
                message=_"I say we kill all three of ’em! Warriors, fight to make me chief and I promise to bathe you all in gold and blood!"
            [/message]
            {DELAY 1000}

            #------------------------
            # KONRAD LEAVES
            #------------------------
            [foreach]
                array=escaping_infiltrators
                variable=unit
                [do]
                    [unstore_unit]
                        variable=unit
                        x,y=20,18
                        find_vacant=yes
                    [/unstore_unit]
                    {MODIFY_UNIT id=$unit.id facing sw}
                [/do]
            [/foreach]
            {MODIFY_UNIT id=Konrad hitpoints 23}
            {SCROLL_TO 20 18}
            {DELAY 500}
            [foreach]
                array=escaping_infiltrators
                variable=unit
                [do]
                    {MOVE_UNIT id=$unit.id 11 27}
                [/do]
            [/foreach]
            {CLEAR_VARIABLE escaping_infiltrators}
            [message]
                speaker=Konrad
                message=_"Hail, Li’sar! I return!"
            [/message]
            [message]
                speaker=Lisar
                message=_"The orcich camp echoes with shouts and screams. I take it Fagh-Mok’s bid to become chief has not gone according to plan?"
            [/message]
            [message]
                speaker=Konrad
                message=_"Not exacty, no. But at least he held up his end of the bargain, and we ours. Chief Khargol is dead, and until the Whitefangs resolve their succession crisis they’ll be of no aid to Asheviere."
            [/message]
            [message]
                speaker=Lisar
                message=_"Then we’ve accomplished what we set out to do. Onwards to the next battle."
            [/message]

            {CLEAR_VARIABLE decloak_turn,enrage_turn}
            [endlevel]
                result=victory
                {NEW_GOLD_CARRYOVER 40}
            [/endlevel]
        [/event]
    [/event]
[/scenario]

#undef SCENARIO_TURN_LIMIT
#undef ORC_SIDE
#undef LOAD_INTO_WAGON
#undef UNLOAD_FROM_WAGON
#undef BONUS_INCOME_PER_LEADER
