#textdomain wesnoth-h2tt
[textdomain]
    name="wesnoth-h2tt"
[/textdomain]

#ifdef CAMPAIGN_HEIR_2_THE_THRONE
[lua]
    code = <<
            wesnoth.dofile('campaigns/Heir_To_The_Throne/lua/' .. 'skip_animations.lua')
            wesnoth.dofile('campaigns/Heir_To_The_Throne/lua/' .. 'companion_message.lua')
            wesnoth.dofile('campaigns/Heir_To_The_Throne/lua/' .. 'popups.lua')
            wesnoth.dofile('campaigns/Heir_To_The_Throne/lua/' .. 'multihex_image.lua')
        >>
[/lua]
{internal/Urban_Jungle}
{internal/Weather}
{internal/Rogue_Mage}
{campaigns/Heir_To_The_Throne/utils}
[units]
    {campaigns/Heir_To_The_Throne/units}
[/units]
{campaigns/Heir_To_The_Throne/scenarios}
[binary_path]
    path=data/campaigns/Heir_To_The_Throne
[/binary_path]
{campaigns/Heir_To_The_Throne/terrain.cfg}
{campaigns/Heir_To_The_Throne/terrain-graphics.cfg}

[color_range]
    id=wesred
    rgb=8A0808,FFFFFF,000000,BB0000
[/color_range]
[color_range]
    id=lisarcolor
    rgb=a01b59,db8eb2,1f000d,ff5b5b
[/color_range]
#endif

#ifdef EDITOR
[binary_path]
    path=data/campaigns/Heir_To_The_Throne
[/binary_path]
[editor_group]
    id=heir_2_the_throne
    name= _ "Heir to the Throne"
    icon="group_custom"
[/editor_group]
{campaigns/Heir_To_The_Throne/terrain.cfg}
{campaigns/Heir_To_The_Throne/terrain-graphics.cfg}
#endif

# wmlscope: set export=no
[campaign]
    id=Heir 2 The Throne
    name= _ "Heir to the Throne"
    icon="data/campaigns/Heir_To_The_Throne/images/units/konrad/konrad-lord-leading.png"
    image="data/campaigns/Heir_To_The_Throne/images/campaign_image.png"
    abbrev= _ "HttT"
    rank=55
    start_year="517 YW"
    end_year="520 YW"
    define=CAMPAIGN_HEIR_2_THE_THRONE
    first_scenario=01_The_Elves_Besieged

    description= _ "Seventeen years ago, the traitor queen Asheviere violently usurped the throne of Wesnoth. Now she rules tyrannically over her domain.

You, the old king’s last legitimate living heir, must embark on a long and perilous journey to dismantle the dark queen’s armies and finally end her reign of terror.

" + _"(Intermediate level, 14 scenarios.)"

    {CAMPAIGN_DIFFICULTY EASY      "data/campaigns/Heir_To_The_Throne/images/units/konrad/konrad-fighter.png~RC(magenta>red)"   ( _ "Easy"  )  ( _ "1x enemies, 16 scenarios")}
    {CAMPAIGN_DIFFICULTY NORMAL    "data/campaigns/Heir_To_The_Throne/images/units/konrad/konrad-captain.png~RC(magenta>red)"   ( _ "Normal")  ( _ "2x enemies, 14 scenarios")} {DEFAULT_DIFFICULTY}
    {CAMPAIGN_DIFFICULTY HARD      "data/campaigns/Heir_To_The_Throne/images/units/konrad/konrad-commander.png~RC(magenta>red)" ( _ "Hard"  )  ( _ "3x enemies, 12 scenarios")}
    {CAMPAIGN_DIFFICULTY NIGHTMARE "data/campaigns/Heir_To_The_Throne/images/units/konrad/konrad-lord.png~RC(magenta>red)"      ( _ "Deadly")  ( _ "4x enemies, 10 scenarios")}
    #
    # ----Difficulty Notes:
    # on higher difficulties, the player gets fewer scenarios to play with
    # this both restricts XP and reduces the available rewards
    #

    [about]
        images = story/httt_story1.webp,story/httt_story2.webp,story/httt_story3.webp,story/httt_story4.webp,story/httt_story5.webp,story/httt_story6.webp,story/httt_story7.webp,story/httt_story8.webp
    [/about]

    [about]
        title = _ "Campaign Design"
        [entry]
            name = "Dalas"
        [/entry]
    [/about]
    [about]
        title = _ "Artwork and Graphics Design"
        [entry]
            name = "doofus-01"
            comment = "new sprites and animations (Princess, Battle Princess, Dark Queen, Sea Orc)"
        [/entry]
        [entry]
            name = "Emilien Rotival (LordBob)"
            comment = "portraits (Delfador, Asheviere, Moremirmu)"
        [/entry]
        [entry]
            name = "Francisco Muñoz (fmunoz)"
        [/entry]
        [entry]
            name = "Kathrin Polikeit (Kitty)"
            comment = "portraits (Konrad, Li'sar, Kalenz, Chantal)"
        [/entry]
        [entry]
            name = "Neoriceisgood"
        [/entry]
        [entry]
            name = "Richard Kettering (Jetrel)"
        [/entry]
    [/about]
    [about]
        title = _ "Miscellaneous"
        [entry]
            name = "Patrick Parker (Sapient)"
            comment = "WML assistance"
        [/entry]
    [/about]

    #############################
    # GLOBAL EVENTS
    #############################
#ifdef CAMPAIGN_HEIR_2_THE_THRONE
    #------------------
    # LOAD MACROS
    #------------------
    [load_resource]
        id=stronger_amlas
    [/load_resource]
    {GLOBAL__INITIAL_NPC_SPAWN}
    {GLOBAL__AUTOSTORE_NPCs}
    {GLOBAL__ANIMATIONS_RECRUIT}
    {GLOBAL__HERODEATHS}
    {GLOBAL__EXACTING_IMPLEMENTATION}
    {GLOBAL__SMITE_IMPLEMENTATION}
    {GLOBAL__HORN_IMPLEMENTATION}
    {GLOBAL__SMALLTALK}
    {GLOBAL__S31_MALADIES}

    # reset zoom, in case we do weird things with save-loading
    [event]
        name=prestart
        priority=99
        [zoom]
            factor,relative=1,no
        [/zoom]
    [/event]

    # allow miner to advance to ulf, since we get miners at the same time as we get our ulf companion
    [modify_unit_type]
        type=Dwarvish Miner
        add_advancement=Dwarvish Ulfserker
    [/modify_unit_type]

    #------------------
    # SUMMONS
    #------------------
    [event]
        name,first_time_only=unit placed,no
        {FILTER( side=1 {AND type_adv_tree="Mudcrawler","Fire Guardian","Granite Golem"} )}
        {GIVE_OBJECT_TO id=$unit.id ({EFFECT new_ability (
            [abilities]
                [dummy]
                    name=_"summoned"
                    description=_"This elemental will dissipate at the end of the scenario."
                [/dummy]
            [/abilities]
        )} )}
        [allow_undo]
        [/allow_undo]
    [/event]
    [event]
        name=victory
        {KILL( side=1 {AND type_adv_tree="Mudcrawler","Fire Guardian","Granite Golem"} )}
    [/event]

    #------------------
    # MAGE ADVANCEMENTS
    #------------------
    # Alduin only lets Konrad advance Red Mages, and Valley of Death only allows White Mages
    # To get both advancements, you must complete both scenarios
    [event]
        name=pre advance
        first_time_only=no
        [filter]
            side,type=1,Mage
            {NOT({FILTER_WML_OBJECT_ID advancement_limiter})} # prevent infinite recursion
        [/filter]
        {IF}{VARIABLE_CONDITIONAL status_s06 not_equals in_progress}
        {VARIABLE_CONDITIONAL status_s06 not_equals completed} {THEN(
            {GIVE_OBJECT_TO id=$unit.id (id=advancement_limiter {EFFECT remove_advancement types="Red Mage"})}
        )} {/IF}
        {IF} {VARIABLE_CONDITIONAL status_s15b not_equals in_progress}
        {VARIABLE_CONDITIONAL status_s15b not_equals completed} {THEN(
            {GIVE_OBJECT_TO id=$unit.id (id=advancement_limiter {EFFECT remove_advancement types="White Mage"})}
        )} {/IF}
    [/event]

    #------------------
    # HI / WHITE MAGE
    #------------------
    # Konrad's HI are all warrior monks, so prefix their names with "Brother"
    [event]
        name=recruit,prefix_brother # not unit placed, or we add Brother multiple times
        first_time_only=no
        {FILTER type_adv_tree="Heavy Infantryman"}
        [filter_condition]
            {VARIABLE_CONDITIONAL unit.side equals 1} # either side 1, or one of the AI allies in S15a/b
            {OR({VARIABLE_CONDITIONAL status_s15a equals in_progress})}
            {OR({VARIABLE_CONDITIONAL status_s15b equals in_progress})}
        [/filter_condition]
        {STORE_UNIT_VAR id=$unit.id name name_before_adding_brother}
        {MODIFY_UNIT id=$unit.id name _"Brother $name_before_adding_brother"}
        {CLEAR_VARIABLE name_before_adding_brother}
    [/event]
    [event]
        name=post advance # only post advance, and only White Mage, or we add Brother multiple times
        first_time_only=no
        {FILTER type,side="White Mage",1}
        {STORE_UNIT_VAR id=$unit.id name name_before_adding_brother}
        {IF} {VARIABLE_CONDITIONAL unit.gender equals male}
        {THEN( {MODIFY_UNIT id=$unit.id name _"Brother $name_before_adding_brother"} )}
        {ELSE( {MODIFY_UNIT id=$unit.id name  _"Sister $name_before_adding_brother"} )}
        {/IF}
        {CLEAR_VARIABLE name_before_adding_brother}
    [/event]
#endif
[/campaign]
