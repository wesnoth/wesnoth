#textdomain wesnoth-nr

# 3 - The Great Chamber - signpost
	    [event]
        name=moveto
        [filter]
            side=1
            x=19
            y=28
        [/filter]

        [message]
            speaker=narrator
            message= _ "The Great Chamber"
            image=scenery/signpost.png
        [/message]
        [message]
            speaker=unit
            message= _ " 'The Great Chamber'? Hmmm, wonder what that could be."
        [/message]
        [allow_undo][/allow_undo]
    [/event]

# 3a - The spider ambush
# On entering the great chamber two stone blocks cut off the way back and a number of giant spiders spawn to harass the player	
    [event]
        name=moveto
        [filter]
            side=1
            x=10-18
            y=1-5
        [/filter]

        [message]
            speaker=unit
            message= _ "So this is the Great Chamber eh? Doesn't look like there is much to see here."
        [/message]
	# This macro should shake the screen
        {TREMOR}
        [message]
            speaker=narrator
            message= _ " *rumble*"
            image=misc/empty.png	# Stop wmllint from inserting the Wesnoth logo here
        [/message]
        [message]
            speaker=unit
            message= _ "Perhaps I spoke too soon..."
        [/message]
        {TREMOR}
        {TREMOR}
        [message]
            speaker=narrator
            message= _ " *CRASH*"
            image=misc/empty.png	# Stop wmllint from inserting the Wesnoth logo here
        [/message]
        [message]
            speaker=unit
            message= _ "What was that? Oh, woe - two big slabs of rock cutting off our retreat!"
        [/message]
	# Cutting off the exit
        [terrain]
            x=13,15
            y=14,14
            terrain=Xu
        [/terrain]
	
	# Spawning spiders 9,13,17 or 21 depending on difficulty levels split in half on both sides of the chamber
		{NOTRAIT_UNIT 2 "Giant Spider" 23 4}
        {NOTRAIT_UNIT 2 "Giant Spider" 22 3}
        {NOTRAIT_UNIT 2 "Giant Spider" 22 4}
        {NOTRAIT_UNIT 2 "Giant Spider" 20 3}
        {NOTRAIT_UNIT 2 "Giant Spider" 21 5}
        {NOTRAIT_UNIT 2 "Giant Spider" 6 2}
        {NOTRAIT_UNIT 2 "Giant Spider" 6 4}
        {NOTRAIT_UNIT 2 "Giant Spider" 6 3}
        {NOTRAIT_UNIT 2 "Giant Spider" 5 5}
		#ifndef NEWBIE
			{NOTRAIT_UNIT 2 "Giant Spider" 23 3}
			{NOTRAIT_UNIT 2 "Giant Spider" 24 3}
		    {NOTRAIT_UNIT 2 "Giant Spider" 5 3}
			{NOTRAIT_UNIT 2 "Giant Spider" 5 2}
			#ifndef EASY
				{NOTRAIT_UNIT 2 "Giant Spider" 20 2}
				{NOTRAIT_UNIT 2 "Giant Spider" 21 3}
				{NOTRAIT_UNIT 2 "Giant Spider" 8 2}
				{NOTRAIT_UNIT 2 "Giant Spider" 8 3}
				#ifndef NORMAL
					{NOTRAIT_UNIT 2 "Giant Spider" 21 4}
					{NOTRAIT_UNIT 2 "Giant Spider" 25 4}
					{NOTRAIT_UNIT 2 "Giant Spider" 4 2}
					{NOTRAIT_UNIT 2 "Giant Spider" 3 3}
				#endif
			#endif
		#endif
        {TREMOR}
        {TREMOR}
        [message]
            speaker=narrator
            message= _ " *CRASH*"
            image=misc/empty.png	# Stop wmllint from inserting a Wesnoth logo here
        [/message]
	# Break some walls exposing side tunnels
        [terrain]
            x=19,19,19,9,9
            y=2,3,4,3,4
            terrain=Uu
        [/terrain]
        [message]
            description=Giant Spider
            message= _ "Hsssssssss"
        [/message]
        [message]
            speaker=unit
            message= _ "This doesn't look good."
        [/message]
        [message]
            role=Supporter
            message= _ "Great Chamber my foot! This is a Death Chamber!"
        [/message]
	# Set a flag required by entering the study event
		{VARIABLE chamber_of_death visited}
    [/event]

# 3b - Rod of Justice
# At the end of the left side corridor. Uberpowerfull artifact that can be picked up by any unit with exception of Abhai.
    [event]
        name=moveto
        [filter]
            side=1
            x=3
            y=7
        [/filter]

	# Check who picked the rod
		[if]
			[variable]
				name=unit.description
				equals=Abhai
			[/variable]
		# If it's Abhai hand the rod to Tallin
			[then]
				[music]
					name=nr-sad.ogg
					play_once=yes
				[/music]
				{VARIABLE explorer Tallin}
			[/then]
		[/if]
	# Remove the icon
        [removeitem]
            x=3
            y=7
        [/removeitem]
	# Apply the effects
        [object]
            id=justice_rod
            name= _ "Rod of Justice"
            image=attacks/staff-magic.png
            duration=forever
            description= _ "This is a magical staff of tremendous power and unknown origin. Although the full extent of its power has not been fathomed, there are a few features about it that will be obvious to any master of lore. The wielder of this staff gains a dramatic increase in strength, speed and intelligence, and is granted the ability to fire devastating lightning bolts at at his opponents. Only a person who is good at heart and who is willing to sacrifice his life on the path of justice can wield this staff."
			[filter]
				description=$unit.description
			[/filter]
		# New 16-4 fire attack with cool lightning animation
            [effect]
                apply_to=new_attack
                name=rod of justice
                description= _ "rod of justice"
                type=fire
                range=ranged
                damage=16
                number=4
                icon=attacks/lightning.png
            [/effect]
		# The cool animation mentioned above, a copypasted fragment from Delfadors attack
            [effect]
                apply_to=new_animation
                [attack_anim]
                    [attack_filter]
                        name=rod of justice
                    [/attack_filter]
                    [missile_frame]
                        begin=-150
                        end=0
                        image=projectiles/lightning-n.png
                        image_diagonal=projectiles/lightning-ne.png
                    [/missile_frame]
                    [if]
                        hits=no
                        [frame]
                            begin=-200
                            end=0
                            sound=lightning-miss.ogg
                        [/frame]
                    [/if]
                    [else]
                        hits=yes
                        [frame]
                            begin=-200
                            end=0
                            sound=lightning.ogg
                        [/frame]
                    [/else]
                [/attack_anim]
            [/effect]
		# Increase the movement by 2
            [effect]
                apply_to=movement
                increase=2
            [/effect]
		# If the unit has melee attacks increase the damage of all of them by two
            [effect]
                apply_to=attack
                range=melee
                increase_damage=2
            [/effect]
		# Give the unit additional 10 HP and heal it
            [effect]
                apply_to=hitpoints
                increase_total=10
                heal_full=yes
            [/effect]
		# Reduce the amount of experience required for next level by 20%
            [effect]
                apply_to=max_experience
                increase=-20%
            [/effect]
        [/object]
	# And do all the talk
        [if]
            [variable]
                name=unit.description
                equals=Abhai
            [/variable]
            [then]
			    [message]
					description=Abhai
					message= _ "The Rod of Justice! What in the world is it doing all the way down here?"
				[/message]
				[message]
					description=Tallin
					message= _ "What do you have there, Abhai?"
				[/message]
				[message]
					description=Abhai
					message= _ "This is the Great Rod of Justice, my boy. It was an ancient artifact even when I was young. They say it was crafted by the Great Gods themselves, and given to the first true Ruler of Men to ensure peace, harmony and above all - justice. For hundreds of years it did just that, for during the time it was wielded by men, the ruling class never became corrupt, the people never lacked justice and neither evil nor wars troubled the land."
				[/message]
				[message]
					description=Tallin
					message= _ "Well, if you don't mind me saying - that certainly isn't the state of affairs now. Knalga lies in ruins, orcs ravish the surface, and these dark and evil creatures haunt the underground passages. In the meantime, Wesnoth is said to be ruled by the wicked and cruel queen Ashevire, while the rightful heir must have long since perished in his vain quest for the Scepter of Fire."
				[/message]
				[message]
					description=Abhai
					message= _ "Ahh, with the Rod of Justice down here it is to be expected. Come Tallin, either you or one of your trusted men must wield this staff and bring peace and justice back into this world."
				[/message]
				[message]
					description=Tallin
					message= _ "Why can't you wield it, Abhai?"
				[/message]
				[message]
					description=Abhai
					message= _ "I am a creature of the past, and thus my time to wield it is long gone. This is your era, Tallin, and thus it is your responsibility to see to it that your people receive peace, prosperity and justice. Quickly, come forth or send one of your men for time is waning."
				[/message]
				[message]
					description=Tallin
					message= _ "Very well."
				[/message]
			[/then]
			[else]
				[message]
					speaker=unit
					message= _ "Wow! This thing is... incredible!"
				[/message]
                [message]
                    speaker=unit
                    message= _ "I wonder what such a powerful artifact is doing hidden all the way back here..."
                [/message]
                [if]
                    [have_unit]
                        description=Camerin
                    [/have_unit]
                    [then]
                        [message]
                            description=Camerin
                            message= _ "That's.... that's the Rod of Justice!"
                        [/message]
                        [message]
                            description=Tallin
                            message= _ "Do you know anything about it, Camerin?"
                        [/message]
                        [message]
                            description=Camerin
                            message= _ "I don't think there is a person alive who knows anything more solid than rumors and legends. There are very few people who even knows it exists!"
                        [/message]
                        [message]
                            description=Tallin
                            message= _ "How did you come to know of it?"
                        [/message]
                        [message]
                            description=Camerin
                            message= _ "Some of the most ancient elvish legends make some vague mention of this artifact. But beyond that..."
                        [/message]
                        [message]
                            description=Tallin
                            message= _ "Interesting. I wonder who - or what - could have created such a powerful artifact. There must be one heck of a story behind this thing."
                        [/message]
                    [/then]
                [/if]
            [/else]
        [/if]
    [/event]
