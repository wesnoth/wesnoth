#textdomain wesnoth-nr

# 1 - Prison - signpost and alarm
    [event]
        name=moveto
        [filter]
            side=1
            x=15
            y=34
        [/filter]

        [message]
            speaker=narrator
            message= _ "The Dungeon"
            image=scenery/signpost.png
        [/message]
        [allow_undo][/allow_undo]
    [/event]

# Raise alarm in the prison section, this gives enemies there more gold on top of the one they had initialy	
    [event]
        name=moveto
        [filter]
            side=1
            x=10-12
            y=35-40
        [/filter]

        [message]
            speaker=Trevor
            message= _ "They are trying to free the prisoners! Stop them!"
        [/message]
        [message]
            speaker=Tallin
            message= _ "Good luck, my friend."
        [/message]
	# Allways give 100 gold
        [gold]
            side=5
            amount=100
        [/gold]
		# If the difficulty level is higher than Newbie add another 100
		#ifndef NEWBIE
			[gold]
				side=5
				amount=100
			[/gold]
			# And another 150 if higher then Easy
			#ifndef EASY
				[gold]
					side=5
					amount=150
				[/gold]
				# With last 150 thrown up on Hard
				#ifndef NORMAL
					[gold]
						side=5
						amount=150
					[/gold]
				#endif
			#endif
		#endif
	# Above sums up to Newbie - 100 gold, Easy - 200, Normal - 350 and Hard 500
    [/event]

# Now freeing the prisoners, there is four of them and the nearest one looking from the entrance is	
# 1a - Father Marcus - free and death event
    [event]
        name=moveto
        [filter]
            side=1
            x=9
            y=40
        [/filter]

	# Remove the caged white mage image from hex	
        [removeitem]
            x=9
            y=40
        [/removeitem]
	# Spawn unit
        [unit]
            type=White Mage
            side=1
            id=Father Marcus
            user_description= _ "Father Marcus"
            profile=portraits/Father_Marcus.jpg
            x=9
            y=39
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
	# Some dialogue
        [message]
            speaker=Father Marcus
            message= _ "Finally! I am free. Lord Tallin, I am forever in your debt! We will follow you to the end of the World if need be."
        [/message]
        [message]
            speaker=Tallin
            message= _ "It's just Tallin, no Lord. And no problem."
        [/message]
	# If he was freed after sister Theta there is no need to repeat the exposition
        [if]
            [have_unit]
                id="Sister Theta"
            [/have_unit]
            [then]
                [message]
                    speaker=Sister Theta
                    message= _ "Marcus!"
                [/message]
                [message]
                    speaker=Father Marcus
                    message= _ "Theta!"
                [/message]
                [message]
                    speaker=unit
                    message= _ "Please, folks, not now."
                [/message]
                [message]
                    speaker=Sister Theta
                    message= _ "Oh, sorry."
                [/message]
			[/then]
		# Else explain how did they finish down here and why are they still alive
			[else]
                [message]
                    speaker=Tallin
                    message= _ "Who are you? How did you end up down here?"
                [/message]
                [message]
                    speaker=Father Marcus
                    message= _ "I am called Father Marcus. My wife, Theta and I were advisers and healers for the dwarvish nobles. We could not shield them from the wrath of Khazg Black-Tusk, but we survived the orcs and trolls -- only to be captured by these skeletons."
                [/message]
                [message]
                    speaker=Tallin
                    message= _ "Funny, why would the bonebag keep you as his prisoners? He doesn't really seem to be the merciful type."
                [/message]
                [message]
                    speaker=Father Marcus
                    message= _ "He didn't keep us alive out of mercy, he wanted to study us to see if there was a way to counteract our arcane attacks. His kind are very vulnerable to such attacks."
                [/message]
                [message]
                    speaker=Tallin
                    message= _ "Indeed, that is good to know. But you are now free to go wherever you like. May the Lords of Light guide your path."
                [/message]
                [message]
                    speaker=Father Marcus
                    message= _ "As I have said, Tallin, I am eternally in your debt, and I take my debts seriously. If you have no objection, I will serve you until one of us departs this life."
                [/message]
                [message]
                    speaker=Tallin
                    message= _ "Oh, think nothing of it. Let no talk of debts come between us; rather let us join hands as allies in restoring these Northlands to sanity."
                [/message]
                [message]
                    speaker=Father Marcus
                    message= _ "Thank you, Tallin."
                [/message]
            [/else]
        [/if]
	# Set up a flavour death event for the pair since they can't die in combat (see utils/herodeaths.cfg)
	    [event]
			name=die
			[filter]
				id=Father Marcus
			[/filter]

			[message]
				speaker=Tallin
				message= _ "Wow! That's incredible. Now I understand why the Bag of Bones kept you guys in jail; He just simply couldn't kill you!"
			[/message]
			[message]
				speaker=Sister Theta
				message= _ " *giggle*"
			[/message]
		[/event]
    [/event]

# Next prisoner in line is sister Theta, this event is essentialy a clone of the previous one
# 1b - Sister Theta
    [event]
        name=moveto
        [filter]
            side=1
            x=6
            y=39
        [/filter]

        [removeitem]
            x=6
            y=39
        [/removeitem]
        [unit]
            type=White Mage
            gender=female
            id=Sister Theta
            user_description= _ "Sister Theta"
            profile=portraits/Sister_Theta.jpg
            side=1
            x=6
            y=38
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
        [/unit]
        [message]
            speaker=Sister Theta
            message= _ "Freedom at last. Thank you Lord Tallin."
        [/message]
        [message]
            speaker=Tallin
            message= _ "Just Tallin. I am no Lord, just a humble peasant trying to restore our people to freedom."
        [/message]
        [if]
            [have_unit]
                id="Father Marcus"
            [/have_unit]
            [then]
                [message]
                    speaker=Sister Theta
                    message= _ "Marcus!"
                [/message]
                [message]
                    speaker=Father Marcus
                    message= _ "Theta!"
                [/message]
                [message]
                    speaker=unit
                    message= _ "Please folks, not now."
                [/message]
                [message]
                    speaker=Sister Theta
                    message= _ "Oh, sorry."
                [/message]
			[/then]
			[else]
                [message]
                    speaker=Tallin
                    message= _ "Who are you? How did you end up down here?"
                [/message]
                [message]
                    speaker=Sister Theta
                    message= _ "I am called Sister Theta. My husband Marcus and I were advisers and healers for the dwarvish nobles of Knalga. We could not save them from Khazg Black-Tusk's troops, but we survived the orcs and trolls only to be captured when these skeletons appeared."
                [/message]
                [message]
                    speaker=Tallin
                    message= _ "Funny, why would the bonebag keep you as his prisoners? He didn't seem to be the merciful type."
                [/message]
                [message]
                    speaker=Sister Theta
                    message= _ "He didn't keep us alive out of mercy, he wanted to study us to see if there was a way to counteract our arcane attacks. His kind are very vulnerable to such attacks, as I am sure you know by now."
                [/message]
                [message]
                    speaker=Tallin
                    message= _ "Indeed, that is good to know. But you are now free to go wherever you like. May the Lords of Light guide your path."
                [/message]
                [message]
                    speaker=Sister Theta
                    message= _ "If you have no objection, Tallin, we would like to join you. These northlands are hardly safe these days for anyone to be traveling on their own, and we could lend valuable help to your cause."
                [/message]
                [message]
                    speaker=Tallin
                    message= _ "Very well, you are most welcome to join us."
                [/message]
                [message]
                    speaker=Sister Theta
                    message= _ "Thank you, Tallin."
                [/message]
            [/else]
        [/if]
    [/event]

# Third prisoner	
# 1c - Elenia
    [event]
        name=moveto
        [filter]
            side=1
            x=3
            y=40
        [/filter]

        [removeitem]
            x=3
            y=40
        [/removeitem]
        [unit]
            type=Elvish Druid
            side=1
            id=Elenia
            user_description= _ "Elenia"
            profile=portraits/Elenia.jpg
            x=3
            y=39
            hitpoints=1
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_HEALTHY}
            [/modifications]
        [/unit]
        [message]
            speaker=unit
            message= _ "Oh my, she is almost dead!"
        [/message]
	# Depending wether or not Theta has been freed dialog describes Elenia healing herself or being healed.
        [if]
            [have_unit]
                id="Sister Theta"
            [/have_unit]
            [then]
                [message]
                    speaker=Sister Theta
                    message= _ "Here, let me see her."
                [/message]
                [teleport]
                    [filter]
                        id=Sister Theta
                    [/filter]
                    x=3
                    y=38
               [/teleport]
                {FLASH}
                [message]
                    speaker=Tallin
                    message= _ "Was that a teleport you just did? Wow, you guys are good!"
                [/message]
                [message]
                    speaker=Father Marcus
                    message= _ " *wink* *wink*"
                [/message]
                [message]
                    speaker=Sister Theta
                    message= _ "Here, this will help her."
                [/message]
                [sound]
                    name=heal.wav
                [/sound]
                [message]
                    speaker=Elenia
                    message= _ "Uh....... where..... am..... I...?"
                [/message]
                [message]
                    speaker=Sister Theta
                    message= _ "You are in the dungeons of Malifor. These brave people have just released you."
                [/message]
                [message]
                    speaker=Elenia
                    message= _ "....thanks."
                [/message]
                [message]
                    speaker=Tallin
                    message= _ "No problem. Sister Theta, you take care of her. If she wants to join us she would make a powerful ally."
                [/message]
                [message]
                    speaker=Elenia
                    message= _ "Yes, I would... like to join... you Lord Tallin."
                [/message]
                [message]
                    speaker=Tallin
                    message= _ "Just Tallin; I am no lord. But gee, that sure is some powerful spell you used on her, Sister. She is looking better already."
                [/message]
                [message]
                    speaker=Elenia
                    message= _ "And I feel better too. Now let's get back at that disgusting skeleton."
                [/message]
            [/then]
			[else]
                [message]
                    speaker=Tallin
                    message= _ "I wish we had some healers with us. Just try to help her the best you can."
                [/message]
                [message]
                    speaker=unit
                    message= _ "Here, I hope that helps."
                [/message]
                [message]
                    speaker=Elenia
                    message= _ "Uh....... where..... am..... I...?"
                [/message]
                [message]
                    speaker=unit
                    message= _ "You are in the dungeons of Malifor. We have just released you."
                [/message]
                [message]
                    speaker=Elenia
                    message= _ "....thanks."
                [/message]
                [message]
                    speaker=Tallin
                    message= _ "No problem. Just take it easy. If you would like to join us your help could mean life or death for a lot of us."
                [/message]
                [message]
                    speaker=Elenia
                    message= _ "Yes, I would... like to join... you Lord Tallin."
                [/message]
                [message]
                    speaker=Tallin
                    message= _ "Just Tallin, I am no lord. And you are looking better already."
                [/message]
                [sound]
                    name=heal.wav
                [/sound]
                [message]
                    speaker=Elenia
                    message= _ "Oh, just a few tricks I know, otherwise I probably would be dead by now. But let's get back at that disgusting skeleton."
                [/message]
			[/else]
        [/if]
        [message]
            speaker=Tallin
            message= _ "Why did the bag of bones capture you in the first place?"
        [/message]
        [message]
            speaker=Elenia
            message= _ "Because he thought I was pretty."
        [/message]
        [message]
            speaker=Tallin
            message= _ "That old skeleton? Geez, what a nutcase."
        [/message]
        [message]
            speaker=Elenia
            message= _ "You're telling me."
        [/message]
    [/event]

# Fourth prisoner	
# 1d - Krash
    [event]
        name=moveto
        [filter]
            side=1
            x=2
            y=32
        [/filter]

        [removeitem]
            x=2
            y=32
        [/removeitem]
        [unit]
            type=Drake Burner
            id=Krash
            user_description= _ "Krash"
            side=1
            x=2
            y=33
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
	# I'm not checking for existence of Camerlin since the dialogue still looks decent without his lines
        [message]
            speaker=unit
            message= _ "Holy cow! What did I just let out of that cage! Look out everyone."
        [/message]
        [message]
            speaker=Camerin
            message= _ "Oooooh, cool, it's a drake!"
        [/message]
        [message]
            speaker=Krash
            message= _ " *whimper*"
        [/message]
        [message]
            speaker=unit
            message= _ "My God, such a fierce creature whimpering! What the heck have they done to it?"
        [/message]
        [message]
            speaker=Camerin
            message= _ "The bastards!"
        [/message]
	# On the other hand following two look akward without Marcus
		[if]
			[have_unit]
				id="Father Marcus"
			[/have_unit]
			[then]
				[message]
					speaker=Father Marcus
					message= _ "Probably another one of Malifor's experiments."
				[/message]
				[message]
					speaker=Tallin
					message= _ "I don't know, see if it talks."
				[/message]
			[/then]
		[/if]
        [message]
            speaker=unit
            message= _ "Hey, big guy. We aren't gonna hurt you. We wanna be your friends."
        [/message]
        [message]
            speaker=Krash
            message= _ ".....not..... going..... to...... hurt.... me?"
        [/message]
        [message]
            speaker=Tallin
            message= _ "Hey, it talks!"
        [/message]
        [message]
            speaker=Camerin
            message= _ "It's a 'he', and yes, they're actually very intelligent creatures."
        [/message]
        [message]
            speaker=unit
            message= _ "Hush! I am trying to talk to him. Nope, we'll never hurt you. But if you want to you can hurt some skeletons."
        [/message]
        [message]
            speaker=Krash
            message= _ "Skeletons! GRRRRRRRR!!!"
        [/message]
        [message]
            speaker=unit
            message= _ "Look out! He is ready to go! Hey, is that smoke coming out of his ears?"
        [/message]
        [message]
            speaker=unit
            message= _ "And look at this, there is some sort of opening in the back of his cell..."
        [/message]
        [message]
            speaker=Krash
            message= _ "It's an escape tunnel. The hole wasn't big enough for me to go through but one you little guys you might fit."
        [/message]
        [message]
            speaker=unit
            message= _ "Hmmm, it is pretty small, let's see if we can make it bigger."
        [/message]
	# Open the escape tunnel by replacing wall tile with a cave floor hex
        [terrain]
            x=2
            y=31
            terrain=Uu
        [/terrain]
        [message]
            speaker=unit
            message= _ "There we go. Now let's see where this tunnel leads to."
        [/message]
	# Set up a flavour attack event for Krash, placed as a subevent since there is no need to have it in memory before he's found
	    [event]
			name=attack
			[filter]
				id=Krash
			[/filter]

			[message]
				speaker=Krash
				message= _ "ROOOOOOAAAARRRR!"
			[/message]
			[message]
				role=Supporter
				message= _ "Whoa! Maybe he isn't so friendly after all... or at least to some things."
			[/message]
		[/event]
    [/event]

# 1e - Escape tunnel
# On encountering water in the tunnel, this line doesn't make sense when seen before the sequence in flooded_path but fixing that
# would require breaking the string or introducing a new one. Both had to be avoided at the moment of writing this commentary.
    [event]
        name=moveto
        [filter]
            side=1
            x=3,4,5,5,4
            y=13,13,14,15,15
        [/filter]

        [message]
            speaker=unit
            message= _ " *sigh* Great. More water. And there doesn't seem to be anything down this tunnel, either friend or foe."
        [/message]
        [allow_undo][/allow_undo]
    [/event]

# 1f - Runaway dwarfs
# Player meets three dwarfs that escaped from the dungeon some time ago, they join the army and show a back entrance to the treasury	
    [event]
        name=moveto
        [filter]
            side=1
            x=9,7-10
            y=8-11,10-12
        [/filter]
	
	# Remove some shroud and place the units
        [remove_shroud]
            x=9,7-10
            y=8-11,10-12
        [/remove_shroud]
        [unit]
            type=Dwarvish Steelclad
            id=Dulcatas
            user_description= _ "Dulcatas"
            side=1
            x=6
            y=11
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_HEALTHY}
            [/modifications]
        [/unit]
        [unit]
            type=Dwarvish Thunderguard
            id=Antolos
            user_description= _ "Antolos"
            side=1
            x=8
            y=11
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
        [unit]
            type=Dwarvish Fighter
            id=Varem
            user_description= _ "Varem"
            side=1
            x=9
            y=12
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [message]
            speaker=Dulcatas
            message= _ "Halt! Who goes there? Friend or foe?"
        [/message]
        [message]
            speaker=unit
            message= _ "Depends. Are you loyal to Malifor?"
        [/message]
        [message]
            speaker=Dulcatas
            message= _ "Never! If you ha' been sent by Malifor, then know that we will never yield! Come and meet your death!"
        [/message]
        [message]
            speaker=unit
            message= _ "Hold! We aren't friends of Malifor in the least. Rather, we have come to destroy him."
        [/message]
        [message]
            speaker=Dulcatas
            message= _ "Finally! You don't know how long we have been waiting for this day."
        [/message]
        [message]
            speaker=unit
            message= _ "How did you get here and how long have you been here?"
        [/message]
        [message]
            speaker=Dulcatas
            message= _ "We were originally prisoners of Malifor, but we tunnelled out and escaped. Since then, we have eked out a precarious survival on what we have been able to steal or raid from Malifor."
        [/message]
        [message]
            speaker=unit
            message= _ "By now you have tunnels all through this place."
        [/message]
        [message]
            speaker=Dulcatas
            message= _ "Aye. That seemingly blank wall to the south there is actually a hidden entrance to the treasury."
        [/message]
        [message]
            speaker=unit
            message= _ "Awesome, let's go!"
        [/message]
	# Since the player doesn't know about the entrance until shown it this event can be set up only after meeting the dwarfs
		[event]
			name=moveto
			[filter]
				side=1
				x=8
				y=13
			[/filter]
		
		# Open the back entrance
			[message]
				speaker=unit
				message= _ "Here we go."
			[/message]
			[terrain]
				x=7
				y=14
				terrain=Uu
			[/terrain]
		# If the treasury alarm wasn't raised yet do it now and set the flag
			[if]
				[variable]
					name=treasury_alerted
					equals=no
				[/variable]
				[then]
					[message]
						role=Treasury Guard
						message= _ "Intruders! Get them!"
					[/message]
					[message]
						speaker=unit
						message= _ "Bring it on!"
					[/message]
				# For detailed explanation of how these work out see dungeon alarm event at the top of this file
				# Add 100,200,350 or 500 gold to both treasury guards depending on difficulty level
					[gold]
						side=6
						amount=100
					[/gold]
					[gold]
						side=7
						amount=100
					[/gold]
					#ifndef NEWBIE
						[gold]
							side=6
							amount=100
						[/gold]
						[gold]
							side=7
							amount=100
						[/gold]
						#ifndef EASY
							[gold]
								side=6
								amount=150
							[/gold]
							[gold]
								side=7
								amount=150
							[/gold]
							#ifndef NORMAL
								[gold]
									side=6
									amount=150
								[/gold]
								[gold]
									side=7
									amount=150
								[/gold]
							#endif
						#endif
					#endif
				# Set the flag
					{VARIABLE treasury_alerted yes}
				[/then]
			[/if]
		[/event]
    [/event]
