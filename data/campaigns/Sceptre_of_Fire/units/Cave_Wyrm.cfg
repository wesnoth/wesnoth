#textdomain wesnoth-sof

#wmlindent: start ignoring
#define CAVE_WYRM_SPRITE
~CHAN(
    if(red < green, green*1.5),
    if(red < green, 2.5*red*(green / (red+1))),
    if(red < green, 2.0*blue*(green / (blue+1)))
    )#enddef
#define CAVE_WYRM_PORTRAIT
~CHAN(
    if(((red > green*0.8) and (red < 1.05*green)) and ((blue < green*0.45) or (blue < 6)), red*1.5, red*1.3),
    if(((red > green*0.8) and (red < 1.05*green)) and ((blue < green*0.45) or (blue < 6)), green*1.3, green),
    if(((red > green*0.8) and (red < 1.05*green)) and ((blue < green*0.45) or (blue < 6)), (blue+green)*1.2, blue*1.9)
)#enddef
#wmlindent: stop ignoring

[unit_type]
    id=Cave Wyrm
    name= _ "Cave Wyrm"
    race=monster
    image="units/monsters/wyrm/wyrm-se-3.png{CAVE_WYRM_SPRITE}"
    profile="portraits/monsters/wyrm-elder.webp{CAVE_WYRM_PORTRAIT}"
    hide_help=yes
    hitpoints=27
    movement_type=smallfly
    movement=8
    experience=70
    level=1
    alignment=chaotic
    advances_to=null
    {AMLA_DEFAULT}
    cost=24
    usage=scout
    description= _ "Unlike other varieties of wyrm and bat, the Cave Wyrm dwells only deep underground in places forever untouched by sunlight. Despite its grimly pale appearance, the creature is quite lively - darting through narrow caverns with reckless abandon, gnashing wildly at prey and spitting wisps of flame when threatened by an intruder."
    die_sound=bat-flapping.wav
    undead_variation=drake

    [resistance]
        fire=70
        arcane=100
    [/resistance]
    [defense]
        village=50
    [/defense]

    # based on the bats, though no north-facing frames yet
    [defend]
        # direction=s,sw,se
        [if]
            hits=miss
            offset=0.0~-0.15,-0.15~0.0
        [/if]
        start_time=-126
        [frame]
            image="units/monsters/wyrm/wyrm-se-[3,4].png{CAVE_WYRM_SPRITE}:[1,100]"
        [/frame]
        [if]
            hits=hit
            [frame]
                image="units/monsters/wyrm/wyrm-se-4.png{CAVE_WYRM_SPRITE}:150"
                sound={SOUND_LIST:BAT_HIT}
            [/frame]
        [/if]
        [else]
            hits=miss,kill
            [frame]
                image="units/monsters/wyrm/wyrm-se-4.png{CAVE_WYRM_SPRITE}:150"
            [/frame]
        [/else]
        [frame]
            image="units/monsters/wyrm/wyrm-se-3.png{CAVE_WYRM_SPRITE}:1"
        [/frame]
    [/defend]

    [standing_anim]
        # direction=s,se,sw
        start_time=0
        layer=60
        [frame]
            image="units/monsters/wyrm/wyrm-se-[3~1,2~5,4].png{CAVE_WYRM_SPRITE}:[50,60,80,60,50,60,80,60]"
        [/frame]
    [/standing_anim]
    [movement_anim]
        # direction=s,se,sw
        start_time=0
        [frame]
            image="units/monsters/wyrm/wyrm-se-[3~1,2~5,4].png{CAVE_WYRM_SPRITE}:[50,60,80,60,50,60,80,60]"
        [/frame]
    [/movement_anim]
    [attack]
        name=fangs
        description=_"fangs"
        icon=attacks/fangs-snake.png
        type=blade
        range=melee
        damage=7
        number=3
    [/attack]
    [attack]
        name=breath
        description=_"breath"
        icon=attacks/fireball.png
        type=fire
        range=ranged
        [specials]
            {WEAPON_SPECIAL_MARKSMAN}
        [/specials]
        damage=8
        number=1
    [/attack]
    [attack_anim]
        [filter_attack]
            name=fangs
        [/filter_attack]
        # direction=s,se,sw
        offset=0.0~0.9:200,0.9~0.0:160
        start_time=-200
        [frame]
            image="units/monsters/wyrm/wyrm-se-[3,2].png{CAVE_WYRM_SPRITE}:30"
        [/frame]
        [frame]
            image="units/monsters/wyrm/wyrm-se-1.png{CAVE_WYRM_SPRITE}:30"
            sound=bat-flapping.wav
        [/frame]
        [frame]
            image="units/monsters/wyrm/wyrm-se-[2~4,3,2,3].png{CAVE_WYRM_SPRITE}:[30*2,70,50*2,40]"
        [/frame]
        {SOUND:HIT_AND_MISS bite-small.ogg {SOUND_LIST:MISS} -50}
    [/attack_anim]
    [attack_anim]
        [filter_attack]
            name=breath
        [/filter_attack]
        # direction=s,se,sw
        missile_start_time=-300
        [missile_frame]
            halo=projectiles/fire-breath-[1~10].png:[70*10]
            offset=0.0~1.0:300,1.0:350
        [/missile_frame]

        offset=0.0
        start_time=-300
        [frame]
            image="units/monsters/wyrm/wyrm-se-3.png{CAVE_WYRM_SPRITE}:700"
        [/frame]
        {SOUND:HIT_AND_MISS fire.wav bow-puny-fire-miss.ogg -150}
    [/attack_anim]
[/unit_type]

#undef CAVE_WYRM_SPRITE
