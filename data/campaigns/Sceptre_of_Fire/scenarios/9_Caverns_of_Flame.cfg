#textdomain wesnoth-sof
[scenario]
    name= _ "Caverns of Flame"
    id=9_Caverns_of_Flame
    map_file=9_Caverns_of_Flame.map
    next_scenario=Epilogue
    turns=unlimited
    victory_when_enemies_defeated=no

    {SCENARIO_MUSIC "the_dangerous_symphony.ogg"}
    {EXTRA_SCENARIO_MUSIC "heroes_rite.ogg"}

    {UNDERGROUND}

    [side]
        type=Dwarvish Fighter
        id=Rugnur
        side=1
        canrecruit=yes
        recruit=
        controller=human
        shroud=yes
        gold=100
        recall_cost=1
        income=4
        team_name=dwarves
        user_team_name= _ "Dwarves"
        {FLAG_VARIANT knalgan}
    [/side]

    [side]
        no_leader=yes
        side=2
        team_name=elves
        user_team_name= _ "Elves"
        {GOLD 140 180 200}
        {INCOME 4 6 8} # don't want them to be too strong, else it becomes AI vs AI slog
        [ai]
            [goal]
                name=target
                [criteria]
                    side=1
                [/criteria]
                value=5
            [/goal]
            [goal]
                name=target
                [criteria]
                    side=3,4,5
                [/criteria]
                value=0.5
            [/goal]
            grouping=no
            aggression=1.0
        [/ai]
        {FLAG_VARIANT wood-elvish}
    [/side]

    # work-around until better AI control is found
    # Moving this guy to side 4 and adding [micro_ai] type simple_attack works,
    # but there were some difficult to reproduce instances where AI didn't behave as expected
    # and Gathor retreated and got out of reach.  It might be worth revisiting in the future.
    # further comment at prestart event
    [side]
        side=3
        no_leader=yes
        hidden=yes
        team_name=orcs
        user_team_name= _ "Orcs"
        color=purple
        [ai]
            [goal]
                name=target
                [criteria]
                    side=1
                [/criteria]
                value=10
            [/goal]
            [goal]
                name=target
                [criteria]
                    side=2,3
                [/criteria]
                value=1
            [/goal]
            grouping=no
            aggression=1.0
            caution=0.0
            simple_targeting=yes
            support_villages=no
            village_value=0
        [/ai]
        [unit]
            id=Gathor
            name= _ "Bar'Gathor"
            type=Orcish Warrior
            profile=portraits/orcs/grunt-3.png
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_STRONG}
                [object]
                    [effect]
                        apply_to=overlay
                        add="misc/loyal-icon.png~GS()"
                    [/effect]
                [/object]
            [/modifications]
            x,y=41,3
        [/unit]
    [/side]

    [side]
        type=Orcish Warlord
        side=4
        canrecruit=yes
        recruit=Orcish Grunt,Orcish Assassin,Orcish Warrior,Orcish Crossbowman
        {GOLD 200 220 240}
        {INCOME 20 25 30}
        [ai]
            [goal]
                name=target
                [criteria]
                    side=1
                [/criteria]
                value=10
            [/goal]
            [goal]
                name=target
                [criteria]
                    side=2
                [/criteria]
                value=2
            [/goal]
            [goal]
                name=target
                [criteria]
                    side=3
                [/criteria]
                value=0.5
            [/goal]
            [aspect]
                id=recruitment_instructions
                [facet]
                    [value]
                        [limit]
                            type=Orcish Grunt
                            max=2
                        [/limit]
                        [limit]
                            type=Orcish Assassin
                            max=2
                        [/limit]
                        [recruit]
                            importance=0
                        [/recruit]
                    [/value]
                [/facet]
            [/aspect]
        [/ai]
        team_name=orcs
        user_team_name= _ "Orcs"
        [village]
            x,y=32,1
        [/village]
        [village]
            x,y=38,7
        [/village]
        [village]
            x,y=40,1
        [/village]
        [village]
            x,y=42,1
        [/village]
        {FLAG_VARIANT6 ragged}
    [/side]

    [side]
        type=Troll Warrior
        id=Harohk
        name= _ "Harohk"
        side=5
        canrecruit=yes
        recruit=Troll Rocklobber,Troll
        {GOLD 150 200 250}
        {INCOME 5 6 7}
        [ai]
            recruitment_pattern=fighter,fighter,mixed fighter
            [goal]
                name=target
                [criteria]
                    side=1
                [/criteria]
                value=10
            [/goal]
            [goal]
                name=target
                [criteria]
                    side=2
                [/criteria]
                value=1
            [/goal]
            [goal]
                name=target
                [criteria]
                    side=3
                [/criteria]
                value=0.1
            [/goal]
        [/ai]
        team_name=trolls
        user_team_name= _ "Trolls"
        [unit]
            id=Toomak
            name= _ "Toomak"
            type=Troll Hero
            profile=portraits/orcs/grunt-3.png
            ai_special=guardian
            [modifications]
                [object]
                    [effect]
                        apply_to=overlay
                        add="misc/loyal-icon.png~GS()"
                    [/effect]
                [/object]
            [/modifications]
            x,y=39,22
        [/unit]
    [/side]

    [side]
        no_leader=yes
        side=6
        team_name=bats
        user_team_name= _ "Bats"
        color=green
        [ai]
            [goal]
                name=target
                [criteria]
                    side=1
                [/criteria]
                value=5
            [/goal]
            [goal]
                name=target
                [criteria]
                    side=2,4,5
                [/criteria]
                value=0.5
            [/goal]
            grouping=no
            aggression=0.9
        [/ai]
        [unit]
            type=Vampire Bat
            x,y=9,2
        [/unit]
        [unit]
            type=Vampire Bat
            x,y=7,3
        [/unit]
        [unit]
            type=Blood Bat
            x,y=9,4
        [/unit]
        [unit]
            type=Vampire Bat
            x,y=5,8
        [/unit]
        [unit]
            type=Blood Bat
            x,y=2,9
        [/unit]
    [/side]
    [event]
        name=new turn
        first_time_only=no
        [unit]
            side=6
            type=Vampire Bat
            x,y=1,8
        [/unit]
        [unit]
            side=6
            type=Blood Bat
            x,y=4,1
        [/unit]
    [/event]

    [story]
        [part]
            story= _ "Rugnur and the dwarves fled down the cave path, deeper into the volcano, with the elves and mercenaries close behind.  Unfortunately, they began to see litter and wall markings indicating they were plunging into the land of orcs and trolls."
        [/part]
        [part]
            story= _ "The situation looked grim, but the dwarves had faced long odds before.  Upon entering a large cavern, lit by pervasive lava pools, Rugnur rallied all his forces for a final push."
        [/part]
    [/story]

    {SOF_TRACK {JOURNEY_09_NEW} }

    {SOF_DEATHS}

    {SOF_RUNIC_EVENTS}

    [event]
        name=prestart

        # micro AI to make sure the orc stays on the front lines
        # need high CA score to keep him from retreating when injured
        # this does not work reliably (1.15.2+dev),
        # so moving Gathor to his own side=3 for now
        # [micro_ai]
        #    side=4
        #    ai_type=simple_attack
        #    action=add
        #    ca_score=300000
        #    [filter]
        #        id=Gathor
        #    [/filter]
        # [/micro_ai]
        # to delay the trolls
        [store_unit]
            [filter]
                id=Harohk
            [/filter]
            variable=harohk
            kill=yes
        [/store_unit]
        #the glyphs - three pairs
        [item]
            x,y=27,20
            image=scenery/rock-cairn.png
        [/item]
        # set 1
        [item]
            x,y=24,18
            halo=scenery/rune[1,1,1,1,1,1-glow].png:[200*6]
        [/item]
        [item]
            x,y=30,21
            halo=scenery/rune[1,1,1-glow,1,1,1].png:[200*6]
        [/item]
        [event]
            name=last_breath
            [filter]
                id=Gathor
            [/filter]
            [message]
                speaker=unit
                message= _ "Argh, this hurts!  But I've still got a trick up my sleeve..."
            [/message]
            [message]
                speaker=narrator
                message= _ "The wounded orc pulled out a stone tile with a glowing rune stamped on one side, and waived it at his foes."
                image=wesnoth-icon.png
            [/message]
            [message]
                speaker=unit
                message= _ "Nothing?  Even this piece of magical garbage lets me down..."
            [/message]
            [message]
                speaker=narrator
                message= _ "The frustrated orc flung the tile against the wall, where it shattered."
                image=wesnoth-icon.png
            [/message]
            {QUAKE "rumble.ogg"}
            [scroll_to]
                x,y=27,20
            [/scroll_to]
            [remove_item]
                x,y=24,18
            [/remove_item]
            [remove_item]
                x,y=30,21
            [/remove_item]
            [terrain]
                x=23,24,25,29,30,31
                y=18,18,19,21,21,22
                terrain=Ql
            [/terrain]
            [remove_shroud]
                side=1
                x,y=21-33,16-24
            [/remove_shroud]
            [redraw]
                side=1
            [/redraw]
            [kill]
                [and]
                    x=23,24,25,29,30,31
                    y=18,18,19,21,21,22
                    [not]
                        race=gryphon
                    [/not]
                [/and]
                animate=yes
                fire_event=yes
            [/kill]
            [delay]
                time=300
            [/delay]
            [objectives]
                side=1
                [objective]
                    description= _ "Find and destroy the remaining runic tablets"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Death of Rugnur"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Krawg"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Thursagan"
                    condition=lose
                [/objective]

                {IS_LAST_SCENARIO}
            [/objectives]
        [/event]
        # set 2
        [item]
            x,y=24,21
            halo=scenery/rune[2,2,2,2,2-glow,2].png:[200*6]
        [/item]
        [item]
            x,y=30,18
            halo=scenery/rune[2,2-glow,2,2,2,2].png:[200*6]
        [/item]
        [event]
            name=die
            [filter]
                id=Toomak
            [/filter]
            [message]
                speaker=narrator
                message= _ "As the troll collapsed, a stone tile it had been wearing hit the floor and shattered."
                image=wesnoth-icon.png
            [/message]
            {QUAKE "rumble.ogg"}
            [scroll_to]
                x,y=27,20
            [/scroll_to]
            [remove_item]
                x,y=24,21
            [/remove_item]
            [remove_item]
                x,y=30,18
            [/remove_item]
            [terrain]
                x=23,24,25,29,30,31
                y=22,21,21,19,18,18
                terrain=Ql
            [/terrain]
            [remove_shroud]
                side=1
                x,y=21-33,16-24
            [/remove_shroud]
            [redraw]
                side=1
            [/redraw]
            [kill]
                [and]
                    x=23,24,25,29,30,31
                    y=22,21,21,19,18,18
                    [not]
                        race=gryphon
                    [/not]
                [/and]
                animate=yes
                fire_event=yes
            [/kill]
            [delay]
                time=300
            [/delay]
            [objectives]
                side=1
                [objective]
                    description= _ "Find and destroy the remaining runic tablets"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Death of Rugnur"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Krawg"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Thursagan"
                    condition=lose
                [/objective]

                {IS_LAST_SCENARIO}
            [/objectives]
        [/event]
        # set 3
        # this contains the end-level event
        [item]
            x,y=27,17
            halo=scenery/rune[3-glow,3,3,3,3,3].png:[200*6]
        [/item]
        [item]
            x,y=27,23
            halo=scenery/rune[3,3,3,3-glow,3,3].png:[200*6]
        [/item]
        [item]
            x,y=29,31
            image=items/stone-tablet.png
        [/item]
        [event]
            name=moveto
            [filter]
                id=Krawg
                x,y=29,31
            [/filter]
            [filter_condition]
                [have_unit]
                    id=Gathor
                [/have_unit]
                [or]
                    [have_unit]
                        id=Toomak
                    [/have_unit]
                [/or]
            [/filter_condition]
            [message]
                speaker=Krawg
                message= _ "Wha'?"
            [/message]
            [message]
                speaker=narrator
                message= _ "Krawg puzzled over a stone tile sitting loose on the small mesa.  Beneath a spattering of bat guano, there was a glowing rune.  Krawg didn't know what to make of it, so the gryphon left it for now."
                image=wesnoth-icon.png
            [/message]
        [/event]
        [event]
            name=moveto
            [filter]
                id=Krawg
                x,y=29,31
            [/filter]
            [filter_condition]
                [not]
                    [have_unit]
                        id=Gathor
                    [/have_unit]
                    [or]
                        [have_unit]
                            id=Toomak
                        [/have_unit]
                    [/or]
                [/not]
            [/filter_condition]
            [message]
                speaker=Krawg
                message= _ "Screech!"
            [/message]
            [message]
                speaker=narrator
                message= _ "Krawg saw that this tablet was like the others held by the orc and troll, and knew that this could remove the last bridge across the fire lake."
                image=wesnoth-icon.png
            [/message]
            [message]
                speaker=Thursagan
                message= _ "Yes, Krawg, that must be the last rune sealing the volcano.  Smash it, like the others!"
            [/message]
            [message]
                speaker=Krawg
                message= _ "Krawg sad."
            [/message]
            [message]
                speaker=Thursagan
                message= _ "Just do it, you dumb bird!  You can escape, our enemies cannot.  We knew that death was likely when we fled here, just go!"
            [/message]
            [message]
                speaker=Rugnur
                message= _ "Wait!  If Krawg can escape, shouldn't we give him the Sceptre?"
            [/message]
            [message]
                speaker=Thursagan
                message= _ "No, too risky, even if Krawg drops it in King Haldric's hand.  You've seen how the elves have behaved, you've seen how your lord behaved.  The corrupting emissions from the ruby are nothing compared to the greed already out there, and my crafted gold cage does nothing to contain that."
            [/message]
            [message]
                speaker=Thursagan
                message= _ "Durstorn and Glildur have both convinced me that the time is not right for the Sceptre of Fire, best that it rests with us for a while.  Now, Krawg!"
            [/message]
            [message]
                speaker=Krawg
                message= _ "Yah!  Krah!"
            [/message]
            [remove_item]
                x,y=29,31
                image=items/stone-tablet.png
            [/remove_item]
            [floating_text]
                x,y=29,31
                text="<span color='#ff7722'>" + _ "Smash!" + "</span>"
            [/floating_text]
            {QUAKE "rumble.ogg"}
            [scroll_to]
                x,y=27,20
            [/scroll_to]
            [remove_item]
                x,y=27,17
            [/remove_item]
            [remove_item]
                x,y=27,23
            [/remove_item]
            [terrain]
                x=27,27
                y=16-18,22-24
                terrain=Ql
            [/terrain]
            [redraw]
                side=1
            [/redraw]
            [kill]
                [and]
                    x=27,27
                    y=16-18,22-24
                    [not]
                        race=gryphon
                    [/not]
                [/and]
                animate=yes
                fire_event=yes
            [/kill]
            [delay]
                time=300
            [/delay]
            {MOVE_UNIT (id=Krawg) 22 33}
            [store_unit]
                [filter]
                    id=Krawg
                [/filter]
                variable=krawg
                kill=yes
            [/store_unit]
            {QUAKE "rumble.ogg"}
            [scroll_to]
                x,y=27,20
            [/scroll_to]
            [remove_item]
                x,y=27,20
            [/remove_item]
            [terrain]
                x=26-28,26-28,27
                y=19,20,21
                terrain=Qxu
            [/terrain]
            [kill]
                [and]
                    x=26-28,26-28,27
                    y=19,20,21
                [/and]
                animate=no
            [/kill]
            [redraw]
                side=1
            [/redraw]
            [delay]
                time=300
            [/delay]
            [terrain]
                [and]
                    x=22-32
                    y=16-24
                    terrain=Ql
                [/and]
                terrain=Qlf
            [/terrain]
            [terrain]
                x=26-28,26-28,27
                y=19,20,21
                terrain=Ql
            [/terrain]
            [redraw]
                side=1
            [/redraw]
            [delay]
                time=300
            [/delay]
            [terrain]
                [and]
                    terrain=Ql*
                    radius=2
                [/and]
                [not]
                    terrain=Xu*
                [/not]
                terrain=Qlf
            [/terrain]
            [redraw]
                side=1
            [/redraw]
            [delay]
                time=300
            [/delay]
            [color_adjust]
                red=255
                green=-100
                blue=-180
            [/color_adjust]
            [kill]
                x=1-44
                animate=no
                fire_event=no
            [/kill]
            {FADE_TO_BLACK}
            [message]
                speaker=narrator
                message= _ "Once the magic seal capping the throat of the volcano was removed, lava and toxic gas exploded upward, killing everyone inside and sealing them in a tomb of hot, flowing rock.  The Sceptre of Fire would wait, unharmed by the lava, until some day far in the future."
                image=wesnoth-icon.png
            [/message]
            [endlevel]
                result=victory
                carryover_report=no
                save=no
                linger_mode=no
            [/endlevel]
        [/event]
        [recall]
            id=Thursagan
        [/recall]
        [recall]
            id=Baglur
        [/recall]
        [recall]
            id=Krawg
        [/recall]
        [recall]
            side=1
        [/recall]
        [recall]
            side=1
        [/recall]
        [recall]
            side=1
        [/recall]
        # original version of this scenario recalled everyone at the start, but that makes this a slog.
        # instead, recall cost is now just 1, and there are lots of little keeps scattered on the map.
#ifdef __UNUSED__
        [store_unit]
            [filter]
                side=1
                x,y=recall,recall
            [/filter]

            kill=no
            variable=to_be_recalled
        [/store_unit]

        [foreach]
            array=to_be_recalled
            [do]
                [recall]
                    id=$this_item.id
                [/recall]
            [/do]
        [/foreach]

        {CLEAR_VARIABLE to_be_recalled}
#endif
        # items hinting at volcano history
        [item]
            x,y=43,26
            image=items/chest-plain-open.png
        [/item]
        [item]
            x,y=44,25
            image=items/chest-plain-open.png
        [/item]
        [item]
            x,y=44,26
            image=items/chest-plain-open.png
        [/item]
        [event]
            name=moveto
            [filter]
                side=1
                race=dwarf
                x=43,44,44
                y=26,25,26
            [/filter]
            [message]
                speaker=unit
                message= _ "These chests have been forced open.  Whatever they once held has been removed."
            [/message]
        [/event]
        [item]
            x,y=44,28
            image=items/barrel.png
        [/item]
        [item]
            x,y=41,29
            image=items/bones.png
        [/item]
        [item]
            x,y=42,30
            image=items/book1.png
        [/item]
        [event]
            name=moveto
            [filter]
                side=1
                race=dwarf
                x,y=42,30
            [/filter]
            [message]
                speaker=unit
                message= _ "This is some sort of notebook...  I can't read the text, but there are drawings showing three arcs spanning what must be the volcano.  There are three symbols for these arcs...  Well, it must describe the volcano somehow, but I can't puzzle it out now."
            [/message]
        [/event]
        [item]
            x,y=37,22
            image=items/burial.png
        [/item]
        [objectives]
            side=1
            [objective]
                description= _ "Explore as much of the cave as possible"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Rugnur"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Krawg"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Thursagan"
                condition=lose
            [/objective]

            {IS_LAST_SCENARIO}
        [/objectives]
    [/event]

    [event]
        name=start

        [unit]
            x,y=27,9
            side=5
            type=Troll
            ai_special=guardian
            role=Guardian
            name= _ "Guardian"
        [/unit]
        [unit]
            x,y=22,22
            side=5
            type=Troll Shaman
            ai_special=guardian
            role=Guardian
            name= _ "Guardian"
        [/unit]
        [unit]
            x,y=27,15
            side=5
            type=Troll Shaman
            ai_special=guardian
            role=Guardian
            name= _ "Guardian"
        [/unit]
        [unit]
            x,y=32,22
            side=5
            type=Troll Shaman
            ai_special=guardian
            role=Guardian
            name= _ "Guardian"
        [/unit]
        #messages
        [message]
            speaker=Rugnur
            message= _ "Well, we've put some distance between us and the elves, so we have a little time to think.  What is this place?"
        [/message]
        [message]
            speaker=Thursagan
            # wmllint: local spelling Khrakrahs
            message= _ "Remember what Khrakrahs said, about this being a volcano?   Well, it seems we're under the crater, sitting on the magma chamber...  I think we should try to cause it to erupt."
        [/message]
        [message]
            speaker=Rugnur
            message= _ "Huh, makes sense.  It will kill all the elves, and we might be able to find a safe place so the lava doesn’t kill us."
        [/message]
        [message]
            speaker=Baglur
            message= _ "Yes, an interesting plan. How do you propose we do this?"
        [/message]
        [message]
            speaker=Thursagan
            message= _ "Look up, if this were a normal volcano, you'd see stars and sky.  Instead, there's a high ceiling, shaped like a cone.  At the center of this chamber, we'll find what is holding back the lava flow, and there lies our chance."
        [/message]
        [message]
            speaker=Rugnur
            message= _ "I see, yes.  Quite a gamble, yet what choice do we have?  We will continue to explore until we find it."
        [/message]
        [message]
            speaker=Krawg
            message= _ "Krah!"
        [/message]
        [message]
            speaker=Thursagan
            message= _ "Indeed, Krawg, we are not alone down here.  Orcs and trolls are prowling around."
        [/message]
    [/event]

#define RANDOM_MERCENARY_2 TYPE
    {GENERIC_UNIT 2 {TYPE} 23 1}
#enddef

    #elves come (and orcs fix their bridge)
    [event]
        name=turn 6
        [move_unit_fake]
            type=Elvish Marshal
            side=2
            x=23,23
            y=1,3
        [/move_unit_fake]
        [unit]
            type=Elvish Marshal
            side=2
            id=Glildur
            name= _ "Glildur"
            canrecruit=yes
            x,y=23,3
            {SOF_GLILDUR_PORTRAIT}
            facing=sw
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
                [object]
                    silent=yes
                    [effect]
                        apply_to=image_mod
                        add=CS(-10,-25,+5)
                    [/effect]
                [/object]
            [/modifications]
            extra_recruit=Elvish Hero, Elvish Ranger
        [/unit]
        [message]
            speaker=Glildur
            message= _ "End of the road, little dwarves!  That ruby is as good as ours..."
        [/message]
        {RANDOM_MERCENARY_2 "Dwarvish Lord"}
        {RANDOM_MERCENARY_2 "Dwarvish Lord"}
        {RANDOM_MERCENARY_2 "Dwarvish Lord"}
        {RANDOM_MERCENARY_2 "Dwarvish Lord"}
#ifdef HARD
        {RANDOM_MERCENARY_2 "Dwarvish Lord"}
#endif
        {RANDOM_MERCENARY_2 "Dwarvish Dragonguard"}
        {RANDOM_MERCENARY_2 "Dwarvish Dragonguard"}
        {RANDOM_MERCENARY_2 "Dwarvish Dragonguard"}
        {RANDOM_MERCENARY_2 "Dwarvish Dragonguard"}
#ifdef HARD
        {RANDOM_MERCENARY_2 "Dwarvish Dragonguard"}
#endif
        {RANDOM_MERCENARY_2 "Elvish Champion"}
        {RANDOM_MERCENARY_2 "Elvish Champion"}
        {RANDOM_MERCENARY_2 "Elvish Champion"}
        {RANDOM_MERCENARY_2 "Elvish Champion"}
#ifdef HARD
        {RANDOM_MERCENARY_2 "Elvish Champion"}
#endif
        {RANDOM_MERCENARY_2 "Elvish Avenger"}
        {RANDOM_MERCENARY_2 "Elvish Avenger"}
        {RANDOM_MERCENARY_2 "Elvish Avenger"}
        {RANDOM_MERCENARY_2 "Elvish Avenger"}
#ifdef HARD
        {RANDOM_MERCENARY_2 "Elvish Avenger"}
#endif
        {RANDOM_MERCENARY_2 "Elvish Outrider"}
        {RANDOM_MERCENARY_2 "Elvish Outrider"}
        {RANDOM_MERCENARY_2 "Elvish Outrider"}
        {RANDOM_MERCENARY_2 "Elvish Outrider"}
#ifdef HARD
        {RANDOM_MERCENARY_2 "Elvish Outrider"}
#endif
        [message]
            speaker=Rugnur
            message= _ "Thursagan! The elves are right on our tail!  What should we do?"
        [/message]
        [message]
            speaker=Thursagan
            message= _ "We should try to set off the volcano as soon as possible.  Draw the elves further into the caves, so they can’t escape when it does erupt."
        [/message]
        [terrain]
            terrain=Qxu^Bp/
            x=34,34,35
            y=4,5,6
        [/terrain]
        [unstore_unit]
            variable=harohk
            find_vacant=no
        [/unstore_unit]
        {CLEAR_VARIABLE harohk}
    [/event]

    [event]
        name=last_breath
        [filter]
            id=Glildur
        [/filter]
        [message]
            speaker=Glildur
            message= _ "Damnation!  I almost had it...  but now I join Landar..."
        [/message]
    [/event]

    #when the elves lose troops, the orcs gain them
    [event]
        name=die
        first_time_only=no
        [filter]
            side=2
        [/filter]
        [gold]
            side=4
            amount=50
        [/gold]
        [gold]
            side=5
            amount=50
        [/gold]
    [/event]

    # the orcs are held back
    [event]
        name=enter_hex
        [filter]
            side=1
            x,y=30,3-8
        [/filter]
        [filter_condition]
            [variable]
                name=turn_number
                less_than=6
            [/variable]
        [/filter_condition]
        {MOVE_UNIT (id=Gathor) 36 5}
        [remove_shroud]
            side=1
            x,y=32-43,3-9
        [/remove_shroud]
        [redraw]
            side=1
        [/redraw]
        [message]
            speaker=Gathor
            message= _ "Ah ha! I knew it, there are intruders!  And yet our damned bridge is broken, it was built by idiots.  Come, come, bring planks, we've got to get across!"
        [/message]
        [message]
            speaker=Rugnur
            message= _ "Huh.  Well, let's not stay here too long."
        [/message]
        [message]
            speaker=Thursagan
            message= _ "Right, if we can get both the orcs and the elves behind us, maybe they'll fight each other."
        [/message]
    [/event]
[/scenario]

#undef RANDOM_MERCENARY_2
