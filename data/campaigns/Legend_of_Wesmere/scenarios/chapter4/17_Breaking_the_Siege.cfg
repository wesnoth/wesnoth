#textdomain wesnoth-low

#define LANDAR_SPOILED
#enddef

[scenario]
    name= _ "Breaking the Siege"
    id=17_Breaking_the_Siege
    next_scenario=18_Hour_of_Glory
    experience_modifier=100

    random_start_time=no
    allow_new_game=no
    force_lock_settings=yes

    {LOW_MAP North_Elves.map}
    {WINTER_MASK 17_Breaking_the_Siege.mask}

    {TURNS 40 36 32}
    {DEFAULT_SCHEDULE}

    {INTRO_AND_SCENARIO_MUSIC revelation.ogg elvish-theme.ogg}
    {EXTRA_SCENARIO_MUSIC traveling_minstrels.ogg}
    {EXTRA_SCENARIO_MUSIC nunc_dimittis.ogg}
    {EXTRA_SCENARIO_MUSIC silvan_sanctuary.ogg}
    {EXTRA_SCENARIO_MUSIC northerners.ogg}
    {EXTRA_SCENARIO_MUSIC legends_of_the_north.ogg}

    {NORTH_ELVES_VILLAGES}

    [story]
        [part]
            story= _ "With the orcs embroiled in a civil war, Kalenz seized the chance to take back his beloved home. Reports had been arriving of an enclave of Northern Elves yet holding out against the orcish invaders. It was quickly decided to send a force to their aid. But harsh winter weather descended while it was en route..."
            delay=4000
        [/part]
    [/story]
    {LOW_TRACK ( {TREASURY_COMPLETE} {BOOK_COMPLETE} {ALLIANCE_STAGE4} ) }

#define PLAYER_GOLD
    {GOLD 300 200 100}
#enddef
#define MULTIPLAYER_GOLD
    {GOLD 45 45 45}
#enddef

    [side]
        side=1
        {KALENZ}
        {PLAYABLE}
        type=Elvish High Lord
        x=46
        y=39
        extra_recruit=Elvish Fighter, Elvish Archer, Elvish Scout
        fog=yes

#ifndef MULTIPLAYER
        {PLAYER_GOLD}
        [unit]
            {LANDAR}
            extra_recruit=Elvish Fighter, Elvish Archer, Elvish Scout
            #TODO place on his keep
            placement=leader
        [/unit]
        [unit]
            {OLURF}
            extra_recruit=Dwarvish Fighter, Dwarvish Thunderer, Dwarvish Guardsman, Dwarvish Scout
            #TODO place on his keep
            placement=leader
        [/unit]
        [unit]
            {CLEODIL}
            extra_recruit=Elvish Shaman, Elvish Scout, Wose
            #TODO place on her keep
            placement=leader
        [/unit]
#else
        {MULTIPLAYER_GOLD}
#endif
    [/side]
    [event]
        name=prestart
        {RECALL_LOYALS}
    [/event]

    [side]
        side=2
        persistent=yes
        save_id=Uradredia
        allow_player=no
        team_name=player
        user_team_name= _ "Player"

        no_leader=yes
        [unit]
            {URADREDIA}
            extra_recruit=Elvish Fighter, Elvish Archer, Elvish Scout, Elvish Shaman
            x=24
            y=7
        [/unit]
    [/side]

    [side]
        side=3
        allow_player=no
        team_name=orcs
        user_team_name= _ "Enemies"
        {FLAG_VARIANT undead}
        type=Orcish Warlord
        id=Kior-Pur
        name=_ "Kior-Pur"
        canrecruit=yes
        x=15
        y=38
#ifdef EASY
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Knight, Goblin Pillager, Goblin Spearman
#endif
#ifdef NORMAL
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Knight, Goblin Pillager, Goblin Spearman, Orcish Slayer
#endif
#ifdef HARD
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Knight, Goblin Pillager, Goblin Spearman, Orcish Slayer, Orcish Warrior
#endif
        {GOLD 200 230 250}

        [ai]
            {NO_SCOUTS}
            recruitment_pattern=scout,fighter,fighter,archer,mixed fighter
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            aggression=0.75
            caution=0.0
            grouping=no
            attack_depth=5
        [/ai]
        {INCOME 4 8 12}
    [/side]

    [side]
        side=4
        allow_player=no
        team_name=orcs
        user_team_name= _ "Enemies"
        {FLAG_VARIANT undead}
        type=Orcish Warlord
        id=Mbiran
        name=_ "Mbiran"
        canrecruit=yes
        x=6
        y=6
        {GOLD 200 240 290}
        {INCOME 4 8 12}
#ifdef EASY
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman
#endif
#ifdef NORMAL
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Knight, Goblin Pillager, Orcish Slayer, Goblin Spearman, Orcish Warrior
#endif
#ifdef HARD
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Orcish Warrior, Goblin Knight, Goblin Pillager, Orcish Slayer, Goblin Spearman
#endif
        [ai]
            {NO_SCOUTS}
            recruitment_pattern=fighter,fighter,mixed fighter,archer,scout,fighter
            aggression=0.75
        [/ai]
        [ai]
            grouping=offensive
            aggression=0.75
        [/ai]
    [/side]

    [side]
        side=5
        allow_player=no
        team_name=orcs
        user_team_name= _ "Enemies"
        {FLAG_VARIANT undead}
        type=Orcish Warlord
        id=Tan-Durr
        name=_ "Tan-Durr"
        canrecruit=yes
        x=44
        y=7
        {INCOME 4 8 12}
        {GOLD 200 250 290}
#ifdef EASY
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Pillager, Goblin Knight, Goblin Spearman
#endif
#ifdef NORMAL
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Goblin Knight, Goblin Pillager, Orcish Slayer, Goblin Spearman, Orcish Warrior
#endif
#ifdef HARD
        recruit=Orcish Archer, Orcish Assassin, Orcish Grunt, Wolf Rider, Orcish Crossbowman, Orcish Warrior, Goblin Knight, Goblin Pillager, Orcish Slayer, Goblin Spearman
#endif
        [ai]
            {NO_SCOUTS}
            recruitment_pattern=scout,fighter,fighter,archer,mixed fighter
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            aggression=0.75
            caution=0.0
            grouping=no
        [/ai]
    [/side]

#ifdef MULTIPLAYER
    [side]
        side=6
        save_id=Landar
        fog=yes
        {PLAYABLE}
        no_leader=yes
        [unit]
            {LANDAR}
            extra_recruit=Elvish Fighter, Elvish Archer, Elvish Scout
            x=20
            y=4
        [/unit]
        {MULTIPLAYER_GOLD}
    [/side]
    [side]
        side=7
        save_id=Olurf
        {PLAYABLE}

        no_leader=yes
        [unit]
            {OLURF}
            extra_recruit=Dwarvish Fighter, Dwarvish Thunderer, Dwarvish Guardsman, Dwarvish Scout
            x=20
            y=4
        [/unit]
        {MULTIPLAYER_GOLD}
        fog=yes
    [/side]
    [side]
        side=8
        save_id=Cleodil
        {PLAYABLE}
        {MULTIPLAYER_GOLD}
        fog=yes

        no_leader=yes
        [unit]
            {CLEODIL}
            extra_recruit=Elvish Shaman, Wose, Elvish Scout
            x=20
            y=4
        [/unit]
    [/side]
#endif

    [event]
        name=prestart
        [objectives]
            side=1

            [objective]
                description= _ "Defeat all enemy leaders"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Landar"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Cleodil"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Uradredia"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Olurf"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}

            [gold_carryover]
                bonus=yes
                carryover_percentage=80
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=enemies defeated
        [endlevel]
            result=victory
            save=no
            bonus=yes
        [/endlevel]
    [/event]

    #wmllint: recognize Uradredia
    [event]
        name=start
        [message]
            id=Kior-Pur
            message= _ "I see troops coming from the south! It must be that our army has beaten these elves and humans and will now help us crush these remaining elves!"
        [/message]
        [message]
            id=Uradredia
            message= _ "Our defenses are stretched thin. Men, prepare to face another orcish attack!"
        [/message]
        [message]
            id=Kalenz
            message= _ "The North Elves still stand. Prepare for battle!"
        [/message]

        {AI_CONTROLLER_ALLOW_LEADER_CONTROL 1 2}
    [/event]

    [event]
        name=victory
        [message]
            id=Kalenz
            message = _ "The North Elves are now free!"
        [/message]
        [message]
            id=Uradredia
            # wmllint: local spelling Kliada
            message= _ "Our thanks to you, Kalenz, son of Kliada. Our troops are at your command."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=1-19
            y=36-40
        [/filter]
        [message]
            id=Kior-Pur
            message= _ "The elves are attacking us! Reserves!"
        [/message]

        [move_unit_fake]
            type=Goblin Impaler
            x=4,5,6,6
            y=35,36,36,37
        [/move_unit_fake]
        [unit]
            type=Direwolf Rider
            id=Zhuk
            name= _ "Zhuk"
            side=4
            x=6
            y=37
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]

        [scroll_to_unit]
            id=Zhuk
        [/scroll_to_unit]

        [unit]
            type=Direwolf Rider
            id=Dran
            name= _ "Dran"
            side=4
            x=6
            y=36
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
        [unit]
            type=Direwolf Rider
            id=Hrugt
            name= _ "Hrugt"
            side=4
            x=5
            y=37
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
        [unit]
            type=Direwolf Rider
            id=Orhtib
            name= _ "Orhtib"
            side=4
            x=5
            y=38
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Kior-Pur
        [/filter]
        [message]
            id=Kalenz
            message= _ "Before you die, know that you lost in Wesmere, you lost at Tath, you will lose here and that your Great Chief is dead!"
        [/message]
    [/event]

    # wmllint: unwho "{OLURF}"
    {campaigns/Legend_of_Wesmere/utils/deaths.cfg}
[/scenario]

#undef PLAYER_GOLD
#undef MULTIPLAYER_GOLD
