#textdomain wesnoth-low
[scenario]
    id=06_Fateful_Encounter
    next_scenario=07_Save_the_Lord
    name= _ "Fateful Encounter"
    {LOW_MAP 06_Fateful_Encounter.map}
    [label]
        x,y=15,15
        text= _ "Goldenleaf Grove"
        immutable=yes
    [/label]
    victory_when_enemies_defeated=yes
    carryover_percentage=40
    carryover_add=yes
    {DEFAULT_SCHEDULE_DAWN}
    {TURNS 24 22 20}

    {INTRO_AND_SCENARIO_MUSIC revelation.ogg breaking_the_chains.ogg}
    {EXTRA_SCENARIO_MUSIC                              knolls.ogg}
    {EXTRA_SCENARIO_MUSIC                    silvan_sanctuary.ogg}

    [story]
        [part]
            # The space at the end stops the last letter from getting cut off. Newlines at the end offset the text to slightly above centered.
            title="<span font_family='WesScript' size='60000'><i>" + _"Chapter Two: Into the Serpent’s Maw" + " </i></span>

"
            title_position=centered
        [/part]
        [part]
            story= _ "Making their way through the thickets of Wesmere, Kalenz encountered many elves from Erlornas’s shattered army. Some of them decided to help him save their lord. But before Kalenz could leave the forest, he had to draw his blade once more..."
        [/part]
    [/story]
    {LOW_TRACK {SCENARIO_6} }

    [side]
        side=1
        {SIDE_1_ESSENTIALS}
        {KALENZ}
        {SIDE_1_GOLD_FIXED 260 150}
        income=-2
        village_gold=1
        fog=no
        shroud=no
#ifndef MULTIPLAYER
        [unit]
            {LANDAR}
            location_id=2
        [/unit]
#endif
    [/side]

    [side]
        side=2
        {SIDE_2_ESSENTIALS}
        {LANDAR}
        gold=150
        income=-2
        village_gold=1
        fog=no
        shroud=no
    [/side]

    [side]
        side=3
        {UNPLAYABLE_SIDE}
        team_name=lizards
        user_team_name= _ "Enemies"
        {FLAG_VARIANT undead}
        type=LoW Saurian Impaler
        id=Trigr
        name= _ "Trigr"
        {GOLD 120 160 200}
        {INCOME 5 10 15}
#ifdef EASY
        recruit=Saurian Skirmisher, Saurian Augur
#else
        recruit=Saurian Skirmisher, Saurian Augur, Saurian Ambusher,LoW Saurian Impaler
#endif
        [ai]
            passive_leader=yes
            grouping=no
#ifdef EASY
            recruitment_pattern="scout, scout, healer"
#else
            recruitment_pattern="scout, scout, fighter, healer"
#endif
        [/ai]
    [/side]

    [side]
        side=4
        {UNPLAYABLE_SIDE}
        team_name=lizards
        user_team_name= _ "Enemies"
        {FLAG_VARIANT undead}
        type=Saurian Ambusher
        id=Shurm
        name= _ "Shurm"
        {GOLD 120 160 200}
        {INCOME 5 10 15}
#ifdef EASY
        recruit=Saurian Skirmisher, Saurian Augur
#else
        recruit=Saurian Skirmisher, Saurian Augur, Saurian Ambusher, LoW Saurian Impaler
#endif
        [ai]
            passive_leader=yes
            grouping=no
#ifdef EASY
            recruitment_pattern="scout, scout, healer"
#else
            recruitment_pattern="scout, scout, fighter, healer"
#endif
        [/ai]
    [/side]

    [side]
        side=5
        {UNPLAYABLE_SIDE}
        team_name=lizards
        user_team_name= _ "Enemies"
        {FLAG_VARIANT undead}
        type=Saurian Ambusher
        id=Nyyz
        name= _ "Nyyz"
        {GOLD 120 160 200}
        {INCOME 5 10 15}
#ifdef EASY
        recruit=Saurian Skirmisher, Saurian Augur
#else
        recruit=Saurian Skirmisher, Saurian Augur, Saurian Ambusher, LoW Saurian Impaler
#endif
        [ai]
            passive_leader=yes
            grouping=no
#ifdef EASY
            recruitment_pattern="scout, scout, healer"
#else
            recruitment_pattern="scout, scout, fighter, healer"
#endif
        [/ai]
    [/side]

    {STARTING_VILLAGES_ALL 6}

    [side]
        side=6
        {UNPLAYABLE_SIDE}
        {PLAYER_TEAM}
        {FLAG_VARIANT wood-elvish}
        {CLEODIL}
        gold=100
        {INCOME 8 6 4}
        recruit=Elvish Shaman,Wose
        [ai]
            recruitment_pattern=fighter,fighter,healer
            passive_leader=yes
            caution=0.75
        [/ai]
    [/side]

    [event]
        name=prestart

        [kill]
            id=Eradion,Galtrid
            search_recall_list=yes
        [/kill]

        {MODIFY_UNIT side=1,2 facing ne}
        {MODIFY_UNIT id=Trigr facing nw}
        {MODIFY_UNIT id=Nyyz facing sw}
        {MODIFY_UNIT id=Shurm facing se}
    [/event]

    [event]
        name=start

        {MODIFY_UNIT id=Cleodil facing sw}

        [message]
            id=Cleodil
            message= _ "Help! We’re under attack by saurians!"
        [/message]
        [message]
            id=Landar
            message= _ "So they not only kidnapped the lord but also invaded Wesmere? Vile creatures!"
        [/message]
        [message]
            id=Kalenz
            message=_ "Hold on, we will protect you!"
        [/message]
        [message]
            id=Cleodil
            message= _ "Hurry, there are no warriors in my grove, we won’t last long!"
        [/message]
        [message]
            id=Nyyz
            message= _ "There is no hope, little elves! Your army is broken, and your lord is our prisoner! Now you are all our prey!"
        [/message]

        [objectives]
            side=1,2
            [objective]
                description= _ "Defeat enemy leaders"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Landar"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Cleodil"
                condition=lose
            [/objective]
            [gold_carryover]
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=saurians_fleeing

        [store_unit]
            [filter]
                side=3
            [/filter]
            kill=no
            variable=saurians3
        [/store_unit]

        [foreach]
            array=saurians3
            index_var=i

            [do]
                {MOVE_UNIT find_in=this_item 30 26}
                [kill]
                    find_in=this_item
                    animate=no
                [/kill]
            [/do]
        [/foreach]

        [store_unit]
            [filter]
                side=4
            [/filter]
            kill=no
            variable=saurians4
        [/store_unit]

        [foreach]
            array=saurians4
            index_var=i

            [do]
                {MOVE_UNIT find_in=this_item 30 1}
                [kill]
                    find_in=this_item
                    animate=no
                [/kill]
            [/do]
        [/foreach]

        [store_unit]
            [filter]
                side=5
            [/filter]
            kill=no
            variable=saurians5
        [/store_unit]

        [foreach]
            array=saurians5
            index_var=i

            [do]
                {MOVE_UNIT find_in=this_item 1 1}
                [kill]
                    find_in=this_item
                    animate=no
                [/kill]
            [/do]
        [/foreach]

        {CLEAR_VARIABLE saurians4}
        {CLEAR_VARIABLE saurians5}
        {CLEAR_VARIABLE saurians5}
    [/event]

    [event]
        name=scenario_end
        [filter_condition]
            [proceed_to_next_scenario]
            [/proceed_to_next_scenario]
        [/filter_condition]

        [store_unit]
            [filter]
                id=Cleodil
            [/filter]
            kill=no
            variable=cleodil
        [/store_unit]
        {VARIABLE actual_cleodil_exp $cleodil.experience}
        [unstore_unit]
            variable=cleodil
        [/unstore_unit]
        {CLEAR_VARIABLE cleodil}
    [/event]

    [event]
        name=last breath
        [filter]
            id=Trigr
        [/filter]

        [filter_second]
            side=1,2
            canrecruit=no
        [/filter_second]

        [message]
            speaker=unit
            message= _ "I am ashamed to die at the hands of tree-shaggers!"
        [/message]
        [message]
            speaker=second_unit
            message= _ "When you meet your kin in the dry hells, tell them you perished at the hands of Kalenz’s elves!"
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Shurm
        [/filter]

        [filter_second]
            side=1,2
            canrecruit=no
        [/filter_second]

        [message]
            speaker=unit
            message= _ "My death changes nothing! Your lord is our prisoner! He will be broken! He will tell us everything! And then you will all fertilize the forest with your bones!"
        [/message]
        [message]
            speaker=second_unit
            message= _ "Silence, beast!"
        [/message]
    [/event]

    [event]
        name=enemies defeated

        [message]
            race=lizard
            message=_ "Our chiefs are slain! Run for your lives!"
        [/message]

        [fire_event]
            name=saurians_fleeing
        [/fire_event]
    [/event]

    [event]
        name=victory

        {REPLACE_SCENARIO_MUSIC love_theme.ogg}

        [message]
            id=Kalenz
            message= _ "You are safe now, my lady."
        [/message]
        [message]
            id=Cleodil
            message= _ "I am forever grateful to you for saving us. But what is happening in Wesmere now? The saurians said they defeated our army and captured Lord Erlornas. But that’s a vile lie..."
        [/message]
        [message]
            id=Kalenz
            message= _ "<i>(silence)</i>"
        [/message]
        [message]
            id=Cleodil
            message= _ "Don’t tell me it’s true. That’s terrible. And why do I not see Galtrid among you? Has something happened to him too?"
        [/message]
        [message]
            id=Kalenz
            message= _ "Galtrid is alive, with the surviving warriors of Wesmere. The Council ordered them to defend the citadel. As for us, we are northern elves. Truth be told, we ourselves need help fighting the orcs..."
        [/message]
        [message]
            id=Landar
            message= _ "The Council decided they would help us only if we free the lord from captivity. So we are going to Saurgrath, even if it’s a path to certain death!"
        [/message]
        [message]
            id=Cleodil
            message= _ "So many trials have befallen our people now... But the unity of the elves is not yet lost. I will follow you and use all my magical gifts to help us save the lord and return alive from the saurian land."
        [/message]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message= _ "Now you can recruit Woses!"
        [/message]
        [message]
            id=Kalenz
            message= _ "I accept your service gratefully, for I will need every sword and bow and spell with which to defeat these invaders. We will have time to talk later; now we must track the saurians before a chance rain washes away their trail."
        [/message]

        [allow_recruit]
            side=1,2
            type=Wose
        [/allow_recruit]

        [endlevel]
            result=victory
#ifdef MULTIPLAYER
            bonus=0.5
#else
            bonus=yes
#endif
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]
    {campaigns/Legend_of_Wesmere/utils/deaths.cfg}
[/scenario]
