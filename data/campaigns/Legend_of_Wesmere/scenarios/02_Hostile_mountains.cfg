#textdomain wesnoth-low
[scenario]
    id=02_Hostile_mountains
    name= _ "Hostile mountains"
    {LOW_MAP 02_Hostile_mountains.map}
    {TURNS 32 28 24}

    {INTRO_AND_SCENARIO_MUSIC sad.ogg knolls.ogg}
    {EXTRA_SCENARIO_MUSIC traveling_minstrels.ogg}
    {EXTRA_SCENARIO_MUSIC legends_of_the_north.ogg}
    {EXTRA_SCENARIO_MUSIC knalgan_theme.ogg}

    {DEFAULT_SCHEDULE}

    {STARTING_VILLAGES_ALL 3}
    {STARTING_VILLAGES_DWARF 2}

    next_scenario=03_Kalian
    [story]
        [part]
            story= _ "Kalenz and his band broke out of the orcish encirclement, only to discover that the country on the direct route to the Ka'lian was already swarming with orcs. The raid on Kalenz's home, it seemed, had been but one small part of a great migration south. There was no choice but to make a detour through territory the elves would rather have avoided..."
            delay=8000
        [/part]
        [part]
            delay=4000
            {TO_HOSTILE_MOUNTAINS}
            show_title=yes
        [/part]
    [/story]

    ### Kalenz's code ###
    #wmllint: validate-off
    #wmllint: recognize Olurf
    [side]
        {KALENZ}
        {GOLD 200 180 100}
        # wmllint: recognize Kalenz
        recruit={ELVES}
    [/side]

    [event]
        name=die
        [filter_second]
            id=Kalenz
        [/filter_second]
        [message]
            speaker=second_unit
            message= _ "Payback time!"
        [/message]
    [/event]

    [event]
        name=prestart
        {RECALL_LOYALS}
        # wmllint: recognize Landar
        {CHECK_LANDAR}

    [/event]

    ### /Kalenz's code ###

    ### Olurf's Code ###
#define OLURFS_LAND
    x=20-24,19-30,17-30,16-30,14-30,12-30,11-30,10-30,7-30,8-30,10-30,13-30,15-30,18-30,19-30,20-30,22-30,23-30,24-30,23-30,22-30
    y=10,11,12,13-15,16-17,18-19,20,21,22,23,24,25,26,27,28-29,30,31-32 ,33-36,37,38-39,40
#enddef
#define NOT_OLURFS_LAND
    x= 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31
    y= 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 18, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 19, 22, 33, 34, 35, 36, 37, 38, 39, 40, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 20, 36, 37, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 25, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11
#    x=1-30,1-19,1-18,1-16,1-15,1-13,1-11,1-10,1-9,1-5,1-7,1-9,1-12,1-14,1-17,1-18,1-19,1-21,1-22 ,1-23,1-22,1-21,6
#    y=1-9,10,11,12,13-15,16-17,18-19,20,21,22,23,24,25,26,27,28-29,30,31-32,33-36,37,38-39,40,22
#enddef

    [side]
        side=2
        {OLURF}
        canrecruit=yes
        {GOLD 150 120 120}
        recruit={DWARVES}
#ifdef EASY
        team_name=dwarves
#else
        team_name=trolls
#endif

        {ai/aliases/stable_singleplayer.cfg}  #note that this MUST be given OUTSIDE the [ai] tag
        [ai]
            {AI_ASPECT caution 0.5}
        [/ai]
    [/side]
    #wmllint: validate-on
    #{MAKE_AI_SIDE_PERSISTENT 2}
    {LIMIT_RECRUITS 2 (Dwarvish Berserker) 2}

    #Olurf will return in a later scenario
    [event]
        name=victory

        [store_unit]
            variable=olurf_store
            [filter]
                id=Olurf
            [/filter]
            kill=no
        [/store_unit]

        [store_unit]
            variable=olurf_party
            [filter]
                [not]
                    id=Olurf
                [/not]
                side=2
            [/filter]
            kill=no
        [/store_unit]
    [/event]

    # Trolls have stepped on Olurf's land.
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=3
            {OLURFS_LAND}
        [/filter]

        [message]
            id=Olurf
            message= _ "Those stinking trolls ha' stepped on OUR land!"
        [/message]

        [if]
            [variable]
                name=offended_by_elves
                boolean_equals=yes
            [/variable]
            # the elves have stepped onto already
            [then]
                [modify_side]
                    side=2
                    team_name=dwarves
                [/modify_side]
#ifdef EASY
                [fire_event]
                    name=dwarves_defend_their_territory
                [/fire_event]
#endif
#ifdef NORMAL
                [fire_event]
                    name=dwarves_defend_their_territory
                [/fire_event]
#endif
#ifdef HARD
                [fire_event]
                    name=dwarves_kill_elves_and_trolls
                [/fire_event]
#endif
            [/then]
            [else]
                [modify_side]
                    side=2
                    team_name=kalenz
                [/modify_side]
#ifdef EASY
                [fire_event]
                    name=dwarves_kill_trolls
                [/fire_event]
#endif
#ifdef NORMAL
                [fire_event]
                    name=dwarves_kill_trolls
                [/fire_event]
#endif
#ifdef HARD
                [fire_event]
                    name=dwarves_kill_trolls
                [/fire_event]
#endif
            [/else]
        [/if]

    [/event]

    # Elves have stepped on Olurf's land.
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            {OLURFS_LAND}
        [/filter]

        [message]
            id=Olurf
            message= _ "Those lying elves have stepped on OUR land!"
        [/message]

        [store_side]
            side=2
            variable=olurf_side
        [/store_side]

        [if]
            [variable]
                name=olurf_side.team_name
                equals=kalenz
            [/variable]
            [then]
                [modify_side]
                    side=2
                    team_name=dwarves
                [/modify_side]
#ifdef EASY
                [fire_event]
                    name=dwarves_defend_their_territory
                [/fire_event]
#endif
#ifdef NORMAL
                [fire_event]
                    name=dwarves_defend_their_territory
                [/fire_event]
#endif
#ifdef HARD
                [fire_event]
                    name=dwarves_kill_elves_and_trolls
                [/fire_event]
#endif

            [/then]
            [else]
                [modify_side]
                    side=2
                    team_name=trolls
                [/modify_side]
#ifdef EASY
                [fire_event]
                    name=dwarves_defend_their_territory
                [/fire_event]
#endif
#ifdef NORMAL
                [fire_event]
                    name=dwarves_kill_elves
                [/fire_event]
#endif
#ifdef HARD
                [fire_event]
                    name=dwarves_kill_elves
                [/fire_event]
#endif

            [/else]
        [/if]
        {CLEAR_VARIABLE olurf_side}
        {VARIABLE offended_by_elves yes}

    [/event]

# start dwarven ai code

# TODO: AI C++ : add engine support for path=goal[*] for mass deleting
# TODO: AI C++ : consider adding the way to mass-delete all 'extra' stuff (via tags)
#define CLEAN_AI SIDE
    [modify_ai]
        side={SIDE}
        action=delete
        path=goal['kill_elves']
    [/modify_ai]
    [modify_ai]
        side={SIDE}
        action=delete
        path=goal['kill_trolls']
    [/modify_ai]
    [modify_ai]
        side={SIDE}
        action=delete
        path=goal['kill_trespassers']
    [/modify_ai] 
    [modify_ai]
        side={SIDE}
        action=delete
        path=stage['retreat_to_olurfs_land']
    [/modify_ai]
    [modify_ai]
        side={SIDE}
        action=delete
        path=aspect['avoid'].facet['stay_in_own_land']
    [/modify_ai]
#enddef

#define ADD_AVOID_STAY_AT_OLURFS_LAND
        [modify_ai]
             side=2
             action=add
             path=aspect['avoid'].facet
             [cfg]
                 id="stay_in_own_land"
                 [value]
                 {NOT_OLURFS_LAND}
                 [/value]
             [/cfg]
        [/modify_ai]
#enddef

#define ADD_GOAL_KILL_ELVES SIDE
    [modify_ai]
         side={SIDE}
         action=add
         path=goal
         [cfg]
            id=kill_elves
            [criteria]
                 side=1
            [/criteria]
            value=1.5
        [/cfg]
    [/modify_ai]
#enddef

#define ADD_GOAL_KILL_TROLLS SIDE
    [modify_ai]
         side={SIDE}
         action=add
         path=goal
         [cfg]
            id=kill_trolls
            [criteria]
                 side=3
            [/criteria]
            value=1.5
        [/cfg]
    [/modify_ai]
#enddef

#define ADD_GOAL_KILL_TRESPASSERS SIDE
    [modify_ai]
         side={SIDE}
         action=add
         path=goal
         [cfg]
            id=kill_trespassers
            [criteria]
                [not]
                    side={SIDE}  
                [/not]
            [/criteria]
            value=1.5
        [/cfg]
    [/modify_ai]
#enddef

#define ADD_STAGE_RETREAT_TO_OLURFS_LAND SIDE
    [modify_ai]
        side={SIDE}
        action=add
        path=stage[0]
        [cfg]
            id=retreat_to_olurfs_land
            name=testing_ai_default::candidate_action_evaluation_loop
            #TODO: add [candidate_action]s to make the retreat work
        [/cfg]
    [/modify_ai] 
#enddef

    [event]
        name=dwarves_watch_the_show
        first_time_only=no
        {CLEAN_AI 2}
        {ADD_AVOID_STAY_AT_OLURFS_LAND}
        [message]
            id=Olurf
            message= _ "Looks like it would be fun to watch... Just take care to not step on our territory" #TODO: text
        [/message]

    [/event]

    [event]
        name=dwarves_kill_elves
        first_time_only=no
        {CLEAN_AI 2}
        {ADD_GOAL_KILL_ELVES 2}
        [message]
            id=Olurf
            message= _ "Death to elves!" #TODO: text
        [/message]
    [/event]

    [event]
        name=dwarves_kill_trolls
        first_time_only=no
        {CLEAN_AI 2}
        {ADD_GOAL_KILL_TROLLS 2}
        [message]
            id=Olurf
            message= _ "Death to trolls!" #TODO: text
        [/message]
    [/event]

    [event]
        name=dwarves_kill_elves_and_trolls
        first_time_only=no
        {CLEAN_AI 2}
        {ADD_GOAL_KILL_ELVES 2}
        {ADD_GOAL_KILL_TROLLS 2}
        [message]
            id=Olurf
            message= _ "Kill them all!" #TODO: text
        [/message]
    [/event]

    [event]
        name=dwarves_defend_their_territory
        first_time_only=no
        {CLEAN_AI 2}
        {ADD_AVOID_STAY_AT_OLURFS_LAND}
        {ADD_GOAL_KILL_TRESPASSERS 2}
        {ADD_STAGE_RETREAT_TO_OLURFS_LAND 2}
        [message]
            id=Olurf
            message= _ "Defend our territory! Slay all trespassers!" #TODO: text
        [/message]
    [/event]

#undef CLEAN_AI
#undef ADD_AVOID_STAY_AT_OLURFS_LAND
#undef ADD_STAGE_RETREAT_TO_OLURFS_LAND
#undef ADD_GOAL_KILL_ELVES
#undef ADD_GOAL_KILL_TROLLS
#undef ADD_GOAL_KILL_TRESPASSERS

# end dwarven ai code

#undef NOT_OLURFS_LAND

    [event]
        name=victory
        {CLEAR_VARIABLE offended_by_elves}
    [/event]
    ### /Olurf's Code ###

    ### Enemy Side ###
    [side]
#ifdef EASY
        type=Troll Hero
#else
        type=Great Troll
#endif
        id=Grugl
        name=_ "Grugl"
        side=3
        team_name=trolls
        canrecruit=yes
#ifdef EASY
        recruit=Troll Whelp
#endif
#ifdef NORMAL
        recruit=Troll Whelp, Troll, Troll Rocklobber
#endif
#ifdef HARD
        recruit=Troll Whelp, Troll, Troll Rocklobber, Troll Warrior
#endif
        {GOLD 170 240 270}

        {ai/aliases/stable_singleplayer.cfg}
        [ai]
#ifdef EASY
            recruitment_pattern=fighter
#else
            recruitment_pattern=fighter,fighter,mixed fighter
#endif
            [goal]
                [criteria]
                    race=elf
                [/criteria]
                value=1.5
            [/goal]

            {AI_ASPECT aggression 0.75}
            [aspect]
                 id=caution
                 [facet]
                     time_of_day=dusk,first_watch,second_watch
                     value=0.0
                 [/facet]
            [/aspect]
            [aspect]
                 id=grouping
                 [facet]
                     time_of_day=dusk,first_watch,second_watch
                     value=no
                 [/facet]
            [/aspect]
        [/ai]
        {INCOME 4 8 12}
    [/side]
#undef OLURFS_LAND
#ifdef HARD
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Troll Warrior" 2}
#endif

    ### /Enemy Side ###

    #### Objectives and corresponding events ####
    [event]
        name=start
        [message]
            id=Kalenz
            message= _ "I had hoped to avoid these paths... The eastern way is through dwarvish territory and is shorter. I pray the dwarves will grant us safe passage, since the other path is through troll territory..."
        [/message]
        [message]
            id=Olurf
            message= _ "Not even in yer dreams, elf. These are dwarvish lands, and troubles we want no part of nip at yer heels. Get out and stay out!"
        [/message]
        [message]
            id=Landar
            message= _ "Our troubles will be yours, too, whether either of us will it or not. The orcs have come down from the north like a flood; if we squabble among ourselves they will feast on our discord."
        [/message]
        [message]
            id=Olurf
            message= _ "Bah. More smooth words and trickery, by my beard. We know yer kind...and who needs yer help anyway, weaklings? Leave now, or feel my axe! That same kiss of steel will greet all intruders. Anyone who sets foot on the eastern bank o' this river will rue the day he was born!"
        [/message]
        [message]
            id=Landar
            message= _ "I cannot see how trolls could be any less friendly."
        [/message]
        [message]
            id=Kalenz
            message= _ "Hmm... Perhaps the dwarves' intransigence can serve our purpose. Onwards, and no matter what you do, do NOT step on the eastern band of the river!"
        [/message]

        {HIGHLIGHT_IMAGE 18 37 scenery/signpost.png ()}

        [fire_event]
            name=dwarves_watch_the_show
        [/fire_event]

    [/event]

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                description= _ "Kalenz must reach the signpost"
                condition=win
            [/objective]
            [objective]
                description= _ "Defeat Grugl"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Landar"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Olurf"
                condition=lose
            [/objective]
            [objective]
                description= _ "Turns run out"
                condition=lose
            [/objective]
#ifndef EASY
            note={NO_EARLY_FINISH_BONUS_NOTE}
#endif
        [/objectives]
    [/event]

#define ENDSPEECH SPEAKER
        [message]
            speaker={SPEAKER}
            message= _ "We made it. Onwards to Wesmere!"
        [/message]
        [message]
            id=Olurf
            message= _ "Crazy elves! But at least they felled a few trolls before they left."
        [/message]
#enddef


    [event]
        name=moveto
        [filter]
            x=18
            y=37
            id=Kalenz
        [/filter]

        {ENDSPEECH unit}

        [endlevel]
            result=victory
#ifndef EASY
            bonus=no
#endif
        [/endlevel]
    [/event]

    [event]
        name=die
        [filter]
            id=Grugl
        [/filter]
        [message]
            id=Grugl
            # wmllint: local spelling Uuuurrrggghh
            message= _ "Uuuurrrggghh! Elves had too many sharp pointy things for Grugl to eat."
        [/message]

        {ENDSPEECH secondary_unit}
#undef ENDSPEECH
        [endlevel]
            result=victory
#ifndef EASY
            bonus=no
#endif
        [/endlevel]
    [/event]

    {campaigns/Legend_of_Wesmere/utils/deaths.cfg}
[/scenario]
