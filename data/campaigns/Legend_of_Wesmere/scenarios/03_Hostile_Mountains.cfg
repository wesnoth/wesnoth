#textdomain wesnoth-low
[scenario]
    id=03_Hostile_Mountains
    next_scenario=04_Kalian_under_Attack
    name= _ "Hostile Mountains"
    {LOW_MAP 03_Hostile_Mountains.map}
    victory_when_enemies_defeated=no
    carryover_percentage=40
    carryover_add=yes
    {DEFAULT_SCHEDULE_AFTERNOON}
    {TURNS 37 33 29}

    {INTRO_AND_SCENARIO_MUSIC sad.ogg northern_mountains.ogg}
    {EXTRA_SCENARIO_MUSIC                         knolls.ogg}
    {EXTRA_SCENARIO_MUSIC            traveling_minstrels.ogg}
    {EXTRA_SCENARIO_MUSIC           legends_of_the_north.ogg}
    {EXTRA_SCENARIO_MUSIC                  knalgan_theme.ogg}

    [story]
        [part]
            story= _ "Leaving the Great Northern Forest, Kalenz discovered that the lands along the path to the Ka’lian were already overrun by orcs. The raid on Lintanir seemed to be just part of a larger movement south. The elves had no choice but to make a detour through territory the elves would rather have avoided..."
        [/part]
    [/story]

    {LOW_TRACK {SCENARIO_3}}

#define OLURFS_LAND
    x="7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,23,24,25,26,27,28,29,30,31"
    y="22,22-23,22-23,21-24,20-24,18-24,18-25,16-25,16-26,13-26,12-26,12-26,11-29,10-30,10-30,9-32,10-23,25-36,11-36,11-37,11-36,11-36,11-33,11-32,11-33,11-33"
#enddef

    [side]
        side=1
        {SIDE_1_ESSENTIALS}
        {KALENZ_YOUNG}
        {SIDE_1_GOLD_FIXED 180 100}
        income=-2
        village_gold=1
        fog=no
        shroud=no
#ifndef MULTIPLAYER
        [unit]
            {LANDAR_YOUNG}
            location_id=2
        [/unit]
#endif
    [/side]

    [side]
        side=2
        {SIDE_2_ESSENTIALS}
        {LANDAR_YOUNG}
        gold=100
        income=-2
        village_gold=1
        fog=no
        shroud=no
    [/side]

    {STARTING_VILLAGES_ALL 3}

    [side]
        side=3
        {UNPLAYABLE_SIDE}
        team_name=trolls
        user_team_name= _ "Enemies"
        {FLAG_VARIANT undead}
#ifdef EASY
        type=Troll Hero
#else
        type=Great Troll
#endif
        id=Grugl
        name=_ "Grugl"
        canrecruit=yes
#ifdef EASY
        recruit=Troll Whelp
#endif
#ifdef NORMAL
        recruit=Troll Whelp, Troll, Troll Rocklobber, Troll Mentor
#endif
#ifdef HARD
        recruit=Troll Whelp, Troll, Troll Rocklobber, Troll Mentor, Troll Warrior
#endif
        {GOLD 170 240 270}
        {INCOME 4 8 12}
        [ai]
            recruitment_pattern="fighter, mixed fighter"
            aggression=0.75
            caution=0
            grouping=no

            [goal]
                [criteria]
                    race=elf
                [/criteria]
                value=1.5
            [/goal]
        [/ai]
    [/side]

#ifndef EASY
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Troll Mentor" 1}
#endif

    [side]
        side=4
        {UNPLAYABLE_SIDE}
        hidden=yes
        team_name=trolls
        user_team_name= _ "Enemies"
        {FLAG_VARIANT ragged}
        no_leader=yes
        [goal]
            [criteria]
                race=elf
            [/criteria]
            value=10
        [/goal]
    [/side]

    [side]
        side=5
        {UNPLAYABLE_SIDE}
        persistent=yes
        save_id=Olurf
#ifdef EASY
        team_name=player
        user_team_name= _ "Player"
#else
        team_name=player,trolls
        user_team_name= _ "Neutrals"
#endif
        {FLAG_VARIANT knalgan}
        {OLURF}
        {GOLD 150 120 120}
        recruit=Dwarvish Fighter, Dwarvish Scout, Dwarvish Thunderer, Dwarvish Ulfserker, Dwarvish Guardsman
        [ai]
            [avoid]
                [not]
                    {OLURFS_LAND}
                [/not]
            [/avoid]
        [/ai]
    [/side]

    [event]
        name=prestart

        {CAPTURE_VILLAGES_OF_TYPE *^Vhh 5 16 18 100}
        {CAPTURE_VILLAGES_OF_TYPE *^Vl 5 16 18 100}

        [micro_ai]
            side=3
            ai_type=healer_support
            action=add
            [filter]
                type=Troll Mentor
            [/filter]
            [filter_second]
                type=Troll Whelp
            [/filter_second]
            aggression=0.8
        [/micro_ai]
    [/event]

    [event]
        name=enter_hex
        first_time_only=yes
        [filter]
            side=1,2
            {OLURFS_LAND}
        [/filter]

        [cancel_action]
        [/cancel_action]

        {VARIABLE_OP offended_counter add 1}

        [message]
            id=Olurf
            message= _ "Those lying elves have stepped on <i>our</i> land!"
        [/message]

        [store_side]
            side=5
            variable=olurf_side
        [/store_side]

        [if]
            [variable]
                name=olurf_side.team_name
                equals=player
            [/variable]
            [then]
                [modify_side]
                    side=5
                    team_name=dwarves
                    user_team_name= _ "Enemies"
                [/modify_side]
            [/then]
            [else]
                [modify_side]
                    side=5
                    team_name=trolls
                    user_team_name= _ "Enemies"
                [/modify_side]
            [/else]
        [/if]

        {CLEAR_VARIABLE olurf_side}

        [switch]
            variable=offended_counter
            [case]
                value=1
                [message]
                    id=Olurf
                    message= _ "Up axes, and death to elves!"
                [/message]
            [/case]
            [case]
                value=2
                [message]
                    id=Olurf
                    message= _ "Up axes, and kill all the interlopers!"
                [/message]
            [/case]
            [case]
                value=3
                [message]
                    id=Olurf
                    message= _ "Defend our bounds! Slay all who trespass them!"
                [/message]
            [/case]
        [/switch]
    [/event]

    [event]
        name=enter_hex
        first_time_only=yes
        [filter]
            side=3
            {OLURFS_LAND}
        [/filter]

        [cancel_action]
        [/cancel_action]

        {VARIABLE_OP offended_counter add 1}

        [message]
            id=Olurf
            message= _ "Those stinking trolls ha’ stepped on <i>our</i> land!"
        [/message]

        [store_side]
            side=5
            variable=olurf_side
        [/store_side]

        [if]
            [variable]
                name=olurf_side.team_name
                equals=trolls
            [/variable]
            [then]
                [modify_side]
                    side=5
                    team_name=dwarves
                [/modify_side]
            [/then]
            [else]
                [modify_side]
                    side=5
                    team_name=player
                [/modify_side]
            [/else]
        [/if]

        [switch]
            variable=offended_counter
            [case]
                value=1
                [message]
                    id=Olurf
                    message= _ "Up axes, and death to trolls!"
                [/message]
            [/case]
            [case]
                value=2
                [message]
                    id=Olurf
                    message= _ "Up axes, and kill all the interlopers!"
                [/message]
            [/case]
            [case]
                value=3
                [message]
                    id=Olurf
                    message= _ "Defend our bounds! Slay all who trespass them!"
                [/message]
            [/case]
        [/switch]
    [/event]

    [event]
        name=enter_hex
        first_time_only=yes
        [filter]
            side=4
            {OLURFS_LAND}
        [/filter]

        [cancel_action]
        [/cancel_action]

        {VARIABLE_OP offended_counter add 1}

        [message]
            id=Olurf
            message= _ "Those filthy orcs ha’ stepped on <i>our</i> land!"
        [/message]

        [switch]
            variable=offended_counter
            [case]
                value=1
                [message]
                    id=Olurf
                    message= _ "Up axes, and death to trolls!"
                [/message]
            [/case]
            [case]
                value=2
                [message]
                    id=Olurf
                    message= _ "Up axes, and kill all the interlopers!"
                [/message]
            [/case]
            [case]
                value=3
                [message]
                    id=Olurf
                    message= _ "Defend our bounds! Slay all who trespass them!"
                [/message]
            [/case]
        [/switch]
    [/event]

    [event]
        name=scenario_end
        {CLEAR_VARIABLE offended_by_elves}
        {CLEAR_VARIABLE offended_by_trolls}
    [/event]

    [event]
        name=start

        [message]
            id=Kalenz
            message= _ "I had hoped to avoid these paths... The eastern way is through dwarvish territory and is shorter. I pray the dwarves will grant us safe passage, since the other path is through troll territory..."
        [/message]
        [message]
            id=Olurf
            message= _ "Not even in yer dreams, elf. These are dwarvish lands, and troubles we want no part of nip at yer heels. Get out and stay out!"
        [/message]
        [message]
            id=Landar
            message= _ "Our troubles will be yours, too, whether either of us wills it or not. The orcs have come down from the north like a flood; if we squabble among ourselves they will feast on our discord."
        [/message]
        [message]
            id=Olurf
            message= _ "Bah. More smooth words and trickery, by my beard. We know yer kind... and who needs yer help anyway, weaklings? Leave now, or feel my axe! That same kiss of steel will greet all intruders. Anyone who sets foot on the eastern bank o’ this river will rue the day he was born!"
        [/message]
        [message]
            id=Landar
            message= _ "I cannot see how trolls could be any less friendly."
        [/message]
        [message]
            id=Kalenz
            message= _ "Hmm... Perhaps the dwarves’ intransigence can serve our purpose. Onwards, and no matter what you do, do <i>not</i> step on the eastern bank of the river!"
        [/message]

        {HIGHLIGHT_IMAGE 27 39 scenery/signpost.png ()}

        [message]
            id=Olurf
            message= _ "It should be rare sport to watch this... Just be sure not to trespass on our land."
        [/message]

        [objectives]
            side=1,2
            [objective]
                description= _ "Kalenz or Landar must reach the signpost"
                condition=win
            [/objective]
            [objective]
                {ALTERNATIVE_OBJECTIVE_CAPTION}
                description= _ "Defeat Grugl"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Landar"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Olurf"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
            [note]
                description=_ "Do not step on the east bank of the river, lest you provoke Olurf’s anger upon yourself."
            [/note]
        [/objectives]
    [/event]

    [event]
        name=turn 13
        first_time_only=yes

        {UNIT 4 "Orcish Warrior" 27 1 (id=Pursuk
        name= _ "Pursuk"
        [modifications]
            {TRAIT_LOYAL_HERO}
        [/modifications])}
        {GENERIC_UNIT 4 "Orcish Grunt" 27 1}
        {GENERIC_UNIT 4 "Orcish Grunt" 27 1}
        {GENERIC_UNIT 4 "Orcish Grunt" 27 1}
        {GENERIC_UNIT 4 "Orcish Grunt" 27 1}
        {GENERIC_UNIT 4 "Goblin Pillager" 27 1}
#ifdef NORMAL
        {GENERIC_UNIT 4 "Orcish Archer" 27 1}
        {GENERIC_UNIT 4 "Goblin Impaler" 27 1}
#endif
#ifdef HARD
        {GENERIC_UNIT 4 "Orcish Crossbowman" 27 1}
        {GENERIC_UNIT 4 "Orcish Archer" 27 1}
        {GENERIC_UNIT 4 "Goblin Impaler" 27 1}
#endif
        {MODIFY_UNIT side=4 facing s}
        [message]
            id=Pursuk
            message= _ "So, the wolves weren’t wrong, a bunch of tree-huggers really escaped from the forest! Thought to ask the dwarves for help!"
        [/message]
        [message]
            id=Olurf
            message= _ "These elves are no allies of mine. Do with them as you wish, just don’t set foot on my land!"
        [/message]
        [message]
            id=Pursuk
            message= _ "Shut up, earthworm! We’ll gut you all!"
        [/message]
        [message]
            id=Landar
            message= _ "And here come the orcs! But it seems even that hasn’t convinced the stubborn dwarf leader."
        [/message]
        [message]
            id=Kalenz
            message= _ "The time will come when the dwarves understand what a terrible threat this is. For now, we continue our journey."
        [/message]
    [/event]

    [event]
        name=last_breath

        [filter]
            id=Pursuk
        [/filter]

        [filter_second]
            side=1,2
        [/filter_second]

        [message]
            speaker=second_unit
            message=_ "Take that! For Velon!"
        [/message]

        [set_achievement]
            content_for=low
            id=low_s3_revenge
        [/set_achievement]
    [/event]

#define ENDSPEECH SPEAKER_NAME
    [message]
        speaker={SPEAKER_NAME}
        message= _ "We made it. Onwards to Wesmere!"
    [/message]
    [message]
        id=Olurf
        message= _ "Crazy elves! But at least they felled a few trolls before they left."
    [/message]
#enddef

    [event]
        name=moveto
        [filter]
            x=27
            y=39
            [and]
                id=Kalenz
                [or]
                    id=Landar
                [/or]
            [/and]
        [/filter]

        {ENDSPEECH unit}

        [endlevel]
            [result]
                side=1,2
                result=victory
#ifdef MULTIPLAYER
                bonus=0.5
#else
                bonus=yes
#endif
                {NEW_GOLD_CARRYOVER 40}
            [/result]
            [result]
                side=5
                result=victory
                carryover_percentage=0
                bonus=0
            [/result]
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Grugl
        [/filter]
        [filter_second]
            race=dwarf
        [/filter_second]

        [message]
            id=Grugl
            # wmllint: local spelling Urgh
            message= _ "Urgh! Grugl tried to eat dwarves, but choked on their sharp nasty axes."
        [/message]

        [set_achievement]
            content_for=low
            id=low_s2_trolls
        [/set_achievement]

        {ENDSPEECH "Kalenz"}

        [endlevel]
            [result]
                side=1,2
                result=victory
#ifdef MULTIPLAYER
                bonus=0.5
#else
                bonus=yes
#endif
                {NEW_GOLD_CARRYOVER 40}
            [/result]
            [result]
                side=5
                result=victory
                carryover_percentage=0
                bonus=0
            [/result]
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Grugl
        [/filter]
        [filter_second]
            race=elf
        [/filter_second]

        [message]
            id=Grugl
            message= _ "Urgh! Grugl wanted tasty elf-meat, but choked on their nasty pointy spears!"
        [/message]

        [set_achievement]
            content_for=low
            id=low_s2_trolls
        [/set_achievement]

        {ENDSPEECH second_unit}
#undef ENDSPEECH
        [endlevel]
            [result]
                side=1,2
                result=victory
#ifdef MULTIPLAYER
                bonus=0.5
#else
                bonus=yes
#endif
                {NEW_GOLD_CARRYOVER 40}
            [/result]
            [result]
                side=5
                result=victory
                carryover_percentage=0
                bonus=0
            [/result]
        [/endlevel]
    [/event]
    {campaigns/Legend_of_Wesmere/utils/deaths.cfg}
[/scenario]
