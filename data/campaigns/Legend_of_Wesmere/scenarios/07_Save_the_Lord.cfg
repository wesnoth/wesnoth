#textdomain wesnoth-low
[scenario]
    id=07_Save_the_Lord
    next_scenario=08_Caverns_of_Saurgath
    name= _ "Save the Lord"
    {LOW_MAP 07_Save_the_Lord.map}
    {campaigns/Legend_of_Wesmere/maps/Saurgath_utils.cfg}
    victory_when_enemies_defeated=no
    carryover_percentage=40
    carryover_add=yes
    {DEFAULT_SCHEDULE}
    {TURNS 27 24 21}

    {INTRO_AND_SCENARIO_MUSIC revelation.ogg the_dangerous_symphony.ogg}
    {EXTRA_SCENARIO_MUSIC                         casualties_of_war.ogg}
    {EXTRA_SCENARIO_MUSIC                            the_city_falls.ogg}
    {EXTRA_SCENARIO_MUSIC                                    knolls.ogg}

    [story]
        [part]
            story= _ "The saurian’s trail led the heroes straight to the Swamp of Dread..."
            {LOW_BIGMAP}
        [/part]
        [part]
            sound=ambient/night.ogg
            story= _ "On the night before the battle, Cleodil dreamed of the elvish lord. A conversation began between them..."
        [/part]
        [part]
            background="portraits/erlornas.webp"
            scale_background=no
            story={CAPTION ( _ "Erlornas")} + _ "...This is too risky. Their squad is too small to break through the saurians. Dissuade him before it’s too late..."
        [/part]
        [part]
            background="story/characters/cleodil.webp"
            scale_background=no
            story={CAPTION ( _ "Cleodil")} + _ "Do not despair prematurely, my lord. Kalenz has already achieved the impossible, crossing hundreds of miles with his small squad and defending Ka’lian from the orcs. Perhaps fortune will smile upon him this time as well."
        [/part]
        [part]
            background="portraits/erlornas.webp"
            scale_background=no
            story={CAPTION ( _ "Erlornas")} + _ "It’s a pity we did not meet sooner. From your words, I understand he is one of those whose hearts hold a guiding star for our people. I could have taught him much..."
        [/part]
        [part]
            story= _ "At dawn, the heroes set out for the Great Sand Rampart, upon which stood the ancient city of Saurgrath..."
            {LOW_BIGMAP}
        [/part]
    [/story]

    {LOW_TRACK {SCENARIO_7} }

    [side]
        side=1
        {SIDE_1_ESSENTIALS}
        {KALENZ}
        {SIDE_1_GOLD_FIXED 280 200}
        income=-2
        village_gold=1
        fog=no
        shroud=no
        [unit]
            {CLEODIL_COMPANION}
            placement=leader
        [/unit]
#ifndef MULTIPLAYER
        [unit]
            {LANDAR}
            location_id=2
        [/unit]
#endif
    [/side]

    [side]
        side=2
        {SIDE_2_ESSENTIALS}
        {LANDAR}
        gold=200
        income=-2
        village_gold=1
        fog=no
        shroud=no
    [/side]

    {STARTING_VILLAGES 3 7}

    [side]
        side=3
        {UNPLAYABLE_SIDE}
        team_name=saurians
        user_team_name= _ "Lizards"
        {FLAG_VARIANT undead}
        type=Saurian Seer
        id=Xiez
        name=_ "Xiez"
        canrecruit=yes
        {GOLD 150 190 230}
        {INCOME 5 10 15}
#ifdef EASY
        recruit=Saurian Skirmisher, Saurian Augur, Giant Mudcrawler
#endif
#ifdef NORMAL
        recruit=Saurian Skirmisher, Saurian Augur, Giant Mudcrawler, Saurian Ambusher, LoW Saurian Impaler
#endif
#ifdef HARD
        recruit=Saurian Skirmisher, Saurian Augur, Giant Mudcrawler, Saurian Ambusher, Saurian Soothsayer, LoW Saurian Impaler
#endif
        [ai]
            passive_leader=yes
            recruitment_pattern="scout, scout, fighter, mixed fighter, healer"
            aggression=0.75
        [/ai]
    [/side]

    {STARTING_VILLAGES 4 6}

    [side]
        side=4
        {UNPLAYABLE_SIDE}
        team_name=saurians
        user_team_name= _ "Lizards"
        {FLAG_VARIANT undead}
        type=LoW Saurian Pikebearer
        id=Aneix
        name=_ "Aneix"
        {GOLD 170 200 250}
        {INCOME 5 10 15}
#ifdef EASY
        recruit=Saurian Skirmisher, Saurian Augur, Dragonfly
#endif
#ifdef NORMAL
        recruit=Saurian Skirmisher, Saurian Augur, Dragonfly, Saurian Ambusher
#endif
#ifdef HARD
        recruit=Saurian Skirmisher, Saurian Augur, Dragonfly, Saurian Ambusher, Saurian Soothsayer, LoW Saurian Impaler
#endif
        [ai]
            passive_leader=yes
            recruitment_pattern="scout, scout, fighter, mixed fighter, healer"
            aggression=0.75
        [/ai]
    [/side]

    {STARTING_VILLAGES 5 9}

    [side]
        side=5
        {UNPLAYABLE_SIDE}
        team_name=saurians
        user_team_name= _ "Lizards"
        {FLAG_VARIANT undead}
        {GOLD 75 125 175}
        {INCOME 5 10 15}
        type=Saurian Ambusher
        id=Kleer
        name=_ "Kleer"
#ifdef EASY
        recruit=Saurian Skirmisher, Saurian Augur
#else
        recruit=Saurian Skirmisher, Saurian Augur, Saurian Ambusher, LoW Saurian Impaler
#endif
        [ai]
            passive_leader=yes
            recruitment_pattern="scout, scout, healer, fighter"
            aggression=0.75
        [/ai]
    [/side]

    [side]
        side=6
        {UNPLAYABLE_SIDE}
        team_name=saurians
        user_team_name= _ "Lizards"
        {FLAG_VARIANT undead}
        no_leader=yes
        gold=0
        income=-2
        hidden=yes
#ifdef EASY
        recruit=Saurian Skirmisher, Saurian Augur
#else
        recruit=Saurian Skirmisher, Saurian Augur, Saurian Ambusher, LoW Saurian Impaler
#endif
        [ai]
            passive_leader=yes
            recruitment_pattern="scout, scout, healer, fighter"
            aggression=0.75
        [/ai]
    [/side]

    [side]
        side=7
        {UNPLAYABLE_SIDE}
        team_name=saurians
        user_team_name= _ "Lizards"
        {FLAG_VARIANT undead}
        no_leader=yes
        gold=0
        income=-2
        hidden=yes
#ifdef EASY
        recruit=Saurian Skirmisher, Saurian Augur
#else
        recruit=Saurian Skirmisher, Saurian Augur, Saurian Ambusher, LoW Saurian Impaler
#endif
        [ai]
            passive_leader=yes
            recruitment_pattern="scout, scout, healer, fighter"
            aggression=0.75
        [/ai]
    [/side]

    [event]
        name=prestart

        {PLACE_IMAGE "items/dummy.png~RC(magenta<red)" 21 22}
        {PLACE_IMAGE "units/elves-wood/high-lord.png~RC(magenta>red)~BLIT(items/cage.png)" 29 19}

        {UNIT 3 "Saurian Ambusher" 29 18 (
            [modifications]
                {MOVE_TO_CASTLE_ONLY}
            [/modifications]
        )}

        {UNIT 4 "Saurian Ambusher" 30 19 (
            [modifications]
                {MOVE_TO_CASTLE_ONLY}
            [/modifications]
        )}

        {UNIT 5 "Saurian Ambusher" 28 19 (
            [modifications]
                {MOVE_TO_CASTLE_ONLY}
            [/modifications]
        )}

        {MODIFY_UNIT side=1,2 facing se}
        {MODIFY_UNIT side=3 facing sw}
        {MODIFY_UNIT side=4,5 facing nw}
    [/event]

    [event]
        name=start

        [message]
            id=Landar
            message= _ "So this hole is the saurian capital? I imagined something more... impressive."
        [/message]

        [scroll_to_unit]
            side=3
            canrecruit=yes
        [/scroll_to_unit]

        [delay]
            time=500
        [/delay]

        [scroll_to_unit]
            side=5
            canrecruit=yes
        [/scroll_to_unit]

        [delay]
            time=500
        [/delay]

        [message]
            speaker=Cleodil
            message=_ "These green creatures spend their short lives on war and plunder. They know nothing of the joy of creation."
        [/message]
        [message]
            speaker=Landar
            message=_ "Since they don’t value their lives, we won’t spare them."
        [/message]
        [message]
            speaker=Cleodil
            message=_ "The saurians are holding the lord in the tower by the sand barrier. We must hurry there."
        [/message]

        [scroll_to]
            x,y=29,19
        [/scroll_to]

        {HIGHLIGHT_IMAGE 29 19 "units/elves-wood/high-lord.png~RC(magenta>red)~BLIT(items/cage.png)" ()}

        [message]
            side=5
            canrecruit=yes
            message=_ "Look! A bunch of worthless elves have come for their lord!"
        [/message]
        [message]
            side=4
            canrecruit=yes
            message=_ "Soon they will be reunited! All together will be our slaves!"
        [/message]

        [objectives]
            side=1,2
            [objective]
                caption= _ "Your first task:"
                description= _ "Move Kalenz or Landar to the cell to free Erlornas"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Landar"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Cleodil"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                carryover_percentage=40
                bonus=yes
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=attacks
        [filter_second]
            id=Cleodil
        [/filter_second]
        [message]
            speaker=unit
            message= _ "Prepare to die, elven witch!"
        [/message]
        [message]
            id=Kalenz
            message= _ "I will slay any who harms her without mercy."
        [/message]
        [message]
            id=Cleodil
            message= _ "Nor will you find me an easy foe!"
        [/message]
    [/event]

    [event]
        name=moveto
        first_time_only=yes

        [filter]
            id=Kalenz
            x,y=29,19
            [or]
                id=Landar
                x,y=29,19
            [/or]
        [/filter]

        {REMOVE_IMAGE 29 19}

        [unit]
            {ERLORNAS}
            x,y=29,19
            experience=67
            side=$unit.side
            animate=yes
        [/unit]

        [message]
            speaker=Erlornas
            message= _ "I can’t believe you actually made it here!"
        [/message]

        {GENERIC_UNIT 6 "Saurian Flanker" 1 1}
        [+unit]
            canrecruit=yes
            id=Hizz
            name= _ "Hizz"
        [/unit]
        {MOVE_UNIT x,y=1,1 3 2}
        [terrain]
            x,y,radius=3,2,1
            terrain=Ce
        [/terrain]
        [terrain]
            x,y=3,2
            terrain=Ke
        [/terrain]
        [redraw][/redraw]

        [modify_side]
            side=6
            hidden=no
            {GOLD 200 240 280}
        [/modify_side]

        {REPEAT 4 (
            {GENERIC_UNIT 6 "Saurian Ambusher" 3 2}
        )}

        {GENERIC_UNIT 7 "Saurian Flanker" 1 25}
        [+unit]
            canrecruit=yes
        [/unit]
        {MOVE_UNIT x,y=1,25 4 23}
        [terrain]
            x,y,radius=4,23,1
            terrain=Ce
        [/terrain]
        [terrain]
            x,y=4,23
            terrain=Ke
        [/terrain]
        [redraw][/redraw]
        {REPEAT 4 (
            {GENERIC_UNIT 7 "Saurian Ambusher" 4 23})}

            [modify_side]
                side=7
                hidden=no
                {GOLD 200 240 280}
            [/modify_side]

            [message]
                side=3,4,5
                canrecruit=yes
                [or]
                    side=3,4,5
                [/or]
                [not]
                    id=Hizz
                [/not]
                message=_ "And here is our army! Vile elves, you are surrounded!"
            [/message]
            [message]
                speaker=Hizz
                message=_ "Impale them on spears!"
            [/message]
            [message]
                speaker=unit
                message=_ "The saurians have cut off our way back! What do we do?"
            [/message]
            [message]
                speaker=Erlornas
                message=_ "There is another way – quickly, into the cave!"
            [/message]

            {HIGHLIGHT_IMAGE 33 2 items/gohere.png ()}

            [message]
                speaker=Kalenz
                message=_ "Are you sure, my lord? We don’t know where it leads."
            [/message]
            [message]
                speaker=Erlornas
                message=_ "I have seen it in the dreams of the saurians, it leads to the northern lands. Forward, before it’s too late!"
            [/message]

            [modify_turns]
                add=10
            [/modify_turns]

            [objectives]
                side=1,2
                [objective]
                    caption= _ "Final task:"
                    description= _ "Move Erlornas to the cave"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Death of Kalenz"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Landar"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Cleodil"
                    condition=lose
                [/objective]
                {TURNS_RUN_OUT}
                [gold_carryover]
                    carryover_percentage=40
                    bonus=yes
                [/gold_carryover]
            [/objectives]
        [/event]

        [event]
            name=moveto
            first_time_only=yes

            [filter]
                id=Erlornas
                [filter_location]
                    x,y=33,2
                [/filter_location]
            [/filter]

            [message]
                speaker=unit
                message=_ "Go down, I will lead you out."
            [/message]
            [message]
                speaker=Landar
                message=_ "I don’t know what awaits us in this cave, but it can hardly be worse than fighting a horde of saurians in the swamps!"
            [/message]
            [message]
                speaker=Kalenz
                message=_ "Let’s trust the lord, forward!"
            [/message]

            [endlevel]
                result=victory
#ifdef MULTIPLAYER
                bonus=0.5
#else
                bonus=yes
#endif
                {NEW_GOLD_CARRYOVER 40}
            [/endlevel]

            [store_unit]
                [filter]
                    id=Erlornas
                [/filter]
                kill=no
                variable=erlornas_stored
            [/store_unit]
        [/event]

        {campaigns/Legend_of_Wesmere/utils/deaths.cfg}
    [/scenario]
