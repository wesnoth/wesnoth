#textdomain wesnoth-low
[scenario]
    id=25_The_Turmoil
    next_scenario=26_Northern_Battle
    name= _ "The Turmoil"
    {LOW_MAP 25_The_Turmoil.map}
    victory_when_enemies_defeated=no
    carryover_percentage=40
    carryover_add=yes
    {TURNS 25 23 22}
    {DEFAULT_SCHEDULE}
    current_time=2

    {INTRO_AND_SCENARIO_MUSIC transience.ogg knolls.ogg}
    {EXTRA_SCENARIO_MUSIC vengeful.ogg}
    {EXTRA_SCENARIO_MUSIC the_city_falls.ogg}

    [story]
        [part]
            story= _ "The heroes ran through the forest, not sparing their legs. Rebels’ arrows flew after them. Finally, they managed to break away and take a short rest."
            {LOW_BIGMAP}
        [/part]
        [part]
            story= _ "Suddenly, a familiar figure of a Wesmere elf appeared from the thicket..."
            {LOW_BIGMAP}
        [/part]
    [/story]

    {LOW_TRACK {SCENARIO_23A}}

    # wmllint: validate-off
    [side]
        side=1
        {SIDE_1_ESSENTIALS}
        {KALENZ_LORD}
        {SIDE_1_GOLD_FIXED 225 140}
        income=-2
        fog=yes
        shroud=yes
        [unit]
            {GALTRID_COMPANION}
            x,y=13,35
        [/unit]
#ifndef MULTIPLAYER
        [unit]
            {CLEODIL_INLOVE}
            location_id=2
        [/unit]
#endif
    [/side]

    [side]
        side=2
        {SIDE_2_ESSENTIALS}
        {CLEODIL_INLOVE}
        gold=140
        income=-2
        fog=yes
        shroud=yes
    [/side]

    [side]
        side=3
        {UNPLAYABLE_SIDE}
        team_name=assassins
        user_team_name= _ "Enemies"
        {FLAG_VARIANT long}
        no_leader=yes
        [ai]
            passive_leader=yes
            [goal]
                name=target_unit
                [criteria]
                    id=Kalenz
                [/criteria]
                value=50
            [/goal]
            [goal]
                name=target_unit
                [criteria]
                    id=Kalenz
                [/criteria]
                value=50
            [/goal]
        [/ai]
    [/side]

    [event]
        name=prestart

        {NEED_KALENZ_LORD}
        {NEED_CLEODIL_LEADER}

        [store_unit]
            [filter]
                id=Eradion
                search_recall_list=yes
            [/filter]
            kill=yes
            variable=eradion_stored
        [/store_unit]

        {VARIABLE left_spawn_x 1}
        {VARIABLE left_spawn_y 40}

        {VARIABLE right_spawn_x 25}
        {VARIABLE right_spawn_y 40}
    [/event]

    [event]
        name=moveto
        [filter]
            id=Kalenz,Cleodil
            x=1-14
            y=1-25
        [/filter]

        {VARIABLE left_spawn_x 1}
        {VARIABLE left_spawn_y 18}
    [/event]

    [event]
        name=moveto
        [filter]
            id=Kalenz,Cleodil
            x=14-25
            y=1-25
        [/filter]

        {VARIABLE right_spawn_x 25}
        {VARIABLE right_spawn_y 17}
    [/event]

    [event]
        name=start

        {MOVE_UNIT id=Galtrid 13 38}

        [message]
            speaker=Galtrid
            message= _ "Lower your weapons, friends! It’s me — Galtrid!"
        [/message]
        [message]
            speaker=Kalenz
            message= _ "Galtrid? I was afraid you had joined the rebellion. What happened in Wesmere?"
        [/message]
        [message]
            speaker=Galtrid
            message= _ "Wesmere has plunged into darkness, Kalenz. Landar slaughtered the Council lords and seized power. Many elves acknowledged him, but there were also those who were outraged. His supporters killed them and threw their bodies from the walls. The River Telfar ran red with blood... At first, I dared not oppose him because of our friendship. But when he ordered you killed, I realized that was a mistake. No, I will not spare my life to stop this barbarism!"
        [/message]
        [message]
            speaker=Cleodil
            message= _ "It sickens me that our people have become like orcs. How did we come to this? But I am glad that among the elves of Wesmere, there are still those who did not succumb to evil."
        [/message]
        [message]
            speaker=Galtrid
            message= _ "Unfortunately, Eradion is not among them. He supported Landar with far greater zeal than I did, and now he leads one of his armies."
        [/message]
        [message]
            speaker=Kalenz
            message= _ "I am sorry to hear that. He seemed to me a brave and ambitious warrior."
        [/message]
        [message]
            speaker=Galtrid
            message= _ "Landar appealed to our courage and honor. That’s why those like Eradion followed him..."
        [/message]
        [message]
            speaker=Cleodil
            message= _ "Careful, we’re being watched!"
        [/message]

        {GENERIC_UNIT 3 "Elvish Fighter" 5 33}
        {MOVE_UNIT type="Elvish Fighter" 8 33}

        [message]
            side=3
            message= _ "Traitors, you are surrounded! Surrender, in the name of Landar!"
        [/message]
        [message]
            speaker=Kalenz
            message= _ "Let Landar lay down his arms and come out to us. I will speak with him as a friend."
        [/message]
        [message]
            side=3
            message= _ "The lord has nothing to say to you. If you will not surrender — then you will die!"
        [/message]
        {MOVE_UNIT type="Elvish Fighter" 5 33}
        [kill]
            type="Elvish Fighter"
            animate=no
        [/kill]
        [message]
            speaker=Kalenz
            message= _ "Hurry, we must reach the capital before these lands are overrun by Landar’s army."
        [/message]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message= _ "Along with Galtrid, your veterans have returned to you."
        [/message]

        [objectives]
            side=0
            [objective]
                description= _ "Move Kalenz to the end of the road"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Cleodil"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Galtrid"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}

            [gold_carryover]
                carryover_percentage=0
                bonus=yes
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=new turn
        first_time_only=no

        [if]
            [not]
                [have_unit]
                    side=3
                    canrecruit=no
                    count=20-9999
                [/have_unit]
            [/not]
            [and]
                [not]
                    [variable]
                        name=turn_number
                        equals=1
                    [/variable]
                [/not]
            [/and]
            [then]
                {GENERIC_UNIT 3 "Elvish Fighter" $left_spawn_x $left_spawn_y}
                {GENERIC_UNIT 3 "Elvish Archer" $left_spawn_x $left_spawn_y}
                {GENERIC_UNIT 3 "Elvish Scout" $left_spawn_x $left_spawn_y}

                {GENERIC_UNIT 3 "Elvish Fighter" $right_spawn_x $right_spawn_y}
                {GENERIC_UNIT 3 "Elvish Archer" $right_spawn_x $right_spawn_y}
                {GENERIC_UNIT 3 "Elvish Scout" $right_spawn_x $right_spawn_y}
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto,enter hex

        [filter]
            side=1,2
            y=1-14
        [/filter]

        [if]
            [variable]
                name=eradion_stored.hitpoints
                greater_than_equal_to=1
            [/variable]
            [then]
                [unstore_unit]
                    variable=eradion_stored
                    x,y=13,2
                [/unstore_unit]
                {MODIFY_UNIT id=Eradion side 3}
            [/then]
            [else]
                [unit]
                    side=3
                    {ERADION_COMPANION}
                    x,y=13,2
                [/unit]
            [/else]
        [/if]
    [/event]

    [event]
        name=sighted

        [filter]
            id=Eradion
        [/filter]
        [filter_second]
            side=1,2
        [/filter_second]

        {INCIDENTAL_MUSIC sad.ogg}

        [remove_shroud]
            side=1,2
            x,y,radius=13,2,2
        [/remove_shroud]
        [lift_fog]
            side=1,2
            x,y,radius=13,2,2
        [/lift_fog]
        [redraw][/redraw]

        {GENERIC_UNIT 3 {ON_DIFFICULTY "Elvish Hero" "Elvish Hero" "Elvish Champion"} 12 2}
        [+unit]
            animate=yes
        [/unit]
        {GENERIC_UNIT 3 {ON_DIFFICULTY "Elvish Hero" "Elvish Hero" "Elvish Champion"} 14 2}
        [+unit]
            animate=yes
        [/unit]
        {GENERIC_UNIT 3 {ON_DIFFICULTY "Elvish Fighter" "Elvish Fighter" "Elvish Hero"} 11 2}
        [+unit]
            animate=yes
        [/unit]
        {GENERIC_UNIT 3 {ON_DIFFICULTY "Elvish Fighter" "Elvish Fighter" "Elvish Hero"} 15 2}
        [+unit]
            animate=yes
        [/unit]
        {GENERIC_UNIT 3 {ON_DIFFICULTY "Elvish Archer" "Elvish Archer" "Elvish Marksman"} 10 2}
        [+unit]
            animate=yes
        [/unit]
        {GENERIC_UNIT 3 {ON_DIFFICULTY "Elvish Archer" "Elvish Archer" "Elvish Marksman"} 16 2}
        [+unit]
            animate=yes
        [/unit]

        [message]
            speaker=Eradion
            message= _ "You shall go no further, Kalenz. Your journey ends here."
        [/message]
        [message]
            speaker=Kalenz
            message= _ "Step aside, Eradion. I do not wish to harm you."
        [/message]
        [message]
            speaker=Eradion
            message= _ "I cannot let you pass. Draw your blade, Kalenz! Let steel decide!"
        [/message]

        [modify_side]
            side=3
            [ai]
                passive_leader=no
                leader_ignores_keep=yes
            [/ai]
        [/modify_side]

        [objectives]
            side=0
            [objective]
                description= _ "Defeat Eradion"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Cleodil"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Galtrid"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}

            [gold_carryover]
                carryover_percentage=0
                bonus=yes
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=last breath

        [filter]
            id=Eradion
        [/filter]

        [message]
            speaker=Eradion
            message= _ "So, I am destined to fall by your hand, Kalenz..."
        [/message]
        [message]
            speaker=Kalenz
            message= _ "No, Eradion. Rise! I will not kill you."
        [/message]
        [message]
            speaker=Eradion
            message= _ "But why? For I have become your enemy."
        [/message]
        [message]
            speaker=Kalenz
            message= _ "I have no enemies among the elves."
        [/message]
        [message]
            speaker=Eradion
            message= _ "I do not know what shadow clouded my mind... Let us speak of this in a safe place. I will help you avoid the ambushes."
        [/message]

        {MODIFY_UNIT find_in=unit hitpoints 1}
        {MODIFY_UNIT find_in=unit side {MP_LANDAR_SIDE}}

        [message]
            speaker=Eradion
            message= _ ""
        [/message]

        [endlevel]
            result=victory
        [/endlevel]
    [/event]
    {campaigns/Legend_of_Wesmere/utils/deaths.cfg}
[/scenario]
